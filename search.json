[{"title":"CentOS--su和sudo","url":"/2018/05/01/CentOS--su%E5%92%8Csudo/","content":"<h5 id=\"su命令\"><a href=\"#su命令\" class=\"headerlink\" title=\"su命令\"></a>su命令</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">su - root</span><br></pre></td></tr></table></figure>\n<p>一旦在使用su命令登录root，用户获取了系统的绝对管理权限</p>\n<h6 id=\"只允许特定用户使用该su命令\"><a href=\"#只允许特定用户使用该su命令\" class=\"headerlink\" title=\"只允许特定用户使用该su命令\"></a>只允许特定用户使用该su命令</h6><p>要做到这一点，编辑插入式验证模块为（PAM）配置文件&#x2F;etc&#x2F;pam.d&#x2F;su 在文本编辑器中打开该文件，取消注释：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#auth           required        pam_wheel.so use_uid</span></span><br></pre></td></tr></table></figure>\n<p>将用户添加到名为wheel的特殊管理组</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">usermod -a -G wheel username</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h5 id=\"sudo命令\"><a href=\"#sudo命令\" class=\"headerlink\" title=\"sudo命令\"></a>sudo命令</h5><p>只有&#x2F;etc&#x2F;sudoers配置文件中列出的用户才可以使用该sudo命令，命令在用户的 shell中执行，而不是在rootshell中执行。这意味着root可以完全禁用shell。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">ls</span> /root</span><br></pre></td></tr></table></figure>\n<p>每个使用该sudo命令的成功身份验证都会记录到&#x2F;var&#x2F;log&#x2F;messages，并将的用户和发出的命令记录到文件&#x2F;var&#x2F;log&#x2F;secure中。</p>\n<h6 id=\"x2F-var-x2F-log-x2F-secure\"><a href=\"#x2F-var-x2F-log-x2F-secure\" class=\"headerlink\" title=\"&#x2F;var&#x2F;log&#x2F;secure\"></a>&#x2F;var&#x2F;log&#x2F;secure</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> /var/log/secure <span class=\"comment\">#查看记录</span></span><br></pre></td></tr></table></figure>\n<p>如果需要额外的日志记录，请使用该pam_tty_audit模块为指定用户启用TTY审计，方法是将以下行添加到&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">session required pam_tty_audit.so <span class=\"built_in\">disable</span>=pattern <span class=\"built_in\">enable</span>=pattern</span><br></pre></td></tr></table></figure>\n<p>其中pattern表示逗号分隔的用户列表，以下配置将启用root用户的TTY审计，并禁用所有其他用户</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">session required pam_tty_audit.so <span class=\"built_in\">disable</span>=* <span class=\"built_in\">enable</span>=root</span><br></pre></td></tr></table></figure>\n<h6 id=\"权限管理\"><a href=\"#权限管理\" class=\"headerlink\" title=\"权限管理\"></a>权限管理</h6><p>要赋予某人完全的管理权限：</p>\n<p>用visudo命令编辑&#x2F;etc&#x2F;sudoers</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">gabe ALL =（ALL）ALL      <span class=\"comment\">#允许gabe使用sudo执行任何命令</span></span><br></pre></td></tr></table></figure>\n<p>赋予部分管理权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">%<span class=\"built_in\">users</span>  ALL=/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom  <span class=\"comment\">#允许users组中的成员执行执行的挂载磁盘命令</span></span><br></pre></td></tr></table></figure>\n<p>不需要输入sudo密码执行一组命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Cmnd_Alias SYS_BACKUP = /bin/su - root -c /usr/locale/sbin/sys_backup.sh,/mnt/cdrom</span><br><span class=\"line\">insmsop1 ALL=(ALL)     NOPASSWD: SYS_BACKUP　</span><br></pre></td></tr></table></figure>\n<h6 id=\"配置sudo记录密码的时间\"><a href=\"#配置sudo记录密码的时间\" class=\"headerlink\" title=\"配置sudo记录密码的时间\"></a>配置sudo记录密码的时间</h6><p>sudo将密码保存五分钟的超时时间。在此期间对该命令的任何后续使用都不会提示用户输入密码。添加下面的一行将修改时间</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Defaults    timestamp_timeout=value    <span class=\"comment\">#value=0,每次sudo都需要输入密码</span></span><br></pre></td></tr></table></figure>\n<p>如果某个帐户遭到入侵，攻击者可以使用以下sudo管理权限打开一个新的shell：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo /bin/bash  <span class=\"comment\">#绕过/etc/sudoers文件中指定的超时时间，并且永远不要求攻击者sudo再次输入密码</span></span><br></pre></td></tr></table></figure>\n","tags":["centos"]},{"title":"CentOS7 搭建 FTP 文件服务","url":"/2018/02/26/CentOS7%20%E6%90%AD%E5%BB%BA%20FTP%20%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1/","content":"<h5 id=\"安装并启动-FTP-服务\"><a href=\"#安装并启动-FTP-服务\" class=\"headerlink\" title=\"安装并启动 FTP 服务\"></a>安装并启动 FTP 服务</h5><h6 id=\"安装-VSFTPD\"><a href=\"#安装-VSFTPD\" class=\"headerlink\" title=\"安装 VSFTPD\"></a>安装 VSFTPD</h6><p>使用 yum 安装 vsftpd</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y vsftpd</span><br></pre></td></tr></table></figure>\n<h6 id=\"启动-VSFTPD\"><a href=\"#启动-VSFTPD\" class=\"headerlink\" title=\"启动 VSFTPD\"></a>启动 VSFTPD</h6><p>安装完成后，启动 FTP 服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service vsftpd start</span><br></pre></td></tr></table></figure>\n<p>启动后，可以看到系统已经监听了 21 端口：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">netstat -nltp | grep 21</span><br></pre></td></tr></table></figure>\n<p>此时，访问 <a href=\"ftp://192.168.3.16/\">ftp://192.168.3.16</a> 可浏览机器上的 &#x2F;var&#x2F;ftp目录了。</p>\n<span id=\"more\"></span>\n\n<h5 id=\"配置-FTP-权限\"><a href=\"#配置-FTP-权限\" class=\"headerlink\" title=\"配置 FTP 权限\"></a>配置 FTP 权限</h5><h6 id=\"了解-VSFTP-配置\"><a href=\"#了解-VSFTP-配置\" class=\"headerlink\" title=\"了解 VSFTP 配置\"></a>了解 VSFTP 配置</h6><p>vsftpd 的配置目录为 &#x2F;etc&#x2F;vsftpd，包含下列的配置文件：</p>\n<p>vsftpd.conf 为主要配置文件<br>ftpusers 配置禁止访问 FTP 服务器的用户列表<br>user_list 配置用户访问控制</p>\n<h6 id=\"阻止匿名访问和切换根目录\"><a href=\"#阻止匿名访问和切换根目录\" class=\"headerlink\" title=\"阻止匿名访问和切换根目录\"></a>阻止匿名访问和切换根目录</h6><p>匿名访问和切换根目录都会给服务器带来安全风险，我们把这两个功能关闭。</p>\n<p>编辑 &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf，找到下面两处配置并修改：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 禁用匿名用户  12 YES 改为NO</span></span><br><span class=\"line\">anonymous_enable=NO</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁止切换根目录 101 行 删除#</span></span><br><span class=\"line\">chroot_local_user=YES</span><br></pre></td></tr></table></figure>\n\n<p>编辑完成后保存配置，重新启动 FTP 服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service vsftpd restart</span><br></pre></td></tr></table></figure>\n<h6 id=\"创建-FTP-用户\"><a href=\"#创建-FTP-用户\" class=\"headerlink\" title=\"创建 FTP 用户\"></a>创建 FTP 用户</h6><p>创建一个用户 ftpuser</p>\n<p>useradd ftpuser<br>为用户 ftpuser 设置密码</p>\n<p>echo “password” | passwd ftpuser –stdin</p>\n<h6 id=\"限制该用户仅能通过-FTP-访问\"><a href=\"#限制该用户仅能通过-FTP-访问\" class=\"headerlink\" title=\"限制该用户仅能通过 FTP 访问\"></a>限制该用户仅能通过 FTP 访问</h6><p>限制用户 ftpuser只能通过 FTP 访问服务器，而不能直接登录服务器：</p>\n<p>usermod -s &#x2F;sbin&#x2F;nologin ftpuser</p>\n<h6 id=\"为用户分配主目录\"><a href=\"#为用户分配主目录\" class=\"headerlink\" title=\"为用户分配主目录\"></a>为用户分配主目录</h6><p>为用户 ftpuser创建主目录并约定：</p>\n<p>&#x2F;data&#x2F;ftp 为主目录, 该目录不可上传文件<br>&#x2F;data&#x2F;ftp&#x2F;pub 文件只能上传到该目录下</p>\n<p>在&#x2F;data中创建相关的目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /data/ftp/pub</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"创建登录欢迎文件\"><a href=\"#创建登录欢迎文件\" class=\"headerlink\" title=\"创建登录欢迎文件\"></a>创建登录欢迎文件</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Welcome to use FTP service.&quot;</span> &gt; /data/ftp/welcome.txt</span><br></pre></td></tr></table></figure>\n<p>设置访问权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> a-w /data/ftp &amp;&amp; <span class=\"built_in\">chmod</span> 777 -R /data/ftp/pub</span><br></pre></td></tr></table></figure>\n<p>设置为用户的主目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">usermod -d /data/ftp ftpuser</span><br></pre></td></tr></table></figure>\n\n\n<h5 id=\"访问FTP\"><a href=\"#访问FTP\" class=\"headerlink\" title=\"访问FTP\"></a>访问FTP</h5><p>根据您个人的工作环境，选择一种方式来访问已经搭建的 FTP 服务</p>\n<p>注意：记得关闭防火墙或者开放FTP默认端口(21)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 关闭SELinux服务</span></span><br><span class=\"line\">setenforce 0</span><br><span class=\"line\"><span class=\"comment\"># 关闭防火墙</span></span><br><span class=\"line\">iptables -F</span><br></pre></td></tr></table></figure>\n<p>通过 Windows 资源管理器访问<br>Windows 用户可以复制下面的链接<br>到资源管理器的地址栏访问：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ftp://ftpuser:password@192.168.1.170</span><br></pre></td></tr></table></figure>\n<p>其中ftpuser为登录FTP的用户名，password为登录FTP的密码</p>\n","tags":["centos","ftp"]},{"title":"CentOS7下安装Python3及Pip3并保留Python2","url":"/2018/01/02/CentOS7%E4%B8%8B%E5%AE%89%E8%A3%85Python3%E5%8F%8APip3%E5%B9%B6%E4%BF%9D%E7%95%99Python2/","content":"<h5 id=\"安装依赖环境\"><a href=\"#安装依赖环境\" class=\"headerlink\" title=\"安装依赖环境\"></a>安装依赖环境</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"浏览器打开-https-www-python-org-ftp-python-查看最新的Python版本，标记为3-A-B\"><a href=\"#浏览器打开-https-www-python-org-ftp-python-查看最新的Python版本，标记为3-A-B\" class=\"headerlink\" title=\"浏览器打开 https://www.python.org/ftp/python/ 查看最新的Python版本，标记为3.A.B\"></a>浏览器打开 <a href=\"https://www.python.org/ftp/python/\">https://www.python.org/ftp/python/</a> 查看最新的Python版本，标记为3.A.B</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https://www.python.org/ftp/python/3.A.B/Python-3.A.B.tgz</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<h5 id=\"创建Python3的目录\"><a href=\"#创建Python3的目录\" class=\"headerlink\" title=\"创建Python3的目录\"></a>创建Python3的目录</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/python3</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"解压下载文件并切换目录\"><a href=\"#解压下载文件并切换目录\" class=\"headerlink\" title=\"解压下载文件并切换目录\"></a>解压下载文件并切换目录</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -zxvf Python-3.A.B.tgz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> Python-3.A.B</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"执行\"><a href=\"#执行\" class=\"headerlink\" title=\"执行\"></a>执行</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./configure --prefix=/usr/local/python3</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"创建Python3的软链接\"><a href=\"#创建Python3的软链接\" class=\"headerlink\" title=\"创建Python3的软链接\"></a>创建Python3的软链接</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/python3/bin/python3 /usr/bin/python3</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"创建Pip3的软链接\"><a href=\"#创建Pip3的软链接\" class=\"headerlink\" title=\"创建Pip3的软链接\"></a>创建Pip3的软链接</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/python3/bin/pip3 /usr/bin/pip3</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"测试命令-python3-和-pip3\"><a href=\"#测试命令-python3-和-pip3\" class=\"headerlink\" title=\"测试命令 python3 和 pip3\"></a>测试命令 python3 和 pip3</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">python3</span><br><span class=\"line\">pip3</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"因为执行yum需要python2版本，所以我们还要修改yum的配置，执行：\"><a href=\"#因为执行yum需要python2版本，所以我们还要修改yum的配置，执行：\" class=\"headerlink\" title=\"因为执行yum需要python2版本，所以我们还要修改yum的配置，执行：\"></a>因为执行yum需要python2版本，所以我们还要修改yum的配置，执行：</h5><p>vim &#x2F;usr&#x2F;bin&#x2F;yum<br><br>把#! &#x2F;usr&#x2F;bin&#x2F;python修改为#! &#x2F;usr&#x2F;bin&#x2F;python2<br></p>\n<p>同理 vim &#x2F;usr&#x2F;libexec&#x2F;urlgrabber-ext-down <br><br>文件里面的#! &#x2F;usr&#x2F;bin&#x2F;python 也要修改为#! &#x2F;usr&#x2F;bin&#x2F;python2</p>\n<p>安装保留了原python命令调用python2</p>\n<p>安装完成</p>\n<h5 id=\"ps-安装报错\"><a href=\"#ps-安装报错\" class=\"headerlink\" title=\"ps 安装报错\"></a>ps 安装报错</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Q：</span><br><span class=\"line\">ModuleNotFoundError: No module named <span class=\"string\">&#x27;_ctypes&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">A：</span><br><span class=\"line\">yum -y install gcc gcc-c++</span><br><span class=\"line\">yum -y install zlib zlib-devel</span><br><span class=\"line\">yum -y install libffi-devel</span><br><span class=\"line\"></span><br><span class=\"line\">Q：configure: error: no acceptable C compiler found <span class=\"keyword\">in</span> <span class=\"variable\">$PATH</span></span><br><span class=\"line\">A：yum install gcc</span><br></pre></td></tr></table></figure>\n","tags":["linux","python"]},{"title":"CentOS-6-4-php-fpm-添加service-添加平滑启动-重启","url":"/2017/12/03/CentOS-6-4-php-fpm-%E6%B7%BB%E5%8A%A0service-%E6%B7%BB%E5%8A%A0%E5%B9%B3%E6%BB%91%E5%90%AF%E5%8A%A8-%E9%87%8D%E5%90%AF/","content":"<p>我的php是源码安装的。php-fpm在PHP 5.3.2以后的版本不支持以前的php-fpm (start|restart|stop|reload) ，那么如果将php-fpm配置成服务，并添加平滑启动&#x2F;重启。<br>配置php-fpm.conf（vi &#x2F;usr&#x2F;local&#x2F;php54&#x2F;etc&#x2F;php-fpm.conf）,将pid（;pid &#x3D; run&#x2F;php-fpm.pid）前的;去掉。<br>因为编译安装php的，所以会在php目录生成很多二进制文件，找到init.d.php-fpm，拷贝到init.d下。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span> /usr/local/src/php54/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br></pre></td></tr></table></figure>\n<p>设置权限，并添加服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> +x /etc/init.d/php-fpm</span><br><span class=\"line\">chkconfig --add php-fpm</span><br></pre></td></tr></table></figure>\n<p>以后可以使用如下命令管理php-fpm了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service php-fpm start</span><br><span class=\"line\">service php-fpm stop</span><br><span class=\"line\">service php-fpm restart</span><br><span class=\"line\">service php-fpm reload</span><br></pre></td></tr></table></figure>\n","tags":["php-fpm"]},{"title":"Centos-6-5-更改系统时间","url":"/2017/12/03/Centos-6-5-%E6%9B%B4%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">date</span>  时间窗口</span><br><span class=\"line\"><span class=\"built_in\">date</span> -s <span class=\"string\">&#x27;2015-02-02 10:10:00&#x27;</span>  更改年月日小时分秒</span><br><span class=\"line\"><span class=\"built_in\">date</span> -s 10:00:02  只更改时间 不更改年月</span><br><span class=\"line\">clock -w 写入系统时间</span><br><span class=\"line\">hwclock  同步bios 时间</span><br><span class=\"line\">service ntpdate start  开启网络时间同步</span><br><span class=\"line\">systemctl start  ntpdate.service 开启网络时间同步 Red Hat 7</span><br><span class=\"line\">chkconfig --leves 2345 ntpdate on  开机启动</span><br><span class=\"line\">reboot 重启报错</span><br><span class=\"line\">or <span class=\"built_in\">type</span> Contril-D to contime:输入系统密码-根据报错修复</span><br><span class=\"line\">fsck -y /dev/mapper/VolGroup-lv_root</span><br><span class=\"line\">fsck -y /dev/sda1</span><br><span class=\"line\">reboot 重启是否正常</span><br></pre></td></tr></table></figure>\n","tags":["centos"]},{"title":"Centos中安装PHP的PDO-MySQL扩展","url":"/2017/12/03/Centos%E4%B8%AD%E5%AE%89%E8%A3%85PHP%E7%9A%84PDO-MySQL%E6%89%A9%E5%B1%95/","content":"<p>1、下载 文件 或者 进入 在PHP源码包中进入ext&#x2F;pdo_mysql<br><a href=\"http://pecl.php.net/get/PDO_MYSQL-1.0.2.tgz\">http://pecl.php.net/get/PDO_MYSQL-1.0.2.tgz</a></p>\n<p>2、解压文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar zxvf PDO_MYSQL-1.0.2.tgz</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<p>3、配置和编译文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> PDO_MYSQL-1.0.2</span><br><span class=\"line\">/usr/local/php/bin/phpize</span><br><span class=\"line\">./configure –with-php-config=/usr/local/php/bin/php-config –with-pdo-mysql=/usr/local/mysql</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p>注： 我的PHP安装在 ： &#x2F;usr&#x2F;local&#x2F;php&#x2F; mysql 安装在 ： &#x2F;usr&#x2F;local&#x2F;mysql 编译的时候注意你自己的安装目录在哪里<br>3、安装到PHP配置下</p>\n<p>把这个记住，然后打开 php.ini文件，<br>并添加一行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">extension=pdo_mysql.so</span><br></pre></td></tr></table></figure>\n","tags":["centos","php"]},{"title":"DDL、DML和DCL的区别与理解","url":"/2018/06/30/DDL%E3%80%81DML%E5%92%8CDCL%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E7%90%86%E8%A7%A3/","content":"<p>DML、DDL、DCL区别 .</p>\n<p>总体解释：</p>\n<p>DML(data manipulation language)：</p>\n<p>它们是SELECT、UPDATE、INSERT、DELETE，就象它的名字一样，这4条命令是用来对数据库里的数据进行操作的语言</p>\n<p>DDL(data definition language)：</p>\n<p>DDL比DML要多，主要的命令有CREATE、ALTER、DROP等，DDL主要是用在定义或改变表(TABLE)的结构，数据类型，表之间的链接和约束等初始化工作上，他们大多在建立表时使用</p>\n<p>DCL(Data Control Language)：</p>\n<p>是数据库控制功能。是用来设置或更改数据库用户或角色权限的语句，包括(grant,deny,revoke等)语句。在默认状态下，只有sysadmin,dbcreator,db_owner或db_securityadmin等人员才有权力执行DCL</p>\n<span id=\"more\"></span>\n\n<p>详细解释：</p>\n<h5 id=\"DDL\"><a href=\"#DDL\" class=\"headerlink\" title=\"DDL\"></a>DDL</h5><p>DDL is Data Definition Language statements. Some examples:数据定义语言，用于定义和管理 SQL 数据库中的所有对象的语言</p>\n<p>1.CREATE - to create objects in the database 创建</p>\n<p>2.ALTER - alters the structure of the database 修改</p>\n<p>3.DROP - delete objects from the database 删除</p>\n<p>4.TRUNCATE - remove all records from a table, including all spaces allocated for the records are removed</p>\n<p>TRUNCATE TABLE [Table Name]。</p>\n<p>下面是对Truncate语句在MSSQLServer2000中用法和原理的说明：</p>\n<p>Truncate table 表名 速度快,而且效率高,因为:</p>\n<p>TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同：二者均删除表中的全部行。但 TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少。</p>\n<p>DELETE 语句每次删除一行，并在事务日志中为所删除的每行记录一项。TRUNCATE TABLE 通过释放存储表数据所用的数据页来删除数据，并且只在事务日志中记录页的释放。</p>\n<p>TRUNCATE TABLE 删除表中的所有行，但表结构及其列、约束、索引等保持不变。新行标识所用的计数值重置为该列的种子。如果想保留标识计数值，请改用 DELETE。如果要删除表定义及其数据，请使用 DROP TABLE 语句。</p>\n<p>对于由 FOREIGN KEY 约束引用的表，不能使用 TRUNCATE TABLE，而应使用不带 WHERE 子句的 DELETE 语句。由于 TRUNCATE TABLE 不记录在日志中，所以它不能激活触发器。</p>\n<p>TRUNCATE TABLE 不能用于参与了索引视图的表。</p>\n<p>5.COMMENT - add comments to the data dictionary 注释</p>\n<p>6.GRANT - gives user’s access privileges to database 授权</p>\n<p>7.REVOKE - withdraw access privileges given with the GRANT command 收回已经授予的权限</p>\n<h5 id=\"DML\"><a href=\"#DML\" class=\"headerlink\" title=\"DML\"></a>DML</h5><p>DML is Data Manipulation Language statements. Some examples:数据操作语言，SQL中处理数据等操作统称为数据操纵语言</p>\n<p>1.SELECT - retrieve data from the a database 查询</p>\n<p>2.INSERT - insert data into a table 添加</p>\n<p>3.UPDATE - updates existing data within a table 更新</p>\n<p>4.DELETE - deletes all records from a table, the space for the records remain 删除</p>\n<p>5.CALL - call a PL&#x2F;SQL or Java subprogram</p>\n<p>6.EXPLAIN PLAN - explain access path to data</p>\n<p>Oracle RDBMS执行每一条SQL语句，都必须经过Oracle优化器的评估。所以，了解优化器是如何选择(搜索)路径以及索引是如何被使用的，对优化SQL语句有很大的帮助。Explain可以用来迅速方便地查出对于给定SQL语句中的查询数据是如何得到的即搜索路径(我们通常称为Access Path)。从而使我们选择最优的查询方式达到最大的优化效果。</p>\n<p>7.LOCK TABLE - control concurrency 锁，用于控制并发</p>\n<h5 id=\"DCL\"><a href=\"#DCL\" class=\"headerlink\" title=\"DCL\"></a>DCL</h5><p>DCL is Data Control Language statements. Some examples:数据控制语言，用来授予或回收访问数据库的某种特权，并控制数据库操纵事务发生的时间及效果，对数据库实行监视等</p>\n<p>1.COMMIT - save work done 提交</p>\n<p>2.SAVEPOINT - identify a point in a transaction to which you can later roll back 保存点</p>\n<p>3.ROLLBACK - restore database to original since the last COMMIT 回滚</p>\n<p>4.SET TRANSACTION - Change transaction options like what rollback segment to use 设置当前事务的特性，它对后面的事务没有影响.</p>\n<p><a href=\"https://www.2cto.com/database/201610/555167.html\" target=\"_blank\">转载自-https://www.2cto.com/database/201610/555167.html</a></p>\n","tags":["mysql"]},{"title":"ERROR 1044 (42000) Access denied for user ''@'localhost' to database 'mysql'","url":"/2017/12/16/ERROR%201044%20(42000)%20Access%20denied%20for%20user%20''@'localhost'%20to%20database%20'mysql'/","content":"<h3 id=\"方法一：\"><a href=\"#方法一：\" class=\"headerlink\" title=\"方法一：\"></a>方法一：</h3><p>1.关闭mysql</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service mysqld stop</span><br></pre></td></tr></table></figure>\n<p>2.屏蔽权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysqld_safe --skip-grant-table</span><br></pre></td></tr></table></figure>\n<p> 屏幕出现： Starting demo from …..</p>\n<span id=\"more\"></span>\n\n<p>3.新开起一个终端输入</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root mysql</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">UPDATE</span> <span class=\"keyword\">user</span> <span class=\"keyword\">SET</span> Password<span class=\"operator\">=</span>PASSWORD(<span class=\"string\">&#x27;newpassword&#x27;</span>) <span class=\"keyword\">where</span> <span class=\"keyword\">USER</span><span class=\"operator\">=</span><span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> FLUSH PRIVILEGES;<span class=\"operator\">/</span><span class=\"operator\">/</span>记得要这句话，否则如果关闭先前的终端，又会出现原来的错误</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span>exit;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方法二：\"><a href=\"#方法二：\" class=\"headerlink\" title=\"方法二：\"></a>方法二：</h3><p>1.关闭mysql</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service mysqld stop</span><br></pre></td></tr></table></figure>\n<p>2.屏蔽权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysqld_safe --skip-grant-table</span><br></pre></td></tr></table></figure>\n<p>   屏幕出现： Starting demo from …..</p>\n<p>3.新开起一个终端输入</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root mysql</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span> <span class=\"keyword\">where</span> <span class=\"keyword\">USER</span><span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> FLUSH PRIVILEGES;<span class=\"operator\">/</span><span class=\"operator\">/</span>记得要这句话，否则如果关闭先前的终端，又会出现原来的错误</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span>exit;</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"Kafka安装","url":"/2018/09/30/Kafka%E5%AE%89%E8%A3%85/","content":"<p>1.去<a href=\"http://kafka.apache.org/downloads\" target=\"_blank\">kafka官网</a>下载到最新的kafka安装包，选择下载二进制版本的tgz文件</p>\n<p>2.环境需求：java运行环境</p>\n<p>3.配置<br>在kafka解压目录下下有一个config的文件夹，里面放置的是我们的配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">consumer.properites <span class=\"comment\">#消费者配置，这个配置文件用于配置于2.5节中开启的消费者，此处我们使用默认的即可</span></span><br><span class=\"line\"></span><br><span class=\"line\">producer.properties <span class=\"comment\">#生产者配置，这个配置文件用于配置于2.5节中开启的生产者，此处我们使用默认的即可</span></span><br><span class=\"line\"></span><br><span class=\"line\">server.properties <span class=\"comment\">#kafka服务器的配置，此配置文件用来配置kafka服务器，目前仅介绍几个最基础的配置</span></span><br><span class=\"line\"></span><br><span class=\"line\">broker.id <span class=\"comment\">#申明当前kafka服务器在集群中的唯一ID，需配置为integer,并且集群中的每一个kafka服务器的id都应是唯一的，我们这里采用默认配置即可</span></span><br><span class=\"line\"></span><br><span class=\"line\">listeners <span class=\"comment\">#申明此kafka服务器需要监听的端口号，如果是在本机上跑虚拟机运行可以不用配置本项，默认会使用localhost的地址，如果是在远程服务器上运行则必须配置，例如：</span></span><br><span class=\"line\">　　　　　<span class=\"comment\">#listeners=PLAINTEXT:// 192.168.180.128:9092。并确保服务器的9092端口能够访问</span></span><br><span class=\"line\"></span><br><span class=\"line\">zookeeper.connect <span class=\"comment\">#申明kafka所连接的zookeeper的地址 ，需配置为zookeeper的地址，由于本次使用的是kafka高版本中自带zookeeper，使用默认配置即可</span></span><br><span class=\"line\">zookeeper.connect=localhost:2181</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>4.运行</p>\n<p>4.1 启动zookeeper<br>cd进入kafka解压目录，输入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin/zookeeper-server-start.sh config/zookeeper.properties</span><br></pre></td></tr></table></figure>\n<p>启动zookeeper成功后会看到如下的输出</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/kafka/%E5%90%AF%E5%8A%A8zookeeper.png\" alt=\"启动zookeeper\"></p>\n<p>4.2. 启动kafka<br>cd进入kafka解压目录，输入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin/kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure>\n<p>启动kafka成功后会看到如下的输出<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/kafka/%E5%90%AF%E5%8A%A8kafka.png\" alt=\"启动kafka\"></p>\n<p>5.第一个消息<br>5.1 创建一个topic<br>Kafka通过topic对同一类的数据进行管理，同一类的数据使用同一个topic可以在处理数据时更加的便捷<br>在kafka解压目录打开终端，输入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic beta</span><br></pre></td></tr></table></figure>\n<p>创建一个名为beta的topic<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/kafka/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAtopic.png\" alt=\"创建一个topic\"></p>\n<p>在创建topic后可以通过输入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br></pre></td></tr></table></figure>\n<p>来查看已经创建的topic<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/kafka/%E6%9F%A5%E7%9C%8B%E5%B7%B2%E7%BB%8F%E5%88%9B%E5%BB%BA%E7%9A%84topic.png\" alt=\"查看已经创建的topic\"></p>\n<p>5.2 创建一个消息消费者<br>在kafka解压目录打开终端，输入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic beta --from-beginning</span><br></pre></td></tr></table></figure>\n<p>可以创建一个用于消费topic为beta的消费者<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/kafka/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%94%A8%E4%BA%8E%E6%B6%88%E8%B4%B9topic%E4%B8%BAtest%E7%9A%84%E6%B6%88%E8%B4%B9%E8%80%85.png\" alt=\"消费topic为beta的消费者\"></p>\n<p>消费者创建完成之后，因为还没有发送任何数据，因此这里在执行后没有打印出任何数据不过别着急，不要关闭这个终端，打开一个新的终端，接下来我们创建第一个消息生产者</p>\n<p>5.3创建一个消息生产者</p>\n<p>在kafka解压目录打开一个新的终端，输入</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin/kafka-console-producer.sh --broker-list localhost:9092 --topic beta</span><br></pre></td></tr></table></figure>\n<p>在执行完毕后会进入的编辑器页面<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/kafka/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E8%80%85.png\" alt=\"创建一个消息生产者\"></p>\n<p>在发送完消息之后，可以回到我们的消息消费者终端中，可以看到，终端中已经打印出了我们刚才发送的消息</p>\n<p><img src=\"https://github.com/zhaoguibin/hexo_blog_files/blob/master/kafka/%E7%BB%88%E7%AB%AF%E4%B8%AD%E5%B7%B2%E7%BB%8F%E6%89%93%E5%8D%B0%E5%87%BA%E4%BA%86%E6%88%91%E4%BB%AC%E5%88%9A%E6%89%8D%E5%8F%91%E9%80%81%E7%9A%84%E6%B6%88%E6%81%AF.png?raw=true\" alt=\"终端中已经打印出了我们刚才发送的消息\"></p>\n<p><a href=\"https://www.cnblogs.com/hei12138/p/7805475.html\" target=\"_blank\">转载自：cnblogs–嘿123</a></p>\n","tags":["kafka"]},{"title":"Laravel访问出错错误信息：`Warning require(vendorautoload.php) failed to open stream No such file or dire","url":"/2018/01/05/Laravel%E8%AE%BF%E9%97%AE%E5%87%BA%E9%94%99%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%EF%BC%9A%60Warning%20require(vendorautoload.php)%20failed%20to%20open%20stream%20No%20such%20file%20or%20dire/","content":"<p>Warning: require(&#x2F;opt&#x2F;project&#x2F;erp_api&#x2F;public&#x2F;..&#x2F;vendor&#x2F;autoload.php): failed to open stream: No such file or directory in &#x2F;opt&#x2F;project&#x2F;erp_api&#x2F;public&#x2F;index.php on line 24</p>\n<p>Fatal error: require(): Failed opening required ‘&#x2F;opt&#x2F;project&#x2F;erp_api&#x2F;public&#x2F;..&#x2F;vendor&#x2F;autoload.php’ (include_path&#x3D;’.:’) in &#x2F;opt&#x2F;project&#x2F;erp_api&#x2F;public&#x2F;index.php on line 24</p>\n<p>原因：网站根目录下缺少vendor这个存放laraver依赖包的目录<br><br>解决方法：使用<code>composer install</code>进行安装<br><br>（没有安装过的情况下，以前安装过的话使用：<code>composer update</code>）</p>\n","tags":["laravel"]},{"title":"Laravel运行出错RuntimeException No application encryption key has been specified.","url":"/2018/01/05/Laravel%E8%BF%90%E8%A1%8C%E5%87%BA%E9%94%99RuntimeException%20No%20application%20encryption%20key%20has%20been%20specified./","content":"<p>在项目根目录放置.env文件</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">APP_NAME=Laravel</span><br><span class=\"line\">APP_ENV=<span class=\"built_in\">local</span></span><br><span class=\"line\">APP_KEY=</span><br><span class=\"line\">APP_DEBUG=<span class=\"literal\">true</span></span><br><span class=\"line\">APP_LOG_LEVEL=debug</span><br><span class=\"line\">APP_URL=http://localhost</span><br><span class=\"line\"></span><br><span class=\"line\">DB_CONNECTION=mysql</span><br><span class=\"line\">DB_HOST=127.0.0.1</span><br><span class=\"line\">DB_PORT=3306</span><br><span class=\"line\">DB_DATABASE=homestead</span><br><span class=\"line\">DB_USERNAME=homestead</span><br><span class=\"line\">DB_PASSWORD=secret</span><br><span class=\"line\"></span><br><span class=\"line\">BROADCAST_DRIVER=<span class=\"built_in\">log</span></span><br><span class=\"line\">CACHE_DRIVER=file</span><br><span class=\"line\">SESSION_DRIVER=file</span><br><span class=\"line\">SESSION_LIFETIME=120</span><br><span class=\"line\">QUEUE_DRIVER=<span class=\"built_in\">sync</span></span><br><span class=\"line\"></span><br><span class=\"line\">REDIS_HOST=127.0.0.1</span><br><span class=\"line\">REDIS_PASSWORD=null</span><br><span class=\"line\">REDIS_PORT=6379</span><br><span class=\"line\"></span><br><span class=\"line\">MAIL_DRIVER=smtp</span><br><span class=\"line\">MAIL_HOST=smtp.mailtrap.io</span><br><span class=\"line\">MAIL_PORT=2525</span><br><span class=\"line\">MAIL_USERNAME=null</span><br><span class=\"line\">MAIL_PASSWORD=null</span><br><span class=\"line\">MAIL_ENCRYPTION=null</span><br><span class=\"line\"></span><br><span class=\"line\">PUSHER_APP_ID=</span><br><span class=\"line\">PUSHER_APP_KEY=</span><br><span class=\"line\">PUSHER_APP_SECRET=</span><br></pre></td></tr></table></figure>\n\n<p>在项目目录下运行:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">php artisan key:generate</span><br></pre></td></tr></table></figure>\n\n<p>该命令会生成APP_KEY并写入到.env文件中，重新运行</p>\n","tags":["laravel"]},{"title":"Linux-Source命令及脚本的执行方式解析","url":"/2017/12/03/Linux-Source%E5%91%BD%E4%BB%A4%E5%8F%8A%E8%84%9A%E6%9C%AC%E7%9A%84%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F%E8%A7%A3%E6%9E%90/","content":"<p>当我修改了&#x2F;etc&#x2F;profile文件，我想让它立刻生效，而不用重新登录；这时就想到用source命令，如:source &#x2F;etc&#x2F;profile<br>对source进行了学习，并且用它与sh 执行脚本进行了对比，现在总结一下。</p>\n<p>source命令：<br><br>source命令也称为“点命令”，也就是一个点符号（.）,是bash的内部命令。<br><br>功能：使Shell读入指定的Shell程序文件并依次执行文件中的所有语句<br><br>source命令通常用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录。<br><br>用法：<br><br>source filename 或 . filename<br><br>source命令(从 C Shell 而来)是bash shell的内置命令;点命令(.)，就是个点符号(从Bourne Shell而来)是source的另一名称。<br><br>source filename 与 sh filename 及.&#x2F;filename执行脚本的区别在那里呢？<br><br>1.当shell脚本具有可执行权限时，用sh filename与.&#x2F;filename执行脚本是没有区别得。.&#x2F;filename是因为当前目录没有在PATH中，所有”.”是用来表示当前目录的。<br><br>2.sh filename 重新建立一个子shell，在子shell中执行脚本里面的语句，该子shell继承父shell的环境变量，但子shell新建的、改变的变量不会被带回父shell，除非使用export。<br><br>3.source filename：这个命令其实只是简单地读取脚本里面的语句依次在当前shell里面执行，没有建立新的子shell。那么脚本里面所有新建、改变变量的语句都会保存在当前shell里面。<br><br>举例说明：<br><br>1.新建一个test.sh脚本，内容为:A&#x3D;1<br><br>2.然后使其可执行chmod +x test.sh<br><br>3.运行sh test.sh后，echo $A，显示为空，因为A&#x3D;1并未传回给当前shell<br><br>4.运行.&#x2F;test.sh后，也是一样的效果<br><br>5.运行source test.sh 或者 . test.sh，然后echo $A，则会显示1，说明A&#x3D;1的变量在当前shell中</p>\n","tags":["linux"]},{"title":"Linux-查看进程和删除进程","url":"/2017/12/03/Linux-%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%88%A0%E9%99%A4%E8%BF%9B%E7%A8%8B/","content":"<ol>\n<li>在 LINUX 命令平台输入 1-2 个字符后按 Tab 键会自动补全后面的部分(前提是要有这个东西，例如在装了 tomcat 的前提下, 输入 tomcat 的 to 按 tab)。</li>\n<li>ps 命令用于查看当前正在运行的进程。<br><br>grep 是搜索<br><br>例如： ps -ef | grep java<br><br>表示查看所有进程里 CMD 是 java 的进程信息<br><br>ps -aux | grep java<br></li>\n</ol>\n<p>-aux 显示所有状态<br><br>ps<br>3. kill 命令用于终止进程<br><br>例如： kill -9 [PID]<br><br>-9 表示强迫进程立即停止<br><br>通常用 ps 查看进程 PID ，用 kill 命令终止进程<br><br>网上关于这两块的内容<br></p>\n<span id=\"more\"></span>\n\n<hr>\n<h2 id=\"PS\"><a href=\"#PS\" class=\"headerlink\" title=\"PS\"></a>PS</h2><ol>\n<li>ps 简介<br><br>ps 命令就是最根本相应情况下也是相当强大地进程查看命令.运用该命令可以确定有哪些进程正在运行和运行地状态、 进程 是否结束、进程有没有僵死、哪些进程占用了过多地资源等等.总之大部分信息均为可以通过执行该命令得到地.</li>\n<li>ps 命令及其参数<br><br>ps 命令最经常使用地还是用于监控后台进程地工作情况,因为后台进程是不和屏幕键盘这些标准输入&#x2F;输出设<br>备进行通信地,所以如果需要检测其情况,便可以运用 ps 命令了.<br><br>该命令语法格式如下：<br><br>ps [选项]<br></li>\n</ol>\n<p>-e 显示所有进程,环境变量<br><br>-f 全格式<br><br>-h 不显示标题<br><br>-l 长格式<br><br>-w 宽输出<br><br>a<br><br>显示终端上地所有进程,包括其他用户地进程<br><br>r<br><br>只显示正在运行地进程<br><br>x<br><br>显示没有控制终端地进程<br><br>O[+|-] k1 [,[+|-] k2 [,…]] 根据 SHORT KEYS、k1、k2 中快捷键指定地多级排序顺序显示进程列表.<br><br>对于 ps 地不同格式都存在着默认地顺序指定.这些默认顺序可以被用户地指定所覆盖.在这里面“+”字符是可选地,“-” 字符是倒转指定键地方向.<br><br>pids 只列出进程标识符,之间运用逗号分隔.该进程列表必须在命令行参数地最后一个选项后面紧接着给出,中间不能插入 空格.比如：ps -f1,4,5.<br><br>以下介绍长命令行选项,这些选项都运用“–”开头：<br><br>–sort X[+|-] key [,[+|-] key [,…]] 从 SORT KEYS 段中选一个多字母键.“+”字符是可选地,因为默认地方向就是按 数字升序或者词典顺序.比如： ps -jax -sort&#x3D;uid,-ppid,+pid.<br><br>–help 显示帮助信息.<br><br>–version 显示该命令地版本信息.<br><br>在前面地选项说明中提到了排序键,接下来对排序键作进一步说明.需要注意地是排序中运用地值是 ps 运用地内部值,并非 仅用于某些输出格式地伪值.排序键列表见表 4-3.<br>表 4-3 排序键列表<br><br>c<br><br>cmd<br><br>可执行地简单名称<br><br>C<br><br>cmdline<br><br>完整命令行<br><br>f<br><br>flags<br><br>长模式标志<br><br>g<br><br>pgrp<br><br>进程地组 ID<br><br>G<br><br>tpgid<br><br>控制 tty 进程组 ID<br><br>j<br><br>cutime<br><br>累计用户时间<br><br>J<br><br>cstime<br><br>累计系统时间<br><br>k<br><br>utime<br><br>用户时间<br><br>K<br><br>stime<br><br>系统时间<br><br>m<br><br>min_flt<br><br>次要页错<br></p>\n","tags":["linux"]},{"title":"Linux下iptables屏蔽IP和端口号","url":"/2018/11/16/Linux%E4%B8%8Biptables%E5%B1%8F%E8%94%BDIP%E5%92%8C%E7%AB%AF%E5%8F%A3%E5%8F%B7/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#封单个IP的命令：</span></span><br><span class=\"line\">iptables -I INPUT -s 192.168.10.66 -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#封IP段的命令：</span></span><br><span class=\"line\">iptables -I INPUT -s 192.168.0.0/16 -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#封整个段的命令：</span></span><br><span class=\"line\">iptables -I INPUT -s 192.168.0.0/8 -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#封几个段的命令：</span></span><br><span class=\"line\">iptables -I INPUT -s 192.168.10.0/24 -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#只封80端口：</span></span><br><span class=\"line\">iptables -I INPUT -p tcp –dport 80 -s 192.168.0.0/24 -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#解封：</span></span><br><span class=\"line\">iptables -F</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#清空：</span></span><br><span class=\"line\">iptables -D INPUT 数字</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#列出 INPUT链 所有的规则：</span></span><br><span class=\"line\">iptables -L INPUT --line-numbers</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#删除某条规则，其中5代表序号（序号可用上面的命令查看）：</span></span><br><span class=\"line\">iptables -D INPUT 5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#开放指定的端口：</span></span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#禁止指定的端口：</span></span><br><span class=\"line\">iptables -A INPUT -p tcp --dport 80 -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#拒绝所有的端口：</span></span><br><span class=\"line\">iptables -A INPUT -j DROP</span><br></pre></td></tr></table></figure>\n\n<p>以上都是针对INPUT链的操作，即是外面来访问本机的方向，配置完之后 需要保存，否则iptables 重启之后以上设置就失效</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service iptables save</span><br></pre></td></tr></table></figure>\n\n<p>iptables 对应的配置文件  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/etc/sysconfig/iptables</span><br></pre></td></tr></table></figure>\n\n<p>注意：iptables的规则匹配顺序上从上到下的，也就是说如果上下两条规则有冲突时，将会以上面的规则为准。</p>\n","tags":["linux","iptables"]},{"title":"Linux安装jdk","url":"/2018/09/30/Linux%E5%AE%89%E8%A3%85jdk/","content":"<p>到<a href=\"https://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html\" target=\"_blank\">oracle官网</a>下载二进制压缩文件</p>\n<h4 id=\"1-解压\"><a href=\"#1-解压\" class=\"headerlink\" title=\"1.解压\"></a>1.解压</h4><h4 id=\"2-编辑-x2F-etc-x2F-profile，添加以下配置\"><a href=\"#2-编辑-x2F-etc-x2F-profile，添加以下配置\" class=\"headerlink\" title=\"2.编辑&#x2F;etc&#x2F;profile，添加以下配置\"></a>2.编辑&#x2F;etc&#x2F;profile，添加以下配置</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/opt/src/jdk1.8.0_171</span><br><span class=\"line\"><span class=\"built_in\">export</span> JRE_HOME=/opt/src/jdk1.8.0_171/jre</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:/opt/src/jdk1.8.0_171/bin</span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=./:/opt/src/jdk1.8.0_171/lib:/opt/src/jdk1.8.0_171/jre/lib</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-刷新配置\"><a href=\"#3-刷新配置\" class=\"headerlink\" title=\"3.刷新配置\"></a>3.刷新配置</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-查看配置是否生效\"><a href=\"#4-查看配置是否生效\" class=\"headerlink\" title=\"4.查看配置是否生效\"></a>4.查看配置是否生效</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -version</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-出现以下信息就安装成功了\"><a href=\"#5-出现以下信息就安装成功了\" class=\"headerlink\" title=\"5.出现以下信息就安装成功了\"></a>5.出现以下信息就安装成功了</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">java version <span class=\"string\">&quot;1.8.0_171&quot;</span></span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_171-b11)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.171-b11, mixed mode)</span><br></pre></td></tr></table></figure>","tags":["linux","jdk"]},{"title":"Linux开机执行命令","url":"/2017/12/03/Linux%E5%BC%80%E6%9C%BA%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/","content":"<p>1、把需要执行的命令写到一个bash脚本里面：<br>#!&#x2F;bin&#x2F;sh （此括号内为需要执行的命令） 保存为一个文件，比如123.sh，放在oracle的主目录里面。<br><br>给这个文件加上可执行属性：chmod 775 123.sh<br><br>然后，在&#x2F;etc&#x2F;rc.d&#x2F;rc.local里面加上这句就可以了：<br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/123.sh</span><br><span class=\"line\">延时执行</span><br><span class=\"line\">例子：(</span><br><span class=\"line\"><span class=\"built_in\">sleep</span> 60</span><br><span class=\"line\">sh /goexcel.sh</span><br><span class=\"line\">)&amp;</span><br><span class=\"line\">延时60秒执行</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"Linux解决Warning mysql_connect() Headers and client library minor version mismatch. 警告","url":"/2017/12/16/Linux%E8%A7%A3%E5%86%B3Warning%20mysql_connect()%20Headers%20and%20client%20library%20minor%20version%20mismatch.%20%E8%AD%A6%E5%91%8A/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum remove php-mysql  </span><br><span class=\"line\">yum install  php70w-mysqlnd</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"linux软件包管理","url":"/2017/12/02/Linux%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/","content":"<p>dpkg (Debian Package)管理工具，软件包名以.deb后缀。这种方法适合系统不能联网的情况下。</p>\n<p>比如安装demo命令的安装包，先将demo.deb传到Linux系统中。再使用如下命令安装。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo dpkg -i demo_1.5.3-1_i386.deb   安装软件</span><br><span class=\"line\">sudo dpkg -r demo    卸载软件</span><br></pre></td></tr></table></figure>\n<p>注：将demo.deb传到Linux系统中，有多种方式。VMwareTool，使用挂载方式；使用winSCP工具等；</p>\n<p>APT（Advanced Packaging Tool）高级软件工具。这种方法适合系统能够连接互联网的情况。</p>\n<p>依然以demo为例</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo apt-get install demo     安装demo</span><br><span class=\"line\">sudo apt-get remove demo      卸载demo</span><br><span class=\"line\">sudo apt-get update           更新软件</span><br><span class=\"line\">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>\n<p>将.rpm文件转为.deb文件</p>\n<p>.rpm为RedHat使用的软件格式。在Ubuntu下不能直接使用，所以需要转换一下。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo alien abc.rpm</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"MySQL-ERROR-Table-mysql-user-doesn-t-exist","url":"/2017/12/03/MySQL-ERROR-Table-mysql-user-doesn-t-exist/","content":"<p>1、现象描述<br>[root@centos65 scripts]# service mysqld start<br>Starting MySQL..The server quit without updating PID file (&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;HKBO.pid).[FAILED]<br>查看错误日志</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos65 scripts]<span class=\"comment\"># tail /var/log/mysqld.log</span></span><br><span class=\"line\">InnoDB: Apply batch completed</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [Note] InnoDB: 128 rollback segment(s) are active.</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [Note] InnoDB: Waiting <span class=\"keyword\">for</span> purge to start</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [Note] InnoDB: 5.6.12 started; <span class=\"built_in\">log</span> sequence number 1600607</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [Note] Server hostname (bind-address): <span class=\"string\">&#x27;*&#x27;</span>; port: 3306</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [Note] IPv6 is available.</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [Note]   - <span class=\"string\">&#x27;::&#x27;</span> resolves to <span class=\"string\">&#x27;::&#x27;</span>;</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [Note] Server socket created on IP: <span class=\"string\">&#x27;::&#x27;</span>.</span><br><span class=\"line\">2014-12-08 11:01:37 15721 [ERROR] Fatal error: Can<span class=\"string\">&#x27;t open and lock privilege tables: Table &#x27;</span>mysql.user<span class=\"string\">&#x27; doesn&#x27;</span>t exist</span><br><span class=\"line\">141208 11:01:37 mysqld_safe mysqld from pid file /var/lib/mysql/HKBO.pid ended</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<p>2、解决办法</p>\n<p>查看当前的my.cnf配置文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">more /etc/my.cnf |grep -v ^#</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir=/var/lib/mysql</span><br><span class=\"line\">socket=/var/lib/mysql/mysql.sock</span><br><span class=\"line\">user=mysql</span><br><span class=\"line\">old_passwords=1</span><br><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\">log-error=/var/log/mysqld.log</span><br><span class=\"line\">pid-file=/var/run/mysqld/mysqld.pid</span><br></pre></td></tr></table></figure>\n<p>由于编译安装时指定的路径为&#x2F;opt&#x2F;data以及mysql_install_db时指定的datadir也为&#x2F;opt&#x2F;data,而my.cnf为缺省的路径<br>因此修改datadir至正确路径后，问题解决</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">vi /etc/my.cnf</span><br><span class=\"line\">more /etc/my.cnf |grep datadir</span><br><span class=\"line\">datadir=/opt/data</span><br><span class=\"line\">service mysqld start</span><br><span class=\"line\">Starting MySQL.[  OK  ]</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"MySQL_OUTFILE导出数据","url":"/2020/01/19/MySQL_OUTFILE%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE/","content":"<p><strong>PS : mysql 需要开启grant FILE on <em>.</em> to newerp; 权限</strong></p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@FILE</span>_NAME:ExcelExport.php</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span> 数据导出excel,从数据库导出再下载，数据库配置</span></span><br><span class=\"line\"><span class=\"comment\"> * [mysqld]</span></span><br><span class=\"line\"><span class=\"comment\"> * secure_file_priv= &#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2019-12-04 13:52:58</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExcelExport</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:exportExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 13:42:11</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $title</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $sql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $data</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">exportExcel</span>(<span class=\"params\"><span class=\"variable\">$title</span> = <span class=\"string\">&#x27;报表导出&#x27;</span>, <span class=\"variable\">$sql</span>, <span class=\"variable\">$data</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">getcwd</span>() . <span class=\"string\">&quot;/data_export/&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$sys</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">SysModel</span>();</span><br><span class=\"line\">        <span class=\"variable\">$db</span> = <span class=\"variable\">$sys</span>-&gt;<span class=\"title function_ invoke__\">getAdapter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//删除历史表格</span></span><br><span class=\"line\">        <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">deleteExcel</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">file_exists</span>(<span class=\"variable\">$data_dir</span>) || !<span class=\"title function_ invoke__\">is_writable</span>(<span class=\"variable\">$data_dir</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!@<span class=\"title function_ invoke__\">mkdir</span>(<span class=\"variable\">$data_dir</span>, <span class=\"number\">0755</span>, <span class=\"literal\">TRUE</span>)) &#123;</span><br><span class=\"line\">                <span class=\"title class_\">Tools</span>::<span class=\"title function_ invoke__\">dieJs</span>(<span class=\"string\">&quot;alert(&#x27;导出失败，请联系管理员处理&#x27;);history.go(-1);&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = <span class=\"variable\">$title</span> . <span class=\"title function_ invoke__\">time</span>() . <span class=\"string\">&quot;.csv&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$file_path</span> = <span class=\"variable\">$data_dir</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//拼接sql</span></span><br><span class=\"line\">        <span class=\"variable\">$convert_fields</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$title_fields</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$fields</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp_key</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"variable\">$fields_count</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$field</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp_key</span> += <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"variable\">$convert_fields</span> .= <span class=\"string\">&quot;ifnull(CONVERT (( `<span class=\"subst\">&#123;$key&#125;</span>` ) USING gb2312 ),&#x27;&#x27;)&quot;</span> . (<span class=\"variable\">$temp_key</span> &lt; <span class=\"variable\">$fields_count</span> ? <span class=\"string\">&#x27;,&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable\">$title_fields</span> .= <span class=\"string\">&quot;&#x27;<span class=\"subst\">&#123;$key&#125;</span>&#x27;&quot;</span> . (<span class=\"variable\">$temp_key</span> &lt; <span class=\"variable\">$fields_count</span> ? <span class=\"string\">&#x27;,&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable\">$fields</span> .= <span class=\"string\">&quot;`<span class=\"subst\">&#123;$field&#125;</span>`&quot;</span> . (<span class=\"variable\">$temp_key</span> &lt; <span class=\"variable\">$fields_count</span> ? <span class=\"string\">&#x27;,&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$sql_str</span> = <span class=\"string\">&quot;SELECT <span class=\"subst\">&#123;$convert_fields&#125;</span> INTO OUTFILE &#x27;<span class=\"subst\">&#123;$file_path&#125;</span>&#x27; FIELDS TERMINATED BY &#x27;,&#x27; OPTIONALLY ENCLOSED BY &#x27;\\&quot;&#x27; LINES TERMINATED BY &#x27;\\n&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        FROM ( SELECT <span class=\"subst\">&#123;$title_fields&#125;</span> UNION SELECT <span class=\"subst\">&#123;$fields&#125;</span> FROM (<span class=\"subst\">&#123;$sql&#125;</span>) as t ) temp&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$db</span>-&gt;<span class=\"title function_ invoke__\">query</span>(<span class=\"variable\">$sql_str</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">downloadExcel</span>(<span class=\"variable\">$file_path</span>, <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:downloadExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 14:25:10</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $file_path 文件地址</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $file_name 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadExcel</span>(<span class=\"params\"><span class=\"variable\">$file_path</span>, <span class=\"variable\">$file_name</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">ob_end_clean</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">file_exists</span>(<span class=\"variable\">$file_path</span>)) &#123;</span><br><span class=\"line\">            <span class=\"title class_\">Tools</span>::<span class=\"title function_ invoke__\">dieJs</span>(<span class=\"string\">&quot;alert(&#x27;文件不存在，请联系管理员处理&#x27;);history.go(-1);&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$fp</span> = <span class=\"title function_ invoke__\">fopen</span>(<span class=\"variable\">$file_path</span>, <span class=\"string\">&quot;r&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_size</span> = <span class=\"title function_ invoke__\">filesize</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//下载文件需要用到的头</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Accept-Ranges: bytes&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Accept-Length:&quot;</span> . <span class=\"variable\">$file_size</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\">        <span class=\"variable\">$buffer</span> = <span class=\"number\">1024</span>;</span><br><span class=\"line\">        <span class=\"variable\">$file_count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!<span class=\"title function_ invoke__\">feof</span>(<span class=\"variable\">$fp</span>) &amp;&amp; <span class=\"variable\">$file_count</span> &lt; <span class=\"variable\">$file_size</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$file_con</span> = <span class=\"title function_ invoke__\">fread</span>(<span class=\"variable\">$fp</span>, <span class=\"variable\">$buffer</span>);</span><br><span class=\"line\">            <span class=\"variable\">$file_count</span> += <span class=\"variable\">$buffer</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"variable\">$file_con</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">fclose</span>(<span class=\"variable\">$fp</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:deleteExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 删除没用的表格</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 15:05:01</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deleteExcel</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//几分钟前的时间戳</span></span><br><span class=\"line\">        <span class=\"variable\">$delete_time</span> = <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;-5 minute&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">getcwd</span>() . <span class=\"string\">&quot;/data_export/*.csv&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">glob</span>(<span class=\"variable\">$data_dir</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>(<span class=\"variable\">$data_dir</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data_dir</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$file_path</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp_time</span> = <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">findNum</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_time</span> &lt; <span class=\"variable\">$delete_time</span>) &#123;</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">unlink</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:findNum</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 14:54:11</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $str</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findNum</span>(<span class=\"params\"><span class=\"variable\">$str</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$str</span> = <span class=\"title function_ invoke__\">trim</span>(<span class=\"variable\">$str</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>(<span class=\"variable\">$str</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$temp</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;4&#x27;</span>, <span class=\"string\">&#x27;5&#x27;</span>, <span class=\"string\">&#x27;6&#x27;</span>, <span class=\"string\">&#x27;7&#x27;</span>, <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>, <span class=\"string\">&#x27;0&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$str</span>); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$str</span>[<span class=\"variable\">$i</span>], <span class=\"variable\">$temp</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$result</span> .= <span class=\"variable\">$str</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$result</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":["php","mysql"]},{"title":"MySQL使用Symbolic-Links以支持数据分区存储","url":"/2017/12/02/MySQL%E4%BD%BF%E7%94%A8Symbolic-Links%E4%BB%A5%E6%94%AF%E6%8C%81%E6%95%B0%E6%8D%AE%E5%88%86%E5%8C%BA%E5%AD%98%E5%82%A8/","content":"<p>MySQL数据库及表(仅MyISAM)支持符号链接(symbolic link)，即数据库或表可以存储在my.cnf中指定datadir之外的分区或目录。<br>要支持符号链接，需要在配置中设置symbolic-links&#x3D;1(较新的版本为默认开启)</p>\n<p>假设my.cnf有设置data目录:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">datadir=/data1/mysql/data/</span><br></pre></td></tr></table></figure>\n<p>而在另一个分区目录下保存有数据数据库TestDB:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/data2/mysql/data/TestDB</span><br></pre></td></tr></table></figure>\n<p>那么可以这样使得同一个MySQL实例能同时管理TestDB:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ln</span> -s /data2/mysql/data/TestDB /data1/mysql/data/</span><br></pre></td></tr></table></figure>\n<p>所有文件相关权限设置正确后，MySQL就可以管理TestDB了。<br>值得注意的是，TestDB最好只能为一个MySQL服务来操作，否则会出现意想不到的问题。使用symbolic link的一个好处是当一个磁盘或分区空间不够时，可以将数据存储到其他的磁盘或分区。</p>\n","tags":["mysql"]},{"title":"MySQL保留两位小数","url":"/2018/11/09/MySQL%E4%BF%9D%E7%95%99%E4%B8%A4%E4%BD%8D%E5%B0%8F%E6%95%B0/","content":"<h6 id=\"round-x-d-用于数据的四舍五入-round-x-其实就是round-x-0-也就是默认d为0；\"><a href=\"#round-x-d-用于数据的四舍五入-round-x-其实就是round-x-0-也就是默认d为0；\" class=\"headerlink\" title=\"round(x,d) :用于数据的四舍五入,round(x)  ,其实就是round(x,0),也就是默认d为0；\"></a>round(x,d) :用于数据的四舍五入,round(x)  ,其实就是round(x,0),也就是默认d为0；</h6><p>这里有个值得注意的地方是，d可以是负数，这时是指定小数点左边的d位整数位为0,同时小数位均为0；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT ROUND(5000.56789,2),ROUND(5000,2),ROUND(0.56789,2),ROUND(115.56789,-1);</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%B0%8F%E6%95%B0/round1.png\" alt=\"mysql保留两位小数\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT ROUND(5000.12345,2),ROUND(5000,2),ROUND(0.12345,2),ROUND(114.12345,-1);</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%B0%8F%E6%95%B0/round2.png\" alt=\"mysql保留两位小数\"></p>\n<span id=\"more\"></span>\n\n<h6 id=\"TRUNCATE-x-d-：函数返回被舍去至小数点后d位的数字x。若d的值为0，则结果不带有小数点或不带有小数部分。若d设为负数，则截去（归零）x小数点左起第d位开始后面所有低位的值。\"><a href=\"#TRUNCATE-x-d-：函数返回被舍去至小数点后d位的数字x。若d的值为0，则结果不带有小数点或不带有小数部分。若d设为负数，则截去（归零）x小数点左起第d位开始后面所有低位的值。\" class=\"headerlink\" title=\"TRUNCATE(x,d)：函数返回被舍去至小数点后d位的数字x。若d的值为0，则结果不带有小数点或不带有小数部分。若d设为负数，则截去（归零）x小数点左起第d位开始后面所有低位的值。\"></a>TRUNCATE(x,d)：函数返回被舍去至小数点后d位的数字x。若d的值为0，则结果不带有小数点或不带有小数部分。若d设为负数，则截去（归零）x小数点左起第d位开始后面所有低位的值。</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT TRUNCATE(5000.56789,2),TRUNCATE(5000,2),TRUNCATE(0.56789,2),TRUNCATE(115.56789,-1);</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%B0%8F%E6%95%B0/TRUNCATE1.png\" alt=\"mysql保留两位小数\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT TRUNCATE(5000.12345,2),TRUNCATE(5000,2),TRUNCATE(0.12345,2),TRUNCATE(114.12345,-1);</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%B0%8F%E6%95%B0/TRUNCATE2.png\" alt=\"mysql保留两位小数\"></p>\n","tags":["mysql"]},{"title":"MySQL查询字段在哪个表","url":"/2018/09/30/MySQL%E6%9F%A5%E8%AF%A2%E5%AD%97%E6%AE%B5%E5%9C%A8%E5%93%AA%E4%B8%AA%E8%A1%A8/","content":"<h4 id=\"查询pwd字段在哪个数据库哪个表\"><a href=\"#查询pwd字段在哪个数据库哪个表\" class=\"headerlink\" title=\"查询pwd字段在哪个数据库哪个表\"></a>查询pwd字段在哪个数据库哪个表</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT</span><br><span class=\"line\">\tTABLE_SCHEMA,</span><br><span class=\"line\">\tTABLE_NAME</span><br><span class=\"line\">FROM</span><br><span class=\"line\">\tinformation_schema.`COLUMNS`</span><br><span class=\"line\">WHERE</span><br><span class=\"line\">\tCOLUMN_NAME = &#x27;pwd&#x27;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查询pwd字段在ERP数据库的哪个表\"><a href=\"#查询pwd字段在ERP数据库的哪个表\" class=\"headerlink\" title=\"查询pwd字段在ERP数据库的哪个表\"></a>查询pwd字段在ERP数据库的哪个表</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT</span><br><span class=\"line\">\tTABLE_SCHEMA,</span><br><span class=\"line\">\tTABLE_NAME</span><br><span class=\"line\">FROM</span><br><span class=\"line\">\tinformation_schema.`COLUMNS`</span><br><span class=\"line\">WHERE</span><br><span class=\"line\">\tCOLUMN_NAME = &#x27;pwd&#x27;</span><br><span class=\"line\">AND TABLE_SCHEMA = &#x27;ERP&#x27;</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"Mysqli statement execute error  Statement violates GTID consistency CREATE TABLE ...","url":"/2018/01/20/Mysqli%20statement%20execute%20error%20%20Statement%20violates%20GTID%20consistency%20CREATE%20TABLE%20...%20/","content":"<p>解决：</p>\n<p>  在my.cnf 中将</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">gtid_mode = ON</span><br><span class=\"line\">enforce_gtid_consistency = ON</span><br></pre></td></tr></table></figure>\n\n<p>改为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">gtid_mode = OFF</span><br><span class=\"line\">enforce_gtid_consistency = OFF</span><br></pre></td></tr></table></figure>\n\n<p>要两个参数一起改,然后重启mysql，问题解决</p>\n","tags":["mysql"]},{"title":"Mysql双主同步","url":"/2017/12/02/Mysql%E5%8F%8C%E4%B8%BB%E5%90%8C%E6%AD%A5/","content":"<p><strong>平台：centos7,mysql5.6.34</strong></p>\n<p>解决数据库瓶颈问题<br>两台服务器可以同时读写数据库<br>A B两台服务器<br>A和B需要拥有一个同名的数据库<br>同步账号设置<br>首先要在两台服务器上各新增加一个可登陆的账号。</p>\n<span id=\"more\"></span>\n\n<p>A端50</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span><span class=\"keyword\">grant</span> replication slave,file <span class=\"keyword\">on</span> <span class=\"operator\">*</span>.<span class=\"operator\">*</span> <span class=\"keyword\">to</span> <span class=\"string\">&#x27;sync_user&#x27;</span>@<span class=\"string\">&#x27;192.168.10.58&#x27;</span> identified <span class=\"keyword\">by</span> <span class=\"string\">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>B端58</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span><span class=\"keyword\">grant</span> replication slave,file <span class=\"keyword\">on</span> <span class=\"operator\">*</span>.<span class=\"operator\">*</span> <span class=\"keyword\">to</span> <span class=\"string\">&#x27;sync_user&#x27;</span>@<span class=\"string\">&#x27;192.168.10.50&#x27;</span> identified <span class=\"keyword\">by</span> <span class=\"string\">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>修改my.cnf主配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>\n<p>在 [mysqld] 添加</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">A端</span><br><span class=\"line\">log-bin=mysql-bin  <span class=\"comment\">#启动二进制日志系统</span></span><br><span class=\"line\">server-id=1              <span class=\"comment\">#本机数据库ID标示为主，另一为2</span></span><br><span class=\"line\">binlog-do-db=<span class=\"built_in\">test</span>   <span class=\"comment\">#二进制需同步的数据库名</span></span><br><span class=\"line\">binlog-ignore-db=mysql   <span class=\"comment\">#避免同步用户数据库配置</span></span><br><span class=\"line\">replicate-do-db=<span class=\"built_in\">test</span>    <span class=\"comment\">#同步数据库的名称</span></span><br><span class=\"line\">replicate-ignore-db=mysql   <span class=\"comment\">#屏蔽对mysql数据库的同步</span></span><br><span class=\"line\">log-slave-updates</span><br><span class=\"line\">slave-skip-errors=all</span><br><span class=\"line\">sync_binlog=1</span><br><span class=\"line\">auto_increment_increment=2</span><br><span class=\"line\">auto_increment_offset=1           <span class=\"comment\">#B端配置2</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">B端</span><br><span class=\"line\">log-bin=mysql-bin  <span class=\"comment\">#启动二进制日志系统</span></span><br><span class=\"line\">server-id=2              <span class=\"comment\">#本机数据库ID标示为主，另一为1</span></span><br><span class=\"line\">binlog-do-db=<span class=\"built_in\">test</span>   <span class=\"comment\">#二进制需同步的数据库名</span></span><br><span class=\"line\">binlog-ignore-db=mysql   <span class=\"comment\">#避免同步用户数据库配置</span></span><br><span class=\"line\">replicate-do-db=<span class=\"built_in\">test</span>    <span class=\"comment\">#同步数据库的名称</span></span><br><span class=\"line\">replicate-ignore-db=mysql   <span class=\"comment\">#屏蔽对mysql数据库的同步</span></span><br><span class=\"line\">log-slave-updates</span><br><span class=\"line\">slave-skip-errors=all</span><br><span class=\"line\">sync_binlog=1</span><br><span class=\"line\">auto_increment_increment=2</span><br><span class=\"line\">auto_increment_offset=2           <span class=\"comment\">#A端配置1</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>p</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span>flush tables <span class=\"keyword\">with</span> read lock;    #锁定表格</span><br><span class=\"line\">service mysqld restart</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span><span class=\"keyword\">show</span> master status\\G  ＃查看主服务器同步状态</span><br></pre></td></tr></table></figure>\n<p>A端是这样的</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> master status\\G</span><br><span class=\"line\"><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span> <span class=\"number\">1.</span> <span class=\"type\">row</span> <span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span></span><br><span class=\"line\">            File: mysql<span class=\"operator\">-</span>bin<span class=\"number\">.000001</span></span><br><span class=\"line\">        Position: <span class=\"number\">106</span></span><br><span class=\"line\">    Binlog_Do_DB: test</span><br><span class=\"line\">Binlog_Ignore_DB: mysql</span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br></pre></td></tr></table></figure>\n<p>B端是这样的</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">show</span> master status\\G</span><br><span class=\"line\"><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span> <span class=\"number\">1.</span> <span class=\"type\">row</span> <span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span></span><br><span class=\"line\">            File: mysql<span class=\"operator\">-</span>bin<span class=\"number\">.000002</span></span><br><span class=\"line\">        Position: <span class=\"number\">106</span></span><br><span class=\"line\">    Binlog_Do_DB: test</span><br><span class=\"line\">Binlog_Ignore_DB: mysql</span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br></pre></td></tr></table></figure>\n<p>设定同步服务器ip 用户名与口令和日志文件名与show master status\\G 输出结果一致。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">A端：</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span>change master <span class=\"keyword\">to</span> master_host<span class=\"operator\">=</span><span class=\"string\">&#x27;192.168.10.58&#x27;</span>, master_user<span class=\"operator\">=</span><span class=\"string\">&#x27;sync_user&#x27;</span>, master_password<span class=\"operator\">=</span><span class=\"string\">&#x27;123456&#x27;</span>, master_log_file<span class=\"operator\">=</span><span class=\"string\">&#x27;mysql-bin.000002&#x27;</span>, master_log_pos<span class=\"operator\">=</span><span class=\"number\">106</span>;</span><br><span class=\"line\">B端：</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span>change master <span class=\"keyword\">to</span> master_host<span class=\"operator\">=</span><span class=\"string\">&#x27;192.168.10.50&#x27;</span>, master_user<span class=\"operator\">=</span><span class=\"string\">&#x27;sync_user&#x27;</span>, master_password<span class=\"operator\">=</span><span class=\"string\">&#x27;123456&#x27;</span>, master_log_file<span class=\"operator\">=</span><span class=\"string\">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos<span class=\"operator\">=</span><span class=\"number\">106</span>;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">start</span> slave; 两段互为辅助</span><br><span class=\"line\"><span class=\"keyword\">show</span> slave status\\G  验证配置</span><br><span class=\"line\">unlock tables;  解锁验证</span><br></pre></td></tr></table></figure>\n<p>1 .  Master_host 指的是 主服务器的地址。</p>\n<p>2 . Master_user 指的是主服务器上用来复制的用户。  从服务器会用此账号来登录主服务。进行复制。</p>\n<p>3 . Master_log_file 就是前面提到的， 主服务器上的日志文件名.</p>\n<p>4 . Read_Master_log_pos 就是前面提到的主服务器的日志记录位置， 从服务器根据这两个条件来选择复制的文件和位置。</p>\n<p>5 . Slave_IO_Running 指的就是从服务器上负责读取主服务器的线程工作状态。 从服务器用这个专门的线程链接到主服务器上，并把日志拷贝回来。</p>\n<p>6 . Slave_SQL_Running 指的就是专门执行sql的线程。 它负责把复制回来的Relaylog执行到自己的数据库中。 这两个参数必须都为Yes 才表明复制在正常工作。</p>\n<p>此时你在A或者B端对test数据库里的内容进行修改，另一端会同步你的更改</p>\n","tags":["mysql"]},{"title":"Nginx 启用gzip压缩","url":"/2018/03/01/Nginx%20%E5%90%AF%E7%94%A8gzip%E5%8E%8B%E7%BC%A9/","content":"<h5 id=\"网页压缩\"><a href=\"#网页压缩\" class=\"headerlink\" title=\"网页压缩\"></a>网页压缩</h5><p>　　网页压缩是一项由 WEB 服务器和浏览器之间共同遵守的协议，也就是说 WEB 服务器和浏览器都必须支持该技术，所幸的是现在流行的浏览器都是支持的，包括 IE、FireFox、Opera 等；服务器有 Apache 和 IIS 等。双方的协商过程如下：　　<br>　　首先浏览器请求某个 URL 地址，并在请求的头 (head) 中设置属性 accept-encoding 值为 gzip, deflate，表明浏览器支持 gzip 和 deflate 这两种压缩方式（事实上 deflate 也是使用 gzip 压缩协议，下面我们会介绍二者之间的区别）；</p>\n<p>　　WEB 服务器接收到请求后判断浏览器是否支持压缩，如果支持就传送压缩后的响应内容，否则传送不经过压缩的内容；<br>　　浏览器获取响应内容后，判断内容是否被压缩，如果是则解压缩，然后显示响应页面的内容。</p>\n<p>　　在实际的应用中我们发现压缩的比率往往在 3 到 10 倍，也就是本来 50k 大小的页面，采用压缩后实际传输的内容大小只有 5 至 15k 大小，这可以大大节省服务器的网络带宽，同时如果应用程序的响应足够快时，网站的速度瓶颈就转到了网络的传输速度上，因此内容压缩后就可以大大的提升页面的浏览速度。</p>\n<span id=\"more\"></span>\n\n<h5 id=\"配置启用gzip\"><a href=\"#配置启用gzip\" class=\"headerlink\" title=\"配置启用gzip\"></a>配置启用gzip</h5><p>在nginx.conf中，gzip的配置可以写在http段，server段中的任何地方</p>\n<p>格式如下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">gzip on;</span><br><span class=\"line\">gzip_min_length  5k;</span><br><span class=\"line\">gzip_buffers     4 16k;</span><br><span class=\"line\"><span class=\"comment\">#gzip_http_version 1.0;</span></span><br><span class=\"line\">gzip_comp_level 3;</span><br><span class=\"line\">gzip_types       text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class=\"line\">gzip_vary on;</span><br></pre></td></tr></table></figure>\n<p>保存，重启nginx</p>\n<h6 id=\"配置指令详细注释：\"><a href=\"#配置指令详细注释：\" class=\"headerlink\" title=\"配置指令详细注释：\"></a>配置指令详细注释：</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">gzip on|off</span><br><span class=\"line\"><span class=\"comment\"># 默认值: gzip off</span></span><br><span class=\"line\"><span class=\"comment\"># 开启或者关闭gzip模块</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_static on|off</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># nginx对于静态文件的处理模块</span></span><br><span class=\"line\"><span class=\"comment\"># 该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗。该模块启用后，nginx首先检查是否存在请求静态文件的gz结尾的文件，如果有则直接返回该gz文件内容。为了要兼容不支持gzip的浏览器，启用gzip_static模块就必须同时保留原始静态文件和gz文件。这样的话，在有大量静态文件的情况下，将会大大增加磁盘空间。我们可以利用nginx的反向代理功能实现只保留gz文件。</span></span><br><span class=\"line\"><span class=\"comment\"># 可以google&quot;nginx gzip_static&quot;了解更多</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_comp_level 4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认值：1(建议选择为4)</span></span><br><span class=\"line\"><span class=\"comment\"># gzip压缩比/压缩级别，压缩级别 1-9，级别越高压缩率越大，当然压缩时间也就越长（传输快但比较消耗cpu）。</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_buffers 4 16k</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认值: gzip_buffers 4 4k/8k</span></span><br><span class=\"line\"><span class=\"comment\"># 设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。 例如 4 4k 代表以4k为单位，按照原始数据大小以4k为单位的4倍申请内存。 4 8k 代表以8k为单位，按照原始数据大小以8k为单位的4倍申请内存。</span></span><br><span class=\"line\"><span class=\"comment\"># 如果没有设置，默认值是申请跟原始数据相同大小的内存空间去存储gzip压缩结果。</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_types mime-type [mime-type ...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认值: gzip_types text/html (默认不对js/css文件进行压缩)</span></span><br><span class=\"line\"><span class=\"comment\"># 压缩类型，匹配MIME类型进行压缩</span></span><br><span class=\"line\"><span class=\"comment\"># 不能用通配符 text/*</span></span><br><span class=\"line\"><span class=\"comment\"># (无论是否指定)text/html默认已经压缩</span></span><br><span class=\"line\"><span class=\"comment\"># 设置哪压缩种文本文件可参考 conf/mime.types</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_min_length  1k</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认值: 0 ，不管页面多大都压缩</span></span><br><span class=\"line\"><span class=\"comment\"># 设置允许压缩的页面最小字节数，页面字节数从header头中的Content-Length中进行获取。</span></span><br><span class=\"line\"><span class=\"comment\"># 建议设置成大于1k的字节数，小于1k可能会越压越大。 即: gzip_min_length 1024</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_http_version 1.0|1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认值: gzip_http_version 1.1(就是说对HTTP/1.1协议的请求才会进行gzip压缩)</span></span><br><span class=\"line\"><span class=\"comment\"># 识别http的协议版本。由于早期的一些浏览器或者http客户端，可能不支持gzip自解压，用户就会看到乱码，所以做一些判断还是有必要的。</span></span><br><span class=\"line\"><span class=\"comment\"># 注：99.99%的浏览器基本上都支持gzip解压了，所以可以不用设这个值,保持系统默认即可。</span></span><br><span class=\"line\"><span class=\"comment\"># 假设我们使用的是默认值1.1，如果我们使用了proxy_pass进行反向代理，那么nginx和后端的upstream server之间是用HTTP/1.0协议通信的，如果我们使用nginx通过反向代理做Cache Server，而且前端的nginx没有开启gzip，同时，我们后端的nginx上没有设置gzip_http_version为1.0，那么Cache的url将不会进行gzip压缩</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_proxied [off|expired|no-cache|no-store|private|no_last_modified|no_etag|auth|any] ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认值：off</span></span><br><span class=\"line\"><span class=\"comment\"># Nginx作为反向代理的时候启用，开启或者关闭后端服务器返回的结果，匹配的前提是后端服务器必须要返回包含&quot;Via&quot;的 header头。</span></span><br><span class=\"line\">off - 关闭所有的代理结果数据的压缩</span><br><span class=\"line\">expired - 启用压缩，如果header头中包含 <span class=\"string\">&quot;Expires&quot;</span> 头信息</span><br><span class=\"line\">no-cache - 启用压缩，如果header头中包含 <span class=\"string\">&quot;Cache-Control:no-cache&quot;</span> 头信息</span><br><span class=\"line\">no-store - 启用压缩，如果header头中包含 <span class=\"string\">&quot;Cache-Control:no-store&quot;</span> 头信息</span><br><span class=\"line\">private - 启用压缩，如果header头中包含 <span class=\"string\">&quot;Cache-Control:private&quot;</span> 头信息</span><br><span class=\"line\">no_last_modified - 启用压缩,如果header头中不包含 <span class=\"string\">&quot;Last-Modified&quot;</span> 头信息</span><br><span class=\"line\">no_etag - 启用压缩 ,如果header头中不包含 <span class=\"string\">&quot;ETag&quot;</span> 头信息</span><br><span class=\"line\">auth - 启用压缩 , 如果header头中包含 <span class=\"string\">&quot;Authorization&quot;</span> 头信息</span><br><span class=\"line\">any - 无条件启用压缩</span><br><span class=\"line\"></span><br><span class=\"line\">gzip_vary on</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 和http头有关系，加个vary头，给代理服务器用的，有的浏览器支持压缩，有的不支持，所以避免浪费不支持的也压缩，所以根据客户端的HTTP头来判断，是否需要压缩</span></span><br><span class=\"line\"></span><br><span class=\"line\">gzip_disable <span class=\"string\">&quot;MSIE [1-6].&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用IE6的gzip压缩，又是因为杯具的IE6。当然，IE6目前依然广泛的存在，所以这里你也可以设置为“MSIE [1-5].”</span></span><br><span class=\"line\"><span class=\"comment\"># IE6的某些版本对gzip的压缩支持很不好，会造成页面的假死，今天产品的同学就测试出了这个问题</span></span><br><span class=\"line\">后来调试后，发现是对img进行gzip后造成IE6的假死，把对img的gzip压缩去掉后就正常了</span><br><span class=\"line\">为了确保其它的IE6版本不出问题，所以建议加上gzip_disable的设置</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/Nginx%20%E5%90%AF%E7%94%A8gzip%E5%8E%8B%E7%BC%A9/Nginx%20%E5%90%AF%E7%94%A8gzip%E5%8E%8B%E7%BC%A91.png\" alt=\"Nginx 启用gzip压缩\"><br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/Nginx%20%E5%90%AF%E7%94%A8gzip%E5%8E%8B%E7%BC%A9/Nginx%20%E5%90%AF%E7%94%A8gzip%E5%8E%8B%E7%BC%A92.png\" alt=\"Nginx 启用gzip压缩\"></p>\n<p>可以看到，网页请求的文件只有7.3K</p>\n<p>而实际文件大小大约是10K（10141）</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/Nginx%20%E5%90%AF%E7%94%A8gzip%E5%8E%8B%E7%BC%A9/Nginx%20%E5%90%AF%E7%94%A8gzip%E5%8E%8B%E7%BC%A93.png\" alt=\"Nginx 启用gzip压缩\"></p>\n<p>这张图可以看到response header 中说明了使用了gzip压缩</p>\n<p>参考 <a href=\"https://www.cnblogs.com/yingsong/p/6047311.html\" action=\"_blank\">https://www.cnblogs.com/yingsong/p/6047311.html</a> </br><br><a href=\"http://blog.csdn.net/hjh15827475896/article/details/53432823\" action=\"_blank\">http://blog.csdn.net/hjh15827475896/article/details/53432823</a></p>\n","tags":["centos","nginx"]},{"title":"NGINX-启动-warn-conflicting-server-name-“xxx-com”-on-0-0-0-0-80-ignored原因分析","url":"/2017/12/03/NGINX-%E5%90%AF%E5%8A%A8-warn-conflicting-server-name-%E2%80%9Cxxx-com%E2%80%9D-on-0-0-0-0-80-ignored%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90/","content":"<p>报错如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nginx: [warn] conflicting server name “www.xxx.com” on 0.0.0.0:80, ignored</span><br></pre></td></tr></table></figure>\n<p>域名重复配置所致</p>\n","tags":["nginx"]},{"title":"Nginx使用brotli","url":"/2018/11/09/Nginx%E4%BD%BF%E7%94%A8brotli/","content":"<h5 id=\"首先下载brotli的nginx模块\"><a href=\"#首先下载brotli的nginx模块\" class=\"headerlink\" title=\"首先下载brotli的nginx模块\"></a>首先下载brotli的nginx模块</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/google/ngx_brotli.git</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"接着下载brotli源代码\"><a href=\"#接着下载brotli源代码\" class=\"headerlink\" title=\"接着下载brotli源代码\"></a>接着下载brotli源代码</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> ngx_brotli</span><br><span class=\"line\"><span class=\"built_in\">cd</span> deps/brotli</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/google/brotli.git</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<h5 id=\"编译nginx源代码指定第三方模块\"><a href=\"#编译nginx源代码指定第三方模块\" class=\"headerlink\" title=\"编译nginx源代码指定第三方模块\"></a>编译nginx源代码指定第三方模块</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./configure </span><br><span class=\"line\">--prefix=/opt/local/nginx --without-http_memcached_module --user=www --group=www --with-http_stub_status_module --with-openssl=/usr/ --with-pcre=/opt/local/src/pcre-8.36 --add-module=/opt/local/src/ngx_brotli</span><br></pre></td></tr></table></figure>\n<h5 id=\"可能会报错，提示你\"><a href=\"#可能会报错，提示你\" class=\"headerlink\" title=\"可能会报错，提示你\"></a>可能会报错，提示你</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./configure: error: Brotli library is missing from the /opt/local/src/ngx_brotli/deps/brotli directory.</span><br><span class=\"line\">Please make sure that the git submodule has been checked out:</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src/ngx_brotli &amp;&amp; git submodule update --init &amp;&amp; <span class=\"built_in\">cd</span> /opt/local/src/nginx-1.12.1</span><br></pre></td></tr></table></figure>\n<h5 id=\"照着它的提示操作就好了-网络不好的话需要等很长时间，这时候就是展现技术的时候了，你懂得\"><a href=\"#照着它的提示操作就好了-网络不好的话需要等很长时间，这时候就是展现技术的时候了，你懂得\" class=\"headerlink\" title=\"照着它的提示操作就好了,网络不好的话需要等很长时间，这时候就是展现技术的时候了，你懂得\"></a>照着它的提示操作就好了,网络不好的话需要等很长时间，这时候就是展现技术的时候了，你懂得</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src/ngx_brotli &amp;&amp; git submodule update --init &amp;&amp; <span class=\"built_in\">cd</span> /opt/local/src/nginx-1.12.1</span><br></pre></td></tr></table></figure>\n<h5 id=\"操作完以后，再一次编译nginx源码\"><a href=\"#操作完以后，再一次编译nginx源码\" class=\"headerlink\" title=\"操作完以后，再一次编译nginx源码\"></a>操作完以后，再一次编译nginx源码</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./configure </span><br><span class=\"line\">--prefix=/opt/local/nginx --without-http_memcached_module --user=www --group=www --with-http_stub_status_module --with-openssl=/usr/ --with-pcre=/opt/local/src/pcre-8.36 --add-module=/opt/local/src/ngx_brotli</span><br></pre></td></tr></table></figure>\n<h5 id=\"make\"><a href=\"#make\" class=\"headerlink\" title=\"make\"></a>make</h5><h5 id=\"拷贝新的nginx-bin文件\"><a href=\"#拷贝新的nginx-bin文件\" class=\"headerlink\" title=\"拷贝新的nginx bin文件\"></a>拷贝新的nginx bin文件</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mv</span> /opt/local/nginx/sbin/nginx /opt/local/nginx/sbin/nginx_bak</span><br><span class=\"line\"><span class=\"built_in\">cp</span> objs/nginx /opt/local/nginx/sbin/</span><br><span class=\"line\"></span><br><span class=\"line\">/opt/local/nginx/sbin/nginx -t</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"不报错的话，就修改配置文件去\"><a href=\"#不报错的话，就修改配置文件去\" class=\"headerlink\" title=\"不报错的话，就修改配置文件去\"></a>不报错的话，就修改配置文件去</h5><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\"><span class=\"comment\">#brotli_types text/plain text/css text/xml application/xml application/json text/javascript application/javascript application/x-javascript</span></span><br><span class=\"line\"><span class=\"attribute\">brotli_types</span> *;</span><br><span class=\"line\"><span class=\"attribute\">brotli_static</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\"><span class=\"attribute\">brotli_comp_level</span> <span class=\"number\">11</span>;</span><br><span class=\"line\"><span class=\"attribute\">brotli_buffers</span> <span class=\"number\">16</span> <span class=\"number\">8k</span>;</span><br><span class=\"line\"><span class=\"attribute\">brotli_window</span> <span class=\"number\">512k</span>;</span><br><span class=\"line\"><span class=\"attribute\">brotli_min_length</span> <span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"反向代理禁用gzip\"><a href=\"#反向代理禁用gzip\" class=\"headerlink\" title=\"反向代理禁用gzip\"></a>反向代理禁用gzip</h5><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">proxy_set_header</span> Accept-Encoding <span class=\"string\">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>\n<h5 id=\"最后在Request-Headers请求头和Response-Headers响应头里可以看到\"><a href=\"#最后在Request-Headers请求头和Response-Headers响应头里可以看到\" class=\"headerlink\" title=\"最后在Request Headers请求头和Response Headers响应头里可以看到\"></a>最后在Request Headers请求头和Response Headers响应头里可以看到</h5><p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/b11c555acaa92bbf9363cfec3e321a30dc950319/Nginx%E4%BD%BF%E7%94%A8brotli.png\" alt=\"nginx_brotli\"></p>\n<h5 id=\"ngx-brotli定义了如下指令：\"><a href=\"#ngx-brotli定义了如下指令：\" class=\"headerlink\" title=\"ngx_brotli定义了如下指令：\"></a>ngx_brotli定义了如下指令：</h5><h6 id=\"brotli，是否允许动态压缩响应数据，可选值为on和off，默认值为off。\"><a href=\"#brotli，是否允许动态压缩响应数据，可选值为on和off，默认值为off。\" class=\"headerlink\" title=\"brotli，是否允许动态压缩响应数据，可选值为on和off，默认值为off。\"></a>brotli，是否允许动态压缩响应数据，可选值为on和off，默认值为off。</h6><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli</span> <span class=\"literal\">on</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"brotli-types，动态压缩启用时，允许压缩的MIME-types，默认值为text-x2F-html。\"><a href=\"#brotli-types，动态压缩启用时，允许压缩的MIME-types，默认值为text-x2F-html。\" class=\"headerlink\" title=\"brotli_types，动态压缩启用时，允许压缩的MIME types，默认值为text&#x2F;html。\"></a>brotli_types，动态压缩启用时，允许压缩的MIME types，默认值为text&#x2F;html。</h6><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli_types</span> text/plain text/css text/xml application/xml application/json text/javascript application/javascript application/x-javascript;</span><br></pre></td></tr></table></figure>\n<h6 id=\"brotli-static，是否允许查找预处理好的、以-br结尾的压缩文件，可选值为on、off和always，默认值为off。\"><a href=\"#brotli-static，是否允许查找预处理好的、以-br结尾的压缩文件，可选值为on、off和always，默认值为off。\" class=\"headerlink\" title=\"brotli_static，是否允许查找预处理好的、以.br结尾的压缩文件，可选值为on、off和always，默认值为off。\"></a>brotli_static，是否允许查找预处理好的、以.br结尾的压缩文件，可选值为on、off和always，默认值为off。</h6><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli_static</span> <span class=\"literal\">off</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"brotli-comp-level，压缩级别，可选值范围为0-11，默认值为6。\"><a href=\"#brotli-comp-level，压缩级别，可选值范围为0-11，默认值为6。\" class=\"headerlink\" title=\"brotli_comp_level，压缩级别，可选值范围为0~11，默认值为6。\"></a>brotli_comp_level，压缩级别，可选值范围为0~11，默认值为6。</h6><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli_comp_level</span> <span class=\"number\">11</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"brotli-buffers，压缩响应数据时使用的缓冲区的数量和大小。\"><a href=\"#brotli-buffers，压缩响应数据时使用的缓冲区的数量和大小。\" class=\"headerlink\" title=\"brotli_buffers，压缩响应数据时使用的缓冲区的数量和大小。\"></a>brotli_buffers，压缩响应数据时使用的缓冲区的数量和大小。</h6><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli_buffers</span> <span class=\"number\">16</span> <span class=\"number\">8k</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"brotli-window，brotli使用的窗口值，默认值为512k。\"><a href=\"#brotli-window，brotli使用的窗口值，默认值为512k。\" class=\"headerlink\" title=\"brotli_window，brotli使用的窗口值，默认值为512k。\"></a>brotli_window，brotli使用的窗口值，默认值为512k。</h6><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli_window</span> <span class=\"number\">512k</span>;</span><br></pre></td></tr></table></figure>\n<h6 id=\"brotli-min-length，响应数据的最小长度，低于该值将不使用brotli算法执行压缩操作。brotli算法使用Content-Length来确定响应数据的长度。\"><a href=\"#brotli-min-length，响应数据的最小长度，低于该值将不使用brotli算法执行压缩操作。brotli算法使用Content-Length来确定响应数据的长度。\" class=\"headerlink\" title=\"brotli_min_length，响应数据的最小长度，低于该值将不使用brotli算法执行压缩操作。brotli算法使用Content-Length来确定响应数据的长度。\"></a>brotli_min_length，响应数据的最小长度，低于该值将不使用brotli算法执行压缩操作。brotli算法使用Content-Length来确定响应数据的长度。</h6><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">brotli_min_length</span> <span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"★★★-最后，brotli只对https生效\"><a href=\"#★★★-最后，brotli只对https生效\" class=\"headerlink\" title=\"★★★ 最后，brotli只对https生效\"></a>★★★ 最后，brotli只对https生效</h5>","tags":["nginx"]},{"title":"PDO-MYSQL-make-pdo-mysql-lo-Error-1","url":"/2017/12/03/PDO-MYSQL-make-pdo-mysql-lo-Error-1/","content":"<p>编译安装PDO_MYSQL拓展模块，总是提示</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">In file included from /data0/software/PDO_MYSQL-1.0.2/pdo_mysql.c:31:</span><br><span class=\"line\">/data0/software/PDO_MYSQL-1.0.2/php_pdo_mysql_int.h:25:19: error: mysql.h: No such file or directory</span><br><span class=\"line\">In file included from /data0/software/PDO_MYSQL-1.0.2/pdo_mysql.c:31:</span><br><span class=\"line\">/data0/software/PDO_MYSQL-1.0.2/php_pdo_mysql_int.h:36: error: expected specifier-qualifier-list before ‘MYSQL’</span><br><span class=\"line\">/data0/software/PDO_MYSQL-1.0.2/php_pdo_mysql_int.h:48: error: expected specifier-qualifier-list before ‘MYSQL_FIELD’</span><br><span class=\"line\">/data0/software/PDO_MYSQL-1.0.2/php_pdo_mysql_int.h:53: error: expected specifier-qualifier-list before ‘MYSQL_RES’</span><br><span class=\"line\">make: *** [pdo_mysql.lo] Error 1</span><br></pre></td></tr></table></figure>\n<p>这是因为这是因为在编译时需要 MySQL 的头的文件。而它按默认搜索找不到头文件的位置，所以才出现这个问题。通过软连接把MySQL头文件对应到&#x2F;usr&#x2F;local&#x2F;include&#x2F;下就好<br>比如你的MySQL安装文件位于&#x2F;usr&#x2F;local&#x2F;mysql，那么就执行以下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/mysql/include/* /usr/local/include/</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"PHP curl returns (35) SSL connect error","url":"/2018/04/15/PHP%20curl%20returns%20(35)%20SSL%20connect%20error/","content":"<p>用PHP cURL来获取https链接的页面，出现错误PHP curl returns (35) SSL connect error，<br>找到一个方法，记录一下，以免忘记。</p>\n<p>解决方法：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum update nss</span><br></pre></td></tr></table></figure>\n\n<p>Q:但是，什么是NSS呢？</p>\n<p>A:curl模块的ssl 支持默认为NSS,网络安全服务（NSS）</p>\n<p><a href=\"http://www.linuxfromscratch.org/blfs/view/svn/postlfs/nss.html\">The Network Security Services (NSS)</a></p>\n<p>再来个详细解释<br><a href=\"https://serverfault.com/questions/606135/curl-35-ssl-connect-error/642203#642203\"><br>https://serverfault.com/questions/606135/curl-35-ssl-connect-error/642203#642203<br></a></p>\n","tags":["centos","php","nss"]},{"title":"PHP导出数据报表","url":"/2020/01/19/PHP%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%A1%A8/","content":"<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@FILE</span>_NAME:ExcelExport.php</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span> csv导出数据</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2019-12-04 13:52:58</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExcelExport</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:sqlQuery</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 生成器模式返回数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-01-08 16:43</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $sql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Generator</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sqlQuery</span>(<span class=\"params\"><span class=\"variable\">$sql</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$sys</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">SysModel</span>();</span><br><span class=\"line\">        <span class=\"variable\">$db</span> = <span class=\"variable\">$sys</span>-&gt;<span class=\"title function_ invoke__\">getAdapter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$db</span>-&gt;<span class=\"title function_ invoke__\">fetchAll</span>(<span class=\"variable\">$sql</span>) <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$val</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> <span class=\"variable\">$val</span>; <span class=\"comment\">//生成器返回数据，避免内存溢出</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:exportExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-01-09 09:23</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $title</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $sql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> array $data example : [&quot;单号&quot; =&gt; &#x27;order_key&#x27;],[&#x27;报表title名称&#x27;=&gt;&#x27;mysql语句字段名&#x27;]</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">exportExcel</span>(<span class=\"params\"><span class=\"variable\">$title</span> = <span class=\"string\">&#x27;报表导出&#x27;</span>, <span class=\"variable\">$sql</span> = <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$data</span> = []</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">getcwd</span>() . <span class=\"string\">&quot;/data_export/&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//删除历史表格</span></span><br><span class=\"line\">        <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">deleteExcel</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">file_exists</span>(<span class=\"variable\">$data_dir</span>) || !<span class=\"title function_ invoke__\">is_writable</span>(<span class=\"variable\">$data_dir</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!@<span class=\"title function_ invoke__\">mkdir</span>(<span class=\"variable\">$data_dir</span>, <span class=\"number\">0755</span>, <span class=\"literal\">TRUE</span>)) &#123;</span><br><span class=\"line\">                <span class=\"title class_\">Tools</span>::<span class=\"title function_ invoke__\">dieJs</span>(<span class=\"string\">&quot;alert(&#x27;导出失败，请联系管理员处理&#x27;);history.go(-1);&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = <span class=\"variable\">$title</span> . <span class=\"title function_ invoke__\">time</span>() . <span class=\"string\">&quot;.csv&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$file_path</span> = <span class=\"variable\">$data_dir</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//拼接sql</span></span><br><span class=\"line\">        <span class=\"variable\">$fields</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$title_fields</span> = [];</span><br><span class=\"line\">        <span class=\"variable\">$temp_key</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"variable\">$fields_count</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$field</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp_key</span> += <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"variable\">$fields</span> .= <span class=\"string\">&quot;ifnull(<span class=\"subst\">&#123;$field&#125;</span>,&#x27;&#x27;) as <span class=\"subst\">&#123;$field&#125;</span>&quot;</span> . (<span class=\"variable\">$temp_key</span> &lt; <span class=\"variable\">$fields_count</span> ? <span class=\"string\">&#x27;,&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">array_push</span>(<span class=\"variable\">$title_fields</span>, <span class=\"variable\">$key</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$fp</span> = <span class=\"title function_ invoke__\">fopen</span>(<span class=\"variable\">$file_path</span>, <span class=\"string\">&#x27;w&#x27;</span>); <span class=\"comment\">//生成临时文件</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">fwrite</span>(<span class=\"variable\">$fp</span>, <span class=\"title function_ invoke__\">chr</span>(<span class=\"number\">0xEF</span>) . <span class=\"title function_ invoke__\">chr</span>(<span class=\"number\">0xBB</span>) . <span class=\"title function_ invoke__\">chr</span>(<span class=\"number\">0xBF</span>));<span class=\"comment\">//转码,防止乱码</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">fputcsv</span>(<span class=\"variable\">$fp</span>, <span class=\"variable\">$title_fields</span>);<span class=\"comment\">//插入标题</span></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">sqlQuery</span>(<span class=\"string\">&quot;SELECT <span class=\"subst\">&#123;$fields&#125;</span> FROM (<span class=\"subst\">&#123;$sql&#125;</span>) as t&quot;</span>) <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">fputcsv</span>(<span class=\"variable\">$fp</span>, <span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">fclose</span>(<span class=\"variable\">$fp</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">downloadExcel</span>(<span class=\"variable\">$file_path</span>, <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:downloadExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-01-08 16:46</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $file_path</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $file_name</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadExcel</span>(<span class=\"params\"><span class=\"variable\">$file_path</span> = <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$file_name</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">ob_end_clean</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">file_exists</span>(<span class=\"variable\">$file_path</span>)) &#123;</span><br><span class=\"line\">            <span class=\"title class_\">Tools</span>::<span class=\"title function_ invoke__\">dieJs</span>(<span class=\"string\">&quot;alert(&#x27;文件不存在，请联系管理员处理&#x27;);history.go(-1);&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$fp</span> = <span class=\"title function_ invoke__\">fopen</span>(<span class=\"variable\">$file_path</span>, <span class=\"string\">&quot;r&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_size</span> = <span class=\"title function_ invoke__\">filesize</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//下载文件需要用到的头</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Accept-Ranges: bytes&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Accept-Length:&quot;</span> . <span class=\"variable\">$file_size</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\">        <span class=\"variable\">$buffer</span> = <span class=\"number\">1024</span>;</span><br><span class=\"line\">        <span class=\"variable\">$file_count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!<span class=\"title function_ invoke__\">feof</span>(<span class=\"variable\">$fp</span>) &amp;&amp; <span class=\"variable\">$file_count</span> &lt; <span class=\"variable\">$file_size</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$file_con</span> = <span class=\"title function_ invoke__\">fread</span>(<span class=\"variable\">$fp</span>, <span class=\"variable\">$buffer</span>);</span><br><span class=\"line\">            <span class=\"variable\">$file_count</span> += <span class=\"variable\">$buffer</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"variable\">$file_con</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">fclose</span>(<span class=\"variable\">$fp</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:deleteExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 删除没用的表格</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 15:05:01</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deleteExcel</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//几分钟前的时间戳</span></span><br><span class=\"line\">        <span class=\"variable\">$delete_time</span> = <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;-5 minute&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">getcwd</span>() . <span class=\"string\">&quot;/data_export/*.csv&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">glob</span>(<span class=\"variable\">$data_dir</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>(<span class=\"variable\">$data_dir</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data_dir</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$file_path</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp_time</span> = <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">findNum</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_time</span> &lt; <span class=\"variable\">$delete_time</span>) &#123;</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">unlink</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:findNum</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 14:54:11</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $str</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findNum</span>(<span class=\"params\"><span class=\"variable\">$str</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$str</span> = <span class=\"title function_ invoke__\">trim</span>(<span class=\"variable\">$str</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>(<span class=\"variable\">$str</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$temp</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;4&#x27;</span>, <span class=\"string\">&#x27;5&#x27;</span>, <span class=\"string\">&#x27;6&#x27;</span>, <span class=\"string\">&#x27;7&#x27;</span>, <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>, <span class=\"string\">&#x27;0&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$str</span>); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$str</span>[<span class=\"variable\">$i</span>], <span class=\"variable\">$temp</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$result</span> .= <span class=\"variable\">$str</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$result</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":["php"]},{"title":"RSA数据加密解密","url":"/2020/08/22/RSA%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/","content":"<h6 id=\"RSA数据加密解密\"><a href=\"#RSA数据加密解密\" class=\"headerlink\" title=\"RSA数据加密解密\"></a>RSA数据加密解密</h6><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//定义常量</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">define</span>(<span class=\"string\">&quot;INVOICE_PRINT_URL&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">define</span>(<span class=\"string\">&quot;MERCHANT_ID&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">define</span>(<span class=\"string\">&quot;MERCHANT_SECRET&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">define</span>(<span class=\"string\">&quot;PLATFORM_PUBLIC_KEY&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">define</span>(<span class=\"string\">&quot;MERCHANT_PUBLIC_KEY&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">define</span>(<span class=\"string\">&quot;MERCHANT_PRIVATE_KEY&quot;</span>, $<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">define</span>(<span class=\"string\">&quot;ACCOUNT_VALUE&quot;</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"variable constant_\">KEYSIZE</span> = <span class=\"number\">2048</span>;<span class=\"comment\">//密钥长度</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:getPlatformPublicKey</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 获取平台公钥</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-08-17 8:29</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> false|resource</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPlatformPublicKey</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">openssl_pkey_get_public</span>(PLATFORM_PUBLIC_KEY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:getMerchantPrivateKey</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 获取商户私钥</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-08-17 8:29</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> false|resource</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getMerchantPrivateKey</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">openssl_pkey_get_private</span>(MERCHANT_PRIVATE_KEY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:getMerchantPublicKey</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 获取商户公钥</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-08-17 8:29</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> false|resource</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getMerchantPublicKey</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">openssl_pkey_get_public</span>(MERCHANT_PUBLIC_KEY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:sslPublicEncrypt</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 公钥加密数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-08-14 10:42</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $source_data</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sslPublicEncrypt</span>(<span class=\"params\"><span class=\"variable\">$source_data</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable\">$source_data</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">500</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"string\">&#x27;加密数据为空&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$key</span> = <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">getPlatformPublicKey</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable\">$key</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">500</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"string\">&#x27;平台密钥不正确，请检查平台密钥配置&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$dataArray</span> = <span class=\"title function_ invoke__\">str_split</span>(<span class=\"variable\">$source_data</span>, <span class=\"built_in\">self</span>::<span class=\"variable constant_\">KEYSIZE</span> / <span class=\"number\">8</span> - <span class=\"number\">11</span>); <span class=\"comment\">//加密最长长度为(self::KEYSIZE / 8 - 11)</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$dataArray</span> <span class=\"keyword\">as</span> <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$res</span> = <span class=\"title function_ invoke__\">openssl_public_encrypt</span>(<span class=\"variable\">$value</span>, <span class=\"variable\">$encryptedTemp</span>, <span class=\"variable\">$key</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!<span class=\"variable\">$res</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">500</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"string\">&#x27;加密失败，请重试&#x27;</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"variable\">$data</span> .= <span class=\"variable\">$encryptedTemp</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">openssl_free_key</span>(<span class=\"variable\">$key</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">200</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"variable\">$data</span>)];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:sslPrivateDecrypt</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 私钥解密</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2020-08-14 10:56</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $encryptData</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> array</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sslPrivateDecrypt</span>(<span class=\"params\"><span class=\"variable\">$encryptData</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable\">$encryptData</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">500</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"string\">&#x27;没有解密数据&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$decrypted</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$decodeStr</span> = <span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$encryptData</span>);</span><br><span class=\"line\">        <span class=\"variable\">$key</span> = <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">getMerchantPrivateKey</span>();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable\">$key</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">500</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"string\">&#x27;获取密钥失败，请联系管理员处理&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$enArray</span> = <span class=\"title function_ invoke__\">str_split</span>(<span class=\"variable\">$decodeStr</span>, <span class=\"built_in\">self</span>::<span class=\"variable constant_\">KEYSIZE</span> / <span class=\"number\">8</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$enArray</span> <span class=\"keyword\">as</span> <span class=\"variable\">$va</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$decryptedTemp</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable\">$res</span> = <span class=\"title function_ invoke__\">openssl_private_decrypt</span>(<span class=\"variable\">$va</span>, <span class=\"variable\">$decryptedTemp</span>, <span class=\"variable\">$key</span>, OPENSSL_PKCS1_PADDING);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!<span class=\"variable\">$res</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">500</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"string\">&#x27;加密失败，请联系管理员处理&#x27;</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"variable\">$decrypted</span> .= <span class=\"variable\">$decryptedTemp</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">openssl_free_key</span>(<span class=\"variable\">$key</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [<span class=\"string\">&#x27;code&#x27;</span> =&gt; <span class=\"number\">200</span>, <span class=\"string\">&#x27;message&#x27;</span> =&gt; <span class=\"variable\">$decrypted</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","tags":["php"]},{"title":"SQL纵向变成横向，横向变成纵向","url":"/2018/09/30/SQL%E7%BA%B5%E5%90%91%E5%8F%98%E6%88%90%E6%A8%AA%E5%90%91%EF%BC%8C%E6%A8%AA%E5%90%91%E5%8F%98%E6%88%90%E7%BA%B5%E5%90%91/","content":"<h3 id=\"纵向变成横向\"><a href=\"#纵向变成横向\" class=\"headerlink\" title=\"纵向变成横向\"></a>纵向变成横向</h3><table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Subject</th>\n<th>Result</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>张三</td>\n<td>语文</td>\n<td>73</td>\n</tr>\n<tr>\n<td>张三</td>\n<td>数学</td>\n<td>83</td>\n</tr>\n<tr>\n<td>张三</td>\n<td>物理</td>\n<td>93</td>\n</tr>\n<tr>\n<td>李四</td>\n<td>语文</td>\n<td>74</td>\n</tr>\n<tr>\n<td>李四</td>\n<td>数学</td>\n<td>84</td>\n</tr>\n<tr>\n<td>李四</td>\n<td>物理</td>\n<td>94</td>\n</tr>\n</tbody></table>\n<p>转换成</p>\n<p>| 姓名 | 语文 | 数学 | 物理 |<br>| —— | —— | —— |<br>| 李四 | 74 | 84 | 94 |<br>| 张三 | 73 | 83 | 93 |</p>\n<h4 id=\"建表插入数据\"><a href=\"#建表插入数据\" class=\"headerlink\" title=\"建表插入数据\"></a>建表插入数据</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CREATE TABLE students (</span><br><span class=\"line\">\t`Name` VARCHAR (50),</span><br><span class=\"line\">\t`Subject` VARCHAR (50),</span><br><span class=\"line\">\t`Result` INT (11)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO students</span><br><span class=\"line\">VALUES</span><br><span class=\"line\">\t(&#x27;张三&#x27;, &#x27;语文&#x27;, &#x27;73&#x27;),</span><br><span class=\"line\">\t(&#x27;张三&#x27;, &#x27;数学&#x27;, &#x27;83&#x27;),</span><br><span class=\"line\">\t(&#x27;张三&#x27;, &#x27;物理&#x27;, &#x27;93&#x27;),</span><br><span class=\"line\">\t(&#x27;李四&#x27;, &#x27;语文&#x27;, &#x27;74&#x27;),</span><br><span class=\"line\">\t(&#x27;李四&#x27;, &#x27;数学&#x27;, &#x27;84&#x27;),</span><br><span class=\"line\">\t(&#x27;李四&#x27;, &#x27;物理&#x27;, &#x27;94&#x27;);</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h4 id=\"转换语句\"><a href=\"#转换语句\" class=\"headerlink\" title=\"转换语句\"></a>转换语句</h4><p><strong>这里的SUM也可以用MAX替代，都是取一条数据</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT</span><br><span class=\"line\">\t`Name` AS 姓名,</span><br><span class=\"line\">\tSUM(</span><br><span class=\"line\">\t\tCASE `Subject`</span><br><span class=\"line\">\t\tWHEN &#x27;语文&#x27; THEN</span><br><span class=\"line\">\t\t\t`Result`</span><br><span class=\"line\">\t\tELSE</span><br><span class=\"line\">\t\t\t0</span><br><span class=\"line\">\t\tEND</span><br><span class=\"line\">\t) AS &#x27;语文&#x27;,</span><br><span class=\"line\">\tSUM(</span><br><span class=\"line\">\t\tCASE `Subject`</span><br><span class=\"line\">\t\tWHEN &#x27;数学&#x27; THEN</span><br><span class=\"line\">\t\t\t`Result`</span><br><span class=\"line\">\t\tELSE</span><br><span class=\"line\">\t\t\t0</span><br><span class=\"line\">\t\tEND</span><br><span class=\"line\">\t) AS &#x27;数学&#x27;,</span><br><span class=\"line\">\tSUM(</span><br><span class=\"line\">\t\tCASE `Subject`</span><br><span class=\"line\">\t\tWHEN &#x27;物理&#x27; THEN</span><br><span class=\"line\">\t\t\t`Result`</span><br><span class=\"line\">\t\tELSE</span><br><span class=\"line\">\t\t\t0</span><br><span class=\"line\">\t\tEND</span><br><span class=\"line\">\t) AS &#x27;物理&#x27;</span><br><span class=\"line\">FROM</span><br><span class=\"line\">\tstudents</span><br><span class=\"line\">GROUP BY</span><br><span class=\"line\">\tNAME</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"横向变成纵向\"><a href=\"#横向变成纵向\" class=\"headerlink\" title=\"横向变成纵向\"></a>横向变成纵向</h3><p>| 姓名 | 语文 | 数学 | 物理 |<br>| —— | —— | —— |<br>| 李四 | 74 | 84 | 94 |<br>| 张三 | 73 | 83 | 93 |</p>\n<p>转换成</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Subject</th>\n<th>Result</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>张三</td>\n<td>语文</td>\n<td>73</td>\n</tr>\n<tr>\n<td>张三</td>\n<td>数学</td>\n<td>83</td>\n</tr>\n<tr>\n<td>张三</td>\n<td>物理</td>\n<td>93</td>\n</tr>\n<tr>\n<td>李四</td>\n<td>语文</td>\n<td>74</td>\n</tr>\n<tr>\n<td>李四</td>\n<td>数学</td>\n<td>84</td>\n</tr>\n<tr>\n<td>李四</td>\n<td>物理</td>\n<td>94</td>\n</tr>\n</tbody></table>\n<h4 id=\"建表插入数据-1\"><a href=\"#建表插入数据-1\" class=\"headerlink\" title=\"建表插入数据\"></a>建表插入数据</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CREATE TABLE students_1 (</span><br><span class=\"line\">\t`姓名` VARCHAR (50),</span><br><span class=\"line\">\t`语文` VARCHAR (50),</span><br><span class=\"line\">\t`数学` VARCHAR (50),</span><br><span class=\"line\">\t`物理` VARCHAR (50)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO `students_1` (</span><br><span class=\"line\">\t`姓名`,</span><br><span class=\"line\">\t`语文`,</span><br><span class=\"line\">\t`数学`,</span><br><span class=\"line\">\t`物理`</span><br><span class=\"line\">)</span><br><span class=\"line\">VALUES</span><br><span class=\"line\">\t(&#x27;张三&#x27;, &#x27;73&#x27;, &#x27;83&#x27;, &#x27;93&#x27;),</span><br><span class=\"line\">\t(&#x27;李四&#x27;, &#x27;74&#x27;, &#x27;84&#x27;, &#x27;94&#x27;);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"转换语句-1\"><a href=\"#转换语句-1\" class=\"headerlink\" title=\"转换语句\"></a>转换语句</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT `姓名` AS &#x27;Name&#x27;, `语文` AS &#x27;Subject&#x27;, `语文` AS &#x27;Result&#x27; FROM students_1 UNION</span><br><span class=\"line\">SELECT `姓名` AS &#x27;Name&#x27;, `数学` AS &#x27;Subject&#x27;, `数学` AS &#x27;Result&#x27; FROM students_1 UNION</span><br><span class=\"line\">SELECT `姓名` AS &#x27;Name&#x27;, `物理` AS &#x27;Subject&#x27;, `物理` AS &#x27;Result&#x27; FROM students_1</span><br><span class=\"line\">ORDER BY</span><br><span class=\"line\">`Name` DESC</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://blog.csdn.net/suheonline/article/details/17447495\" target=\"_blank\">参考自：CSDN-会飞的鱼online</a></p>\n","tags":["mysql"]},{"title":"Samba-配置文件详解","url":"/2017/12/02/Samba-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/","content":"<p>Samba 的配置文件 &#x2F;etc&#x2F;samba&#x2F;smb.conf 分为两大部分，一部分是 [global] ，即全局配置，另一部分是 [home] 、[printer] 、[自定义共享名] ，这些都是共享的部分，共享部分的设置优先级高于全局配置，另外，Samba 默认开启本地用户家目录 [home] 和打印机 [printer] 的共享，如果不需要你也可以关闭这两个共享，然后在末行自己重新创建一个共享，下面是详细的配置，你可以自定义一个共享，然后自己选择需要哪些配置：</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[pzk]                                      <span class=\"comment\"># 自定义共享名</span></span><br><span class=\"line\">comment = Home Directories                 <span class=\"comment\"># 描述符，是给系统管理员看的</span></span><br><span class=\"line\">path = /tmp                                <span class=\"comment\"># 共享的路径</span></span><br><span class=\"line\">public = <span class=\"built_in\">yes</span>                               <span class=\"comment\"># 是否公开，也就是是否能在网上邻居看到该共享</span></span><br><span class=\"line\">browseable = <span class=\"built_in\">yes</span>                           <span class=\"comment\"># 共享的目录是否让所有人可见</span></span><br><span class=\"line\">writable = <span class=\"built_in\">yes</span>                             <span class=\"comment\"># 是否可写</span></span><br><span class=\"line\">guest ok = no                              <span class=\"comment\"># 是否拒绝匿名访问，仅当安全级别为 share 时才生效</span></span><br><span class=\"line\">workgroup = WORKGROUP                      <span class=\"comment\"># 工作组，要设置成跟 Windows 的工作组一致</span></span><br><span class=\"line\">server string = Samba Server Version %v    <span class=\"comment\"># 其他 Linux 主机查看共享时的提示符</span></span><br><span class=\"line\">netbios name = MYSERVER                    <span class=\"comment\"># 用于在 Windows 网上邻居上显示的主机名</span></span><br><span class=\"line\">hosts allow = 127. 192.168.12. 192.168.13. EXCEPT 192.168.13.13   <span class=\"comment\"># 指定允许访问 samba 服务器的主机    </span></span><br><span class=\"line\">security = share                           <span class=\"comment\"># 定义安全级别</span></span><br><span class=\"line\"><span class=\"built_in\">log</span> file = /var/log/samba/log.%m           <span class=\"comment\"># 定义日志文件，每个访问的主机会产生独立的日志文件，%m 是客户端主机名</span></span><br><span class=\"line\">max <span class=\"built_in\">log</span> size = 50                          <span class=\"comment\"># 定义单个日志的最大容量（KB）</span></span><br><span class=\"line\">passdb backend = tdbsam                    <span class=\"comment\"># Samba 用户的存储方式，smbpasswd 表示明文存储，tdbsam 表示密文存储</span></span><br><span class=\"line\">deadtime = 10                              <span class=\"comment\"># 客户端在10分钟内没有打开任何 Samba 资源，服务器将自动关闭会话，在大量的并发访问环境中，这样的设置可以提高服务器性能</span></span><br><span class=\"line\">display charset = UTF8                     <span class=\"comment\"># 设置显示的字符集</span></span><br><span class=\"line\">max connections = 0                        <span class=\"comment\"># 设置最大连接数，0表示无限制，如果超过最大连接数则拒绝连接</span></span><br><span class=\"line\">guest account = nobody                     <span class=\"comment\"># 设置匿名账户为nobody</span></span><br><span class=\"line\">load printers = <span class=\"built_in\">yes</span>                        <span class=\"comment\"># 是否在启动 Samba 时就共享打印机    </span></span><br><span class=\"line\">cups options = raw                         <span class=\"comment\"># 设置打印机使用的方式</span></span><br><span class=\"line\">valid <span class=\"built_in\">users</span> = user1 user2    user3         <span class=\"comment\"># 指定哪些用户可以访问，如果不指定则所有用户都可访问</span></span><br><span class=\"line\">invalid <span class=\"built_in\">users</span> = user1 user2                <span class=\"comment\"># 指定哪些用户不可以访问</span></span><br><span class=\"line\">create mask = 0775                         <span class=\"comment\"># 客户端上传文件的默认权限</span></span><br><span class=\"line\">directory mask = 0775                      <span class=\"comment\"># 客户端创建目录的默认权限</span></span><br><span class=\"line\">write list = user1 user2 user3             <span class=\"comment\"># 设置可对文件进行写操作的用户</span></span><br><span class=\"line\">admin <span class=\"built_in\">users</span> = user1                        <span class=\"comment\"># 设置共享目录的管理员，具有完全权限</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">安全级别：</span><br><span class=\"line\">share ：表示匿名用户，不需要 samba 账户就可登陆 samba 服务器</span><br><span class=\"line\">user ：系统账户要先添加进 samba 库然后变成 samba 用户，使用 samba 用户来登陆，简单来讲就是需要使用用户密码登录</span><br><span class=\"line\">server ：由另外一台 samba 服务器来对用户进行身份验证</span><br><span class=\"line\">domain ：把 samba 服务器加入到 NT 域，由 NT 的域控制器来进行身份验证</span><br><span class=\"line\">ADS ：（Active Directory Service，活动目录服务），是 samba3.0 中新增的身份验证方式，采用 ADS 验证方式，samba 服务器集成到活动目录中</span><br></pre></td></tr></table></figure>\n","tags":["linux","samba"]},{"title":"Ubuntu-手动挂载U盘","url":"/2017/12/02/Ubuntu-%E6%89%8B%E5%8A%A8%E6%8C%82%E8%BD%BDU%E7%9B%98/","content":"<p>1.在插入U盘前和插入U盘后，都输入同一个命令，检查多了哪个盘</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> /proc/partitions</span><br></pre></td></tr></table></figure>\n<p>这里我发现多了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">8       16    7827424 sdb</span><br><span class=\"line\">8       17    7825423 sdb1</span><br></pre></td></tr></table></figure>\n<p>sdb是统称，所以新插入的U盘就是&#x2F;dev&#x2F;sdb1</p>\n<span id=\"more\"></span>\n<p>2.用命令检查新的U盘的文件系统格式</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">root@ www.linuxidc.com :/<span class=\"comment\"># fdisk -l /dev/sdb</span></span><br><span class=\"line\">Disk /dev/sdb: 8015 MB, 8015282176 bytes</span><br><span class=\"line\">247 heads, 62 sectors/track, 1022 cylinders, total 15654848 sectors</span><br><span class=\"line\">Units = sectors of 1 * 512 = 512 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disk identifier: 0x0001fce0</span><br><span class=\"line\">   Device Boot      Start         End      Blocks   Id  System</span><br><span class=\"line\">/dev/sdb1   *          62    15650907     7825423    c  W95 FAT32 (LBA)</span><br></pre></td></tr></table></figure>\n<p>看到这里是FAT32格式。</p>\n<p>3.mount</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mount -t vfat /dev/sdb1 /media/usb</span><br></pre></td></tr></table></figure>\n<p>注意:<br>mount -t 按两次tab键会提示输入什么文件系统类型<br>&#x2F;media&#x2F;usb是我自己创建的目录</p>\n<p>4.umount</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">umount /media/usb</span><br></pre></td></tr></table></figure>\n","tags":["ubuntu"]},{"title":"Virtualbox 共享文件夹 cannot create symlink error","url":"/2019/01/26/Virtualbox%20%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9%20cannot%20create%20symlink%20error/","content":"<p>npm操作虚拟机共享文件夹里的文件时出现 <font color=red ><strong>npm Error: EROFS: read-only file system, symlink</strong></font>的报错信息。</p>\n<h5 id=\"解决方法\"><a href=\"#解决方法\" class=\"headerlink\" title=\"解决方法\"></a>解决方法</h5><p>原来VirtualBox从安全角度出发，限制了软链接的创建，需要打开相应的Feature。以下为详细步骤：</p>\n<h6 id=\"关闭-VirtualBox。\"><a href=\"#关闭-VirtualBox。\" class=\"headerlink\" title=\"关闭 VirtualBox。\"></a>关闭 VirtualBox。</h6><h6 id=\"将VirtualBox安装目录的路径加入系统环境变量PATH中。\"><a href=\"#将VirtualBox安装目录的路径加入系统环境变量PATH中。\" class=\"headerlink\" title=\"将VirtualBox安装目录的路径加入系统环境变量PATH中。\"></a>将VirtualBox安装目录的路径加入系统环境变量PATH中。</h6><h6 id=\"打开命令行窗口，执行如下命令：\"><a href=\"#打开命令行窗口，执行如下命令：\" class=\"headerlink\" title=\"打开命令行窗口，执行如下命令：\"></a>打开命令行窗口，执行如下命令：</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">VBoxManage setextradata YOURVMNAME VBoxInternal2/SharedFoldersEnableSymlinksCreate/YOURSHAREFOLDERNAME 1</span><br></pre></td></tr></table></figure>\n<p>其中：YOURVMNAME为虚拟机中linux系统的名称<br>YOURSHAREFOLDERNAME 为共享的目录名称</p>\n<h6 id=\"“以管理者身份运行”-VirtualBox-即可！\"><a href=\"#“以管理者身份运行”-VirtualBox-即可！\" class=\"headerlink\" title=\"“以管理者身份运行” VirtualBox　即可！\"></a>“以管理者身份运行” VirtualBox　即可！</h6>","tags":["linux","Virtualbox"]},{"title":"Warning RPMDB altered outside of yum.的解决办法","url":"/2017/12/02/Warning%20RPMDB%20altered%20outside%20of%20yum.%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%20/","content":"<p>错误提示： Warning: RPMDB altered outside of yum<br><br>解决办法： 删除yum的历史记录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">rm</span> -rf /var/lib/yum/history/*.sqlite</span><br></pre></td></tr></table></figure>\n","tags":["yum"]},{"title":"Windows通过Samba访问Linux文件","url":"/2017/12/02/Windows%E9%80%9A%E8%BF%87Samba%E8%AE%BF%E9%97%AELinux%E6%96%87%E4%BB%B6/","content":"<p>安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install samba smaba-client</span><br></pre></td></tr></table></figure>\n<p>配置</p>\n<p>我想设置root用户给samba，并设置其密码，执行以下命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">smbpasswd -a root</span><br></pre></td></tr></table></figure>\n<p>这个命令也可以修改设置的用户的密码</p>\n<p>这里的意思是说，当windows登录到Linux共享文件夹的时候输入的用户名root和密码(刚刚设置的)</p>\n<p>配置下smb.conf</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure>\n<p>⒈找到security &#x3D; XXXX</p>\n<p>设置其为   security &#x3D; root<br>⒉定位到该文件的最后，添加以下代码</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root]</span><br><span class=\"line\">comment = share</span><br><span class=\"line\">path = /www</span><br><span class=\"line\">browseable = <span class=\"built_in\">yes</span></span><br><span class=\"line\">guest ok = <span class=\"built_in\">yes</span></span><br><span class=\"line\">writable = <span class=\"built_in\">yes</span></span><br></pre></td></tr></table></figure>\n<p>path的意思是说我要共享的文件夹路径，其他的设置成yes就OK</p>\n<p>④使用windows连接Linux共享的这个文件夹<br>windows : 开始 -&gt; 输入\\192.168.10.52 (该IP为Linux的IP地址) -&gt; 输入设置好的用户名和密码即可连接。。</p>\n<p><strong>ps:linux需要开启139和445端口</strong></p>\n","tags":["samba"]},{"title":"centOS7下安装GUI图形界面","url":"/2018/02/09/centOS7%E4%B8%8B%E5%AE%89%E8%A3%85GUI%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/","content":"<h5 id=\"1-在命令行下-输入下面的命令来安装Gnome包。\"><a href=\"#1-在命令行下-输入下面的命令来安装Gnome包。\" class=\"headerlink\" title=\"1 .在命令行下 输入下面的命令来安装Gnome包。\"></a>1 .在命令行下 输入下面的命令来安装Gnome包。</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum groupinstall <span class=\"string\">&quot;GNOME Desktop&quot;</span> <span class=\"string\">&quot;Graphical Administration Tools&quot;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"2-在命令行输入startx进入桌面\"><a href=\"#2-在命令行输入startx进入桌面\" class=\"headerlink\" title=\"2.在命令行输入startx进入桌面\"></a>2.在命令行输入startx进入桌面</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">startx</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"3-如果想开机就进桌面，那就更新系统的运行级别。\"><a href=\"#3-如果想开机就进桌面，那就更新系统的运行级别。\" class=\"headerlink\" title=\"3.如果想开机就进桌面，那就更新系统的运行级别。\"></a>3.如果想开机就进桌面，那就更新系统的运行级别。</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ln</span> -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-重启机器。启动默认进入图形界面。\"><a href=\"#4-重启机器。启动默认进入图形界面。\" class=\"headerlink\" title=\"4.重启机器。启动默认进入图形界面。\"></a>4.重启机器。启动默认进入图形界面。</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"centos6-5开启-关闭端口","url":"/2017/12/02/centos6-5%E5%BC%80%E5%90%AF-%E5%85%B3%E9%97%AD%E7%AB%AF%E5%8F%A3/","content":"<p>列出所有端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">netstat -ntlp</span><br></pre></td></tr></table></figure>\n<p>1、开启端口（以80端口为例）</p>\n<p>方法一：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT   写入修改</span><br><span class=\"line\">/etc/init.d/iptables save   保存修改</span><br><span class=\"line\">service iptables restart    重启防火墙，修改生效</span><br></pre></td></tr></table></figure>\n<p>方法二：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/iptables  打开配置文件加入如下语句:</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT   重启防火墙，修改完成</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>2、关闭端口</p>\n<p>方法一：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/sbin/iptables -I INPUT -p tcp --dport 80 -j DROP   写入修改</span><br><span class=\"line\">/etc/init.d/iptables save   保存修改</span><br><span class=\"line\">service iptables restart    重启防火墙，修改生效</span><br></pre></td></tr></table></figure>\n<p>方法二：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/iptables  打开配置文件加入如下语句:</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j DROP   重启防火墙，修改完成</span><br></pre></td></tr></table></figure>\n<p>3、查看端口状态</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/etc/init.d/iptables status</span><br></pre></td></tr></table></figure>\n","tags":["centos"]},{"title":"Centos6.5安装git","url":"/2018/02/23/centos6.5%E5%AE%89%E8%A3%85git/","content":"<h6 id=\"安装编译git时需要的包\"><a href=\"#安装编译git时需要的包\" class=\"headerlink\" title=\"安装编译git时需要的包\"></a>安装编译git时需要的包</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel</span><br><span class=\"line\"></span><br><span class=\"line\">yum install  gcc perl-ExtUtils-MakeMaker</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"删除已有的git\"><a href=\"#删除已有的git\" class=\"headerlink\" title=\"删除已有的git\"></a>删除已有的git</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum remove git</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"下载git源码\"><a href=\"#下载git源码\" class=\"headerlink\" title=\"下载git源码\"></a>下载git源码</h6><p>地址：<a href=\"https://www.kernel.org/pub/software/scm/git/\">https://www.kernel.org/pub/software/scm/git/</a> 选择要安装的版本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">wget https://www.kernel.org/pub/software/scm/git/git-x.x.x.tar.gz</span><br><span class=\"line\">tar xzf git-x.x.x.tar.gz</span><br></pre></td></tr></table></figure>\n<h6 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd git-x.x.x</span><br><span class=\"line\">make prefix=/usr/local/git all</span><br><span class=\"line\">make prefix=/usr/local/git install</span><br><span class=\"line\">echo &quot;export PATH=$PATH:/usr/local/git/bin&quot; &gt;&gt; /etc/bashrc</span><br><span class=\"line\">source /etc/bashrc</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"检查一下版本号\"><a href=\"#检查一下版本号\" class=\"headerlink\" title=\"检查一下版本号\"></a>检查一下版本号</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git --version</span><br></pre></td></tr></table></figure>\n","tags":["centos","git"]},{"title":"centos6.5编译安装LNMP","url":"/2017/12/02/centos6.5%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85LNMP/","content":"<h2 id=\"一、环境准备\"><a href=\"#一、环境准备\" class=\"headerlink\" title=\"一、环境准备\"></a>一、环境准备</h2><h3 id=\"1、操作系统安装：CentOS-6-5-64位最小化安装。\"><a href=\"#1、操作系统安装：CentOS-6-5-64位最小化安装。\" class=\"headerlink\" title=\"1、操作系统安装：CentOS 6.5 64位最小化安装。\"></a>1、操作系统安装：CentOS 6.5 64位最小化安装。</h3><h3 id=\"2、配置好IP、DNS、网关、主机名\"><a href=\"#2、配置好IP、DNS、网关、主机名\" class=\"headerlink\" title=\"2、配置好IP、DNS、网关、主机名\"></a>2、配置好IP、DNS、网关、主机名</h3><h3 id=\"3、配置防火墙，开启80、3306端口\"><a href=\"#3、配置防火墙，开启80、3306端口\" class=\"headerlink\" title=\"3、配置防火墙，开启80、3306端口\"></a>3、配置防火墙，开启80、3306端口</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class=\"line\">/etc/rc.d/init.d/iptables save</span><br><span class=\"line\">/etc/init.d/iptables restart</span><br></pre></td></tr></table></figure>\n\n<p>这样就搞定了，查看效果</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/etc/init.d/iptables status</span><br><span class=\"line\">/etc/init.d/iptables restart <span class=\"comment\">#最后重启防火墙使配置生效</span></span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p><strong>PS</strong>：</p>\n<p>Centos升级到7之后，发现无法使用iptables控制Linuxs的端口，google之后发现Centos 7使用firewalld代替了原来的iptables。下面记录如何使用firewalld开放Linux端口：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#开启端口</span></span><br><span class=\"line\">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class=\"line\"><span class=\"comment\">#重启防火墙</span></span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n\n<p>命令含义：<br><br>–zone #作用域<br><br>–add-port&#x3D;80&#x2F;tcp #添加端口，格式为：端口&#x2F;通讯协议<br><br>–permanent #永久生效，没有此参数重启后失效<br></p>\n<h3 id=\"4、关闭SELinux\"><a href=\"#4、关闭SELinux\" class=\"headerlink\" title=\"4、关闭SELinux\"></a>4、关闭SELinux</h3><p>查看selinux状态：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/sbin/sestatus -v</span><br><span class=\"line\">SELinux status: disabled  //禁用selinux</span><br><span class=\"line\">getenforce</span><br><span class=\"line\">Disabled  //禁用selinux</span><br><span class=\"line\">getenforce</span><br><span class=\"line\">Enforcing //启动</span><br></pre></td></tr></table></figure>\n\n<p>关闭selinux方法：<br>setenforce 0 #设置SELinux 成为permissive模式<br>setenforce 1 #设置SELinux 成为enforcing模式<br>第二种方法：<br>vim &#x2F;etc&#x2F;selinux&#x2F;config 编辑文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This file controls the state of SELinux on the system.</span></span><br><span class=\"line\"><span class=\"comment\"># SELINUX= can take one of these three values:</span></span><br><span class=\"line\"><span class=\"comment\"># enforcing - SELinux security policy is enforced.</span></span><br><span class=\"line\"><span class=\"comment\">#permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class=\"line\"><span class=\"comment\">#disabled - No SELinux policy is loaded.</span></span><br><span class=\"line\">SELINUX=enforcing</span><br><span class=\"line\"><span class=\"comment\"># SELINUXTYPE= can take one of these two values:</span></span><br><span class=\"line\"><span class=\"comment\"># targeted - Targeted processes are protected,</span></span><br><span class=\"line\"><span class=\"comment\"># mls - Multi Level Security protection.</span></span><br></pre></td></tr></table></figure>\n<p>将SELINUX&#x3D;enforceing 改为 SELINUX&#x3D;disabled 重启机器就ok了</p>\n<h2 id=\"二、系统约定\"><a href=\"#二、系统约定\" class=\"headerlink\" title=\"二、系统约定\"></a>二、系统约定</h2><p>硬盘分区：50G(&#x2F;boot 200M &#x2F;swap 8192M &#x2F;)+100G(&#x2F;opt)<br><br>软件源代码包存放位置：&#x2F;opt&#x2F;local&#x2F;src<br><br>源码包编译安装位置：&#x2F;opt&#x2F;local&#x2F;软件名<br><br>数据库数据文件存储路径&#x2F;opt&#x2F;local&#x2F;mysql&#x2F;var<br></p>\n<h2 id=\"三、软件包下载\"><a href=\"#三、软件包下载\" class=\"headerlink\" title=\"三、软件包下载\"></a>三、软件包下载</h2><li>下载nginx（目前稳定版）：http://nginx.org/download/nginx-1.4.4.tar.gz\n<li>下载pcre （支持nginx伪静态）：ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.34.tar.gz\n<li>下载MySQL：http://cdn.mysql.com/Downloads/MySQL-5.5/mysql-5.5.35.tar.gz\n<li>下载php：http://cn2.php.net/distributions/php-5.5.7.tar.gz\n<li>下载cmake（MySQL编译工具）：http://www.cmake.org/files/v2.8/cmake-2.8.12.1.tar.gz\n<li>下载libmcrypt（PHPlibmcrypt模块）：http://nchc.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz\n<li>下载GD库安装包（php页面图片验证码支持）：https://phpsqq.googlecode.com/files/gd-2.0.36RC1.tar.gz\n\n\n<p>将以上软件包上传到&#x2F;opt&#x2F;local&#x2F;src目录</p>\n<h2 id=\"四、安装编译工具及库文件\"><a href=\"#四、安装编译工具及库文件\" class=\"headerlink\" title=\"四、安装编译工具及库文件\"></a>四、安装编译工具及库文件</h2><p>使用CentOS yum命令一键安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y make apr* autoconf automake curl curl-devel gcc gcc-c++ gtk+-devel zlib-devel openssl openssl-devel pcre-devel gd kernel keyutils patch perl kernel-headers compat* cpp glibc libgomp libstdc++-devel keyutils-libs-devel libsepol-devel libselinux-devel krb5-devel libXpm* freetype freetype-devel freetype* fontconfig fontconfig-devel libjpeg* libpng* php-common php-gd gettext gettext-devel ncurses* libtool* libxml2 libxml2-devel patch policycoreutils bison</span><br></pre></td></tr></table></figure>\n<h2 id=\"五、软件安装篇\"><a href=\"#五、软件安装篇\" class=\"headerlink\" title=\"五、软件安装篇\"></a>五、软件安装篇</h2><h3 id=\"1、安装cmake\"><a href=\"#1、安装cmake\" class=\"headerlink\" title=\"1、安装cmake\"></a>1、安装cmake</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">tar zxvf cmake-2.8.8.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> cmake-2.8.8</span><br><span class=\"line\">./configure --prefix=/opt/local/cmake</span><br><span class=\"line\">make <span class=\"comment\">#编译</span></span><br><span class=\"line\">make install <span class=\"comment\">#安装</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/profile 在path路径中增加cmake执行文件路径</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:/opt/local/cmake/bin</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile使配置立即生效</span><br></pre></td></tr></table></figure>\n<h3 id=\"2、安装pcre\"><a href=\"#2、安装pcre\" class=\"headerlink\" title=\"2、安装pcre\"></a>2、安装pcre</h3><p><strong>PS</strong>：Pcre版本不能太高，8最好，要不编译不能通过</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/pcre <span class=\"comment\">#创建安装目录</span></span><br><span class=\"line\">tar zxvf pcre-8.34.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> pcre-8.34</span><br><span class=\"line\">./configure --prefix=/opt/local/pcre <span class=\"comment\">#配置</span></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<h3 id=\"3、安装libmcrypt\"><a href=\"#3、安装libmcrypt\" class=\"headerlink\" title=\"3、安装libmcrypt\"></a>3、安装libmcrypt</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">tar zxvf libmcrypt-2.5.8.tar.gz <span class=\"comment\">#解压</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> libmcrypt-2.5.8 <span class=\"comment\">#进入目录</span></span><br><span class=\"line\">./configure <span class=\"comment\">#配置</span></span><br><span class=\"line\">make <span class=\"comment\">#编译</span></span><br><span class=\"line\">make install <span class=\"comment\">#安装</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4、安装gd库\"><a href=\"#4、安装gd库\" class=\"headerlink\" title=\"4、安装gd库\"></a>4、安装gd库</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">tar zxvf gd-2.0.36RC1.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> gd-2.0.36RC1</span><br><span class=\"line\">./configure --enable-m4_pattern_allow --prefix=/opt/local/gd --with-jpeg=/usr/lib --with-png=/usr/lib --with-xpm=/usr/lib --with-freetype=/usr/lib --with-fontconfig=/usr/lib <span class=\"comment\">#配置</span></span><br><span class=\"line\">make <span class=\"comment\">#编译</span></span><br><span class=\"line\">make install <span class=\"comment\">#安装</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、安装Mysql\"><a href=\"#5、安装Mysql\" class=\"headerlink\" title=\"5、安装Mysql\"></a>5、安装Mysql</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">groupadd mysql <span class=\"comment\">#添加mysql组</span></span><br><span class=\"line\">useradd -g mysql mysql -s /bin/false <span class=\"comment\">#创建用户mysql并加入到mysql组，不允许mysql用户直接登录系统</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /opt/data/mysql/var <span class=\"comment\">#创建MySQL数据库存放目录</span></span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R mysql:mysql /opt/data/mysql/var <span class=\"comment\">#设置MySQL数据库目录权限</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">tar zxvf mysql-5.5.35.tar.gz <span class=\"comment\">#解压</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> mysql-5.5.35</span><br><span class=\"line\"> cmake . -DCMAKE_INSTALL_PREFIX=/opt/local/mysql -DMYSQL_DATADIR=/opt/data/mysql/var -DSYSCONFDIR=/etc <span class=\"comment\">#配置</span></span><br><span class=\"line\">make <span class=\"comment\">#编译</span></span><br><span class=\"line\">make install <span class=\"comment\">#安装</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/mysql</span><br><span class=\"line\"><span class=\"built_in\">cp</span> ./support-files/my-huge.cnf /etc/my.cnf <span class=\"comment\">#拷贝配置文件（注意：如果/etc目录下面默认有一个my.cnf，直接覆盖即可）</span></span><br><span class=\"line\">vi /etc/my.cnf <span class=\"comment\">#编辑配置文件,在 [mysqld] 部分增加</span></span><br><span class=\"line\">datadir = /opt/data/mysql/var <span class=\"comment\">#添加MySQL数据库路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">./scripts/mysql_install_db --user=mysql <span class=\"comment\">#生成mysql系统数据库</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cp</span> ./support-files/mysql.server /etc/rc.d/init.d/mysqld <span class=\"comment\">#把Mysql加入系统启动</span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 755 /etc/init.d/mysqld <span class=\"comment\">#增加执行权限</span></span><br><span class=\"line\">chkconfig mysqld on <span class=\"comment\">#加入开机启动</span></span><br><span class=\"line\">vi /etc/rc.d/init.d/mysqld <span class=\"comment\">#编辑</span></span><br><span class=\"line\">basedir = /opt/local/mysql <span class=\"comment\">#MySQL程序安装路径</span></span><br><span class=\"line\">datadir = /opt/local/mysql/var <span class=\"comment\">#MySQl数据库存放目录</span></span><br><span class=\"line\">service mysqld start <span class=\"comment\">#启动</span></span><br><span class=\"line\">vi /etc/profile <span class=\"comment\">#把mysql服务加入系统环境变量：在最后添加下面这一行</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:/opt/local/cmake/bin:/opt/local/mysql/bin</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile <span class=\"comment\">#使配置立即生效</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /var/lib/mysql <span class=\"comment\">#创建目录</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /tmp/mysql.sock /var/lib/mysql/mysql.sock <span class=\"comment\">#添加软链接</span></span><br><span class=\"line\">mysql_secure_installation <span class=\"comment\">#设置Mysql密码，根据提示按Y 回车输入2次密码</span></span><br><span class=\"line\"><span class=\"comment\">#执行mysql_secure_installation时可能会报错</span></span><br><span class=\"line\"><span class=\"comment\">#ERROR 2002 (HY000): Can&#x27;t connect to local MySQL server through socket &#x27;/tmp/mysql.sock&#x27; (2)</span></span><br><span class=\"line\"><span class=\"comment\">#这时检查 /etc/my.cnf里面</span></span><br><span class=\"line\"><span class=\"comment\">#[mysqld]</span></span><br><span class=\"line\"><span class=\"comment\">#socket=/tmp/mysql.sock是否设置正确，这里把这里的目录修改成和报错一样的就可以</span></span><br><span class=\"line\">/opt/local/mysql/bin/mysqladmin -u root -p password <span class=\"string\">&quot;123456&quot;</span> <span class=\"comment\">#或者直接修改密码</span></span><br></pre></td></tr></table></figure>\n<p>到此，mysql安装完成！</p>\n<h3 id=\"6、安装-nginx\"><a href=\"#6、安装-nginx\" class=\"headerlink\" title=\"6、安装 nginx\"></a>6、安装 nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">groupadd www <span class=\"comment\">#添加www组</span></span><br><span class=\"line\">useradd -g www www -s /bin/false <span class=\"comment\">#创建nginx运行账户www并加入到www组，不允许www用户直接登录系统</span></span><br><span class=\"line\">tar zxvf nginx-1.4.4.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> nginx-1.4.4</span><br><span class=\"line\">./configure --prefix=/opt/local/nginx --without-http_memcached_module --user=www --group=www --with-http_stub_status_module --with-openssl=/usr/ --with-pcre=/opt/local/src/pcre-8.36</span><br><span class=\"line\"></span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\">/opt/local/nginx/sbin/nginx <span class=\"comment\">#启动nginx</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><strong>注意:–with-pcre&#x3D;&#x2F;opt&#x2F;local&#x2F;src&#x2F;pcre-8.64指向的是源码包解压的路径，而不是安装的路径，否则会报错</strong></p>\n<h4 id=\"设置nginx开启启动\"><a href=\"#设置nginx开启启动\" class=\"headerlink\" title=\"设置nginx开启启动\"></a>设置nginx开启启动<br></h4><p>vi &#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;nginx #编辑启动文件添加下面内容</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># nginx Startup script for the Nginx HTTP Server</span></span><br><span class=\"line\"><span class=\"comment\"># it is v.0.0.2 version.</span></span><br><span class=\"line\"><span class=\"comment\"># chkconfig: - 85 15</span></span><br><span class=\"line\"><span class=\"comment\"># description: Nginx is a high-performance web and proxy server.</span></span><br><span class=\"line\"><span class=\"comment\"># It has a lot of features, but it&#x27;s not for everyone.</span></span><br><span class=\"line\"><span class=\"comment\"># processname: nginx</span></span><br><span class=\"line\"><span class=\"comment\"># pidfile: /var/run/nginx.pid</span></span><br><span class=\"line\"><span class=\"comment\"># config: /usr/local/nginx/conf/nginx.conf</span></span><br><span class=\"line\">nginxd=/opt/local/nginx/sbin/nginx</span><br><span class=\"line\">nginx_config=/opt/local/nginx/conf/nginx.conf</span><br><span class=\"line\">nginx_pid=/opt/local/nginx/logs/nginx.pid</span><br><span class=\"line\">RETVAL=0</span><br><span class=\"line\">prog=<span class=\"string\">&quot;nginx&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># Source function library.</span></span><br><span class=\"line\">. /etc/rc.d/init.d/functions</span><br><span class=\"line\"><span class=\"comment\"># Source networking configuration.</span></span><br><span class=\"line\">. /etc/sysconfig/network</span><br><span class=\"line\"><span class=\"comment\"># Check that networking is up.</span></span><br><span class=\"line\">[ <span class=\"variable\">$&#123;NETWORKING&#125;</span> = <span class=\"string\">&quot;no&quot;</span> ] &amp;&amp; <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">[ -x <span class=\"variable\">$nginxd</span> ] || <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"><span class=\"comment\"># Start nginx daemons functions.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">start</span></span>() &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -e <span class=\"variable\">$nginx_pid</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;nginx already running....&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Starting <span class=\"variable\">$prog</span>: &quot;</span></span><br><span class=\"line\">daemon <span class=\"variable\">$nginxd</span> -c <span class=\"variable\">$&#123;nginx_config&#125;</span></span><br><span class=\"line\">RETVAL=$?</span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\">[ <span class=\"variable\">$RETVAL</span> = 0 ] &amp;&amp; <span class=\"built_in\">touch</span> /var/lock/subsys/nginx</span><br><span class=\"line\"><span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># Stop nginx daemons functions.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stop</span></span>() &#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Stopping <span class=\"variable\">$prog</span>: &quot;</span></span><br><span class=\"line\">killproc <span class=\"variable\">$nginxd</span></span><br><span class=\"line\">RETVAL=$?</span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\">[ <span class=\"variable\">$RETVAL</span> = 0 ] &amp;&amp; <span class=\"built_in\">rm</span> -f /var/lock/subsys/nginx /usr/local/nginx/logs/nginx.pid</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">reload</span></span>() &#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Reloading <span class=\"variable\">$prog</span>: &quot;</span></span><br><span class=\"line\"><span class=\"comment\">#kill -HUP `cat $&#123;nginx_pid&#125;`</span></span><br><span class=\"line\">killproc <span class=\"variable\">$nginxd</span> -HUP</span><br><span class=\"line\">RETVAL=$?</span><br><span class=\"line\"><span class=\"built_in\">echo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># See how we were called.</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">start)</span><br><span class=\"line\">start</span><br><span class=\"line\">;;</span><br><span class=\"line\">stop)</span><br><span class=\"line\">stop</span><br><span class=\"line\">;;</span><br><span class=\"line\">reload)</span><br><span class=\"line\">reload</span><br><span class=\"line\">;;</span><br><span class=\"line\">restart)</span><br><span class=\"line\">stop</span><br><span class=\"line\">start</span><br><span class=\"line\">;;</span><br><span class=\"line\">status)</span><br><span class=\"line\">status <span class=\"variable\">$prog</span></span><br><span class=\"line\">RETVAL=$?</span><br><span class=\"line\">;;</span><br><span class=\"line\">*)</span><br><span class=\"line\"><span class=\"built_in\">echo</span> $<span class=\"string\">&quot;Usage: <span class=\"variable\">$prog</span> &#123;start|stop|restart|reload|status|help&#125;&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span> <span class=\"variable\">$RETVAL</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">:wq! <span class=\"comment\">#保存退出</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 775 /etc/rc.d/init.d/nginx <span class=\"comment\">#赋予文件执行权限</span></span><br><span class=\"line\">chkconfig nginx on <span class=\"comment\">#设置开机启动</span></span><br><span class=\"line\">/etc/rc.d/init.d/nginx restart <span class=\"comment\">#重新启动Nginx</span></span><br><span class=\"line\">service nginx restart</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7、安装php\"><a href=\"#7、安装php\" class=\"headerlink\" title=\"7、安装php\"></a>7、安装php</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">tar -zvxf php-5.5.7.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> php-5.5.7.</span><br><span class=\"line\">./configure --prefix=/opt/local/php --with-config-file-path=/opt/local/php/etc --with-mysql=/opt/local/mysql --with-mysql-sock=/tmp/mysql.sock --with-gd --with-iconv --with-zlib --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-gd-native-ttf --with-openssl --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-mcrypt --with-curl --with-jpeg-dir --with-freetype-dir</span><br><span class=\"line\">make <span class=\"comment\">#编译</span></span><br><span class=\"line\">make install <span class=\"comment\">#安装</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> php.ini-production /opt/local/php/etc/php.ini <span class=\"comment\">#复制php配置文件到安装目录</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf /etc/php.ini <span class=\"comment\">#删除系统自带配置文件</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /opt/local/php/etc/php.ini /etc/php.ini <span class=\"comment\">#添加软链接</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> /opt/local/php/etc/php-fpm.conf.default /opt/local/php/etc/php-fpm.conf <span class=\"comment\">#拷贝模板文件为php-fpm配置文件</span></span><br><span class=\"line\">vi /opt/local/php/etc/php-fpm.conf <span class=\"comment\">#编辑</span></span><br><span class=\"line\">user = www <span class=\"comment\">#设置php-fpm运行账号为www</span></span><br><span class=\"line\">group = www <span class=\"comment\">#设置php-fpm运行组为www</span></span><br><span class=\"line\">pid = run/php-fpm.pid <span class=\"comment\">#取消前面的分号</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"设置-php-fpm开机启动\"><a href=\"#设置-php-fpm开机启动\" class=\"headerlink\" title=\"设置 php-fpm开机启动\"></a>设置 php-fpm开机启动</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span> /opt/local/src/php-5.5.7/sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm <span class=\"comment\">#拷贝php-fpm到启动目录</span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> +x /etc/rc.d/init.d/php-fpm <span class=\"comment\">#添加执行权限</span></span><br><span class=\"line\">chkconfig php-fpm on <span class=\"comment\">#设置开机启动</span></span><br></pre></td></tr></table></figure>\n<p>vi &#x2F;opt&#x2F;local&#x2F;php&#x2F;etc&#x2F;php.ini #编辑配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">修改为：disable_functions= passthru,<span class=\"built_in\">exec</span>,system,<span class=\"built_in\">chroot</span>,scandir,<span class=\"built_in\">chgrp</span>,<span class=\"built_in\">chown</span>,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,openlog,syslog,<span class=\"built_in\">readlink</span>,symlink,popepassthru,stream_socket_server,escapeshellcmd,dll,popen,disk_free_space,checkdnsrr,checkdnsrr,getservbyname,getservbyport,disk_total_space,posix_ctermid,posix_get_last_error,posix_getcwd, posix_getegid,posix_geteuid,posix_getgid, posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid, posix_getppid,posix_getpwnam,posix_getpwuid, posix_getrlimit, posix_getsid,posix_getuid,posix_isatty, posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid, posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname</span><br><span class=\"line\"><span class=\"comment\">#列出PHP可以禁用的函数，如果某些程序需要用到这个函数，可以删除，取消禁用</span></span><br><span class=\"line\">找到：;date.timezone =</span><br><span class=\"line\">修改为：date.timezone = PRC <span class=\"comment\">#设置时区</span></span><br><span class=\"line\">找到：expose_php = On</span><br><span class=\"line\">修改为：expose_php = OFF <span class=\"comment\">#禁止显示php版本的信息</span></span><br><span class=\"line\">找到：short_open_tag = Off</span><br><span class=\"line\">修改为：short_open_tag = ON <span class=\"comment\">#支持php短标签</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、配置nginx支持php\"><a href=\"#8、配置nginx支持php\" class=\"headerlink\" title=\"8、配置nginx支持php\"></a>8、配置nginx支持php</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vi /opt/local/nginx/conf/nginx.conf</span><br><span class=\"line\">修改/opt/local/nginx/conf/nginx.conf 配置文件,需做如下修改</span><br><span class=\"line\">user www www; <span class=\"comment\">#首行user去掉注释,修改Nginx运行组为www www；必须与/opt/local/php/etc/php-fpm.conf中的user,group配置相同，否则php运行出错</span></span><br><span class=\"line\">user www www;</span><br><span class=\"line\">worker_processes 1;</span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">worker_connections 1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">include mime.types;</span><br><span class=\"line\">default_type application/octet-stream;</span><br><span class=\"line\">sendfile on;</span><br><span class=\"line\">keepalive_timeout 65;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">listen 80;</span><br><span class=\"line\">server_name localhost;</span><br><span class=\"line\">location / &#123;</span><br><span class=\"line\">root html;</span><br><span class=\"line\">index index.php index.html index.htm;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~ \\.php$ &#123;</span><br><span class=\"line\">root html;</span><br><span class=\"line\">fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">fastcgi_index index.php;</span><br><span class=\"line\">fastcgi_param SCRIPT_FILENAME $document_root<span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">include fastcgi_params;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">/etc/init.d/nginx restart <span class=\"comment\">#重启nginx</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"六、测试篇\"><a href=\"#六、测试篇\" class=\"headerlink\" title=\"六、测试篇\"></a>六、测试篇</h2><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/nginx/html/ <span class=\"comment\">#进入nginx默认网站根目录</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf /opt/local/nginx/html/* <span class=\"comment\">#删除默认测试页</span></span><br><span class=\"line\">vi index.php <span class=\"comment\">#新建index.php文件</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">phpinfo();</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">:wq! <span class=\"comment\">#保存退出</span></span><br><span class=\"line\"><span class=\"built_in\">chown</span> www.www /opt/local/nginx/html/ -R <span class=\"comment\">#设置目录所有者</span></span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 700 /opt/local/nginx/html/ -R <span class=\"comment\">#设置目录权限</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"七、其它说明\"><a href=\"#七、其它说明\" class=\"headerlink\" title=\"七、其它说明\"></a>七、其它说明</h2><h3 id=\"服务器相关操作命令\"><a href=\"#服务器相关操作命令\" class=\"headerlink\" title=\"服务器相关操作命令\"></a>服务器相关操作命令</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service nginx restart <span class=\"comment\">#重启nginx</span></span><br><span class=\"line\">service mysqld restart <span class=\"comment\">#重启mysql</span></span><br><span class=\"line\">/usr/local/php/sbin/php-fpm <span class=\"comment\">#启动php-fpm</span></span><br><span class=\"line\">/etc/rc.d/init.d/php-fpm restart <span class=\"comment\">#重启php-fpm</span></span><br><span class=\"line\">/etc/rc.d/init.d/php-fpm stop <span class=\"comment\">#停止php-fpm</span></span><br><span class=\"line\">/etc/rc.d/init.d/php-fpm start <span class=\"comment\">#启动php-fpm</span></span><br><span class=\"line\">nginx默认站点目录是：/opt/local/nginx/html/</span><br><span class=\"line\">权限设置：<span class=\"built_in\">chown</span> www.www /opt/local/nginx/html/ -R</span><br><span class=\"line\">MySQL数据库目录是：/opt/local/mysql/var</span><br><span class=\"line\">权限设置：<span class=\"built_in\">chown</span> mysql.mysql -R /opt/local/mysql/var</span><br><span class=\"line\">重启nginx</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /lnmp/nginx/sbin</span><br><span class=\"line\">  ./nginx -s reload</span><br></pre></td></tr></table></figure>\n","tags":["linux","LNMP"]},{"title":"centos7 yum安装lnmp","url":"/2017/12/09/centos7%20yum%E5%AE%89%E8%A3%85lnmp/","content":"<h2 id=\"PHP7\"><a href=\"#PHP7\" class=\"headerlink\" title=\"PHP7\"></a>PHP7</h2><h3 id=\"1-安装epel-release\"><a href=\"#1-安装epel-release\" class=\"headerlink\" title=\"1.安装epel-release\"></a>1.安装epel-release</h3><p>通过命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install epel-release</span><br></pre></td></tr></table></figure>\n<p>成功安装。</p>\n<h3 id=\"2-安装PHP7\"><a href=\"#2-安装PHP7\" class=\"headerlink\" title=\"2.安装PHP7\"></a>2.安装PHP7</h3><p>终端再次运行如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span><br></pre></td></tr></table></figure>\n<p>成功获取PHP7的yum源，然后再执行：</p>\n<h3 id=\"php安装以及安装扩展\"><a href=\"#php安装以及安装扩展\" class=\"headerlink\" title=\"php安装以及安装扩展\"></a>php安装以及安装扩展</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install php70w  php70w-devel php70w-fpm php70w-gd php70w-mysqli php70w-mbstring</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<h2 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h2><p>centos7系统库中默认是没有nginx的rpm包的，所以我们自己需要先更新下rpm依赖库</p>\n<h3 id=\"1-使用yum安装nginx需要包括Nginx的库，安装Nginx的库\"><a href=\"#1-使用yum安装nginx需要包括Nginx的库，安装Nginx的库\" class=\"headerlink\" title=\"1.使用yum安装nginx需要包括Nginx的库，安装Nginx的库\"></a>1.使用yum安装nginx需要包括Nginx的库，安装Nginx的库</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-使用下面命令安装nginx\"><a href=\"#2-使用下面命令安装nginx\" class=\"headerlink\" title=\"2.使用下面命令安装nginx\"></a>2.使用下面命令安装nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install nginx</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-启动Nginx\"><a href=\"#3-启动Nginx\" class=\"headerlink\" title=\"3.启动Nginx\"></a>3.启动Nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service nginx start</span><br></pre></td></tr></table></figure>\n<p>或</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start nginx.service</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"mysql\"><a href=\"#mysql\" class=\"headerlink\" title=\"mysql\"></a>mysql</h2><h3 id=\"1-下载mysql的repo源\"><a href=\"#1-下载mysql的repo源\" class=\"headerlink\" title=\"1.下载mysql的repo源\"></a>1.下载mysql的repo源</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-安装mysql-community-release-el7-5-noarch-rpm包\"><a href=\"#2-安装mysql-community-release-el7-5-noarch-rpm包\" class=\"headerlink\" title=\"2.安装mysql-community-release-el7-5.noarch.rpm包\"></a>2.安装mysql-community-release-el7-5.noarch.rpm包</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br></pre></td></tr></table></figure>\n<p>安装这个包后，会获得两个mysql的yum repo源：&#x2F;etc&#x2F;yum.repos.d&#x2F;mysql-community.repo，&#x2F;etc&#x2F;yum.repos.d&#x2F;mysql-community-source.repo。</p>\n<h3 id=\"3-安装mysql\"><a href=\"#3-安装mysql\" class=\"headerlink\" title=\"3.安装mysql\"></a>3.安装mysql</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo yum install mysql-server</span><br></pre></td></tr></table></figure>\n<p>根据提示安装就可以了,不过安装完成后没有密码,需要重置密码</p>\n<h3 id=\"4-重置mysql密码\"><a href=\"#4-重置mysql密码\" class=\"headerlink\" title=\"4.重置mysql密码\"></a>4.重置mysql密码</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -u root</span><br></pre></td></tr></table></figure>\n<p>登录时有可能报这样的错：ERROR 2002 (HY000): Can‘t connect to local MySQL server through socket ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock‘ (2)，原因是&#x2F;var&#x2F;lib&#x2F;mysql的访问权限问题。下面的命令把&#x2F;var&#x2F;lib&#x2F;mysql的拥有者改为当前用户：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">chown</span> -R root:root /var/lib/mysql</span><br></pre></td></tr></table></figure>\n<p>重启mysql服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service mysqld restart</span><br></pre></td></tr></table></figure>\n<p>接下来登录重置密码：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -u root  //直接回车进入mysql控制台</span><br><span class=\"line\">mysql &gt; use mysql;</span><br><span class=\"line\">mysql &gt; update user <span class=\"built_in\">set</span> password=password(<span class=\"string\">&#x27;123456&#x27;</span>) <span class=\"built_in\">where</span> user=<span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\">mysql &gt; <span class=\"built_in\">exit</span>;</span><br></pre></td></tr></table></figure>\n","tags":["centos","yum","lnmp"]},{"title":"centos7下使用yum安装mysql数据库","url":"/2017/12/02/centos7%E4%B8%8B%E4%BD%BF%E7%94%A8yum%E5%AE%89%E8%A3%85mysql%E6%95%B0%E6%8D%AE%E5%BA%93/","content":"<p>CentOS7的yum源中默认好像是没有mysql的。为了解决这个问题，我们要先下载mysql的repo源。</p>\n<p>1 . 下载mysql的repo源</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br></pre></td></tr></table></figure>\n<p>2 . 安装mysql-community-release-el7-5.noarch.rpm包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br></pre></td></tr></table></figure>\n<p>安装这个包后，会获得两个mysql的yum repo源：&#x2F;etc&#x2F;yum.repos.d&#x2F;mysql-community.repo，&#x2F;etc&#x2F;yum.repos.d&#x2F;mysql-community-source.repo。</p>\n<span id=\"more\"></span>\n\n<p>3 . 安装mysql</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo yum install mysql-server</span><br></pre></td></tr></table></figure>\n<p>根据步骤安装就可以了，不过安装完成后，没有密码，需要重置密码。</p>\n<p>4 . 重置密码</p>\n<p>重置密码前，首先要登录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -u root</span><br></pre></td></tr></table></figure>\n<p>登录时有可能报这样的错：ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock’ (2)，原因是&#x2F;var&#x2F;lib&#x2F;mysql的访问权限问题。下面的命令把&#x2F;var&#x2F;lib&#x2F;mysql的拥有者改为当前用户：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">chown</span> -R root:root /var/lib/mysql</span><br></pre></td></tr></table></figure>\n<p>然后，重启服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service mysqld restart</span><br></pre></td></tr></table></figure>\n<p>接下来登录重置密码：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root</span><br><span class=\"line\">mysql <span class=\"operator\">&gt;</span> use mysql;</span><br><span class=\"line\">mysql <span class=\"operator\">&gt;</span> <span class=\"keyword\">update</span> <span class=\"keyword\">user</span> <span class=\"keyword\">set</span> password<span class=\"operator\">=</span>password(<span class=\"string\">&#x27;123456&#x27;</span>) <span class=\"keyword\">where</span> <span class=\"keyword\">user</span><span class=\"operator\">=</span><span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\">mysql <span class=\"operator\">&gt;</span> exit;</span><br></pre></td></tr></table></figure>\n","tags":["centos","mysql"]},{"title":"centos7编译安装nginx","url":"/2017/12/02/centos7%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85nginx/","content":"<p><strong>ps : nginx安装在&#x2F;opt&#x2F;local&#x2F;nginx里</strong></p>\n<p>1.安装编译安装依赖的类库和包</p>\n<p>如果需要编译MySQL和PHP，就安装这些</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y make apr* autoconf automake curl curl-devel gcc gcc-c++ gtk+-devel zlib-devel openssl openssl-devel pcre-devel gd kernel keyutils patch perl kernel-headers compat* cpp glibc libgomp libstdc++-devel keyutils-libs-devel libsepol-devel libselinux-devel krb5-devel libXpm* freetype freetype-devel freetype* fontconfig fontconfig-devel libjpeg* libpng* php-common php-gd gettext gettext-devel ncurses* libtool* libxml2 libxml2-devel patch policycoreutils bison</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>如果只编译nginx，就安装这些</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install gcc gcc-c++ autoconf automake zlib zlib-devel openssl openssl-devel pcre-devel</span><br></pre></td></tr></table></figure>\n<p>2.编译安装pcre</p>\n<p><strong>PS：Pcre版本不能太高，8最好，要不编译不能通过</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/pcre <span class=\"comment\">#创建安装目录</span></span><br><span class=\"line\">tar zxvf pcre-8.34.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> pcre-8.34</span><br><span class=\"line\">./configure --prefix=/opt/local/pcre <span class=\"comment\">#配置</span></span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<p>3.配置 Nginx 安装选项</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">checking <span class=\"keyword\">for</span> OS</span><br><span class=\"line\"> + Linux 3.10.0-327.22.2.el7.x86_64 x86_64</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> C compiler ... found</span><br><span class=\"line\"> + using GNU C compiler</span><br><span class=\"line\"> + gcc version: 4.8.5 20150623 (Red Hat 4.8.5-11) (GCC)</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> gcc -pipe switch ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> -Wl,-E switch ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> gcc <span class=\"built_in\">builtin</span> atomic operations ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> C99 variadic macros ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> gcc variadic macros ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> gcc <span class=\"built_in\">builtin</span> 64 bit byteswap ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> unistd.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> inttypes.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> limits.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sys/filio.h ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sys/param.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sys/mount.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sys/statvfs.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> crypt.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> Linux specific features</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> epoll ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> EPOLLRDHUP ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> EPOLLEXCLUSIVE ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> O_PATH ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sendfile() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sendfile64() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sys/prctl.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> prctl(PR_SET_DUMPABLE) ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sched_setaffinity() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> crypt_r() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sys/vfs.h ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> poll() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> /dev/poll ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> kqueue ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> crypt() ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> crypt() <span class=\"keyword\">in</span> libcrypt ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> F_READAHEAD ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> posix_fadvise() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> O_DIRECT ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> F_NOCACHE ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> directio() ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> statfs() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> statvfs() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> dlopen() ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> dlopen() <span class=\"keyword\">in</span> libdl ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sched_yield() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> SO_SETFIB ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> SO_REUSEPORT ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> SO_ACCEPTFILTER ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> SO_BINDANY ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> IP_BIND_ADDRESS_NO_PORT ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> IP_TRANSPARENT ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> IP_BINDANY ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> IP_RECVDSTADDR ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> IP_PKTINFO ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> IPV6_RECVPKTINFO ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> TCP_DEFER_ACCEPT ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> TCP_KEEPIDLE ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> TCP_FASTOPEN ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> TCP_INFO ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> accept4() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> eventfd() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> int size ... 4 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> long size ... 8 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> long long size ... 8 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> void * size ... 8 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> uint32_t ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> uint64_t ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sig_atomic_t ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sig_atomic_t size ... 4 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> socklen_t ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> in_addr_t ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> in_port_t ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> rlim_t ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> uintptr_t ... uintptr_t found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> system byte ordering ... little endian</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> size_t size ... 8 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> off_t size ... 8 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> time_t size ... 8 bytes</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> AF_INET6 ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> setproctitle() ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> pread() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> pwrite() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> pwritev() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sys_nerr ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> localtime_r() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> posix_memalign() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> memalign() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> mmap(MAP_ANON|MAP_SHARED) ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> mmap(<span class=\"string\">&quot;/dev/zero&quot;</span>, MAP_SHARED) ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> System V shared memory ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> POSIX semaphores ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> POSIX semaphores <span class=\"keyword\">in</span> libpthread ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> struct msghdr.msg_control ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> ioctl(FIONBIO) ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> struct tm.tm_gmtoff ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> struct dirent.d_namlen ... not found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> struct dirent.d_type ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> sysconf(_SC_NPROCESSORS_ONLN) ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> openat(), fstatat() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> getaddrinfo() ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> PCRE library ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> PCRE JIT support ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> OpenSSL library ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> zlib library ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> libxslt ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> libexslt ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> GD library ... found</span><br><span class=\"line\">checking <span class=\"keyword\">for</span> GD WebP support ... not found</span><br><span class=\"line\">creating objs/Makefile</span><br><span class=\"line\">Configuration summary</span><br><span class=\"line\"> + using system PCRE library</span><br><span class=\"line\"> + using system OpenSSL library</span><br><span class=\"line\"> + using system zlib library</span><br><span class=\"line\"> <span class=\"comment\">#配置地址</span></span><br><span class=\"line\"> nginx path prefix: <span class=\"string\">&quot;/opt/local/nginx&quot;</span></span><br><span class=\"line\"> nginx binary file: <span class=\"string\">&quot;/opt/local/nginx/sbin/nginx&quot;</span></span><br><span class=\"line\"> nginx modules path: <span class=\"string\">&quot;/opt/local/nginx/modules&quot;</span></span><br><span class=\"line\"> nginx configuration prefix: <span class=\"string\">&quot;/opt/local/nginx/conf&quot;</span></span><br><span class=\"line\"> nginx configuration file: <span class=\"string\">&quot;/opt/local/nginx/conf/nginx.conf&quot;</span></span><br><span class=\"line\"> nginx pid file: <span class=\"string\">&quot;/opt/local/nginx/logs/nginx.pid&quot;</span></span><br><span class=\"line\"> nginx error <span class=\"built_in\">log</span> file: <span class=\"string\">&quot;/opt/local/nginx/logs/error.log&quot;</span></span><br><span class=\"line\"> nginx http access <span class=\"built_in\">log</span> file: <span class=\"string\">&quot;/opt/local/nginx/logs/access.log&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> nginx http client request body temporary files: <span class=\"string\">&quot;client_body_temp&quot;</span></span><br><span class=\"line\"> nginx http proxy temporary files: <span class=\"string\">&quot;proxy_temp&quot;</span></span><br><span class=\"line\"> nginx http fastcgi temporary files: <span class=\"string\">&quot;fastcgi_temp&quot;</span></span><br><span class=\"line\"> nginx http uwsgi temporary files: <span class=\"string\">&quot;uwsgi_temp&quot;</span></span><br><span class=\"line\"> nginx http scgi temporary files: <span class=\"string\">&quot;scgi_temp&quot;</span></span><br></pre></td></tr></table></figure>\n<p>编译完成之后注意nginx path prefix 到 nginx http access log file 这几行配置信息，后面需要用的到。</p>\n<p>4.安装 Nginx</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n<p>5.配置 systemd Nginx 服务和设置 Nginx 自启动</p>\n<p>centos 7 中采用 systemd 来管理系统，我们来为 nginx 创建服务文件，来实现通过 systemd 来管理 nginx 。<br>创建 systemd 服务文件： &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service，内容如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=The NGINX HTTP and reverse proxy server</span><br><span class=\"line\">After=syslog.target network.target remote-fs.target nss-lookup.target</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">PIDFile=/opt/local/nginx/logs/nginx.pid</span><br><span class=\"line\">ExecStartPre=/opt/local/nginx/sbin/nginx -t</span><br><span class=\"line\">ExecStart=/opt/local/nginx/sbin/nginx</span><br><span class=\"line\">ExecReload=/bin/kill -s HUP <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">ExecStop=/bin/kill -s QUIT <span class=\"variable\">$MAINPID</span></span><br><span class=\"line\">PrivateTmp=<span class=\"literal\">true</span></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n<p>这里的 PIDFile 的配置要和前面的 配置保持一致。</p>\n<p>设置自启动</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl <span class=\"built_in\">enable</span> nginx</span><br></pre></td></tr></table></figure>\n<p>通过 systemd 管理 nginx</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start nginx</span><br><span class=\"line\">systemctl stop nginx</span><br><span class=\"line\">systemctl restart nginx</span><br><span class=\"line\">systemctl reload nginx</span><br></pre></td></tr></table></figure>\n","tags":["centos","nginx"]},{"title":"centos7设置IP白名单","url":"/2018/03/02/centos7%E8%AE%BE%E7%BD%AEIP%E7%99%BD%E5%90%8D%E5%8D%95/","content":"<p>编辑iptables配置文件，将文件内容更改为如下，则具备了ip地址白名单功能</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/sysconfig/iptables   </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">1 *filter</span><br><span class=\"line\">2 :INPUT ACCEPT [0:0]</span><br><span class=\"line\">3 :FORWARD ACCEPT [0:0]</span><br><span class=\"line\">4 :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">5</span><br><span class=\"line\">6 -N whitelist</span><br><span class=\"line\">7 -A whitelist -s 1.2.3.0/24 -j ACCEPT</span><br><span class=\"line\">8 -A whitelist -s 4.5.6.7 -j ACCEPT</span><br><span class=\"line\">9</span><br><span class=\"line\">10 -A INPUT -m state --state RELATED,ESTABLISHED -j whitelist</span><br><span class=\"line\">11 -A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j whitelist</span><br><span class=\"line\">12 -A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j whitelist</span><br><span class=\"line\">13 -A INPUT -p icmp -j ACCEPT</span><br><span class=\"line\">14 -A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">15 -A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">16 -A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">17 COMMIT</span><br></pre></td></tr></table></figure>\n\n<p>6~8 行是添加白名单列表，可以是ip段或者单个ip地址</p>\n<p>10~12行 注意的是“-j whitelist”而不是“-j ACCEPT”，前者将该端口访问权限限制在白名单内，后者为不限制</p>\n<p>13行 任何ip地址都能ping通该主机，因为“-j ACCEPT”没有做相应限制</p>\n<p>配置完毕后，运行命令重启防火墙使规则生效</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl restart iptables.service</span><br></pre></td></tr></table></figure>\n","tags":["centos"]},{"title":"centos下彻底删除MYSQL 和重新安装MYSQL","url":"/2017/12/16/centos%E4%B8%8B%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4MYSQL%20%E5%92%8C%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85MYSQL/","content":"<p>1 删除Mysql</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum remove  mysql mysql-server mysql-libs mysql-server;</span><br><span class=\"line\">find / -name mysql 将找到的相关东西delete掉；</span><br><span class=\"line\">rpm -qa|grep mysql(查询出来的东东yum remove掉)</span><br></pre></td></tr></table></figure>\n\n<p>2 安装Mysql</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install  mysql mysql-server mysql-libs mysql-server;</span><br></pre></td></tr></table></figure>\n","tags":["centos","mysql"]},{"title":"centos修改IP","url":"/2018/11/16/centos%E4%BF%AE%E6%94%B9IP/","content":"<h5 id=\"首先查看网络接口名称\"><a href=\"#首先查看网络接口名称\" class=\"headerlink\" title=\"首先查看网络接口名称\"></a>首先查看网络接口名称</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ifconfig</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/b11c555acaa92bbf9363cfec3e321a30dc950319/centos%20%E4%B8%B4%E6%97%B6%E4%BF%AE%E6%94%B9IP%E3%80%81%E6%B0%B8%E4%B9%85%E4%BF%AE%E6%94%B9IP.png\" alt=\"修改IP地址\"></p>\n<h5 id=\"临时修改IP\"><a href=\"#临时修改IP\" class=\"headerlink\" title=\"临时修改IP\"></a>临时修改IP</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ifconfig eth1 192.168.10.88</span><br></pre></td></tr></table></figure>\n<h5 id=\"永久修改IP\"><a href=\"#永久修改IP\" class=\"headerlink\" title=\"永久修改IP\"></a>永久修改IP</h5><h6 id=\"修改对应的网络接口配置文件，文件路径是\"><a href=\"#修改对应的网络接口配置文件，文件路径是\" class=\"headerlink\" title=\"修改对应的网络接口配置文件，文件路径是\"></a>修改对应的网络接口配置文件，文件路径是</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/etc/sysconfig/network-scripts/</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/sysconfig/network-scripts/ifcfg-网络接口名称</span><br></pre></td></tr></table></figure>\n<h6 id=\"修改以下配置\"><a href=\"#修改以下配置\" class=\"headerlink\" title=\"修改以下配置\"></a>修改以下配置</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">BOOTPROTO=static</span><br><span class=\"line\"><span class=\"comment\"># 以下配置有就修改，没有就添加</span></span><br><span class=\"line\">IPADDR=192.168.10.88     <span class=\"comment\">#静态IP</span></span><br><span class=\"line\">GATEWAY=192.168.10.1     <span class=\"comment\">#默认网关</span></span><br><span class=\"line\">NETMASK=255.255.255.0    <span class=\"comment\">#子网掩码</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"修改DNS\"><a href=\"#修改DNS\" class=\"headerlink\" title=\"修改DNS\"></a>修改DNS</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/resolv.conf</span><br><span class=\"line\">nameserver 1.1.1.1</span><br><span class=\"line\">nameserver 8.8.8.8</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"重启网络服务\"><a href=\"#重启网络服务\" class=\"headerlink\" title=\"重启网络服务\"></a>重启网络服务</h6>","tags":["centos","linux"]},{"title":"docker 不能运行 systemctl","url":"/2018/09/30/docker%20%E4%B8%8D%E8%83%BD%E8%BF%90%E8%A1%8C%20systemctl/","content":"<p>docker centos7运行systemctl start nginx 报错：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Failed to get D-BUS connection: Operation no permitted</span><br></pre></td></tr></table></figure>\n\n<p>解决方法：</p>\n<p>在启动容器的时候添加上-d参数就可以了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run -itd --privileged -p 3306:3306 -v /opt/data/:/opt/mysql/data 镜像ID /usr/sbin/init</span><br><span class=\"line\"></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it 容器ID /bin/bash</span><br></pre></td></tr></table></figure>\n","tags":["docker"]},{"title":"docker保存对容器的修改","url":"/2018/09/30/docker%E4%BF%9D%E5%AD%98%E5%AF%B9%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BF%AE%E6%94%B9/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker commit 容器ID 要保存的镜像名称</span><br></pre></td></tr></table></figure>\n","tags":["docker"]},{"title":"git将本地代码提交到远程仓库","url":"/2018/01/20/git%E5%B0%86%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E6%8F%90%E4%BA%A4%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">touch</span> README.md</span><br><span class=\"line\">git init</span><br><span class=\"line\">git add README.md</span><br><span class=\"line\"></span><br><span class=\"line\">git add .</span><br><span class=\"line\">git commit -m <span class=\"string\">&quot;first commit&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">git remote add origin git@xx.xx.xx.xx:repos/xxx/xxx/xxx.git</span><br><span class=\"line\">git push -u origin 分支名</span><br></pre></td></tr></table></figure>\n<p>可能会遇到这个问题<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/git/git_error1.png\" alt=\"git_error\"><br>出现错误的原因是git服务器中的README.md文件不在本地代码目录中，可以通过如下命令进行代码合并</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git pull --rebase origin master</span><br></pre></td></tr></table></figure>\n","tags":["git"]},{"title":"golang两个线程交替打印1-100的奇数偶数","url":"/2019/01/31/golang%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B01-100%E7%9A%84%E5%A5%87%E6%95%B0%E5%81%B6%E6%95%B0/","content":"<p>启动两个线程, 一个输出 1,3,5,7…99, 另一个输出 2,4,6,8…100 最后 STDOUT 中按序输出 1,2,3,4,5…100</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> pool = <span class=\"number\">100</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//奇数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">oddNum</span><span class=\"params\">(c <span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">1</span>; i &lt;= pool; i++ &#123;</span><br><span class=\"line\">\t\tc &lt;- i</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i%<span class=\"number\">2</span> == <span class=\"number\">1</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(i)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//偶数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">even</span><span class=\"params\">(c <span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">1</span>; i &lt;= pool; i++ &#123;</span><br><span class=\"line\">\t\t&lt;-c</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i%<span class=\"number\">2</span> == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(i)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tc := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">go</span> oddNum(c)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> even(c)</span><br><span class=\"line\"></span><br><span class=\"line\">\ttime.Sleep(time.Second * <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n","tags":["golang"]},{"title":"golang抓取知乎图片","url":"/2019/01/26/golang%E6%8A%93%E5%8F%96%E7%9F%A5%E4%B9%8E%E5%9B%BE%E7%89%87/","content":"<h6 id=\"代码github地址\"><a href=\"#代码github地址\" class=\"headerlink\" title=\"代码github地址\"></a>代码github地址</h6><p> <a  href=\"https://github.com/zhaoguibin/zhihu_pic\" target=\"_blank\">https://github.com/zhaoguibin/zhihu_pic</a></p>\n<h6 id=\"需要安装-gjson\"><a href=\"#需要安装-gjson\" class=\"headerlink\" title=\"需要安装  gjson\"></a>需要安装  <a  href=\"https://github.com/tidwall/gjson\" target=\"_blank\">gjson</a></h6><span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">go get -u github.com/tidwall/gjson</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight golang\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;bytes&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;io&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;io/ioutil&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;regexp&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;strings&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/tidwall/gjson&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"string\">&quot;bufio&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;strconv&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> quit = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\turl := urlExists()</span><br><span class=\"line\"></span><br><span class=\"line\">\tdirName := strconv.FormatInt(time.Now().Unix(), <span class=\"number\">10</span>)</span><br><span class=\"line\">\timgDir := <span class=\"string\">&quot;./&quot;</span> + dirName + <span class=\"string\">&quot;/&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t_, errs := pathExists(imgDir)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> errs != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Printf(<span class=\"string\">&quot;创建文件失败&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tgetImgURL(url, imgDir)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取图片地址</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getImgURL</span><span class=\"params\">(url, imgDir <span class=\"type\">string</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//提交请求</span></span><br><span class=\"line\">\treqest, err := http.NewRequest(<span class=\"string\">&quot;GET&quot;</span>, url, <span class=\"literal\">nil</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//增加header选项</span></span><br><span class=\"line\">\treqest.Header.Add(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json; charset=utf-8&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//这里似乎不需要cookie，先注释掉</span></span><br><span class=\"line\">\t<span class=\"comment\">//reqest.Header.Add(&quot;Cookie&quot;, &quot;_zap=97a733fe-7d3e-45e0-9fe8-c138f01b6fc9; d_c0=\\&quot;AEBjiMYYoA2PTo-4jA6iymyc8bkORSrQyVg=|1526862212\\&quot;; _xsrf=rSY6NLBWiJVpd3t779cxSpkzOCTNZfnn; z_c0=Mi4xTURUVEFRQUFBQUFBUUdPSXhoaWdEUmNBQUFCaEFsVk4xakhKWEFBcmtpS09jQUFoVWpJM2NXNG9LQjBtbWxuWm5B|1541137366|ad106a49adcbac59f43323b0d4f97ded81c4a08b; __utmv=51854390.100-1|2=registration_date=20150706=1^3=entry_date=20150706=1; _ga=GA1.2.632016254.1541137374; tst=r; q_c1=c7a254833a0146769ea4f47f755774ba|1547085195000|1527140571000; __utmc=51854390; __utma=51854390.632016254.1541137374.1547085197.1547112488.3; __utmz=51854390.1547112488.3.3.utmcsr=zhihu.com|utmccn=(referral)|utmcmd=referral|utmcct=/people/zhao-gui-bin-zero/following/collections; tgw_l7_route=66cb16bc7f45da64562a077714739c11; arp_scroll_position=192745&quot;)</span></span><br><span class=\"line\">\treqest.Header.Add(<span class=\"string\">&quot;Host&quot;</span>, <span class=\"string\">&quot;www.zhihu.com&quot;</span>)</span><br><span class=\"line\">\treqest.Header.Add(<span class=\"string\">&quot;Referer&quot;</span>, <span class=\"string\">&quot;www.zhihu.com&quot;</span>)</span><br><span class=\"line\">\treqest.Header.Add(<span class=\"string\">&quot;User-Agent&quot;</span>, <span class=\"string\">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//生成client 参数为默认</span></span><br><span class=\"line\">\tclient := &amp;http.Client&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//处理返回结果</span></span><br><span class=\"line\">\tresponse, err := client.Do(reqest)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;图片地址不正确，请重试&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> response.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> response.StatusCode == <span class=\"number\">200</span> &#123;</span><br><span class=\"line\">\t\tbody, _ := ioutil.ReadAll(response.Body)</span><br><span class=\"line\">\t\tbodystr := <span class=\"type\">string</span>(body)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">//下一页数据</span></span><br><span class=\"line\">\t\tnext := gjson.Get(bodystr, <span class=\"string\">&quot;paging.next&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tfmt.Println(next.String() + <span class=\"string\">&quot;------------------------------------------------------&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++ &#123;</span><br><span class=\"line\">\t\t\tvalue := gjson.Get(bodystr, <span class=\"string\">&quot;data.&quot;</span>+strconv.Itoa(i)+<span class=\"string\">&quot;.content&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(value.String()) &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> re = regexp.MustCompile(<span class=\"string\">`(?m)&lt;noscript&gt;&lt;img src=&quot;(.\\S*)&quot;`</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> _, match := <span class=\"keyword\">range</span> re.FindAllStringSubmatch(value.String(), <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">go</span> downloadImg(match[<span class=\"number\">1</span>], imgDir)</span><br><span class=\"line\">\t\t\t\t\t&lt;-quit</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tfmt.Println(<span class=\"string\">&quot;抓取结束&quot;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(next.String()) &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t\tgetImgURL(next.String(), imgDir)</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;抓取结束，已到最后一页&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;获取数据错误，请重试&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//下载图片</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">downloadImg</span><span class=\"params\">(url, imgDir <span class=\"type\">string</span>)</span></span> (n <span class=\"type\">int64</span>, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\tpath := strings.Split(url, <span class=\"string\">&quot;/&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> name <span class=\"type\">string</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(path) &gt; <span class=\"number\">1</span> &#123;</span><br><span class=\"line\">\t\tname = path[<span class=\"built_in\">len</span>(path)<span class=\"number\">-1</span>]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfmt.Println(name)</span><br><span class=\"line\">\tout, err := os.Create(imgDir + name)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> out.Close()</span><br><span class=\"line\">\tresp, err := http.Get(url)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;图片下载失败&quot;</span>)</span><br><span class=\"line\">\t\tquit &lt;- <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tquit &lt;- <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> resp.Body.Close()</span><br><span class=\"line\">\tpix, err := ioutil.ReadAll(resp.Body)</span><br><span class=\"line\">\tn, err = io.Copy(out, bytes.NewReader(pix))</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">pathExists</span><span class=\"params\">(path <span class=\"type\">string</span>)</span></span> (<span class=\"type\">bool</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t_, err := os.Stat(path)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\terr := os.Mkdir(path, os.ModePerm)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>, <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//判断URL是否为空</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">urlExists</span><span class=\"params\">()</span></span> <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">\turls := bufio.NewReader(os.Stdin)</span><br><span class=\"line\">\tfmt.Print(<span class=\"string\">&quot;输入Url:&quot;</span>)</span><br><span class=\"line\">\turl, _, _ := urls.ReadLine()</span><br><span class=\"line\">\turlStr := <span class=\"type\">string</span>(url[:])</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(url) == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\turlStr = urlExists()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> urlStr</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","tags":["golang"]},{"title":"linux下php扩展mysqli的支持","url":"/2017/12/03/linux%E4%B8%8Bphp%E6%89%A9%E5%B1%95mysqli%E7%9A%84%E6%94%AF%E6%8C%81/","content":"<p>mysqli是优化后的mysql，具体的优点baidu下就ok了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> php-5.2.8   在这下面有个ext文件夹里有mysqli</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ext/mysqli</span><br></pre></td></tr></table></figure>\n<p>linux下将源码文件编译应该都有configure吧，可这里没有，在我们已经安装php后，php5这个文件夹里的命令目录bin里有一个文件叫phpize，用它就可以生成configure文件啦，继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/local/php5/bin/phpize</span><br></pre></td></tr></table></figure>\n<p>这里回车运行，执行完后就出了configure文件，</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./configure --prefix=/opt/local/mysqli --with-php-config=/opt/local/php/bin/php-config --with-mysqli=/opt/local/mysql/bin/mysql_config</span><br><span class=\"line\">直接回车，不出问题就继续。。</span><br><span class=\"line\">make</span><br><span class=\"line\">make <span class=\"built_in\">test</span></span><br><span class=\"line\">make install   (不出错就会显示Installing shared extensions: /usr/local/php5/lib/php/extensions/no-debug-non-zts-20041030/)</span><br></pre></td></tr></table></figure>\n<p>现在mysqli.so文件就出来啦。。</p>\n<p>直接在php.ini里把这个文件加载就OK啦。。</p>\n<span id=\"more\"></span>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">extension_dir=”/usr/local/php5/ext”</span><br><span class=\"line\">extension=mysqli.so</span><br></pre></td></tr></table></figure>\n<p>把上面第一行找到修改成这个,然后再把第二行加入。。wq保存退出。</p>\n<p>把mysqli.so这个文件cp到&#x2F;usr&#x2F;local&#x2F;php5&#x2F;ext下</p>\n<p>重启apache.</p>\n","tags":["linux","mysql"]},{"title":"hexo相关优化","url":"/2017/12/01/hexo%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96/","content":"<h3 id=\"local-search\"><a href=\"#local-search\" class=\"headerlink\" title=\"local search\"></a>local search</h3><p>安装 hexo-generator-search</p>\n<span id=\"more\"></span>\n\n<p>在站点的根目录下执行以下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure>\n<p>安装 hexo-generator-searchdb</p>\n<p>在站点的根目录下执行以下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>\n<p>启用搜索</p>\n<p>编辑 站点配置文件，新增以下内容到任意位置：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">search:</span><br><span class=\"line\">  path: search.xml</span><br><span class=\"line\">  field: post</span><br><span class=\"line\">  format: html</span><br><span class=\"line\">  <span class=\"built_in\">limit</span>: 10000</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"给-Github-添加-README\"><a href=\"#给-Github-添加-README\" class=\"headerlink\" title=\"给 Github 添加 README\"></a>给 Github 添加 README</h3><p>默认情况下， Github 中每一个项目，我们希望有一份 README.md 的文件来作为项目的说明，但是我们在项目根目录下的 blog\\source 目录下创建一份 README.md 文件，写好说明介绍，部署的时候，这个 README.md 会被 hexo 解析掉，而不会被解析到 Github 中去的。<br>正确的解决方法其实很简单：<br>把 README.md 文件的后缀名改成 MDOWN 然后扔到 blog&#x2F;source 文件夹下即可，这样 hexo 不会解析， Github 也会将其作为MD文件解析。</p>\n<h3 id=\"解决每次发布后需要手动在-github-page-的-setting-里重新设置自定义域名\"><a href=\"#解决每次发布后需要手动在-github-page-的-setting-里重新设置自定义域名\" class=\"headerlink\" title=\"解决每次发布后需要手动在 github page 的 setting 里重新设置自定义域名\"></a>解决每次发布后需要手动在 github page 的 setting 里重新设置自定义域名</h3><p>在 &#x2F;hexo&#x2F;source 目录建一个 CNAME，里面写你的域名，这样每次生成的时候就会自带这个文件了，以后就不用重新修改自定义域名了</p>\n","tags":["hexo"]},{"title":"linux安装pear","url":"/2018/01/20/linux%E5%AE%89%E8%A3%85pear/","content":"<p>看图操作</p>\n<p>这是错误，先放在前面，以免出现错误不知道怎么办<br><br>出现这个错误就按照它的那个地址下载现在在执行安装就好了<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/linux%E5%AE%89%E8%A3%85pear/error.png\" alt=\"error\"></p>\n<span id=\"more\"></span>\n\n<p>安装过程，基本上一路回车就可以了<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/linux%E5%AE%89%E8%A3%85pear/all.png\" alt=\"step\"></p>\n","tags":["linux","php"]},{"title":"linux挂载windows下的共享文件","url":"/2018/11/23/linux%E6%8C%82%E8%BD%BDwindows%E4%B8%8B%E7%9A%84%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/","content":"<h5 id=\"安装cifs-utils\"><a href=\"#安装cifs-utils\" class=\"headerlink\" title=\"安装cifs-utils\"></a>安装cifs-utils</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install cifs* -y</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"这条命令只可以读取Windows共享文件，不能创建文件\"><a href=\"#这条命令只可以读取Windows共享文件，不能创建文件\" class=\"headerlink\" title=\"这条命令只可以读取Windows共享文件，不能创建文件\"></a>这条命令只可以读取Windows共享文件，不能创建文件</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#user=Windows用户</span></span><br><span class=\"line\"><span class=\"comment\">#pass=Windows登录密码</span></span><br><span class=\"line\"><span class=\"comment\">#//192.168.10.64/APP Windows共享文件</span></span><br><span class=\"line\"><span class=\"comment\">#/opt/APP/ linux挂载目录</span></span><br><span class=\"line\"></span><br><span class=\"line\">mount.cifs //192.168.10.64/APP /opt/APP/ -o user=Developer,pass=123456trewq</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"这条命令可以添加文件操作权限\"><a href=\"#这条命令可以添加文件操作权限\" class=\"headerlink\" title=\"这条命令可以添加文件操作权限\"></a>这条命令可以添加文件操作权限</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#user=Windows用户</span></span><br><span class=\"line\"><span class=\"comment\">#pass=Windows登录密码</span></span><br><span class=\"line\"><span class=\"comment\">#//192.168.10.64/APP Windows共享文件</span></span><br><span class=\"line\"><span class=\"comment\">#/opt/APP/ linux挂载目录</span></span><br><span class=\"line\"><span class=\"comment\">#uid，gid，linux用户的id和用户组id，可以通过 id root 命令查看用户的id和用户组id</span></span><br><span class=\"line\"><span class=\"comment\">#rw,dir_mode=0777,file_mode=0777这些是设置文件夹权限，可以根据自己的需求设置权限</span></span><br><span class=\"line\"></span><br><span class=\"line\">mount.cifs //192.168.10.64/APP /opt/APP/ -o user=Developer,pass=123456trewq,rw,uid=0,gid=0,dir_mode=0777,file_mode=0777</span><br></pre></td></tr></table></figure>\n\n\n\n","tags":["linux","windows"]},{"title":"lsyncd实时同步工具安装","url":"/2017/11/30/lsyncd%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85/","content":"<p>有2种方法可以安装</p>\n<p>1.yum安装，前提是安装了epel更新源。使用命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y lsyncd</span><br></pre></td></tr></table></figure>\n\n<p>2.github下载，地址为：<a href=\"https://github.com/axkibe/lsyncd\">https://github.com/axkibe/lsyncd</a></p>\n<span id=\"more\"></span>\n\n<p>安装lua软件包以及依赖软件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y lua lua-devel cmake rsync</span><br></pre></td></tr></table></figure>\n\n<p>解压下载的压缩包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">unzip lsyncd-master.zip -d /usr/src/</span><br></pre></td></tr></table></figure>\n\n<p>进入目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/src/lsyncd-master/</span><br></pre></td></tr></table></figure>\n\n<p>使用cmake编译，如果没有安装cmake,可以yum安装一下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/lsyncd</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<p>进入安装目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/lsyncd/</span><br></pre></td></tr></table></figure>\n\n<p>创建配置文件目录和日志目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> etc var</span><br></pre></td></tr></table></figure>\n\n<p>进入配置文件目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> etc/</span><br></pre></td></tr></table></figure>\n\n<p>编译配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim lsyncd.conf</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">settings &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"> --pid文件</span><br><span class=\"line\"></span><br><span class=\"line\"> logfile = <span class=\"string\">&quot;/usr/local/lsyncd/var/lsyncd.log&quot;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> --状态文件</span><br><span class=\"line\"></span><br><span class=\"line\"> statusFile = <span class=\"string\">&quot;/usr/local/lsyncd/var/lsyncd.status&quot;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> --同步模式，意思就是有更新就同步</span><br><span class=\"line\"></span><br><span class=\"line\"> inotifyMode = <span class=\"string\">&quot;CloseWrite or Modify&quot;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> --最大8个进程</span><br><span class=\"line\"></span><br><span class=\"line\">    maxProcesses = 8,</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sync</span> &#123;</span><br><span class=\"line\">    default.rsync,</span><br><span class=\"line\">    <span class=\"built_in\">source</span>    = <span class=\"string\">&quot;/www&quot;</span>,</span><br><span class=\"line\">    target    = <span class=\"string\">&quot;root@192.168.10.50:/www&quot;</span>,</span><br><span class=\"line\">    maxDelays = 5,</span><br><span class=\"line\">    delay = 30,</span><br><span class=\"line\">    -- init = <span class=\"literal\">true</span>,</span><br><span class=\"line\">    rsync     = &#123;</span><br><span class=\"line\">        binary = <span class=\"string\">&quot;/usr/bin/rsync&quot;</span>,</span><br><span class=\"line\">        archive = <span class=\"literal\">true</span>,</span><br><span class=\"line\">        compress = <span class=\"literal\">true</span>,</span><br><span class=\"line\">        bwlimit   = 2000</span><br><span class=\"line\">        -- rsh = <span class=\"string\">&quot;/usr/bin/ssh -p 22 -o StrictHostKeyChecking=no&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>在远端被同步的服务器上开启ssh无密码登录，请注意用户身份：（用root还是最吼的！！！）</p>\n<p>链接：<a href=\"http://www.zhaoguibin.me/2017/11/30/ssh%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/#more\">ssh免密码登录</a></p>\n<p>最后启动</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/local/lsyncd/bin/lsyncd -<span class=\"built_in\">log</span> Exec /usr/local/lsyncd/etc/lsyncd.conf</span><br></pre></td></tr></table></figure>\n<p>关闭</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"> ps -aux | grep lsyncd</span><br><span class=\"line\"><span class=\"built_in\">kill</span> <span class=\"built_in\">id</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>编译启动脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/init.d/lsyncd</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># chkconfig: - 85 15</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># description: Lightweight inotify based sync daemon</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># processname:  lsyncd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># config:       /usr/local/lsyncd/etc/lsyncd.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># config:       /etc/sysconfig/lsyncd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># pidfile:      /var/run/lsyncd.pid</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Source function library</span></span><br><span class=\"line\"></span><br><span class=\"line\">. /etc/init.d/functions</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Source networking configuration.</span></span><br><span class=\"line\"></span><br><span class=\"line\">. /etc/sysconfig/network</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Check that networking is up.</span></span><br><span class=\"line\"></span><br><span class=\"line\">[ <span class=\"string\">&quot;<span class=\"variable\">$NETWORKING</span>&quot;</span> = <span class=\"string\">&quot;no&quot;</span> ] &amp;&amp; <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">LSYNCD_OPTIONS=<span class=\"string\">&quot;-pidfile /var/run/lsyncd.pid /usr/local/lsyncd/etc/lsyncd.conf&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -e /etc/sysconfig/lsyncd ]; <span class=\"keyword\">then</span></span><br><span class=\"line\"></span><br><span class=\"line\">  . /etc/sysconfig/lsyncd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">RETVAL=0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">prog=<span class=\"string\">&quot;lsyncd&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">thelock=/var/lock/subsys/lsyncd</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">start</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">[ -f /usr/local/lsyncd/etc/lsyncd.conf ] || <span class=\"built_in\">exit</span> 6</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Starting <span class=\"variable\">$prog</span>: &quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ <span class=\"variable\">$UID</span> -ne 0 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\"></span><br><span class=\"line\">                RETVAL=1</span><br><span class=\"line\"></span><br><span class=\"line\">                failure</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\"></span><br><span class=\"line\">                daemon <span class=\"variable\">$&#123;LSYNCD_USER:+--user <span class=\"variable\">$&#123;LSYNCD_USER&#125;</span>&#125;</span> /usr/local/lsyncd/bin/lsyncd <span class=\"variable\">$LSYNCD_OPTIONS</span></span><br><span class=\"line\"></span><br><span class=\"line\">                RETVAL=$?</span><br><span class=\"line\"></span><br><span class=\"line\">                [ <span class=\"variable\">$RETVAL</span> -eq 0 ] &amp;&amp; <span class=\"built_in\">touch</span> <span class=\"variable\">$thelock</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">fi</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stop</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Stopping <span class=\"variable\">$prog</span>: &quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ <span class=\"variable\">$UID</span> -ne 0 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\"></span><br><span class=\"line\">                RETVAL=1</span><br><span class=\"line\"></span><br><span class=\"line\">                failure</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\"></span><br><span class=\"line\">                killproc lsyncd</span><br><span class=\"line\"></span><br><span class=\"line\">                RETVAL=$?</span><br><span class=\"line\"></span><br><span class=\"line\">                [ <span class=\"variable\">$RETVAL</span> -eq 0 ] &amp;&amp; <span class=\"built_in\">rm</span> -f <span class=\"variable\">$thelock</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">fi</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">reload</span></span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Reloading <span class=\"variable\">$prog</span>: &quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        killproc lsyncd -HUP</span><br><span class=\"line\"></span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">restart</span></span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        stop</span><br><span class=\"line\"></span><br><span class=\"line\">        start</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">condrestart</span></span>()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [ -e <span class=\"variable\">$thelock</span> ] &amp;&amp; restart</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">return</span> 0</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> <span class=\"keyword\">in</span></span><br><span class=\"line\"></span><br><span class=\"line\">  start)</span><br><span class=\"line\"></span><br><span class=\"line\">        start</span><br><span class=\"line\"></span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  stop)</span><br><span class=\"line\"></span><br><span class=\"line\">        stop</span><br><span class=\"line\"></span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  restart)</span><br><span class=\"line\"></span><br><span class=\"line\">        restart</span><br><span class=\"line\"></span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  reload)</span><br><span class=\"line\"></span><br><span class=\"line\">        reload</span><br><span class=\"line\"></span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  condrestart)</span><br><span class=\"line\"></span><br><span class=\"line\">        condrestart</span><br><span class=\"line\"></span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  status)</span><br><span class=\"line\"></span><br><span class=\"line\">        status lsyncd</span><br><span class=\"line\"></span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\"></span><br><span class=\"line\">        ;;</span><br><span class=\"line\"></span><br><span class=\"line\">  *)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> $<span class=\"string\">&quot;Usage: <span class=\"variable\">$0</span> &#123;start|stop|status|restart|condrestart|reload&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        RETVAL=1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">exit</span> <span class=\"variable\">$RETVAL</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>设置权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> 755 /etc/init.d/lsyncd</span><br></pre></td></tr></table></figure>\n<p>添加到开机自启动文件中</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;/etc/init.d/lsyncd start&quot;</span> &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure>\n","tags":["linux","lsyncd"]},{"title":"mysql-日志文件mysql-bin文件清除方法","url":"/2017/12/02/mysql-%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6mysql-bin%E6%96%87%E4%BB%B6%E6%B8%85%E9%99%A4%E6%96%B9%E6%B3%95/","content":"<p>默认情况下mysql会一直保留mysql-bin文件，这样到一定时候，磁盘可能会被撑满，这时候是否可以删除这些文件呢，是否可以安全删除，是个问题。</p>\n<p>首先要说明一下，这些文件都是mysql的日志文件，如果不做主从复制的话，基本上是没用的，虽然没用，但是不建议使用rm命令删除，这样有可能会不安全，正确的方法是通过mysql的命令去删除。</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -u root -p</span><br><span class=\"line\">Enter password:Welcome to the MySQL monitor.Commandsendwith;or \\g.YourMySQL connection <span class=\"built_in\">id</span> is2819416Server version:5.5.24-0ubuntu0.12.04.1-log (Ubuntu)Copyright(c)2000,2011,Oracleand/or its affiliates.All rights reserved.Oracleis a registered trademark of OracleCorporationand/or its</span><br><span class=\"line\">affiliates.Other names may be trademarks of their respective</span><br><span class=\"line\">owners.Type<span class=\"string\">&#x27;help;&#x27;</span>or<span class=\"string\">&#x27;\\h&#x27;</span><span class=\"keyword\">for</span> help.Type<span class=\"string\">&#x27;\\c&#x27;</span> to clear the current input statement.</span><br><span class=\"line\">mysql&gt; reset master;Query OK,0 rows affected (3 min 37.65 sec)</span><br></pre></td></tr></table></figure>\n<p>其实关键的命令就是reset master;这个命令会清空mysql-bin文件。</p>\n<p>另外如果你的mysql服务器不需要做主从复制的话，建议通过修改my.cnf文件，来设置不生成这些文件，只要删除my.cnf中的下面一行就可以了。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">log-bin=mysql-bin</span><br></pre></td></tr></table></figure>\n<p>如果你需要复制，最好控制一下这些日志文件保留的天数，可以通过下面的配置设定日志文件保留的天数：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">expire_logs_days =7</span><br></pre></td></tr></table></figure>\n<p>表示保留7天的日志，这样老日志会自动被清理掉。</p>\n","tags":["mysql"]},{"title":"mysql实现主从复制","url":"/2017/12/02/mysql%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/","content":"<p>准备工作：</p>\n<p>1.两个虚拟机：我这里用的是CentOS5.5，IP地址分别是192.168.1.101 和192.168.1.105；</p>\n<p>101做主服务器，105做从服务器（都已经安装相同版本的Mysql）；</p>\n<p>2.本机环境：Nginx+PHP+MySQL</p>\n<p>好了，现在开始吧，来看看这听起来高大上的主从复制是怎么回事。</p>\n<p>原理：mysql要做到主从复制，其实依靠的是二进制日志，即：假设主服务器叫A，从服务器叫B；主从复制就是</p>\n<p>B跟着A学，A做什么，B就做什么。那么B怎么同步A的动作呢？现在A有一个日志功能，把自己所做的增删改查的动作</p>\n<p>全都记录在日志中，B只需要拿到这份日志，照着日志上面的动作施加到自己身上就可以了。这样就实现了主从复制。</p>\n<p>扩展：MYSQL还有一种日志叫做：慢日志</p>\n<p>可以设置一个时间，那么所有执行时间超过这个时间的SQL都会被记录下来。这样就可以通过慢日志快速的找到网站中SQL的瓶颈来进行优化。</p>\n<p>实现步骤：</p>\n<p>1.首先修改mysql的配置文件，使其支持二进制日志功能。</p>\n<p>打开主服务器的mysql配置文件：my.conf</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>\n<p>加入如下三行代码：</p>\n<span id=\"more\"></span>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B61.png\" alt=\"添加代码\"></p>\n<p>参数解释：<br>log-bin&#x3D;mysql-bin &#x2F;&#x2F;将mysql二进制日志取名为mysql-bin</p>\n<p>binlog_format&#x3D;mixed &#x2F;&#x2F;二进制日志的格式，有三种：statement&#x2F;row&#x2F;mixed,具体分别不多做解释，这里使用mixed</p>\n<p>server-id&#x3D;101 &#x2F;&#x2F;为服务器设置一个独一无二的id便于区分，这里使用ip地址的最后一位充当server-id</p>\n<p>配置完成，:wq 保存，重启mysql</p>\n<p>重启mysql命令：# service mysqld restart</p>\n<p>同样的，进入从服务器，配置从服务器的my.cnf,重复步骤1即可，</p>\n<p>唯一的区别是，server-id要改成从服务器的ip尾位，即server-id&#x3D;105;其他两项是一样的，保存，并重启mySQL；</p>\n<p>2.在主服务器上为从服务器分配一个账号，就像一把钥匙，从服务器拿着这个钥匙，才能到主服务器上来共享主服务器的日志文件。</p>\n<p>进入主服务器的mysql界面，</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -u root -p 111111     //我这里mysql账号是root，密码是111111</span><br></pre></td></tr></table></figure>\n<p>在mysql操作界面下，输入下面一行命令：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">GRANT</span> replication slave <span class=\"keyword\">ON</span> <span class=\"operator\">*</span>.<span class=\"operator\">*</span> <span class=\"keyword\">TO</span> <span class=\"string\">&#x27;slave&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> IDENTIFIED <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;111111&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B62.png\" alt=\"参数解释\"></p>\n<p>3.查看主服务器BIN日志的信息（执行完之后记录下这两值，然后在配置完从服务器之前不要对主服务器进行任何操作，因为每次操作数据库时这两值会发生改变）.</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B63.png\" alt=\"主服务器BIN日志的信息\"></p>\n<p>4.设置从服务器</p>\n<p>进入从服务器mysql</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -u root -p111111</span><br></pre></td></tr></table></figure>\n<p>关闭slave（如果你以前配置过主从的话，一定要先关闭）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stop slave;</span><br></pre></td></tr></table></figure>\n<p>开始配置：</p>\n<p>输入下面代码即可：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B64.png\" alt=\"配置主从代码\"></p>\n<p>参数解释：</p>\n<p>MASTER_HOST : 设置要连接的主服务器的ip地址</p>\n<p>MASTER_USER : 设置要连接的主服务器的用户名</p>\n<p>MASTER_PASSWORD : 设置要连接的主服务器的密码</p>\n<p>MASTER_LOG_FILE : 设置要连接的主服务器的bin日志的日志名称，即第3步得到的信息</p>\n<p>MASTER_LOG_POS : 设置要连接的主服务器的bin日志的记录位置，即第3步得到的信息，（这里注意，最后一项不需要加引号。否则配置失败）</p>\n<p>先在从服务器配置完成，启动从服务器：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">start slave;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B65.png\" alt=\"启动从服务器\"></p>\n<p>5.查看是否配置成功：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">show slave status;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/mysql%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B66.png\" alt=\"查看是否配置成功\"></p>\n<p>上面两项均为yes，说明配置成功，否则，请重复前面的步骤。</p>\n<p>文章参考：<a href=\"http://www.cnblogs.com/superfat/p/5267449.html\" target=\"_blank\">http://www.cnblogs.com/superfat/p/5267449.html</a></p>\n","tags":["linux","mysql"]},{"title":"mysql更改数据库目录","url":"/2017/12/16/mysql%E6%9B%B4%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%AE%E5%BD%95/","content":"<p>修改 my.cnf</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">datadir=/www/mysql/data</span><br><span class=\"line\">socket=/www/mysql/data/mysql.sock</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>其实这里不需要复制&#x2F;var&#x2F;lib&#x2F;mysql下的文件到新目录，修改完配置之后，mysql会自动复制&#x2F;var&#x2F;lib&#x2F;mysql下的文件到新目录</p>\n<p>关闭SELinux</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/selinux/config <span class=\"comment\">#编辑文件</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># This file controls the state of SELinux on the system.</span></span><br><span class=\"line\"><span class=\"comment\"># SELINUX= can take one of these three values:</span></span><br><span class=\"line\"><span class=\"comment\"># enforcing - SELinux security policy is enforced.</span></span><br><span class=\"line\"><span class=\"comment\">#permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class=\"line\"><span class=\"comment\">#disabled - No SELinux policy is loaded.</span></span><br><span class=\"line\">SELINUX=enforcing</span><br><span class=\"line\"><span class=\"comment\"># SELINUXTYPE= can take one of these two values:</span></span><br><span class=\"line\"><span class=\"comment\"># targeted - Targeted processes are protected,</span></span><br><span class=\"line\"><span class=\"comment\"># mls - Multi Level Security protection.</span></span><br></pre></td></tr></table></figure>\n<p>将SELINUX&#x3D;enforceing 改为 SELINUX&#x3D;disabled 重启机器就ok了</p>\n<p>最后</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ln</span> -s /www/mysql/data/mysql.sock /var/lib/mysql/mysql.sock</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"mysql添加索引命令","url":"/2018/01/20/mysql%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95%E5%91%BD%E4%BB%A4/","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1.PRIMARY  KEY（主键索引）</span><br><span class=\"line\">mysql&gt;ALTER  TABLE  `table_name`  ADD  PRIMARY  KEY (`column`)</span><br><span class=\"line\">2.UNIQUE(唯一索引)</span><br><span class=\"line\">        mysql&gt;ALTER  TABLE  `table_name`  ADD  UNIQUE (`column` )</span><br><span class=\"line\">3.INDEX(普通索引)</span><br><span class=\"line\">mysql&gt;ALTER  TABLE  `table_name`  ADD  INDEX index_name (`column`)</span><br><span class=\"line\">4.FULLTEXT(全文索引)</span><br><span class=\"line\">mysql&gt;ALTER  TABLE  `table_name`  ADD  FULLTEXT (`column`)</span><br><span class=\"line\">5.多列索引</span><br><span class=\"line\">mysql&gt;ALTER  TABLE  `table_name`  ADD  INDEX index_name (`column1`,  `column2`,</span><br><span class=\"line\">   `column3`)</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"nginx-alert-kill-646-1-failed-3-No-such-process-解决方法","url":"/2017/12/03/nginx-alert-kill-646-1-failed-3-No-such-process-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./nginx -s reload</span><br><span class=\"line\">nginx: [alert] <span class=\"built_in\">kill</span>(1708, 1) failed (3: No such process)</span><br><span class=\"line\">/opt/local/nginx/sbin/nginx -c /opt/local/nginx/conf/nginx.conf</span><br><span class=\"line\">/opt/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<p>PS:<br><br>假设你的nginx的目录是：&#x2F;usr&#x2F;opt&#x2F;nginx&#x2F;sbin&#x2F;nginx <br><br>假设nginx的配置目录是： &#x2F;usr&#x2F;opt&#x2F;nginx&#x2F;conf&#x2F;nginx.conf <br><br>重启的方法是：&#x2F;usr&#x2F;opt&#x2F;nginx&#x2F;sbin&#x2F;nginx -c &#x2F;usr&#x2F;opt&#x2F;nginx&#x2F;conf&#x2F;nginx.conf<br> 参数-c 指定了配置文件的路径，如果不指定该参数，则nginx会默认加载其按照目录的conf目录下的nginx.conf. 平滑重启： <br><br>1、检查修改后的配置文件是否正确： &#x2F;usr&#x2F;opt&#x2F;nginx&#x2F;sbin&#x2F;nginx -t -c<br> &#x2F;usr&#x2F;opt&#x2F;nginx&#x2F;conf&#x2F;nginx.conf <br><br>2、kill -HUP Nginx主进程号。示例如下：<br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">kill</span> -HUP <span class=\"built_in\">cat</span>/usr/local/webserver/nginx/logs/nginx.pid</span><br></pre></td></tr></table></figure>\n<p>主要参数介绍如下：-c 为Nginx 指定一个配置文件，来代替缺省的。-t 不运行，而仅仅测试配置文件。</p>\n","tags":["nginx"]},{"title":"netstat命令","url":"/2018/05/01/netstat%E5%91%BD%E4%BB%A4/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">netstat -anp | grep 端口号</span><br><span class=\"line\">telnet 127.0.0.1 9501</span><br><span class=\"line\">ps aft | grep tcp.php</span><br><span class=\"line\">pstree -p 22727</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"mysql查询出的数据插入另一个表","url":"/2018/01/20/mysql%E6%9F%A5%E8%AF%A2%E5%87%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%8F%A6%E4%B8%80%E4%B8%AA%E8%A1%A8/","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1.</span><br><span class=\"line\">INSERT INTO 表名1(字段列表1)</span><br><span class=\"line\">SELECT 字段列表2 FROM 表名2 WHERE 条件表达式;</span><br><span class=\"line\"></span><br><span class=\"line\">2.</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO 表名1(字段列表1)</span><br><span class=\"line\">select * from (select 字段 from *) 临时表名</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO 要插入数据的表 (字段1,字段2,....)</span><br><span class=\"line\">SELECT * FROM (查询数据的sql语句) 临时表名</span><br><span class=\"line\"></span><br><span class=\"line\">2-例子：</span><br><span class=\"line\"></span><br><span class=\"line\">INSERT INTO purchaseandsale_export (`name`)</span><br><span class=\"line\">SELECT * FROM (SELECT name FROM `worker`) temp</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"nginx-fastcgi-param解释","url":"/2017/12/03/nginx-fastcgi-param%E8%A7%A3%E9%87%8A/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">fastcgi_param SCRIPT_FILENAME $document_root<span class=\"variable\">$fastcgi_script_name</span>;<span class=\"comment\">#脚本文件请求的路径</span></span><br><span class=\"line\">fastcgi_param QUERY_STRING <span class=\"variable\">$query_string</span>;                        <span class=\"comment\">#请求的参数;如?app=123</span></span><br><span class=\"line\">fastcgi_param REQUEST_METHOD <span class=\"variable\">$request_method</span>;                    <span class=\"comment\">#请求的动作(GET,POST)</span></span><br><span class=\"line\">fastcgi_param CONTENT_TYPE <span class=\"variable\">$content_type</span>;                        <span class=\"comment\">#请求头中的Content-Type字段</span></span><br><span class=\"line\">fastcgi_param CONTENT_LENGTH <span class=\"variable\">$content_length</span>;                    <span class=\"comment\">#请求头中的Content-length字段。</span></span><br><span class=\"line\">fastcgi_param SCRIPT_NAME <span class=\"variable\">$fastcgi_script_name</span>;                  <span class=\"comment\">#脚本名称</span></span><br><span class=\"line\">fastcgi_param REQUEST_URI <span class=\"variable\">$request_uri</span>;                          <span class=\"comment\">#请求的地址不带参数</span></span><br><span class=\"line\">fastcgi_param DOCUMENT_URI <span class=\"variable\">$document_uri</span>;                        <span class=\"comment\">#与$uri相同。</span></span><br><span class=\"line\">fastcgi_param DOCUMENT_ROOT <span class=\"variable\">$document_root</span>;                      <span class=\"comment\">#网站的根目录。在server配置中root指令中指定的值</span></span><br><span class=\"line\">fastcgi_param SERVER_PROTOCOL <span class=\"variable\">$server_protocol</span>;                  <span class=\"comment\">#请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</span></span><br><span class=\"line\">fastcgi_param GATEWAY_INTERFACE CGI/1.1;                         <span class=\"comment\">#cgi 版本</span></span><br><span class=\"line\">fastcgi_param SERVER_SOFTWARE nginx/<span class=\"variable\">$nginx_version</span>;              <span class=\"comment\">#nginx 版本号，可修改、隐藏</span></span><br><span class=\"line\">fastcgi_param REMOTE_ADDR <span class=\"variable\">$remote_addr</span>;                          <span class=\"comment\">#客户端IP</span></span><br><span class=\"line\">fastcgi_param REMOTE_PORT <span class=\"variable\">$remote_port</span>;                          <span class=\"comment\">#客户端端口</span></span><br><span class=\"line\">fastcgi_param SERVER_ADDR <span class=\"variable\">$server_addr</span>;                          <span class=\"comment\">#服务器IP地址</span></span><br><span class=\"line\">fastcgi_param SERVER_PORT <span class=\"variable\">$server_port</span>;                          <span class=\"comment\">#服务器端口</span></span><br><span class=\"line\">fastcgi_param SERVER_NAME <span class=\"variable\">$server_name</span>;                          <span class=\"comment\">#服务器名，域名在server配置中指定的server_name</span></span><br><span class=\"line\"><span class=\"comment\">#fastcgi_param PATH_INFO $path_info;                             #可自定义变量</span></span><br><span class=\"line\"><span class=\"comment\">#PHP only, required if PHP was built with --enable-force-cgi-redirect</span></span><br><span class=\"line\"><span class=\"comment\">#fastcgi_param REDIRECT_STATUS 200;</span></span><br><span class=\"line\">在php可打印出上面的服务环境变量</span><br><span class=\"line\">如：<span class=\"built_in\">echo</span> <span class=\"variable\">$_SERVER</span>[<span class=\"string\">&#x27;REMOTE_ADDR&#x27;</span>]</span><br></pre></td></tr></table></figure>\n","tags":["nginx"]},{"title":"nginx-php-fpm出现502-bad-gateway错误解决方法","url":"/2017/12/03/nginx-php-fpm%E5%87%BA%E7%8E%B0502-bad-gateway%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/","content":"<p>1.或者php-cgi端口和nginx配置不一致，这是比较低级的错误</p>\n<p>2.php-fpm没有启动,到php-fpm所在目录启动</p>\n<p>3.php-fpm配置文件user和group配置和Nginx不一致</p>\n<p>4.在centos7中user和group修改在&#x2F;opt&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.d&#x2F;<a href=\"http://www.conf里面/\">www.conf里面</a></p>\n","tags":["nginx"]},{"title":"nginx配置HTTPS","url":"/2017/12/16/nginx%E9%85%8D%E7%BD%AEHTTPS/","content":"<h6 id=\"PS：设置HTTPS-nginx需要添加ssl模块-–with-http-ssl-module\"><a href=\"#PS：设置HTTPS-nginx需要添加ssl模块-–with-http-ssl-module\" class=\"headerlink\" title=\"PS：设置HTTPS nginx需要添加ssl模块 –with-http_ssl_module\"></a>PS：设置HTTPS nginx需要添加ssl模块 –with-http_ssl_module</h6><h6 id=\"在nginx的conf目录下新增ssl目录，并进入。\"><a href=\"#在nginx的conf目录下新增ssl目录，并进入。\" class=\"headerlink\" title=\"在nginx的conf目录下新增ssl目录，并进入。\"></a>在nginx的conf目录下新增ssl目录，并进入。<br></h6><h6 id=\"生成服务器端的私钥-key文件\"><a href=\"#生成服务器端的私钥-key文件\" class=\"headerlink\" title=\"生成服务器端的私钥(key文件):\"></a>生成服务器端的私钥(key文件):</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl genrsa -des3 -out server.key 2048</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/1.png\" alt=\"nginx配置HTTPS\"></p>\n<h6 id=\"运行时会提示输入密码-此密码用于加密key文件-参数des3便是指加密算法-当然也可以选用其他你认为安全的算法-以后每当需读取此文件-通过openssl提供的命令或API-都需输入口令-如果觉得不方便-也可以去除这个口令-但一定要采取其他的保护措施\"><a href=\"#运行时会提示输入密码-此密码用于加密key文件-参数des3便是指加密算法-当然也可以选用其他你认为安全的算法-以后每当需读取此文件-通过openssl提供的命令或API-都需输入口令-如果觉得不方便-也可以去除这个口令-但一定要采取其他的保护措施\" class=\"headerlink\" title=\"运行时会提示输入密码,此密码用于加密key文件(参数des3便是指加密算法,当然也可以选用其他你认为安全的算法.),以后每当需读取此文件(通过openssl提供的命令或API)都需输入口令.如果觉得不方便,也可以去除这个口令,但一定要采取其他的保护措施!\"></a>运行时会提示输入密码,此密码用于加密key文件(参数des3便是指加密算法,当然也可以选用其他你认为安全的算法.),以后每当需读取此文件(通过openssl提供的命令或API)都需输入口令.如果觉得不方便,也可以去除这个口令,但一定要采取其他的保护措施!</h6><p>去除key文件口令的命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> server.key -out server.key</span><br></pre></td></tr></table></figure>\n<h6 id=\"用刚生成的服务器私钥，生成证书请求文件。\"><a href=\"#用刚生成的服务器私钥，生成证书请求文件。\" class=\"headerlink\" title=\"用刚生成的服务器私钥，生成证书请求文件。\"></a>用刚生成的服务器私钥，生成证书请求文件。</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req -new -key server.key -out server.csr</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/2.png\" alt=\"nginx配置HTTPS\"></p>\n<span id=\"more\"></span>\n\n<p>生成Certificate Signing Request（CSR）,生成的csr文件交给CA签名后形成服务端自己的证书.<br></p>\n<h6 id=\"同样的命令生成生成客户端的私钥-key-文件-和证书请求文件Certificate-Signing-Request（CSR）\"><a href=\"#同样的命令生成生成客户端的私钥-key-文件-和证书请求文件Certificate-Signing-Request（CSR）\" class=\"headerlink\" title=\"同样的命令生成生成客户端的私钥(key 文件)和证书请求文件Certificate Signing Request（CSR）\"></a>同样的命令生成生成客户端的私钥(key 文件)和证书请求文件Certificate Signing Request（CSR）</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl genrsa -des3 -out client.key 2048</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/3.png\" alt=\"nginx配置HTTPS\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req -new -key client.key -out client.csr</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/4.png\" alt=\"nginx配置HTTPS\"></p>\n<h6 id=\"生成的CSR证书文件必须有CA的签名才可形成证书。这里制作自己的CA，-这时生成一个KEY文件ca-key-和根证书ca-crt。默认生成CA证书有效期是一个月，可以添加-days-365-设置有效期即为365天。\"><a href=\"#生成的CSR证书文件必须有CA的签名才可形成证书。这里制作自己的CA，-这时生成一个KEY文件ca-key-和根证书ca-crt。默认生成CA证书有效期是一个月，可以添加-days-365-设置有效期即为365天。\" class=\"headerlink\" title=\"生成的CSR证书文件必须有CA的签名才可形成证书。这里制作自己的CA， 这时生成一个KEY文件ca.key 和根证书ca.crt。默认生成CA证书有效期是一个月，可以添加-days 365,设置有效期即为365天。\"></a>生成的CSR证书文件必须有CA的签名才可形成证书。这里制作自己的CA， 这时生成一个KEY文件ca.key 和根证书ca.crt。默认生成CA证书有效期是一个月，可以添加-days 365,设置有效期即为365天。</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl req -new -x509 -keyout ca.key -out ca.crt -days 365</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/5.png\" alt=\"nginx配置HTTPS\"></p>\n<h6 id=\"签署证书准备工作：\"><a href=\"#签署证书准备工作：\" class=\"headerlink\" title=\"签署证书准备工作：\"></a>签署证书准备工作：</h6><p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/dir.png\" alt=\"nginx配置HTTPS\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@centos65 ssl]<span class=\"comment\"># vim /etc/pki/tls/openssl.cnf</span></span><br><span class=\"line\"><span class=\"comment\">#修改如下</span></span><br><span class=\"line\"><span class=\"built_in\">dir</span>             = /etc/pki/CA</span><br><span class=\"line\"><span class=\"comment\">#根据openssl.cnf生成配置文件</span></span><br><span class=\"line\">[root@centos65 ssl]<span class=\"comment\"># touch /etc/pki/CA/&#123;index.txt,serial&#125; </span></span><br><span class=\"line\">[root@centos65 ssl]<span class=\"comment\">#echo 01 &gt; /etc/pki/CA/serial</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"用生成的CA的证书-ca-crt-为刚才生成的服务器请求文件server-csr生成对应CA签名后的crt文件。默认有效期是365天，命令后增加-days-3650，即设置有效期为3650天。\"><a href=\"#用生成的CA的证书-ca-crt-为刚才生成的服务器请求文件server-csr生成对应CA签名后的crt文件。默认有效期是365天，命令后增加-days-3650，即设置有效期为3650天。\" class=\"headerlink\" title=\"用生成的CA的证书(ca.crt)为刚才生成的服务器请求文件server.csr生成对应CA签名后的crt文件。默认有效期是365天，命令后增加-days 3650，即设置有效期为3650天。\"></a>用生成的CA的证书(ca.crt)为刚才生成的服务器请求文件server.csr生成对应CA签名后的crt文件。默认有效期是365天，命令后增加-days 3650，即设置有效期为3650天。</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl ca -<span class=\"keyword\">in</span> server.csr -out server.crt -cert ca.crt -keyfile ca.key</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/6.png\" alt=\"nginx配置HTTPS\"></p>\n<h6 id=\"用生成的CA的证书-ca-crt-为刚才生成的客户端请求文件client-csr生成对应CA签名后的crt文件。注意：可能直接运行会报以下错误，修改对应index-txt-attr文件unique-subject-x3D-no，重新运行即可。默认有效期是365天，命令后增加-days-1，即设置有效期为1天。\"><a href=\"#用生成的CA的证书-ca-crt-为刚才生成的客户端请求文件client-csr生成对应CA签名后的crt文件。注意：可能直接运行会报以下错误，修改对应index-txt-attr文件unique-subject-x3D-no，重新运行即可。默认有效期是365天，命令后增加-days-1，即设置有效期为1天。\" class=\"headerlink\" title=\"用生成的CA的证书(ca.crt)为刚才生成的客户端请求文件client.csr生成对应CA签名后的crt文件。注意：可能直接运行会报以下错误，修改对应index.txt.attr文件unique_subject &#x3D; no，重新运行即可。默认有效期是365天，命令后增加-days 1，即设置有效期为1天。\"></a>用生成的CA的证书(ca.crt)为刚才生成的客户端请求文件client.csr生成对应CA签名后的crt文件。注意：可能直接运行会报以下错误，修改对应index.txt.attr文件unique_subject &#x3D; no，重新运行即可。默认有效期是365天，命令后增加-days 1，即设置有效期为1天。</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl ca -<span class=\"keyword\">in</span> client.csr -out client.crt -cert ca.crt -keyfile ca.key</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/7_error.png\" alt=\"nginx配置HTTPS\"></p>\n<p>如果有错误修改</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/pki/CA/index.txt.attr</span><br><span class=\"line\"><span class=\"comment\">#unique_subject = yes</span></span><br><span class=\"line\">unique_subject = no</span><br></pre></td></tr></table></figure>\n<p>然后再重新运行一次<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/7.png\" alt=\"nginx配置HTTPS\"></p>\n<h6 id=\"这个certificate是BASE64形式的-要转成PKCS12才能装到IE-x2F-NETSCAPE上-转换如下：\"><a href=\"#这个certificate是BASE64形式的-要转成PKCS12才能装到IE-x2F-NETSCAPE上-转换如下：\" class=\"headerlink\" title=\"这个certificate是BASE64形式的,要转成PKCS12才能装到IE,&#x2F;NETSCAPE上.转换如下：\"></a>这个certificate是BASE64形式的,要转成PKCS12才能装到IE,&#x2F;NETSCAPE上.转换如下：</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"built_in\">export</span> -<span class=\"keyword\">in</span> client.crt -inkey client.key -out client.pfx</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/8.png\" alt=\"nginx配置HTTPS\"></p>\n<p>最后生成这些文件<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/nginx_ssl/9.png\" alt=\"nginx配置HTTPS\"></p>\n<h6 id=\"配置nginx如下：\"><a href=\"#配置nginx如下：\" class=\"headerlink\" title=\"配置nginx如下：\"></a>配置nginx如下：</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">listen\t443 ssl;</span><br><span class=\"line\">\tserver_name  alpha.sherp.xyz;</span><br><span class=\"line\">\troot /opt/project/erp_old_version/Shanghai_erp/public;</span><br><span class=\"line\">\tindex index.php;</span><br><span class=\"line\">        ssl_certificate ssl/server.crt;</span><br><span class=\"line\">        ssl_certificate_key ssl/server.key;</span><br><span class=\"line\">        ssl_client_certificate ssl/ca.crt;</span><br><span class=\"line\">        ssl_session_timeout 5m;</span><br><span class=\"line\">        ssl_verify_client on;</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"最后把client-pfx安装到客户端就可以了\"><a href=\"#最后把client-pfx安装到客户端就可以了\" class=\"headerlink\" title=\"最后把client.pfx安装到客户端就可以了\"></a>最后把client.pfx安装到客户端就可以了</h6>","tags":["nginx"]},{"title":"nginx配置location总结及rewrite规则写法","url":"/2017/12/03/nginx%E9%85%8D%E7%BD%AElocation%E6%80%BB%E7%BB%93%E5%8F%8Arewrite%E8%A7%84%E5%88%99%E5%86%99%E6%B3%95/","content":"<p>location正则写法<br>一个示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">location  = / &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 精确匹配 / ，主机名后面不能带任何字符串</span></span><br><span class=\"line\">  [ configuration A ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location  / &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求</span></span><br><span class=\"line\">  <span class=\"comment\"># 但是正则和最长字符串会优先匹配</span></span><br><span class=\"line\">  [ configuration B ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location /documents/ &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索</span></span><br><span class=\"line\">  <span class=\"comment\"># 只有后面的正则表达式没有匹配到时，这一条才会采用这一条</span></span><br><span class=\"line\">  [ configuration C ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~ /documents/Abc &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索</span></span><br><span class=\"line\">  <span class=\"comment\"># 只有后面的正则表达式没有匹配到时，这一条才会采用这一条</span></span><br><span class=\"line\">  [ configuration CC ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ^~ /images/ &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 匹配任何以 /images/ 开头的地址，匹配符合以后，停止往下搜索正则，采用这一条。</span></span><br><span class=\"line\">  [ configuration D ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~* \\.(gif|jpg|jpeg)$ &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 匹配所有以 gif,jpg或jpeg 结尾的请求</span></span><br><span class=\"line\">  <span class=\"comment\"># 然而，所有请求 /images/ 下的图片会被 config D 处理，因为 ^~ 到达不了这一条正则</span></span><br><span class=\"line\">  [ configuration E ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location /images/ &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 字符匹配到 /images/，继续往下，会发现 ^~ 存在</span></span><br><span class=\"line\">  [ configuration F ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location /images/abc &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 最长字符匹配到 /images/abc，继续往下，会发现 ^~ 存在</span></span><br><span class=\"line\">  <span class=\"comment\"># F与G的放置顺序是没有关系的</span></span><br><span class=\"line\">  [ configuration G ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~ /images/abc/ &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 只有去掉 config D 才有效：先最长匹配 config G 开头的地址，继续往下搜索，匹配到这一条正则，采用</span></span><br><span class=\"line\">    [ configuration H ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">1</span><br><span class=\"line\">location ~* /js/.*/\\.js</span><br><span class=\"line\">已=开头表示精确匹配</span><br><span class=\"line\"></span><br><span class=\"line\">如 A 中只匹配根目录结尾的请求，后面不能带任何字符串。</span><br><span class=\"line\"></span><br><span class=\"line\">^~ 开头表示uri以某个常规字符串开头，不是正则匹配</span><br><span class=\"line\"></span><br><span class=\"line\">~ 开头表示区分大小写的正则匹配;</span><br><span class=\"line\"></span><br><span class=\"line\">~* 开头表示不区分大小写的正则匹配</span><br><span class=\"line\"></span><br><span class=\"line\">/ 通用匹配, 如果没有其它匹配,任何请求都会匹配到</span><br><span class=\"line\">顺序 no优先级： (location =) &gt; (location 完整路径) &gt; (location ^~ 路径) &gt; (location ~,~* 正则顺序) &gt; (location 部分起始路径) &gt; (/)</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>上面的匹配结果 按照上面的location写法，以下的匹配示例成立：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/ -&gt; config A</span><br><span class=\"line\">精确完全匹配，即使/index.html也匹配不了</span><br><span class=\"line\">/downloads/download.html -&gt; config B</span><br><span class=\"line\">匹配B以后，往下没有任何匹配，采用B</span><br><span class=\"line\">/images/1.gif -&gt; configuration D</span><br><span class=\"line\">匹配到F，往下匹配到D，停止往下</span><br><span class=\"line\">/images/abc/def -&gt; config D</span><br><span class=\"line\">最长匹配到G，往下匹配D，停止往下</span><br><span class=\"line\">你可以看到 任何以/images/开头的都会匹配到D并停止，FG写在这里是没有任何意义的，H是永远轮不到的，这里只是为了说明匹配顺序</span><br><span class=\"line\">/documents/document.html -&gt; config C</span><br><span class=\"line\">匹配到C，往下没有任何匹配，采用C</span><br><span class=\"line\">/documents/1.jpg -&gt; configuration E</span><br><span class=\"line\">匹配到C，往下正则匹配到E</span><br><span class=\"line\">/documents/Abc.jpg -&gt; config CC</span><br><span class=\"line\">最长匹配到C，往下正则顺序匹配到CC，不会往下到E</span><br><span class=\"line\">实际使用建议</span><br><span class=\"line\">所以实际使用中，个人觉得至少有三个匹配规则定义，如下：</span><br><span class=\"line\">#直接匹配网站根，通过域名访问网站首页比较频繁，使用这个会加速处理，官网如是说。</span><br><span class=\"line\">#这里是直接转发给后端应用服务器了，也可以是一个静态首页</span><br><span class=\"line\"># 第一个必选规则</span><br><span class=\"line\">location = / &#123;</span><br><span class=\"line\">    proxy_pass http://tomcat:8080/index</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"># 第二个必选规则是处理静态文件请求，这是nginx作为http服务器的强项</span><br><span class=\"line\"># 有两种配置模式，目录匹配或后缀匹配,任选其一或搭配使用</span><br><span class=\"line\">location ^~ /static/ &#123;</span><br><span class=\"line\">    root /webroot/static/;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~* \\.(gif|jpg|jpeg|png|css|js|ico)$ &#123;</span><br><span class=\"line\">    root /webroot/res/;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">#第三个规则就是通用规则，用来转发动态请求到后端应用服务器</span><br><span class=\"line\">#非静态文件请求就默认是动态请求，自己根据实际把握</span><br><span class=\"line\">#毕竟目前的一些框架的流行，带.php,.jsp后缀的情况很少了</span><br><span class=\"line\">location / &#123;</span><br><span class=\"line\">    proxy_pass http://tomcat:8080/</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http://tengine.taobao.org/book/chapter_02.html</span><br><span class=\"line\">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html</span><br><span class=\"line\">Rewrite规则</span><br><span class=\"line\"></span><br><span class=\"line\">rewrite功能就是，使用nginx提供的全局变量或自己设置的变量，结合正则表达式和标志位实现url重写以及重定向。rewrite只能放在server&#123;&#125;,location&#123;&#125;,if&#123;&#125;中，并且只能对域名后边的除去传递的参数外的字符串起作用，例如 http://seanlook.com/a/we/index.php?id=1&amp;u=str 只对/a/we/index.php重写。语法rewrite regex replacement [flag];</span><br><span class=\"line\"></span><br><span class=\"line\">如果相对域名或参数字符串起作用，可以使用全局变量匹配，也可以使用proxy_pass反向代理。</span><br><span class=\"line\"></span><br><span class=\"line\">表明看rewrite和location功能有点像，都能实现跳转，主要区别在于rewrite是在同一域名内更改获取资源的路径，而location是对一类路径做控制访问或反向代理，可以proxy_pass到其他机器。很多情况下rewrite也会写在location里，它们的执行顺序是：</span><br><span class=\"line\"></span><br><span class=\"line\">执行server块的rewrite指令</span><br><span class=\"line\">执行location匹配</span><br><span class=\"line\">执行选定的location中的rewrite指令</span><br><span class=\"line\">如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件；循环超过10次，则返回500 Internal Server Error错误。</span><br><span class=\"line\">flag标志位</span><br><span class=\"line\">last : 相当于Apache的[L]标记，表示完成rewrite</span><br><span class=\"line\">break : 停止执行当前虚拟主机的后续rewrite指令集</span><br><span class=\"line\">redirect : 返回302临时重定向，地址栏会显示跳转后的地址</span><br><span class=\"line\">permanent : 返回301永久重定向，地址栏会显示跳转后的地址</span><br><span class=\"line\">因为301和302不能简单的只返回状态码，还必须有重定向的URL，这就是return指令无法返回301,302的原因了。这里 last 和 break 区别有点难以理解：</span><br><span class=\"line\">last一般写在server和if中，而break一般使用在location中</span><br><span class=\"line\">last不终止重写后的url匹配，即新的url会再从server走一遍匹配流程，而break终止重写后的匹配</span><br><span class=\"line\">break和last都能组织继续执行后面的rewrite指令</span><br><span class=\"line\">if指令与全局变量</span><br><span class=\"line\">if判断指令</span><br><span class=\"line\">语法为if(condition)&#123;...&#125;，对给定的条件condition进行判断。如果为真，大括号内的rewrite指令将被执行，if条件(conditon)可以是如下任何内容：</span><br><span class=\"line\">当表达式只是一个变量时，如果值为空或任何以0开头的字符串都会当做false</span><br><span class=\"line\">直接比较变量和内容时，使用=或!=</span><br><span class=\"line\">~正则表达式匹配，~*不区分大小写的匹配，!~区分大小写的不匹配</span><br><span class=\"line\">-f和!-f用来判断是否存在文件</span><br><span class=\"line\">-d和!-d用来判断是否存在目录</span><br><span class=\"line\">-e和!-e用来判断是否存在文件或目录</span><br><span class=\"line\">-x和!-x用来判断文件是否可执行</span><br><span class=\"line\">例如：</span><br><span class=\"line\">if ($http_user_agent ~ MSIE) &#123;</span><br><span class=\"line\">    rewrite ^(.*)$ /msie/$1 break;</span><br><span class=\"line\">&#125; //如果UA包含&quot;MSIE&quot;，rewrite请求到/msid/目录下</span><br><span class=\"line\">if ($http_cookie ~* &quot;id=([^;]+)(?:;|$)&quot;) &#123;</span><br><span class=\"line\">    set $id $1;</span><br><span class=\"line\"> &#125; //如果cookie匹配正则，设置变量$id等于正则引用部分</span><br><span class=\"line\">if ($request_method = POST) &#123;</span><br><span class=\"line\">    return 405;</span><br><span class=\"line\">&#125; //如果提交方法为POST，则返回状态405（Method not allowed）。return不能返回301,302</span><br><span class=\"line\">if ($slow) &#123;</span><br><span class=\"line\">    limit_rate 10k;</span><br><span class=\"line\">&#125; //限速，$slow可以通过 set 指令设置</span><br><span class=\"line\">if (!-f $request_filename)&#123;</span><br><span class=\"line\">    break;</span><br><span class=\"line\">    proxy_pass  http://127.0.0.1;</span><br><span class=\"line\">&#125; //如果请求的文件名不存在，则反向代理到localhost 。这里的break也是停止rewrite检查</span><br><span class=\"line\">if ($args ~ post=140)&#123;</span><br><span class=\"line\">    rewrite ^ http://example.com/ permanent;</span><br><span class=\"line\">&#125; //如果query string中包含&quot;post=140&quot;，永久重定向到example.com</span><br><span class=\"line\">location ~* \\.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class=\"line\">    valid_referers none blocked www.jefflei.com www.leizhenfang.com;</span><br><span class=\"line\">    if ($invalid_referer) &#123;</span><br><span class=\"line\">        return 404;</span><br><span class=\"line\">    &#125; //防盗链</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">全局变量</span><br><span class=\"line\">下面是可以用作if判断的全局变量</span><br><span class=\"line\">$args ： #这个变量等于请求行中的参数，同$query_string</span><br><span class=\"line\">$content_length ： 请求头中的Content-length字段。</span><br><span class=\"line\">$content_type ： 请求头中的Content-Type字段。</span><br><span class=\"line\">$document_root ： 当前请求在root指令中指定的值。</span><br><span class=\"line\">$host ： 请求主机头字段，否则为服务器名称。</span><br><span class=\"line\">$http_user_agent ： 客户端agent信息</span><br><span class=\"line\">$http_cookie ： 客户端cookie信息</span><br><span class=\"line\">$limit_rate ： 这个变量可以限制连接速率。</span><br><span class=\"line\">$request_method ： 客户端请求的动作，通常为GET或POST。</span><br><span class=\"line\">$remote_addr ： 客户端的IP地址。</span><br><span class=\"line\">$remote_port ： 客户端的端口。</span><br><span class=\"line\">$remote_user ： 已经经过Auth Basic Module验证的用户名。</span><br><span class=\"line\">$request_filename ： 当前请求的文件路径，由root或alias指令与URI请求生成。</span><br><span class=\"line\">$scheme ： HTTP方法（如http，https）。</span><br><span class=\"line\">$server_protocol ： 请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</span><br><span class=\"line\">$server_addr ： 服务器地址，在完成一次系统调用后可以确定这个值。</span><br><span class=\"line\">$server_name ： 服务器名称。</span><br><span class=\"line\">$server_port ： 请求到达服务器的端口号。</span><br><span class=\"line\">$request_uri ： 包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。</span><br><span class=\"line\">$uri ： 不带请求参数的当前URI，$uri不包含主机名，如”/foo/bar.html”。</span><br><span class=\"line\">$document_uri ： 与$uri相同。</span><br><span class=\"line\">例：http://localhost:88/test1/test2/test.php</span><br><span class=\"line\">$host：localhost</span><br><span class=\"line\">$server_port：88</span><br><span class=\"line\">$request_uri：http://localhost:88/test1/test2/test.php</span><br><span class=\"line\">$document_uri：/test1/test2/test.php</span><br><span class=\"line\">$document_root：/var/www/html</span><br><span class=\"line\">$request_filename：/var/www/html/test1/test2/test.php</span><br><span class=\"line\">常用正则</span><br><span class=\"line\">. ： 匹配除换行符以外的任意字符</span><br><span class=\"line\">? ： 重复0次或1次</span><br><span class=\"line\">+ ： 重复1次或更多次</span><br><span class=\"line\">* ： 重复0次或更多次</span><br><span class=\"line\">\\d ：匹配数字</span><br><span class=\"line\">^ ： 匹配字符串的开始</span><br><span class=\"line\">$ ： 匹配字符串的介绍</span><br><span class=\"line\">&#123;n&#125; ： 重复n次</span><br><span class=\"line\">&#123;n,&#125; ： 重复n次或更多次</span><br><span class=\"line\">[c] ： 匹配单个字符c</span><br><span class=\"line\">[a-z] ： 匹配a-z小写字母的任意一个</span><br><span class=\"line\">小括号()之间匹配的内容，可以在后面通过$1来引用，$2表示的是前面第二个()里的内容。正则里面容易让人困惑的是\\转义特殊字符。</span><br><span class=\"line\">rewrite实例</span><br><span class=\"line\">例1：</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    # 定义image日志格式</span><br><span class=\"line\">    log_format imagelog &#x27;[$time_local] &#x27; $image_file &#x27; &#x27; $image_type &#x27; &#x27; $body_bytes_sent &#x27; &#x27; $status;</span><br><span class=\"line\">    # 开启重写日志</span><br><span class=\"line\">    rewrite_log on;</span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        root /home/www;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                # 重写规则信息</span><br><span class=\"line\">                error_log logs/rewrite.log notice;</span><br><span class=\"line\">                # 注意这里要用‘’单引号引起来，避免&#123;&#125;</span><br><span class=\"line\">                rewrite &#x27;^/images/([a-z]&#123;2&#125;)/([a-z0-9]&#123;5&#125;)/(.*)\\.(png|jpg|gif)$&#x27; /data?file=$3.$4;</span><br><span class=\"line\">                # 注意不能在上面这条规则后面加上“last”参数，否则下面的set指令不会执行</span><br><span class=\"line\">                set $image_file $3;</span><br><span class=\"line\">                set $image_type $4;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location /data &#123;</span><br><span class=\"line\">                # 指定针对图片的日志格式，来分析图片类型和大小</span><br><span class=\"line\">                access_log logs/images.log mian;</span><br><span class=\"line\">                root /data/images;</span><br><span class=\"line\">                # 应用前面定义的变量。判断首先文件在不在，不在再判断目录在不在，如果还不在就跳转到最后一个url里</span><br><span class=\"line\">                try_files /$arg_file /image404.html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location = /image404.html &#123;</span><br><span class=\"line\">                # 图片不存在返回特定的信息</span><br><span class=\"line\">                return 404 &quot;image not found\\n&quot;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">对形如/images/ef/uh7b3/test.png的请求，重写到/data?file=test.png，于是匹配到location /data，先看/data/images/test.png文件存不存在，如果存在则正常响应，如果不存在则重写tryfiles到新的image404 location，直接返回404状态码。</span><br><span class=\"line\">例2：</span><br><span class=\"line\">rewrite ^/images/(.*)_(\\d+)x(\\d+)\\.(png|jpg|gif)$ /resizer/$1.$4?width=$2&amp;height=$3? last;</span><br><span class=\"line\">对形如/images/bla_500x400.jpg的文件请求，重写到/resizer/bla.jpg?width=500&amp;height=400地址，并会继续尝试匹配location。</span><br><span class=\"line\">一．正则表达式匹配，其中：</span><br><span class=\"line\">* ~ 为区分大小写匹配</span><br><span class=\"line\">* ~* 为不区分大小写匹配</span><br><span class=\"line\">* !~和!~*分别为区分大小写不匹配及不区分大小写不匹配</span><br><span class=\"line\">二．文件及目录匹配，其中：</span><br><span class=\"line\">* -f和!-f用来判断是否存在文件</span><br><span class=\"line\">* -d和!-d用来判断是否存在目录</span><br><span class=\"line\">* -e和!-e用来判断是否存在文件或目录</span><br><span class=\"line\">* -x和!-x用来判断文件是否可执行</span><br><span class=\"line\">三．rewrite指令的最后一项参数为flag标记，flag标记有：</span><br><span class=\"line\">1.last    相当于apache里面的[L]标记，表示rewrite。</span><br><span class=\"line\">2.break本条规则匹配完成后，终止匹配，不再匹配后面的规则。</span><br><span class=\"line\">3.redirect  返回302临时重定向，浏览器地址会显示跳转后的URL地址。</span><br><span class=\"line\">4.permanent  返回301永久重定向，浏览器地址会显示跳转后的URL地址。</span><br><span class=\"line\">使用last和break实现URI重写，浏览器地址栏不变。而且两者有细微差别，使用alias指令必须用last标记;使用proxy_pass指令时，需要使用break标记。Last标记在本条rewrite规则执行完毕后，会对其所在server&#123;......&#125;标签重新发起请求，而break标记则在本条规则匹配完成后，终止匹配。</span><br><span class=\"line\">例如：如果我们将类似URL/photo/123456 重定向到/path/to/photo/12/1234/123456.png</span><br><span class=\"line\">rewrite &quot;/photo/([0-9]&#123;2&#125;)([0-9]&#123;2&#125;)([0-9]&#123;2&#125;)&quot;/path/to/photo/$1/$1$2/$1$2$3.png ;</span><br><span class=\"line\">四．NginxRewrite 规则相关指令</span><br><span class=\"line\">1.break指令</span><br><span class=\"line\">使用环境：server,location,if;</span><br><span class=\"line\">该指令的作用是完成当前的规则集，不再处理rewrite指令。</span><br><span class=\"line\">2.if指令</span><br><span class=\"line\">使用环境：server,location</span><br><span class=\"line\">该指令用于检查一个条件是否符合，如果条件符合，则执行大括号内的语句。If指令不支持嵌套，不支持多个条件&amp;&amp;和||处理。</span><br><span class=\"line\">3.return指令</span><br><span class=\"line\">语法：returncode ;</span><br><span class=\"line\">使用环境：server,location,if;</span><br><span class=\"line\">该指令用于结束规则的执行并返回状态码给客户端。</span><br><span class=\"line\">示例：如果访问的URL以&quot;.sh&quot;或&quot;.bash&quot;结尾，则返回403状态码</span><br><span class=\"line\">location ~ .*\\.(sh|bash)?$</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">return 403;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">4.rewrite 指令</span><br><span class=\"line\">语法：rewriteregex replacement flag</span><br><span class=\"line\">使用环境：server,location,if</span><br><span class=\"line\">该指令根据表达式来重定向URI，或者修改字符串。指令根据配置文件中的顺序来执行。注意重写表达式只对相对路径有效。如果你想配对主机名，你应该使用if语句，示例如下：</span><br><span class=\"line\">if( $host ~* www\\.(.*) )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">set $host_without_www $1;</span><br><span class=\"line\">rewrite ^(.*)$  http://$host_without_www$1permanent;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">5.Set指令</span><br><span class=\"line\">语法：setvariable value ; 默认值:none; 使用环境：server,location,if;</span><br><span class=\"line\">该指令用于定义一个变量，并给变量赋值。变量的值可以为文本、变量以及文本变量的联合。</span><br><span class=\"line\">示例：set$varname &quot;hello world&quot;;</span><br><span class=\"line\">6.Uninitialized_variable_warn指令</span><br><span class=\"line\">语法：uninitialized_variable_warnon|off</span><br><span class=\"line\">使用环境：http,server,location,if</span><br><span class=\"line\">该指令用于开启和关闭未初始化变量的警告信息，默认值为开启。</span><br><span class=\"line\">五．Nginx的Rewrite规则编写实例</span><br><span class=\"line\">1.当访问的文件和目录不存在时，重定向到某个php文件</span><br><span class=\"line\">if( !-e $request_filename )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">rewrite ^/(.*)$ index.php last;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">2.目录对换 /123456/xxxx  ====&gt;  /xxxx?id=123456</span><br><span class=\"line\">rewrite ^/(\\d+)/(.+)/  /$2?id=$1 last;</span><br><span class=\"line\">3.如果客户端使用的是IE浏览器，则重定向到/ie目录下</span><br><span class=\"line\">if( $http_user_agent  ~ MSIE)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">rewrite ^(.*)$ /ie/$1 break;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">4.禁止访问多个目录</span><br><span class=\"line\">location ~ ^/(cron|templates)/</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">deny all;</span><br><span class=\"line\">break;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">5.禁止访问以/data开头的文件</span><br><span class=\"line\">location ~ ^/data</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">deny all;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">6.禁止访问以.sh,.flv,.mp3为文件后缀名的文件</span><br><span class=\"line\">location ~ .*\\.(sh|flv|mp3)$</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">return 403;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">7.设置某些类型文件的浏览器缓存时间</span><br><span class=\"line\">location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">expires 30d;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~ .*\\.(js|css)$</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">expires 1h;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">8.给favicon.ico和robots.txt设置过期时间;</span><br><span class=\"line\">这里为favicon.ico为99天,robots.txt为7天并不记录404错误日志</span><br><span class=\"line\">location ~(favicon.ico) &#123;</span><br><span class=\"line\">log_not_found off;</span><br><span class=\"line\">expires 99d;</span><br><span class=\"line\">break;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">location ~(robots.txt) &#123;</span><br><span class=\"line\">log_not_found off;</span><br><span class=\"line\">expires 7d;</span><br><span class=\"line\">break;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">9.设定某个文件的过期时间;这里为600秒，并不记录访问日志</span><br><span class=\"line\">location ^~ /html/scripts/loadhead_1.js &#123;</span><br><span class=\"line\">access_log  off;</span><br><span class=\"line\">root /opt/lampp/htdocs/web;</span><br><span class=\"line\">expires 600;</span><br><span class=\"line\">break;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">10.文件反盗链并设置过期时间</span><br><span class=\"line\">这里的return412 为自定义的http状态码，默认为403，方便找出正确的盗链的请求</span><br><span class=\"line\">“rewrite ^/ http://img.linuxidc.net/leech.gif;”显示一张防盗链图片</span><br><span class=\"line\">“access_log off;”不记录访问日志，减轻压力</span><br><span class=\"line\">“expires 3d”所有文件3天的浏览器缓存</span><br><span class=\"line\">location ~*^.+\\.(jpg|jpeg|gif|png|swf|rar|zip|css|js)$ &#123;</span><br><span class=\"line\">valid_referers none blocked *.linuxidc.com*.linuxidc.net localhost 208.97.167.194;</span><br><span class=\"line\">if ($invalid_referer) &#123;</span><br><span class=\"line\">rewrite ^/ http://img.linuxidc.net/leech.gif;</span><br><span class=\"line\">return 412;</span><br><span class=\"line\">break;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">access_log  off;</span><br><span class=\"line\">root /opt/lampp/htdocs/web;</span><br><span class=\"line\">expires 3d;</span><br><span class=\"line\">break;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">11.只允许固定ip访问网站，并加上密码</span><br><span class=\"line\">root /opt/htdocs/www;</span><br><span class=\"line\">allow  208.97.167.194;</span><br><span class=\"line\">allow  222.33.1.2;</span><br><span class=\"line\">allow  231.152.49.4;</span><br><span class=\"line\">deny  all;</span><br><span class=\"line\">auth_basic “C1G_ADMIN”;</span><br><span class=\"line\">auth_basic_user_file htpasswd;</span><br><span class=\"line\">12将多级目录下的文件转成一个文件，增强seo效果</span><br><span class=\"line\">/job-123-456-789.html 指向/job/123/456/789.html</span><br><span class=\"line\">rewrite^/job-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ /job/$1/$2/jobshow_$3.html last;</span><br><span class=\"line\">13.文件和目录不存在的时候重定向：</span><br><span class=\"line\">if (!-e $request_filename) &#123;</span><br><span class=\"line\">proxy_pass http://127.0.0.1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">14.将根目录下某个文件夹指向2级目录</span><br><span class=\"line\">如/shanghaijob/ 指向 /area/shanghai/</span><br><span class=\"line\">如果你将last改成permanent，那么浏览器地址栏显是/location/shanghai/</span><br><span class=\"line\">rewrite ^/([0-9a-z]+)job/(.*)$ /area/$1/$2last;</span><br><span class=\"line\">上面例子有个问题是访问/shanghai时将不会匹配</span><br><span class=\"line\">rewrite ^/([0-9a-z]+)job$ /area/$1/ last;</span><br><span class=\"line\">rewrite ^/([0-9a-z]+)job/(.*)$ /area/$1/$2last;</span><br><span class=\"line\">这样/shanghai 也可以访问了，但页面中的相对链接无法使用，</span><br><span class=\"line\">如./list_1.html真实地址是/area/shanghia/list_1.html会变成/list_1.html,导至无法访问。</span><br><span class=\"line\">那我加上自动跳转也是不行咯</span><br><span class=\"line\">(-d $request_filename)它有个条件是必需为真实目录，而我的rewrite不是的，所以没有效果</span><br><span class=\"line\">if (-d $request_filename)&#123;</span><br><span class=\"line\">rewrite ^/(.*)([^/])$ http://$host/$1$2/permanent;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">知道原因后就好办了，让我手动跳转吧</span><br><span class=\"line\">rewrite ^/([0-9a-z]+)job$ /$1job/permanent;</span><br><span class=\"line\">rewrite ^/([0-9a-z]+)job/(.*)$ /area/$1/$2last;</span><br><span class=\"line\">15.域名跳转</span><br><span class=\"line\">server</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">listen      80;</span><br><span class=\"line\">server_name  jump.linuxidc.com;</span><br><span class=\"line\">index index.html index.htm index.php;</span><br><span class=\"line\">root  /opt/lampp/htdocs/www;</span><br><span class=\"line\">rewrite ^/ http://www.linuxidc.com/;</span><br><span class=\"line\">access_log  off;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">16.多域名转向</span><br><span class=\"line\">server_name  www.linuxidc.comwww.linuxidc.net;</span><br><span class=\"line\">index index.html index.htm index.php;</span><br><span class=\"line\">root  /opt/lampp/htdocs;</span><br><span class=\"line\">if ($host ~ &quot;linuxidc\\.net&quot;) &#123;</span><br><span class=\"line\">rewrite ^(.*) http://www.linuxidc.com$1permanent;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">六．nginx全局变量</span><br><span class=\"line\">arg_PARAMETER    #这个变量包含GET请求中，如果有变量PARAMETER时的值。</span><br><span class=\"line\">args                    #这个变量等于请求行中(GET请求)的参数，如：foo=123&amp;bar=blahblah;</span><br><span class=\"line\">binary_remote_addr #二进制的客户地址。</span><br><span class=\"line\">body_bytes_sent    #响应时送出的body字节数数量。即使连接中断，这个数据也是精确的。</span><br><span class=\"line\">content_length    #请求头中的Content-length字段。</span><br><span class=\"line\">content_type      #请求头中的Content-Type字段。</span><br><span class=\"line\">cookie_COOKIE    #cookie COOKIE变量的值</span><br><span class=\"line\">document_root    #当前请求在root指令中指定的值。</span><br><span class=\"line\">document_uri      #与uri相同。</span><br><span class=\"line\">host                #请求主机头字段，否则为服务器名称。</span><br><span class=\"line\">hostname          #Set to themachine’s hostname as returned by gethostname</span><br><span class=\"line\">http_HEADER</span><br><span class=\"line\">is_args              #如果有args参数，这个变量等于”?”，否则等于”&quot;，空值。</span><br><span class=\"line\">http_user_agent    #客户端agent信息</span><br><span class=\"line\">http_cookie          #客户端cookie信息</span><br><span class=\"line\">limit_rate            #这个变量可以限制连接速率。</span><br><span class=\"line\">query_string          #与args相同。</span><br><span class=\"line\">request_body_file  #客户端请求主体信息的临时文件名。</span><br><span class=\"line\">request_method    #客户端请求的动作，通常为GET或POST。</span><br><span class=\"line\">remote_addr          #客户端的IP地址。</span><br><span class=\"line\">remote_port          #客户端的端口。</span><br><span class=\"line\">remote_user          #已经经过Auth Basic Module验证的用户名。</span><br><span class=\"line\">request_completion #如果请求结束，设置为OK. 当请求未结束或如果该请求不是请求链串的最后一个时，为空(Empty)。</span><br><span class=\"line\">request_method    #GET或POST</span><br><span class=\"line\">request_filename  #当前请求的文件路径，由root或alias指令与URI请求生成。</span><br><span class=\"line\">request_uri          #包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。不能修改。</span><br><span class=\"line\">scheme                #HTTP方法（如http，https）。</span><br><span class=\"line\">server_protocol      #请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</span><br><span class=\"line\">server_addr          #服务器地址，在完成一次系统调用后可以确定这个值。</span><br><span class=\"line\">server_name        #服务器名称。</span><br><span class=\"line\">server_port          #请求到达服务器的端口号。</span><br><span class=\"line\">七．Apache和Nginx规则的对应关系</span><br><span class=\"line\">Apache的RewriteCond对应Nginx的if</span><br><span class=\"line\">Apache的RewriteRule对应Nginx的rewrite</span><br><span class=\"line\">Apache的[R]对应Nginx的redirect</span><br><span class=\"line\">Apache的[P]对应Nginx的last</span><br><span class=\"line\">Apache的[R,L]对应Nginx的redirect</span><br><span class=\"line\">Apache的[P,L]对应Nginx的last</span><br><span class=\"line\">Apache的[PT,L]对应Nginx的last</span><br><span class=\"line\">例如：允许指定的域名访问本站，其他的域名一律转向www.linuxidc.net</span><br><span class=\"line\">  Apache:</span><br><span class=\"line\">RewriteCond %&#123;HTTP_HOST&#125; !^(.*?)\\.aaa\\.com$[NC]</span><br><span class=\"line\">RewriteCond %&#123;HTTP_HOST&#125; !^localhost$</span><br><span class=\"line\">RewriteCond %&#123;HTTP_HOST&#125;!^192\\.168\\.0\\.(.*?)$</span><br><span class=\"line\">RewriteRule ^/(.*)$ http://www.linuxidc.net[R,L]</span><br><span class=\"line\">  Nginx:</span><br><span class=\"line\">if( $host ~* ^(.*)\\.aaa\\.com$ )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">set $allowHost ‘1’;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( $host ~* ^localhost )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">set $allowHost ‘1’;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( $host ~* ^192\\.168\\.1\\.(.*?)$ )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">set $allowHost ‘1’;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if( $allowHost !~ ‘1’ )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">rewrite ^/(.*)$ http://www.linuxidc.netredirect ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","tags":["nginx"]},{"title":"php-fpm的关闭和重启","url":"/2018/11/23/php-fpm%E7%9A%84%E5%85%B3%E9%97%AD%E5%92%8C%E9%87%8D%E5%90%AF/","content":"<h6 id=\"php-fpm-关闭：\"><a href=\"#php-fpm-关闭：\" class=\"headerlink\" title=\"php-fpm 关闭：\"></a>php-fpm 关闭：</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">kill</span> -INT `<span class=\"built_in\">cat</span> /usr/local/php/var/run/php-fpm.pid`</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">killall php-fpm</span><br></pre></td></tr></table></figure>\n<h6 id=\"php-fpm启动\"><a href=\"#php-fpm启动\" class=\"headerlink\" title=\"php-fpm启动\"></a>php-fpm启动</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/local/php/sbin/php-fpm</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"php-fpm-重启\"><a href=\"#php-fpm-重启\" class=\"headerlink\" title=\"php-fpm 重启\"></a>php-fpm 重启</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">kill</span> -USR2 `<span class=\"built_in\">cat</span> /usr/local/php/var/run/php-fpm.pid`</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"查看php-fpm进程数\"><a href=\"#查看php-fpm进程数\" class=\"headerlink\" title=\"查看php-fpm进程数\"></a>查看php-fpm进程数</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ps aux | grep -c php-fpm</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n","tags":["php"]},{"title":"php-fpm设置socket方式连接FastCGI","url":"/2017/12/03/php-fpm%E8%AE%BE%E7%BD%AEsocket%E6%96%B9%E5%BC%8F%E8%BF%9E%E6%8E%A5FastCGI/","content":"<p>nginx和fastcgi的通信方式有两种，一种是TCP的方式，一种是unix socket方式。</p>\n<span id=\"more\"></span>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/%E5%9B%BE%E7%89%872.png\" alt=\"php-fpm设置socket方式连接FastCGI\"></p>\n<p>socket方式不会走到tcp层，tcp方式则会走到ip层。因此，理论上说socket连接方式效率会更好一点。<br>TCP和unix domain socket方式对比</p>\n<p>TCP是使用TCP端口连接127.0.0.1:9000</p>\n<p>Socket是使用unix domain socket连接套接字&#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</p>\n<p>修改php-fpm.conf配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#listen = 127.0.0.1:9000</span></span><br><span class=\"line\">listen=/dev/shm/php-fpm.sock <span class=\"comment\">#/dev/shm/为内存文件系统，注意 确保可读写</span></span><br><span class=\"line\">listen.owner=apache  <span class=\"comment\">#注意自己的用户和组</span></span><br><span class=\"line\">listen.group=apache</span><br></pre></td></tr></table></figure>\n<p>修改nginx.conf配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#fastcgi_pass    127.0.0.1:9000;</span></span><br><span class=\"line\"><span class=\"comment\">#将相应的如上内容修改如下</span></span><br><span class=\"line\">fastcgi_pass     unix:/dev/shm/php-fpm.sock;</span><br></pre></td></tr></table></figure>\n<p>重启nginx和php-fpm</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service nginx restart</span><br><span class=\"line\">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>\n","tags":["php"]},{"title":"phpstorm中配置远程调试xdebug","url":"/2017/12/03/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/","content":"<p>这里说的是真正的远程调试，不是本地，本地不需要安装任何php程序！！！</p>\n<p>这里略去xdebug的安装，安装很简单可以下载源码包，动态编译进去！</p>\n<p>环境：</p>\n<p>　　Dev 服务器(IP:192.168.3.2)，安装phpstorm，用来做开发任务！</p>\n<p>　　Server服务器（IP:192.168.3.9），web服务器(php架构)，用来浏览网页用！</p>\n<p>这里的两台服务器在同一个网段下，可以互通！</p>\n<p>在Server服务器上的php.ini里配置xdebug如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[xdebug]</span><br><span class=\"line\">zend_extension=xdebug.so</span><br><span class=\"line\">xdebug.remote_enable=1</span><br><span class=\"line\">xdebug.remote_handler=dbgp</span><br><span class=\"line\">xdebug.remote_mode=req</span><br><span class=\"line\">xdebug.remote_host=192.168.3.9</span><br><span class=\"line\">xdebug.remote_port=9000</span><br><span class=\"line\">xdebug.idekey=<span class=\"string\">&quot;PHPSTORM&quot;</span></span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<p>remote_host参数的值填写Dev 服务器(开发机器)的IP地址。</p>\n<p>remote_port填写9000，只要没有被其它程序占用，就可以了，可以不是9000。</p>\n<p>接下来开始设置phpstorm的参数：</p>\n<p>快捷键(Ctrl + Alt + S)打开窗口：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-1.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>打开phpstorm的配置对话框，找到Languages &amp; Frameworks  &gt;&gt; PHP &gt;&gt;Debug 窗口</p>\n<p>这里填写的Debug port为：9000，与php.ini里配置的端口号保持一致!</p>\n<p>接下来点选Server选项，点击绿色的 “+” 新建Server，并根据如下设置填写你相对应的内容！</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-2.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>因为是远程调试，所以这里的Use Path mappings 一定要选，并且本地与远程文件要映射好。</p>\n<p>Debugger里选择：Xdebug ！</p>\n<p>接下来配置Edit Configurations( Run &gt;&gt; Edit Configurations)</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-3.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>点击后弹出窗口如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-4.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>选中PHP Web Application ，在右边选择前面新增的Server：ecstore，保存。</p>\n<p>这里其实只是用来配置一个模板，我之前只配置了这个，没有新增Debug选项，总是不能调试，后来参照资料才想明白，这里其实只是模板，配置好了后，可以直接新增选择对应模板就可以了。</p>\n<p>现在来新增Debug选项：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-5.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>点击后新增调试选项：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-6.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>好了。</p>\n<p>在php代码里打个断点开始调试吧：)</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-7.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>然后，点击调试，开始愉快的干活吧！！！</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-8.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>看看调试效果：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-9.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>这里真的没有什么DBGp概念，我们没有用到，也没有什么点击什么绿色的电话图标启动Start Listening…，有吗？？</p>\n<p>没用，真的用不到那么些概念，网上一大堆以讹传讹的贴子，真是越看越迷糊！！！</p>\n<p>就这么愉快的调试吧 :)</p>\n<p>关于DBGp，其实就是个代理，把phpstorm设置成一个代理，但是对于我来说，真的需要什么代理吗？？？</p>\n<p>就这样吧，最简单的远程调试，去粗到精的成果！</p>\n<h3 id=\"浏览器设置\"><a href=\"#浏览器设置\" class=\"headerlink\" title=\"浏览器设置\"></a>浏览器设置</h3><p>下载谷歌浏览器的扩展程序chrome helper，安装好后，在选项里找到IDE key，在其下拉列表中选择PhpStorm。如下图：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/-phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug10.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>，接着点击灰色的chrome helper的臭虫图标，在下拉项中选择Debug项，这时臭虫图标变为绿色，处于调试模式。配置好后，打开phpstorm，点击下图中的电话按钮开启侦听浏览器。如下图所示：</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug/phpstorm%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95xdebug-11.png\" alt=\"phpstorm中配置远程调试xdebug\"></p>\n<p>转载自：<a href=\"https://www.cnblogs.com/yjken/p/6555438.html\" target=\"_blank\">https://www.cnblogs.com/yjken/p/6555438.html</a></p>\n","tags":["phpstorm"]},{"title":"php下安装event扩展","url":"/2018/01/09/php%E4%B8%8B%E5%AE%89%E8%A3%85event%E6%89%A9%E5%B1%95/","content":"<p>安装支持库libevent，需要编译高版本（这里以最新版本release-2.1.8-stable为例）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget -c https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz -P /opt/local/src</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">tar -zxvf libevent-2.1.8-stable.tar.gz &amp;&amp; <span class=\"built_in\">cd</span> libevent-2.1.8-stable</span><br><span class=\"line\">./configure --prefix=/opt/local/libevent</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<p>安装event库（以event-2.3.0.tgz为例）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget -c http://pecl.php.net/get/event-2.3.0.tgz -P /opt/local/src</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /opt/local/src</span><br><span class=\"line\">tar -zxvf event-2.3.0.tgz &amp;&amp; <span class=\"built_in\">cd</span> event-2.3.0</span><br><span class=\"line\">/opt/local/php72/bin/bin/phpize</span><br><span class=\"line\">./configure --with-php-config=/opt/local/php72/bin/php-config --with-event-libevent-dir=/opt/local/libevent/</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<p>在php.ini添加下面配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">extension=event.so</span><br></pre></td></tr></table></figure>\n","tags":["linux","php"]},{"title":"php下载文件简单实例","url":"/2018/03/02/php%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B/","content":"<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Spider</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadImage</span>(<span class=\"params\"><span class=\"variable\">$url</span>, <span class=\"variable\">$path</span>=<span class=\"string\">&#x27;images/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">          </span>&#123;</span><br><span class=\"line\">                <span class=\"variable\">$ch</span> = <span class=\"title function_ invoke__\">curl_init</span>();</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">curl_setopt</span>(<span class=\"variable\">$ch</span>, CURLOPT_URL, <span class=\"variable\">$url</span>);</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">curl_setopt</span>(<span class=\"variable\">$ch</span>, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">curl_setopt</span>(<span class=\"variable\">$ch</span>, CURLOPT_CONNECTTIMEOUT, <span class=\"number\">30</span>);</span><br><span class=\"line\">                <span class=\"variable\">$file</span> = <span class=\"title function_ invoke__\">curl_exec</span>(<span class=\"variable\">$ch</span>);</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">curl_close</span>(<span class=\"variable\">$ch</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">saveAsImage</span>(<span class=\"variable\">$url</span>, <span class=\"variable\">$file</span>, <span class=\"variable\">$path</span>);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">saveAsImage</span>(<span class=\"params\"><span class=\"variable\">$url</span>, <span class=\"variable\">$file</span>, <span class=\"variable\">$path</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">          </span>&#123;</span><br><span class=\"line\">                <span class=\"variable\">$filename</span> = <span class=\"title function_ invoke__\">pathinfo</span>(<span class=\"variable\">$url</span>, PATHINFO_BASENAME);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!<span class=\"title function_ invoke__\">file_exists</span>(<span class=\"variable\">$path</span>))&#123;</span><br><span class=\"line\">                   <span class=\"title function_ invoke__\">mkdir</span>(<span class=\"variable\">$path</span>,<span class=\"number\">0777</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"variable\">$resource</span> = <span class=\"title function_ invoke__\">fopen</span>(<span class=\"variable\">$path</span> . <span class=\"variable\">$filename</span>, <span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">fwrite</span>(<span class=\"variable\">$resource</span>, <span class=\"variable\">$file</span>);</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">fclose</span>(<span class=\"variable\">$resource</span>);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$str</span> = <span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&quot;http://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;mkt=en-US&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$arr</span> = <span class=\"title function_ invoke__\">json_decode</span>(<span class=\"variable\">$str</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$img_url</span> = <span class=\"string\">&#x27;http://www.bing.com&#x27;</span>.<span class=\"variable\">$arr</span>[<span class=\"string\">&#x27;images&#x27;</span>][<span class=\"number\">0</span>][<span class=\"string\">&#x27;url&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$img</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Spider</span>();</span><br><span class=\"line\"><span class=\"variable\">$img</span>-&gt;<span class=\"title function_ invoke__\">downloadImage</span>(<span class=\"variable\">$img_url</span>);</span><br></pre></td></tr></table></figure>\n","tags":["linux","php"]},{"title":"php使用Linux命令导出MySQL数据到csv","url":"/2020/01/19/php%E4%BD%BF%E7%94%A8Linux%E5%91%BD%E4%BB%A4%E5%AF%BC%E5%87%BAMySQL%E6%95%B0%E6%8D%AE%E5%88%B0csv/","content":"<p><strong>PS :使用这个导出功能需要的条件：<br>1–服务器需要安装mysql客户端：yum install mysql<br>2–php需要开启exec函数(disable_functions exec)</strong></p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@FILE</span>_NAME:ExcelExport.php</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span> 数据导出excel,从数据库导出再下载，数据库配置</span></span><br><span class=\"line\"><span class=\"comment\"> * [mysqld]</span></span><br><span class=\"line\"><span class=\"comment\"> * secure_file_priv= &#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2019-12-04 13:52:58</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExcelExport</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:exportExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 13:42:11</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $title</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $sql</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $data</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">exportExcel</span>(<span class=\"params\"><span class=\"variable\">$title</span> = <span class=\"string\">&#x27;报表导出&#x27;</span>, <span class=\"variable\">$sql</span>, <span class=\"variable\">$data</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">getcwd</span>() . <span class=\"string\">&quot;/data_export/&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//去除sql语句里的`,要不然执行shell命令报错</span></span><br><span class=\"line\">        <span class=\"variable\">$sql</span> = <span class=\"title function_ invoke__\">str_replace</span>(<span class=\"string\">&#x27;`&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$sql</span>);</span><br><span class=\"line\">        <span class=\"variable\">$sql</span> = <span class=\"title function_ invoke__\">str_replace</span>(<span class=\"string\">&#x27;&quot;&#x27;</span>, <span class=\"string\">&quot;&#x27;&quot;</span>, <span class=\"variable\">$sql</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//删除历史表格</span></span><br><span class=\"line\">        <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">deleteExcel</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">file_exists</span>(<span class=\"variable\">$data_dir</span>) || !<span class=\"title function_ invoke__\">is_writable</span>(<span class=\"variable\">$data_dir</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!@<span class=\"title function_ invoke__\">mkdir</span>(<span class=\"variable\">$data_dir</span>, <span class=\"number\">0755</span>, <span class=\"literal\">TRUE</span>)) &#123;</span><br><span class=\"line\">                <span class=\"title class_\">Tools</span>::<span class=\"title function_ invoke__\">dieJs</span>(<span class=\"string\">&quot;alert(&#x27;导出失败，请联系管理员处理&#x27;);history.go(-1);&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = <span class=\"variable\">$title</span> . <span class=\"title function_ invoke__\">time</span>() . <span class=\"string\">&quot;.csv&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp_file_name</span> = <span class=\"variable\">$title</span> . <span class=\"title function_ invoke__\">time</span>() . <span class=\"string\">&quot;_temp.csv&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$file_path</span> = <span class=\"variable\">$data_dir</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp_file_path</span> = <span class=\"variable\">$data_dir</span> . <span class=\"variable\">$temp_file_name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//拼接sql</span></span><br><span class=\"line\">        <span class=\"variable\">$fields</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$title_fields</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp_key</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"variable\">$fields_count</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$field</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp_key</span> += <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"variable\">$fields</span> .= <span class=\"string\">&quot;ifnull(<span class=\"subst\">&#123;$field&#125;</span>,&#x27;&#x27;) as <span class=\"subst\">&#123;$field&#125;</span>&quot;</span> . (<span class=\"variable\">$temp_key</span> &lt; <span class=\"variable\">$fields_count</span> ? <span class=\"string\">&#x27;,&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable\">$title_fields</span> .= <span class=\"string\">&quot;&#x27;<span class=\"subst\">&#123;$key&#125;</span>&#x27;&quot;</span> . (<span class=\"variable\">$temp_key</span> &lt; <span class=\"variable\">$fields_count</span> ? <span class=\"string\">&#x27;,&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$sql_str</span> = <span class=\"string\">&quot;SELECT <span class=\"subst\">&#123;$title_fields&#125;</span> UNION SELECT <span class=\"subst\">&#123;$fields&#125;</span> FROM (<span class=\"subst\">&#123;$sql&#125;</span>) as t&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$mysql_config</span> = <span class=\"title class_\">Yaf_Application</span>::<span class=\"title function_ invoke__\">app</span>()-&gt;<span class=\"title function_ invoke__\">getConfig</span>()-&gt;<span class=\"title function_ invoke__\">toArray</span>();</span><br><span class=\"line\">        <span class=\"variable\">$mysql_config</span> = <span class=\"variable\">$mysql_config</span>[<span class=\"string\">&#x27;database&#x27;</span>][<span class=\"string\">&#x27;config&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2&gt;&amp;1 为了输出shell执行错误</span></span><br><span class=\"line\">        <span class=\"variable\">$export_shell</span> = <span class=\"string\">&#x27;mysql -h &#x27;</span> . <span class=\"variable\">$mysql_config</span>[<span class=\"string\">&#x27;host&#x27;</span>] . <span class=\"string\">&#x27; -P&#x27;</span> . <span class=\"variable\">$mysql_config</span>[<span class=\"string\">&#x27;port&#x27;</span>] . <span class=\"string\">&#x27; -u&#x27;</span> . <span class=\"variable\">$mysql_config</span>[<span class=\"string\">&#x27;username&#x27;</span>] . <span class=\"string\">&#x27; -p&#x27;</span> . <span class=\"string\">&#x27;&quot;&#x27;</span> . <span class=\"variable\">$mysql_config</span>[<span class=\"string\">&#x27;password&#x27;</span>] . <span class=\"string\">&#x27;&quot;&#x27;</span> . <span class=\"string\">&#x27; &#x27;</span> . <span class=\"variable\">$mysql_config</span>[<span class=\"string\">&#x27;dbname&#x27;</span>] . <span class=\"string\">&#x27; --default-character-set=utf8 -e &quot;&#x27;</span> . <span class=\"variable\">$sql_str</span> . <span class=\"string\">&#x27;&quot; | sed &#x27;</span> . <span class=\"string\">&quot;&#x27;&quot;</span> . <span class=\"string\">&#x27;s/\\t/&quot;,&quot;/g;s/^/&quot;/;s/$/&quot;/;s/\\n//g&#x27;</span> . <span class=\"string\">&quot;&#x27;&quot;</span> . <span class=\"string\">&#x27; &gt; &#x27;</span> . <span class=\"variable\">$temp_file_path</span> . <span class=\"string\">&#x27; 2&gt;&amp;1&#x27;</span>;</span><br><span class=\"line\">        <span class=\"comment\">//文件转码</span></span><br><span class=\"line\">        <span class=\"variable\">$iconv_shell</span> = <span class=\"string\">&quot;iconv -f UTF-8 -t GB18030 <span class=\"subst\">&#123;$temp_file_path&#125;</span> &gt; <span class=\"subst\">&#123;$file_path&#125;</span> 2&gt;&amp;1&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//        dd($export_shell);</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">exec</span>(<span class=\"variable\">$export_shell</span>, <span class=\"variable\">$output</span>, <span class=\"variable\">$return_var</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">exec</span>(<span class=\"variable\">$iconv_shell</span>, <span class=\"variable\">$i_output</span>, <span class=\"variable\">$i_return_var</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">unlink</span>(<span class=\"variable\">$temp_file_path</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">downloadExcel</span>(<span class=\"variable\">$file_path</span>, <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:downloadExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 14:25:10</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $file_path 文件地址</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> $file_name 文件名称</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> void</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadExcel</span>(<span class=\"params\"><span class=\"variable\">$file_path</span>, <span class=\"variable\">$file_name</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">ob_end_clean</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">file_exists</span>(<span class=\"variable\">$file_path</span>)) &#123;</span><br><span class=\"line\">            <span class=\"title class_\">Tools</span>::<span class=\"title function_ invoke__\">dieJs</span>(<span class=\"string\">&quot;alert(&#x27;文件不存在，请联系管理员处理&#x27;);history.go(-1);&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$fp</span> = <span class=\"title function_ invoke__\">fopen</span>(<span class=\"variable\">$file_path</span>, <span class=\"string\">&quot;r&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_size</span> = <span class=\"title function_ invoke__\">filesize</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//下载文件需要用到的头</span></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Accept-Ranges: bytes&quot;</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Accept-Length:&quot;</span> . <span class=\"variable\">$file_size</span>);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">Header</span>(<span class=\"string\">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\">        <span class=\"variable\">$buffer</span> = <span class=\"number\">1024</span>;</span><br><span class=\"line\">        <span class=\"variable\">$file_count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!<span class=\"title function_ invoke__\">feof</span>(<span class=\"variable\">$fp</span>) &amp;&amp; <span class=\"variable\">$file_count</span> &lt; <span class=\"variable\">$file_size</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$file_con</span> = <span class=\"title function_ invoke__\">fread</span>(<span class=\"variable\">$fp</span>, <span class=\"variable\">$buffer</span>);</span><br><span class=\"line\">            <span class=\"variable\">$file_count</span> += <span class=\"variable\">$buffer</span>;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"variable\">$file_con</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">fclose</span>(<span class=\"variable\">$fp</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:deleteExcel</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span> 删除没用的表格</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 15:05:01</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deleteExcel</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//几分钟前的时间戳</span></span><br><span class=\"line\">        <span class=\"variable\">$delete_time</span> = <span class=\"title function_ invoke__\">strtotime</span>(<span class=\"string\">&quot;-5 minute&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">getcwd</span>() . <span class=\"string\">&quot;/data_export/*.csv&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$data_dir</span> = <span class=\"title function_ invoke__\">glob</span>(<span class=\"variable\">$data_dir</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>(<span class=\"variable\">$data_dir</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data_dir</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$file_path</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp_time</span> = <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">findNum</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$temp_time</span> &lt; <span class=\"variable\">$delete_time</span>) &#123;</span><br><span class=\"line\">                <span class=\"title function_ invoke__\">unlink</span>(<span class=\"variable\">$file_path</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@FuncName</span>:findNum</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Description</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@Date</span> 2019-12-24 14:54:11</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> string $str</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findNum</span>(<span class=\"params\"><span class=\"variable\">$str</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$str</span> = <span class=\"title function_ invoke__\">trim</span>(<span class=\"variable\">$str</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">empty</span>(<span class=\"variable\">$str</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$temp</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;4&#x27;</span>, <span class=\"string\">&#x27;5&#x27;</span>, <span class=\"string\">&#x27;6&#x27;</span>, <span class=\"string\">&#x27;7&#x27;</span>, <span class=\"string\">&#x27;8&#x27;</span>, <span class=\"string\">&#x27;9&#x27;</span>, <span class=\"string\">&#x27;0&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$str</span>); <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$str</span>[<span class=\"variable\">$i</span>], <span class=\"variable\">$temp</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$result</span> .= <span class=\"variable\">$str</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$result</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","tags":["linux","php","mysql"]},{"title":"php导出CSV","url":"/2018/01/05/php%E5%AF%BC%E5%87%BACSV/","content":"<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//导出的首行标题以及需要导出的字段</span></span><br><span class=\"line\"><span class=\"variable\">$parm</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">     <span class=\"string\">&quot;公司名称&quot;</span>=&gt;<span class=\"string\">&#x27;business_name&#x27;</span>,</span><br><span class=\"line\">     <span class=\"string\">&#x27;公司城市&#x27;</span>=&gt;<span class=\"string\">&#x27;province&#x27;</span>,</span><br><span class=\"line\">     <span class=\"string\">&#x27;公司地址&#x27;</span>=&gt;<span class=\"string\">&#x27;detail_addr_&#x27;</span></span><br><span class=\"line\"> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 导出CSV文件</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> array $data        数据</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> array $header_data 首行数据</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> string $file_name  文件名称</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> string $body_data  需要导出的字段名</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">export_csv</span>(<span class=\"params\"><span class=\"variable\">$data</span> = [], <span class=\"variable\">$parm</span> = [], <span class=\"variable\">$file_name</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&#x27;Content-Type: application/vnd.ms-excel&#x27;</span>);</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&#x27;Content-Disposition: attachment;filename=&#x27;</span>.<span class=\"variable\">$file_name</span>);</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&#x27;Cache-Control: max-age=0&#x27;</span>);</span><br><span class=\"line\">  <span class=\"variable\">$fp</span> = <span class=\"title function_ invoke__\">fopen</span>(<span class=\"string\">&#x27;php://output&#x27;</span>, <span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">  <span class=\"variable\">$header_data</span> = <span class=\"title function_ invoke__\">array_keys</span>(<span class=\"variable\">$parm</span>);</span><br><span class=\"line\">  <span class=\"variable\">$body_data</span> = <span class=\"title function_ invoke__\">array_values</span>(<span class=\"variable\">$parm</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>(<span class=\"variable\">$header_data</span>)) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">foreach</span> (<span class=\"variable\">$header_data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\">       <span class=\"variable\">$header_data</span>[<span class=\"variable\">$key</span>] = <span class=\"title function_ invoke__\">iconv</span>(<span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"string\">&#x27;gbk&#x27;</span>, <span class=\"variable\">$value</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"title function_ invoke__\">fputcsv</span>(<span class=\"variable\">$fp</span>, <span class=\"variable\">$header_data</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable\">$num</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"variable\">$limit</span> = <span class=\"number\">100000</span>;</span><br><span class=\"line\">  <span class=\"comment\">//逐行取出数据，不浪费内存</span></span><br><span class=\"line\">  <span class=\"variable\">$count</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$count</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"variable\">$count</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">       <span class=\"variable\">$num</span>++;</span><br><span class=\"line\">       <span class=\"comment\">//刷新一下输出buffer，防止由于数据过多造成问题</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (<span class=\"variable\">$limit</span> == <span class=\"variable\">$num</span>) &#123;</span><br><span class=\"line\">           <span class=\"title function_ invoke__\">ob_flush</span>();</span><br><span class=\"line\">           <span class=\"title function_ invoke__\">flush</span>();</span><br><span class=\"line\">           <span class=\"variable\">$num</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"variable\">$row</span> = [];</span><br><span class=\"line\">       <span class=\"variable\">$export_data</span> = <span class=\"variable\">$data</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">       <span class=\"keyword\">foreach</span> (<span class=\"variable\">$export_data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span>(!<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$key</span>,<span class=\"variable\">$body_data</span>))&#123;</span><br><span class=\"line\">               <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">           &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">               <span class=\"keyword\">foreach</span>(<span class=\"variable\">$body_data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key1</span>=&gt;<span class=\"variable\">$value1</span>)&#123;</span><br><span class=\"line\">                   <span class=\"variable\">$row</span>[<span class=\"variable\">$value1</span>] = <span class=\"title function_ invoke__\">iconv</span>(<span class=\"string\">&#x27;utf-8&#x27;</span>, <span class=\"string\">&#x27;gbk&#x27;</span>, <span class=\"variable\">$export_data</span>[<span class=\"variable\">$value1</span>]);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"title function_ invoke__\">fputcsv</span>(<span class=\"variable\">$fp</span>, <span class=\"variable\">$row</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">fclose</span>(<span class=\"variable\">$fp</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">export_csv_1</span>(<span class=\"params\"><span class=\"variable\">$data</span> = [], <span class=\"variable\">$header_data</span> = [], <span class=\"variable\">$file_name</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&#x27;Content-Type: application/octet-stream&#x27;</span>);</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&#x27;Content-Disposition: attachment; filename=&#x27;</span> . <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>(<span class=\"variable\">$header_data</span>)) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">iconv</span>(<span class=\"string\">&#x27;utf-8&#x27;</span>,<span class=\"string\">&#x27;gbk//TRANSLIT&#x27;</span>,<span class=\"string\">&#x27;&quot;&#x27;</span>.<span class=\"title function_ invoke__\">implode</span>(<span class=\"string\">&#x27;&quot;,&quot;&#x27;</span>,<span class=\"variable\">$header_data</span>).<span class=\"string\">&#x27;&quot;&#x27;</span>.<span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\">   <span class=\"variable\">$output</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">   <span class=\"variable\">$output</span>[] = <span class=\"variable\">$value</span>[<span class=\"string\">&#x27;id&#x27;</span>];</span><br><span class=\"line\">   <span class=\"variable\">$output</span>[] = <span class=\"variable\">$value</span>[<span class=\"string\">&#x27;name&#x27;</span>];</span><br><span class=\"line\">   <span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">iconv</span>(<span class=\"string\">&#x27;utf-8&#x27;</span>,<span class=\"string\">&#x27;gbk//TRANSLIT&#x27;</span>,<span class=\"string\">&#x27;&quot;&#x27;</span>.<span class=\"title function_ invoke__\">implode</span>(<span class=\"string\">&#x27;&quot;,&quot;&#x27;</span>, <span class=\"variable\">$output</span>).<span class=\"string\">&quot;\\&quot;\\n&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","tags":["php"]},{"title":"php排序实现方法","url":"/2018/06/30/php%E6%8E%92%E5%BA%8F%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95/","content":"<h5 id=\"直接插入排序\"><a href=\"#直接插入排序\" class=\"headerlink\" title=\"直接插入排序\"></a>直接插入排序</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> *  直接插入排序,插入排序的思想是：当前插入位置之前的元素有序，</span></span><br><span class=\"line\"><span class=\"comment\"> *  若插入当前位置的元素比有序元素最后一个元素大，则什么也不做，</span></span><br><span class=\"line\"><span class=\"comment\"> *  否则在有序序列中找到插入的位置，并插入</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">insertSort</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"variable\">$len</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>);  </span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">1</span>; <span class=\"variable\">$i</span> &lt; <span class=\"variable\">$len</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>-<span class=\"number\">1</span>] &gt; <span class=\"variable\">$arr</span>[i]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"variable\">$j</span> = <span class=\"variable\">$i</span> - <span class=\"number\">1</span>;<span class=\"variable\">$j</span> &gt;= <span class=\"number\">0</span>; <span class=\"variable\">$j</span>-- ) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$tmp</span> &lt; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>]) &#123;</span><br><span class=\"line\">          <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">          <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;          </span><br><span class=\"line\">      &#125;  </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"冒泡排序\"><a href=\"#冒泡排序\" class=\"headerlink\" title=\"冒泡排序\"></a>冒泡排序</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  冒泡排序,冒泡排序思想：进行 n-1 趟冒泡排序， 每趟两两比较调整最大值到数组（子数组）末尾</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bubbleSort</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"variable\">$len</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>);</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">1</span>; <span class=\"variable\">$i</span> &lt; <span class=\"variable\">$len</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"variable\">$j</span> = <span class=\"number\">0</span>; <span class=\"variable\">$j</span> &lt; <span class=\"variable\">$len</span>-<span class=\"variable\">$i</span>; <span class=\"variable\">$j</span>++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] &gt; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">        <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h5 id=\"简单选择排序\"><a href=\"#简单选择排序\" class=\"headerlink\" title=\"简单选择排序\"></a>简单选择排序</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  简单选择排序, 简单排序思想：从数组第一个元素开始依次确定从小到大的元素</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">selectSort</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"variable\">$len</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>);</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"variable\">$len</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$k</span> = <span class=\"variable\">$i</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"variable\">$j</span> = <span class=\"variable\">$i</span>+<span class=\"number\">1</span>; <span class=\"variable\">$j</span> &lt; <span class=\"variable\">$len</span>; <span class=\"variable\">$j</span>++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>] &gt; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>]) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$k</span> = <span class=\"variable\">$j</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$k</span> != <span class=\"variable\">$i</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">      <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>];</span><br><span class=\"line\">      <span class=\"variable\">$arr</span>[<span class=\"variable\">$k</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"希尔排序\"><a href=\"#希尔排序\" class=\"headerlink\" title=\"希尔排序\"></a>希尔排序</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  希尔排序,希尔排序原理：将数组按指定步长分隔成若干子序列，然后分别对子序列进行排序（在这是直接）</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">shellSort</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"variable\">$len</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>);</span><br><span class=\"line\">  <span class=\"variable\">$k</span> = <span class=\"title function_ invoke__\">floor</span>(<span class=\"variable\">$len</span>/<span class=\"number\">2</span>);</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"variable\">$k</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"number\">0</span>; <span class=\"variable\">$i</span> &lt; <span class=\"variable\">$k</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"variable\">$j</span> = <span class=\"variable\">$i</span>; <span class=\"variable\">$j</span> &lt; <span class=\"variable\">$len</span>, (<span class=\"variable\">$j</span> + <span class=\"variable\">$k</span>) &lt; <span class=\"variable\">$len</span>; <span class=\"variable\">$j</span> = <span class=\"variable\">$j</span> + <span class=\"variable\">$k</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] &gt; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"variable\">$k</span>]) &#123;</span><br><span class=\"line\">          <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"variable\">$k</span>];</span><br><span class=\"line\">          <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"variable\">$k</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">          <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$k</span> = <span class=\"title function_ invoke__\">floor</span>(<span class=\"variable\">$k</span>/<span class=\"number\">2</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"快速排序\"><a href=\"#快速排序\" class=\"headerlink\" title=\"快速排序\"></a>快速排序</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> *  快速排序,快排思想：通过一趟排序将待排的记录分为两个独立的部分，其中一部分的记录的关键字均不大于</span></span><br><span class=\"line\"><span class=\"comment\"> *  另一部分记录的关键字，然后再分别对这两部分记录继续进行快速排序，以达到整个序列有序，具体做法需要</span></span><br><span class=\"line\"><span class=\"comment\"> *  每趟排序设置一个标准关键字和分别指向头一个记录的关键字和最后一个记录的关键字的指针。</span></span><br><span class=\"line\"><span class=\"comment\"> *  quickSort($arr, 0, count($arr) -1);</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">quickSort</span>(<span class=\"params\">&amp;<span class=\"variable\">$arr</span>,<span class=\"variable\">$low</span>,<span class=\"variable\">$high</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$low</span> &lt; <span class=\"variable\">$high</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$i</span> = <span class=\"variable\">$low</span>;</span><br><span class=\"line\">    <span class=\"variable\">$j</span> = <span class=\"variable\">$high</span>;</span><br><span class=\"line\">    <span class=\"variable\">$primary</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$low</span>];</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"variable\">$i</span> &lt; <span class=\"variable\">$j</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(<span class=\"variable\">$i</span> &lt; <span class=\"variable\">$j</span> &amp;&amp; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] &gt;= <span class=\"variable\">$primary</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$j</span>--;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"variable\">$i</span> &lt; <span class=\"variable\">$j</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>++] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(<span class=\"variable\">$i</span> &lt; <span class=\"variable\">$j</span> &amp;&amp; <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>] &lt;= <span class=\"variable\">$primary</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$i</span>++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"variable\">$i</span> &lt; <span class=\"variable\">$j</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>--] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$arr</span>[<span class=\"variable\">$i</span>] = <span class=\"variable\">$primary</span>;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">quickSort</span>(<span class=\"variable\">$arr</span>, <span class=\"variable\">$low</span>, <span class=\"variable\">$i</span>-<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">quickSort</span>(<span class=\"variable\">$arr</span>, <span class=\"variable\">$i</span>+<span class=\"number\">1</span>, <span class=\"variable\">$high</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"堆排序\"><a href=\"#堆排序\" class=\"headerlink\" title=\"堆排序\"></a>堆排序</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  堆排序</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 调整子堆的为大根堆的过程，$s为子堆的根的位置，$m为堆最后一个元素位置</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">heapAdjust</span>(<span class=\"params\">&amp;<span class=\"variable\">$arr</span>, <span class=\"variable\">$s</span>, <span class=\"variable\">$m</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$s</span>];</span><br><span class=\"line\">  <span class=\"comment\">// 在调整为大根堆的过程中可能会影响左子堆或右子堆</span></span><br><span class=\"line\">  <span class=\"comment\">// for循环的作用是要保证子堆也是大根堆</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"variable\">$j</span> = <span class=\"number\">2</span>*<span class=\"variable\">$s</span> + <span class=\"number\">1</span>; <span class=\"variable\">$j</span> &lt;= <span class=\"variable\">$m</span>; <span class=\"variable\">$j</span> = <span class=\"number\">2</span>*<span class=\"variable\">$j</span> + <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 找到根节点的左右孩子中的最大者，然后用这个最大者与根节点比较，</span></span><br><span class=\"line\">    <span class=\"comment\">// 若大则进行调整，否则符合大根堆的 特点跳出循环  </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$j</span> &lt; <span class=\"variable\">$m</span> &amp;&amp; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] &lt; <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>+<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$j</span>++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$tmp</span> &gt;= <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>] ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$arr</span>[<span class=\"variable\">$s</span>] = <span class=\"variable\">$arr</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">    <span class=\"variable\">$s</span> = <span class=\"variable\">$j</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable\">$arr</span>[<span class=\"variable\">$s</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 堆排序</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">heapSort</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"variable\">$len</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 依次从子堆开始调整堆为大根堆</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"variable\">$i</span> = <span class=\"title function_ invoke__\">floor</span>(<span class=\"variable\">$len</span>/<span class=\"number\">2</span>-<span class=\"number\">1</span>); <span class=\"variable\">$i</span> &gt;= <span class=\"number\">0</span>; <span class=\"variable\">$i</span>--) &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">heapAdjust</span>(<span class=\"variable\">$arr</span>, <span class=\"variable\">$i</span>, <span class=\"variable\">$len</span>-<span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 依次把根节点调换至最后一个位置，再次调整堆为大根堆，找到次最大值，</span></span><br><span class=\"line\">  <span class=\"comment\">// 依次类推得到一个有序数组</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"variable\">$n</span> = <span class=\"variable\">$len</span>-<span class=\"number\">1</span>; <span class=\"variable\">$n</span> &gt; <span class=\"number\">0</span>; <span class=\"variable\">$n</span>--) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$tmp</span> = <span class=\"variable\">$arr</span>[<span class=\"variable\">$n</span>];</span><br><span class=\"line\">    <span class=\"variable\">$arr</span>[<span class=\"variable\">$n</span>] = <span class=\"variable\">$arr</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"variable\">$arr</span>[<span class=\"number\">0</span>] = <span class=\"variable\">$tmp</span>;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">heapAdjust</span>(<span class=\"variable\">$arr</span>, <span class=\"number\">0</span>, <span class=\"variable\">$n</span>-<span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"归并排序\"><a href=\"#归并排序\" class=\"headerlink\" title=\"归并排序\"></a>归并排序</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  归并排序,这里实现的是两路归并</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"comment\">// 分别将有序的$arr1[s..m]、$arr2[m+1..n]归并为有序的$arr2[s..n]</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Merge</span>(<span class=\"params\">&amp;<span class=\"variable\">$arr1</span>, &amp;<span class=\"variable\">$arr2</span>, <span class=\"variable\">$s</span>, <span class=\"variable\">$m</span>, <span class=\"variable\">$n</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"variable\">$k</span> = <span class=\"variable\">$s</span>,<span class=\"variable\">$i</span> = <span class=\"variable\">$s</span>, <span class=\"variable\">$j</span> = <span class=\"variable\">$m</span>+<span class=\"number\">1</span>; <span class=\"variable\">$i</span> &lt;= <span class=\"variable\">$m</span> &amp;&amp; <span class=\"variable\">$j</span> &lt;= <span class=\"variable\">$n</span>; <span class=\"variable\">$k</span>++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$arr1</span>[<span class=\"variable\">$i</span>]&lt;<span class=\"variable\">$arr1</span>[<span class=\"variable\">$j</span>]) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$arr2</span>[<span class=\"variable\">$k</span>] = <span class=\"variable\">$arr1</span>[<span class=\"variable\">$i</span>++];</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable\">$arr2</span>[<span class=\"variable\">$k</span>] = <span class=\"variable\">$arr1</span>[<span class=\"variable\">$j</span>++];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$i</span> &lt;= <span class=\"variable\">$m</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(; <span class=\"variable\">$i</span> &lt;= <span class=\"variable\">$m</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$arr2</span>[<span class=\"variable\">$k</span>++] = <span class=\"variable\">$arr1</span>[<span class=\"variable\">$i</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"variable\">$j</span> &lt;= <span class=\"variable\">$n</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(; <span class=\"variable\">$j</span> &lt;= <span class=\"variable\">$n</span>; <span class=\"variable\">$j</span>++) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$arr2</span>[<span class=\"variable\">$k</span>++] = <span class=\"variable\">$arr1</span>[<span class=\"variable\">$j</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 递归形式的两路归并</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MSort</span>(<span class=\"params\">&amp;<span class=\"variable\">$arr1</span>, &amp;<span class=\"variable\">$arr2</span>, <span class=\"variable\">$s</span>, <span class=\"variable\">$t</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$s</span> == <span class=\"variable\">$t</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$arr2</span>[<span class=\"variable\">$s</span>] = <span class=\"variable\">$arr1</span>[<span class=\"variable\">$s</span>];</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$m</span> = <span class=\"title function_ invoke__\">floor</span>((<span class=\"variable\">$s</span>+<span class=\"variable\">$t</span>)/<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"variable\">$tmp_arr</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">MSort</span>(<span class=\"variable\">$arr1</span>, <span class=\"variable\">$tmp_arr</span>, <span class=\"variable\">$s</span>, <span class=\"variable\">$m</span>);</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">MSort</span>(<span class=\"variable\">$arr1</span>, <span class=\"variable\">$tmp_arr</span>, <span class=\"variable\">$m</span>+<span class=\"number\">1</span>, <span class=\"variable\">$t</span>);</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">Merge</span>(<span class=\"variable\">$tmp_arr</span>, <span class=\"variable\">$arr2</span>, <span class=\"variable\">$s</span>, <span class=\"variable\">$m</span>, <span class=\"variable\">$t</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对一位数组$arr[0..n-1]中的元素进行两路归并</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mergeSort</span>(<span class=\"params\"><span class=\"variable\">$arr</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"variable\">$len</span> = <span class=\"title function_ invoke__\">count</span>(<span class=\"variable\">$arr</span>);</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">MSort</span>(<span class=\"variable\">$arr</span>, <span class=\"variable\">$arr</span>, <span class=\"number\">0</span>, <span class=\"variable\">$len</span>-<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$arr</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用经验<br>若排序的记录数目n较小时，可以采用直接插入排序和简单选择排序，当记录本身信息量较大时，用简单选择排序方法较好。<br>若待排序记录按关键字基本有序，适合采用直接插入排序和冒泡排序。<br>若n值较大时，可以采用快速排序、堆排序和归并排序。另外快速排序被认为是内部排序方法中最好的方法。</p>\n","tags":["php"]},{"title":"php浮点数精确运算","url":"/2018/01/20/php%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B2%BE%E7%A1%AE%E8%BF%90%E7%AE%97/","content":"<p>如果用php的+-*&#x2F;计算浮点数的时候，可能会遇到一些计算结果错误的问题，所以基本上大部分语言都提供了精准计算的类库或函数库，比如php有BC高精确度函数库，下面我们介绍一下一些常用的BC高精确度函数使用。</p>\n<p>bc是Binary Calculator的缩写。bc*函数的参数都是操作数加上一个可选的 [int scale]，比如string bcadd(string $left_operand, string $right_operand[, int $scale])，如果scale没有提供，就用bcscale的缺省值。这里大数直接用一个由0-9组成的string表示，计算结果返回的也是一个 string。</p>\n<span id=\"more\"></span>\n\n<p>bcadd — 将两个高精度数字相加<br>bccomp — 比较两个高精度数字，返回-1, 0, 1<br>bcdiv — 将两个高精度数字相除<br>bcmod — 求高精度数字余数<br>bcmul — 将两个高精度数字相乘<br>bcpow — 求高精度数字乘方<br>bcpowmod — 求高精度数字乘方求模，数论里非常常用<br>bcscale — 配置默认小数点位数，相当于就是Linux bc中的”scale&#x3D;”<br>bcsqrt — 求高精度数字平方根<br>bcsub — 将两个高精度数字相减</p>\n<p>首先看一段代码:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$a</span> = <span class=\"number\">0.1</span>;</span><br><span class=\"line\"><span class=\"variable\">$b</span> = <span class=\"number\">0.7</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">var_dump</span>((<span class=\"variable\">$a</span> + <span class=\"variable\">$b</span>) == <span class=\"number\">0.8</span>);</span><br></pre></td></tr></table></figure>\n\n\n<p>打印出来的值居然为 boolean false</p>\n<p>这是为啥?PHP手册对于浮点数有以下警告信息:</p>\n<p>Warning<br>浮点数精度<br>显然简单的十进制分数如同 0.1 或 0.7 不能在不丢失一点点精度的情况下转换为内部二进制的格式。这就会造成混乱的结果：例如，floor((0.1+0.7)*10) 通常会返回 7 而不是预期中的 8，因为该结果内部的表示其实是类似 7.9999999999…。 <br><br>这和一个事实有关，那就是不可能精确的用有限位数表达某些十进制分数。例如，十进制的 1&#x2F;3 变成了 0.3333333. . .。 <br><br>所以永远不要相信浮点数结果精确到了最后一位，也永远不要比较两个浮点数是否相等。如果确实需要更高的精度，应该使用任意精度数学函数或者 gmp 函数</p>\n<p>那么上面的算式我们应该改写为</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$a</span> = <span class=\"number\">0.1</span>;</span><br><span class=\"line\"><span class=\"variable\">$b</span> = <span class=\"number\">0.7</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">var_dump</span>(<span class=\"title function_ invoke__\">bcadd</span>(<span class=\"variable\">$a</span>,<span class=\"variable\">$b</span>,<span class=\"number\">2</span>) == <span class=\"number\">0.8</span>);</span><br></pre></td></tr></table></figure>\n\n<p>这样就能解决浮点数的计算问题了</p>\n","tags":["php"]},{"title":"php的socket通信","url":"/2018/01/02/php%E7%9A%84socket%E9%80%9A%E4%BF%A1/","content":"<p>对TCP&#x2F;IP、UDP、Socket编程这些词你不会很陌生吧？随着网络技术的发展，这些词充斥着我们的耳朵。那么我想问：</p>\n<ol>\n<li>什么是TCP&#x2F;IP、UDP？</li>\n<li>Socket在哪里呢？</li>\n<li>Socket是什么呢？</li>\n<li>你会使用它们吗？</li>\n</ol>\n<h5 id=\"什么是TCP-x2F-IP、UDP？\"><a href=\"#什么是TCP-x2F-IP、UDP？\" class=\"headerlink\" title=\"什么是TCP&#x2F;IP、UDP？\"></a>什么是TCP&#x2F;IP、UDP？</h5><p>TCP&#x2F;IP（Transmission Control Protocol&#x2F;Internet Protocol）即传输控制协议&#x2F;网间协议，是一个工业标准的协议集，它是为广域网（WANs）设计的。<br><br>UDP（User Data Protocol，用户数据报协议）是与TCP相对应的协议。它是属于TCP&#x2F;IP协议族中的一种。<br>这里有一张图，表明了这些协议的关系。</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/php_socket/php_socket_1.jpg\" alt=\"TCP/IP-UDP\"></p>\n<p>TCP&#x2F;IP协议族包括运输层、网络层、链路层。</p>\n<span id=\"more\"></span>\n\n<h5 id=\"Socket在哪里呢？\"><a href=\"#Socket在哪里呢？\" class=\"headerlink\" title=\"Socket在哪里呢？\"></a>Socket在哪里呢？</h5><p>在图1中，我们没有看到Socket的影子，那么它到底在哪里呢？还是用图来说话，一目了然。</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/php_socket/php_socket_2.jpg\" alt=\"TCP/IP-UDP\"></p>\n<p>原来Socket在这里。</p>\n<h5 id=\"Socket是什么呢？\"><a href=\"#Socket是什么呢？\" class=\"headerlink\" title=\"Socket是什么呢？\"></a>Socket是什么呢？</h5><p>Socket是应用层与TCP&#x2F;IP协议族通信的中间软件抽象层，它是一组接口。在设计模式中，Socket其实就是一个门面模式，它把复杂的TCP&#x2F;IP协议族隐藏在Socket接口后面，对用户来说，一组简单的接口就是全部，让Socket去组织数据，以符合指定的协议。<br><br>你会使用它们吗？<br><br>　　前人已经给我们做了好多的事了，网络间的通信也就简单了许多，但毕竟还是有挺多工作要做的。以前听到Socket编程，觉得它是比较高深的编程知识，但是只要弄清Socket编程的工作原理，神秘的面纱也就揭开了。<br><br>　　一个生活中的场景。你要打电话给一个朋友，先拨号，朋友听到电话铃声后提起电话，这时你和你的朋友就建立起了连接，就可以讲话了。等交流结束，挂断电话结束此次交谈。 生活中的场景就解释了这工作原理，也许TCP&#x2F;IP协议族就是诞生于生活中，这也不一定。</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/php_socket/php_socket_3.jpg\" alt=\"TCP/IP-UDP\"></p>\n<p>先从服务器端说起。服务器端先初始化Socket，然后与端口绑定(bind)，对端口进行监听(listen)，调用accept阻塞，等待客户端连接。在这时如果有个客户端初始化一个Socket，然后连接服务器(connect)，如果连接成功，这时客户端与服务器端的连接就建立了。客户端发送数据请求，服务器端接收请求并处理请求，然后把回应数据发送给客户端，客户端读取数据，最后关闭连接，一次交互结束。</p>\n<h5 id=\"socket相关函数：\"><a href=\"#socket相关函数：\" class=\"headerlink\" title=\"socket相关函数：\"></a>socket相关函数：</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_accept</span>() 接受一个Socket连接</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_bind</span>() 把socket绑定在一个IP地址和端口上</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_clear_error</span>() 清除socket的错误或者最后的错误代码</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_close</span>() 关闭一个socket资源</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_connect</span>() 开始一个socket连接</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_create_listen</span>() 在指定端口打开一个socket监听</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_create_pair</span>() 产生一对没有区别的socket到一个数组里</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_create</span>() 产生一个socket，相当于产生一个socket的数据结构</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_get_option</span>() 获取socket选项</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_getpeername</span>() 获取远程类似主机的ip地址</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_getsockname</span>() 获取本地socket的ip地址</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_iovec_add</span>() 添加一个新的向量到一个分散/聚合的数组</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_iovec_alloc</span>() 这个函数创建一个能够发送接收读写的iovec数据结构</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_iovec_delete</span>() 删除一个已经分配的iovec</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_iovec_fetch</span>() 返回指定的iovec资源的数据</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_iovec_free</span>() 释放一个iovec资源</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_iovec_set</span>() 设置iovec的数据新值</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_last_error</span>() 获取当前socket的最后错误代码</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_listen</span>() 监听由指定socket的所有连接</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_read</span>() 读取指定长度的数据</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_readv</span>() 读取从分散/聚合数组过来的数据</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_recv</span>() 从socket里结束数据到缓存</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_recvfrom</span>() 接受数据从指定的socket，如果没有指定则默认当前socket</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_recvmsg</span>() 从iovec里接受消息</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_select</span>() 多路选择</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_send</span>() 这个函数发送数据到已连接的socket</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_sendmsg</span>() 发送消息到socket</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_sendto</span>() 发送消息到指定地址的socket</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_set_block</span>() 在socket里设置为块模式</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_set_nonblock</span>() socket里设置为非块模式</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_set_option</span>() 设置socket选项</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_shutdown</span>() 这个函数允许你关闭读、写、或者指定的socket</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_strerror</span>() 返回指定错误号的详细错误</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_write</span>() 写数据到socket缓存</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_writev</span>() 写数据到分散/聚合数组</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"案例一：socket通信演示\"><a href=\"#案例一：socket通信演示\" class=\"headerlink\" title=\"案例一：socket通信演示\"></a>案例一：socket通信演示</h5><p>服务器端：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//确保在连接客户端时不会超时</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">set_time_limit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ip</span> = <span class=\"string\">&#x27;127.0.0.1&#x27;</span>;</span><br><span class=\"line\"><span class=\"variable\">$port</span> = <span class=\"number\">2018</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> +-------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>通信整个过程</span></span><br><span class=\"line\"><span class=\"comment\"> +-------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_create</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_bind</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_listen</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_accept</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_read</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_write</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_close</span></span><br><span class=\"line\"><span class=\"comment\"> +--------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*----------------    以下操作都是手册上的    -------------------*/</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>((<span class=\"variable\">$sock</span> = <span class=\"title function_ invoke__\">socket_create</span>(AF_INET,SOCK_STREAM,SOL_TCP)) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;socket_create() 失败的原因是:&quot;</span>.<span class=\"title function_ invoke__\">socket_strerror</span>(<span class=\"variable\">$sock</span>).<span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>((<span class=\"variable\">$ret</span> = <span class=\"title function_ invoke__\">socket_bind</span>(<span class=\"variable\">$sock</span>,<span class=\"variable\">$ip</span>,<span class=\"variable\">$port</span>)) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;socket_bind() 失败的原因是:&quot;</span>.<span class=\"title function_ invoke__\">socket_strerror</span>(<span class=\"variable\">$ret</span>).<span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>((<span class=\"variable\">$ret</span> = <span class=\"title function_ invoke__\">socket_listen</span>(<span class=\"variable\">$sock</span>,<span class=\"number\">4</span>)) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;socket_listen() 失败的原因是:&quot;</span>.<span class=\"title function_ invoke__\">socket_strerror</span>(<span class=\"variable\">$ret</span>).<span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$count</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((<span class=\"variable\">$msgsock</span> = <span class=\"title function_ invoke__\">socket_accept</span>(<span class=\"variable\">$sock</span>)) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;socket_accept() failed: reason: &quot;</span> . <span class=\"title function_ invoke__\">socket_strerror</span>(<span class=\"variable\">$msgsock</span>) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//发到客户端</span></span><br><span class=\"line\">        <span class=\"variable\">$msg</span> =<span class=\"string\">&quot;测试成功！\\n&quot;</span>;</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">socket_write</span>(<span class=\"variable\">$msgsock</span>, <span class=\"variable\">$msg</span>, <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$msg</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;测试成功了啊\\n&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$buf</span> = <span class=\"title function_ invoke__\">socket_read</span>(<span class=\"variable\">$msgsock</span>,<span class=\"number\">8192</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$talkback</span> = <span class=\"string\">&quot;收到的信息:<span class=\"subst\">$buf</span>\\n&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"variable\">$talkback</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(++<span class=\"variable\">$count</span> &gt;= <span class=\"number\">5</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//echo $buf;</span></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">socket_close</span>(<span class=\"variable\">$msgsock</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_close</span>(<span class=\"variable\">$sock</span>);</span><br></pre></td></tr></table></figure>\n\n<p>这是socket的服务端代码,然后在命令行运行</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/php_socket/server_start.png\" alt=\"php_socket\"></p>\n<p>没有反映，对现在服务端的程序已经开始运行，端口已经开始监听了。运行netstat -nltp可以查看端口情况，我的是2018端口</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/php_socket/php_socket_port.png\" alt=\"php_socket\"></p>\n<p>端口已经处于LISTENING状态了。接下来我们只要运行客户端程序即可连接上。代码如下</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(E_ALL);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">set_time_limit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;h2&gt;TCP/IP Connection&lt;/h2&gt;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$port</span> = <span class=\"number\">2018</span>;</span><br><span class=\"line\"><span class=\"variable\">$ip</span> = <span class=\"string\">&quot;127.0.0.1&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> +-------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>连接整个过程</span></span><br><span class=\"line\"><span class=\"comment\"> +-------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_create</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_connect</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_write</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_read</span></span><br><span class=\"line\"><span class=\"comment\"> *    <span class=\"doctag\">@socket</span>_close</span></span><br><span class=\"line\"><span class=\"comment\"> +--------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$socket</span> = <span class=\"title function_ invoke__\">socket_create</span>(AF_INET, SOCK_STREAM, SOL_TCP);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$socket</span> &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;socket_create() failed: reason: &quot;</span> . <span class=\"title function_ invoke__\">socket_strerror</span>(<span class=\"variable\">$socket</span>) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;OK.\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;试图连接 &#x27;<span class=\"subst\">$ip</span>&#x27; 端口 &#x27;<span class=\"subst\">$port</span>&#x27;...\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">socket_connect</span>(<span class=\"variable\">$socket</span>, <span class=\"variable\">$ip</span>, <span class=\"variable\">$port</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$result</span> &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;socket_connect() failed.\\nReason: (<span class=\"subst\">$result</span>) &quot;</span> . <span class=\"title function_ invoke__\">socket_strerror</span>(<span class=\"variable\">$result</span>) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;连接OK\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$in</span> = <span class=\"string\">&quot;Yo\\r\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$in</span> .= <span class=\"string\">&quot;hello world\\r\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$out</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"title function_ invoke__\">socket_write</span>(<span class=\"variable\">$socket</span>, <span class=\"variable\">$in</span>, <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$in</span>))) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;socket_write() failed: reason: &quot;</span> . <span class=\"title function_ invoke__\">socket_strerror</span>(<span class=\"variable\">$socket</span>) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;发送到服务器信息成功！\\n&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;发送的内容为: <span class=\"subst\">$in</span> \\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"variable\">$out</span> = <span class=\"title function_ invoke__\">socket_read</span>(<span class=\"variable\">$socket</span>, <span class=\"number\">8192</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;接收服务器回传信息成功！\\n&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;接受的内容为:&quot;</span>,<span class=\"variable\">$out</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;关闭SOCKET...\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_close</span>(<span class=\"variable\">$socket</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;关闭OK\\n&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/php_socket/php_socket_server.png\" alt=\"php_socket\"></p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/php_socket/php_socket_client.png\" alt=\"php_socket\"></p>\n<p>至此客户端已经连接上服务端了。</p>\n<h5 id=\"案例二：代码详解\"><a href=\"#案例二：代码详解\" class=\"headerlink\" title=\"案例二：代码详解\"></a>案例二：代码详解</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">// 设置一些基本的变量</span></span><br><span class=\"line\"><span class=\"variable\">$host</span> = <span class=\"string\">&quot;192.168.1.99&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$port</span> = <span class=\"number\">1234</span>;</span><br><span class=\"line\"><span class=\"comment\">// 设置超时时间</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">set_time_limit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"comment\">// 创建一个Socket</span></span><br><span class=\"line\"><span class=\"variable\">$socket</span> = <span class=\"title function_ invoke__\">socket_create</span>(AF_INET, SOCK_STREAM, <span class=\"number\">0</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not createsocket\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//绑定Socket到端口</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">socket_bind</span>(<span class=\"variable\">$socket</span>, <span class=\"variable\">$host</span>, <span class=\"variable\">$port</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not bind tosocket\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 开始监听链接</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">socket_listen</span>(<span class=\"variable\">$socket</span>, <span class=\"number\">3</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not set up socketlistener\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// accept incoming connections</span></span><br><span class=\"line\"><span class=\"comment\">// 另一个Socket来处理通信</span></span><br><span class=\"line\"><span class=\"variable\">$spawn</span> = <span class=\"title function_ invoke__\">socket_accept</span>(<span class=\"variable\">$socket</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not accept incomingconnection\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 获得客户端的输入</span></span><br><span class=\"line\"><span class=\"variable\">$input</span> = <span class=\"title function_ invoke__\">socket_read</span>(<span class=\"variable\">$spawn</span>, <span class=\"number\">1024</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not read input\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 清空输入字符串</span></span><br><span class=\"line\"><span class=\"variable\">$input</span> = <span class=\"title function_ invoke__\">trim</span>(<span class=\"variable\">$input</span>);</span><br><span class=\"line\"><span class=\"comment\">//处理客户端输入并返回结果</span></span><br><span class=\"line\"><span class=\"variable\">$output</span> = <span class=\"title function_ invoke__\">strrev</span>(<span class=\"variable\">$input</span>) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_write</span>(<span class=\"variable\">$spawn</span>, <span class=\"variable\">$output</span>, <span class=\"title function_ invoke__\">strlen</span> (<span class=\"variable\">$output</span>)) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not write</span></span><br><span class=\"line\"><span class=\"string\">output\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 关闭sockets</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_close</span>(<span class=\"variable\">$spawn</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_close</span>(<span class=\"variable\">$socket</span>);</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"下面是其每一步骤的详细说明\"><a href=\"#下面是其每一步骤的详细说明\" class=\"headerlink\" title=\"下面是其每一步骤的详细说明:\"></a>下面是其每一步骤的详细说明:</h6><p>1 . 第一步是建立两个变量来保存Socket运行的服务器的IP地址和端口.你可以设置为你自己的服务器和端口(这个端口可以是1到65535之间的数字),前提是这个端口未被使用.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置两个变量</span></span><br><span class=\"line\"><span class=\"variable\">$host</span> = <span class=\"string\">&quot;192.168.1.99&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$port</span> = <span class=\"number\">1234</span>;</span><br></pre></td></tr></table></figure>\n\n<p>2 . 在服务器端可以使用set_time_out()函数来确保PHP在等待客户端连接时不会超时.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 超时时间</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">set_time_limit</span>(<span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n<p>3 . 在前面的基础上,现在该使用socket_creat()函数创建一个Socket了—这个函数返回一个Socket句柄,这个句柄将用在以后所有的函数中.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建Socket</span></span><br><span class=\"line\"><span class=\"variable\">$socket</span> = <span class=\"title function_ invoke__\">socket_create</span>(AF_INET, SOCK_STREAM, <span class=\"number\">0</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not create</span></span><br><span class=\"line\"><span class=\"string\">socket\\n&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>第一个参数”AF_INET”用来指定域名;<br><br>第二个参数”SOCK_STREM”告诉函数将创建一个什么类型的Socket(在这个例子中是TCP类型)</p>\n<p>因此,如果你想创建一个UDP Socket的话,你可以使用如下的代码:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 绑定 socket to 指定地址和端口</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">socket_bind</span>(<span class=\"variable\">$socket</span>, <span class=\"variable\">$host</span>, <span class=\"variable\">$port</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not bind to</span></span><br><span class=\"line\"><span class=\"string\">socket\\n&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>4 . 一旦创建了一个Socket句柄,下一步就是指定或者绑定它到指定的地址和端口.这可以通过socket_bind()函数来完成.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 绑定 socket to 指定地址和端口</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">socket_bind</span>(<span class=\"variable\">$socket</span>, <span class=\"variable\">$host</span>, <span class=\"variable\">$port</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not bind to</span></span><br><span class=\"line\"><span class=\"string\">socket\\n&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>5 . 当Socket被创建好并绑定到一个端口后,就可以开始监听外部的连接了.PHP允许你由socket_listen()函数来开始一个监听,同时你可以指定一个数字(在这个例子中就是第二个参数:3)</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 开始监听连接</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">socket_listen</span>(<span class=\"variable\">$socket</span>, <span class=\"number\">3</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not set up socket</span></span><br><span class=\"line\"><span class=\"string\">listener\\n&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>6 . 到现在,你的服务器除了等待来自客户端的连接请求外基本上什么也没有做.一旦一个客户端的连接被收到,socket_accept()函数便开始起作用了,它接收连接请求并调用另一个子Socket来处理客户端–服务器间的信息.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//接受请求链接</span></span><br><span class=\"line\"><span class=\"comment\">// 调用子socket 处理信息</span></span><br><span class=\"line\"><span class=\"variable\">$spawn</span> = <span class=\"title function_ invoke__\">socket_accept</span>(<span class=\"variable\">$socket</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not accept incoming</span></span><br><span class=\"line\"><span class=\"string\">connection\\n&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>这个子socket现在就可以被随后的客户端–服务器通信所用了.</p>\n<p>7 . 当一个连接被建立后,服务器就会等待客户端发送一些输入信息,这写信息可以由socket_read()函数来获得,并把它赋值给PHP的$input变量.</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 读取客户端输入</span></span><br><span class=\"line\"><span class=\"variable\">$input</span> = <span class=\"title function_ invoke__\">socket_read</span>(<span class=\"variable\">$spawn</span>, <span class=\"number\">1024</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not read input\\n&quot;</span>);</span><br><span class=\"line\">?&amp;gt;</span><br></pre></td></tr></table></figure>\n\n<p>socker_read的第而个参数用以指定读入的字节数,你可以通过它来限制从客户端获取数据的大小.</p>\n<p>注意:socket_read函数会一直读取壳户端数据,直到遇见\\n,\\t或者\\0字符.PHP脚本把这写字符看做是输入的结束符.</p>\n<p>8 . 现在服务器必须处理这些由客户端发来是数据(在这个例子中的处理仅仅包含数据的输入和回传到客户端).这部分可以由socket_write()函数来完成(使得由通信socket发回一个数据流到客户端成为可能)</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 处理客户端输入并返回数据</span></span><br><span class=\"line\"><span class=\"variable\">$output</span> = <span class=\"title function_ invoke__\">strrev</span>(<span class=\"variable\">$input</span>) . <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_write</span>(<span class=\"variable\">$spawn</span>, <span class=\"variable\">$output</span>, <span class=\"title function_ invoke__\">strlen</span> (<span class=\"variable\">$output</span>)) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Could not write</span></span><br><span class=\"line\"><span class=\"string\">output\\n&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>9 . 一旦输出被返回到客户端,父&#x2F;子socket都应通过socket_close()函数来终止</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 关闭 sockets</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_close</span>(<span class=\"variable\">$spawn</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">socket_close</span>(<span class=\"variable\">$socket</span>);</span><br></pre></td></tr></table></figure>\n\n\n<p>文章参考：<a href=\"http://www.cnblogs.com/thinksasa/archive/2013/02/26/2934206.html\" target=\"_blank\">http://www.cnblogs.com/thinksasa/archive/2013/02/26/2934206.html</a></p>\n","tags":["php","socket"]},{"title":"php设计模式概述","url":"/2017/12/23/php%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%BF%B0/","content":"<h4 id=\"工厂模式：\"><a href=\"#工厂模式：\" class=\"headerlink\" title=\"工厂模式：\"></a>工厂模式：</h4><p>  我们定义一个专门用来创建其它对象的类。 这样在需要调用某个类的时候，我们就不需要去使用new关键字实例化这个类，而是通过我们的工厂类调用某个方法得到类的实例。<br><br>  好处：当我们对象所对应的类的类名发生变化的时候，我们只需要改一下工厂类类里面的实例化方法即可。不需要外部改所有的地方。</p>\n<h4 id=\"单例模式（口诀：三私一公）\"><a href=\"#单例模式（口诀：三私一公）\" class=\"headerlink\" title=\"单例模式（口诀：三私一公）\"></a>单例模式（口诀：三私一公）</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//私有化构造方法，禁止外部实例化对象</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//私有化__clone，防止对象被克隆</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__clone</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//私有化内部实例化的对象</span></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"variable\">$instance</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t<span class=\"comment\">// 公有静态实例方法</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getInstance</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">self</span>::<span class=\"variable\">$instance</span> == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//内部实例化对象</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">self</span>::<span class=\"variable\">$instance</span> = <span class=\"keyword\">new</span> <span class=\"built_in\">self</span>();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">self</span>::<span class=\"variable\">$instance</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"注册器模式：\"><a href=\"#注册器模式：\" class=\"headerlink\" title=\"注册器模式：\"></a>注册器模式：</h4><p>用来将一些对象注册到全局的注册树上，可以在任何地方访问。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_ invoke__\">set</span>():将对象隐射到全局树上，</span><br><span class=\"line\"><span class=\"title function_ invoke__\">_unset</span>():从树上移除。</span><br><span class=\"line\"><span class=\"title function_ invoke__\">get</span>():去注册到树上的对象。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"适配器模式：\"><a href=\"#适配器模式：\" class=\"headerlink\" title=\"适配器模式：\"></a>适配器模式：</h4><p>1、可以将截然不同的函数接口封装成统一的API<br><br>2、实际应用举例：PHP的数据库操作有mysql&#x2F;mysqli&#x2F;pdo 三种，可以用适配器模式统一成一致。类似的场景还有cache适配器，可以将memcache&#x2F;redis&#x2F;file&#x2F;apc等不同的缓存函数统一成一致的接口。</p>\n<h4 id=\"策略模式：\"><a href=\"#策略模式：\" class=\"headerlink\" title=\"策略模式：\"></a>策略模式：</h4><p>1、策略模式，将一组特定的行为和算法封装成类，以适应某些特定的上下文环境，这种模式就是策略模式<br><br>2、实际应用举例，假如一个电商网站系统，针对男性女性用户要各自跳转到不同的商品类名，并且所有广告位展示不同的广告，传统的做法是加入if…else… 判断。<br>如果新增加一种用户类型，只需要新增加一种策略即可<br><br>3、使用策略模式可以实现Ioc ,依赖倒置，控制反转</p>\n<h4 id=\"数据对象映射模式：\"><a href=\"#数据对象映射模式：\" class=\"headerlink\" title=\"数据对象映射模式：\"></a>数据对象映射模式：</h4><p>  1、数据对象映射模式，是将对象和数据存储映射起来，对一个对象的操作会映射为对数据存储的操作，比我们在代码中new一个对象，那么使用该模式就可以将对对象的一些操作，比如说我们设置的一些属性，它就会自动保存到数据库，跟数据库中表的一条记录对应起来<br><br>   实例，在代码中实现数据对象映射模式，我们将写一个ORM类，将复杂的SQL语句映射成对象属性的操作<br>   结合使用数据对象映射模式，工厂模式，注册模式</p>\n<h4 id=\"对象关系映射\"><a href=\"#对象关系映射\" class=\"headerlink\" title=\"对象关系映射\"></a>对象关系映射</h4><p>对象关系映射（英语：Object Relation Mapping，简称ORM，或O&#x2F;RM，或O&#x2F;R mapping），是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换[1]  。从效果上说，它其实是创建了一个可在编程语言里使用的–“虚拟对象数据库”。<br>面向对象是从软件工程基本原则（如耦合、聚合、封装）的基础上发展起来的，而关系数据库则是从数学理论发展而来的，两套理论存在显著的区别。为了解决这个不匹配的现象，对象关系映射技术应运而生<br>简单的说：ORM相当于中继数据</p>\n<h4 id=\"适配器模式：-1\"><a href=\"#适配器模式：-1\" class=\"headerlink\" title=\"适配器模式：\"></a>适配器模式：</h4><p>1、可以将截然不同的函数接口封装成统一的API<br><br>2、实际应用举例：PHP的数据库操作有mysql&#x2F;mysqli&#x2F;pdo 三种，可以用适配器模式统一成一致。类似的场景还有cache适配器，可以将memcache&#x2F;redis&#x2F;file&#x2F;apc等不同的缓存函数统一成一致的接口。</p>\n<h4 id=\"观察者模式\"><a href=\"#观察者模式\" class=\"headerlink\" title=\"观察者模式\"></a>观察者模式</h4><p>1、 观察者模式（ Observer ），当一个对象状态发生改变时，依赖它的对象全部会收到通知，并自动更新<br><br>2、 场景：一个事件发生后，要执行一连串更新操作。传统的编程方式，就是在事件的代码之后直接加入处理逻辑。当更新的逻辑增多后，代码会变得难以维护。这种方式是耦合的，入侵式的，增加新的逻辑需要修改事件主体的代码<br><br>3、观察者模式实现了低耦合，非入侵式的通知与更新机制</p>\n<h4 id=\"原型模式\"><a href=\"#原型模式\" class=\"headerlink\" title=\"原型模式\"></a>原型模式</h4><p>1、 与工厂模式作用类似，都是用来创建对象<br><br>2、 与工厂模式的实现不懂，原型模式是首先创建好一个原型对象，然后通过clone原型对象来创建新的对象。这样就免去了类创建是重复的初始化操作<br><br>3、 原型模式适用于大对象的创建。创建一个大对象需要很大的开销，如果每次new就会消耗很大，原型模式仅需内存拷贝即可</p>\n<h4 id=\"装饰器模式\"><a href=\"#装饰器模式\" class=\"headerlink\" title=\"装饰器模式\"></a>装饰器模式</h4><p>1、装饰器模式（Decorator）可以动态地添加修改类的功能<br><br>2、一个类提供了一项功能，如果要在修改并添加额外的功能，传统的编程模式，需要写一个子类继承它，并重新实现类的方法<br><br>3、使用装饰器模式，仅需在运行时添加一个装饰器对象即可实现，可以实现最大的灵活性</p>\n<h4 id=\"迭代器模式\"><a href=\"#迭代器模式\" class=\"headerlink\" title=\"迭代器模式\"></a>迭代器模式</h4><p>1、 迭代器模式，在不需要了解内部实现的前提下，遍历一个聚合对象的内部元素。<br><br>2、 相比传统的编程模式，迭代器模式可以隐藏遍历元素的所需操作。<br></p>\n<h4 id=\"代理模式\"><a href=\"#代理模式\" class=\"headerlink\" title=\"代理模式\"></a>代理模式</h4><p>1、 在客户端与实体之间建立一个代理对象（proxy），客户端对实体进行的操作全部委派给代理对象，隐藏实体的具体实现细节。<br><br>2、 Proxy还可以与业务代码分离，部署到另外的服务器，业务代码中通过RPC来委派任务。</p>\n<h4 id=\"面向对象编程的基本原则：\"><a href=\"#面向对象编程的基本原则：\" class=\"headerlink\" title=\"面向对象编程的基本原则：\"></a>面向对象编程的基本原则：</h4><p>1、单一职责：一个类，只需要做好一件事，一个文件中最好只有一个类<br><br>2、开放封闭：一个类，应该是可扩展的，而不可修改的。<br><br>3、依赖倒置：一个类，不应该强依赖另一个类。每个类对于另外一个类都是可替换的。<br><br>4、配置化：尽可能地使用配置，而不是硬编码。<br><br>5、面向接口编程：只需要关心接口，不需要关心实现。<br></p>\n<h4 id=\"mvc结构\"><a href=\"#mvc结构\" class=\"headerlink\" title=\"mvc结构\"></a>mvc结构</h4><p>1、model：对数据库的操作<br><br>2、view：视图，例如模板文件<br><br>3、controller：逻辑层，实现业务逻辑部分<br></p>\n<h4 id=\"配置和设计模式\"><a href=\"#配置和设计模式\" class=\"headerlink\" title=\"配置和设计模式\"></a>配置和设计模式</h4><p>1、php中使用ArrayAccess实现配置文件的加载<br><br>2、在工厂方法中读取配置,生成可配置化对象<br><br>3、使用装饰模式实现权限验证,模板渲染,json串化<br><br>4、使用观察者模式实现数据跟新时间的一系列更新操作<br><br>5、使用代理模式实现数据库的主从自动切换<br></p>\n<h4 id=\"PHP魔术方法的使用：\"><a href=\"#PHP魔术方法的使用：\" class=\"headerlink\" title=\"PHP魔术方法的使用：\"></a>PHP魔术方法的使用：</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">__get/ __set   将对象的属性进行接管，访问/设置不存在的属性时</span><br><span class=\"line\">__call/ __callStatic   控制对象的方法调用，访问不存在的方法、静态方法时</span><br><span class=\"line\">__toString   将php对象转化为字符串</span><br><span class=\"line\">__invoke    将php对象当作一个函数来执行时会调用这个方法</span><br></pre></td></tr></table></figure>\n","tags":["php"]},{"title":"ssh免密码登录","url":"/2017/11/30/ssh%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/","content":"<p>ssh 无密码登录要使用公钥与私钥。linux下可以用用ssh-keygen生成公钥&#x2F;私钥对，下面我以CentOS为例。</p>\n<p>有机器A(192.168.3.7)，B(192.168.3.3)。现想A通过ssh免密码登录到B。</p>\n<span id=\"more\"></span>\n\n<p>1.在A机下生成公钥&#x2F;私钥对。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -P <span class=\"string\">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>-P表示密码，-P ‘’ 就表示空密码，也可以不用-P参数，这样就要三车回车，用-P就一次回车。<br>它在&#x2F;home&#x2F;root下生成.ssh目录，.ssh下有id_rsa和id_rsa.pub。</p>\n<p>2.把A机下的id_rsa.pub复制到B机下，在B机的.ssh&#x2F;authorized_keys文件里，我用scp复制。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">scp ~/.ssh/id_rsa.pub root@192.168.3.3:/home/root/id_rsa.pub</span><br><span class=\"line\">root@192.168.3.3<span class=\"string\">&#x27;s password:</span></span><br><span class=\"line\"><span class=\"string\">id_rsa.pub                                    100%  223     0.2KB/s   00:00</span></span><br></pre></td></tr></table></figure>\n\n<p>由于还没有免密码登录的，所以要输入密码。</p>\n<p>3.B机把从A机复制的id_rsa.pub添加到.ssh&#x2F;authorzied_keys 命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n<p>authorized_keys的权限要是600。</p>\n<p>4.A机登录B机。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh 192.168.3.3</span><br><span class=\"line\">The authenticity of host <span class=\"string\">&#x27;192.168.3.3 (192.168.3.3)&#x27;</span> can<span class=\"string\">&#x27;t be established.</span></span><br><span class=\"line\"><span class=\"string\">RSA key fingerprint is 00:a6:a8:87:eb:c7:40:10:39:cc:a0:eb:50:d9:6a:5b.</span></span><br><span class=\"line\"><span class=\"string\">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class=\"line\"><span class=\"string\">Warning: Permanently added &#x27;</span>192.168.3.3<span class=\"string\">&#x27; (RSA) to the list of known hosts.</span></span><br><span class=\"line\"><span class=\"string\">Last login: Thu Nov 30 21:03:18 2017 from root</span></span><br><span class=\"line\"><span class=\"string\">[root@B ~]$</span></span><br></pre></td></tr></table></figure>\n\n<p>第一次登录是时要你输入yes。</p>\n<p>现在A机可以无密码登录B机了。</p>\n<p>小结：登录的机子可有私钥，被登录的机子要有登录机子的公钥。这个公钥&#x2F;私钥对一般在私钥宿主机产生。上面是用rsa算法的公钥&#x2F;私钥对，当然也可以用dsa(对应的文件是id_dsa，id_dsa.pub)</p>\n<p>想让A，B机无密码互登录，那B机以上面同样的方式配置即可。</p>\n<p>转载自：<a href=\"http://chenlb.iteye.com/blog/211809\" target=\"_blank\">http://chenlb.iteye.com/blog/211809</a></p>\n","tags":["linux","ssh"]},{"title":"ssh远程登录命令简单实例","url":"/2017/12/03/ssh%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E5%91%BD%E4%BB%A4%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh命令用于远程登录上Linux主机。</span><br><span class=\"line\">常用格式：ssh [-l login_name] [-p port] [user@]hostname</span><br><span class=\"line\">更详细的可以用ssh -h查看。</span><br><span class=\"line\">举例</span><br><span class=\"line\">不指定用户：</span><br><span class=\"line\">ssh 192.168.0.11</span><br><span class=\"line\">指定用户：</span><br><span class=\"line\">ssh -l root 192.168.0.11</span><br><span class=\"line\">ssh root@192.168.0.11</span><br><span class=\"line\">如果修改过ssh登录端口的可以：</span><br><span class=\"line\">ssh -p 12333 192.168.0.11</span><br><span class=\"line\">ssh -l root -p 12333 216.230.230.114</span><br><span class=\"line\">ssh -p 12333 root@216.230.230.114</span><br><span class=\"line\">另外修改配置文件/etc/ssh/sshd_config，可以改ssh登录端口和禁止root登录。改端口可以防止被端口扫描。</span><br><span class=\"line\">编辑配置文件：</span><br><span class=\"line\">vim /etc/ssh/sshd_config</span><br><span class=\"line\">找到<span class=\"comment\">#Port 22，去掉注释，修改成一个五位的端口：</span></span><br><span class=\"line\">Port 12333</span><br><span class=\"line\">找到<span class=\"comment\">#PermitRootLogin yes，去掉注释，修改为：</span></span><br><span class=\"line\">PermitRootLogin no</span><br><span class=\"line\">重启sshd服务：</span><br><span class=\"line\">service sshd restart</span><br></pre></td></tr></table></figure>\n","tags":["ssh"]},{"title":"ss服务端安装libsodium支持chacha20","url":"/2017/12/03/ss%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85libsodium%E6%94%AF%E6%8C%81chacha20/","content":"<p>ss如果要使用 salsa20 或 chacha20 或 chacha20-ietf 算法，需要安装 libsodium ，否则就算在config.json里面设置成chacha20也会提示method not supported.</p>\n<p>centos：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y groupinstall <span class=\"string\">&quot;Development Tools&quot;</span></span><br><span class=\"line\">wget https://github.com/jedisct1/libsodium/releases/download/1.0.11/libsodium-1.0.11.tar.gztar xf libsodium-1.0.11.tar.gz &amp;&amp; <span class=\"built_in\">cd</span> libsodium-1.0.11./configure &amp;&amp; make -j2 &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">echo</span> /usr/local/lib &gt;/etc/ld.so.conf.d/usr_local_lib.confldconfig</span><br><span class=\"line\">ubuntu/debian：</span><br><span class=\"line\">apt-get install build-essential</span><br><span class=\"line\">wget https://github.com/jedisct1/libsodium/releases/download/1.0.11/libsodium-1.0.11.tar.gztar xf libsodium-1.0.11.tar.gz &amp;&amp; <span class=\"built_in\">cd</span> libsodium-1.0.11./configure &amp;&amp; make -j2 &amp;&amp; make installldconfig</span><br><span class=\"line\">如果曾经安装过旧版本，亦可重复用以上步骤更新到最新版，仅1.0.4或以上版本支持chacha20-ietf</span><br></pre></td></tr></table></figure>\n","tags":["ss"]},{"title":"surge脚本-【DSU】每日签到","url":"/2020/08/04/surge%E8%84%9A%E6%9C%AC-%E3%80%90DSU%E3%80%91%E6%AF%8F%E6%97%A5%E7%AD%BE%E5%88%B0/","content":"<h6 id=\"surge签到脚本\"><a href=\"#surge签到脚本\" class=\"headerlink\" title=\"surge签到脚本\"></a>surge签到脚本</h6><h6 id=\"代码github地址\"><a href=\"#代码github地址\" class=\"headerlink\" title=\"代码github地址\"></a>代码github地址</h6><p> <a  href=\"https://raw.githubusercontent.com/zhaoguibin/surge/master/script/RNB_daily_bonus.js\" target=\"_blank\">https://raw.githubusercontent.com/zhaoguibin/surge/master/script/RNB_daily_bonus.js</a></p>\n<span id=\"more\"></span>\n\n\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">/*************************</span></span><br><span class=\"line\"><span class=\"comment\"> [Script]</span></span><br><span class=\"line\"><span class=\"comment\"> mixrnb签到.js = type=cron,cronexp=35 8 * * *,wake-system=1,timeout=20,script-path=https://raw.githubusercontent.com/zhaoguibin/surge/master/script/RNB_daily_bonus.js</span></span><br><span class=\"line\"><span class=\"comment\"> 获取mixrnb的cookie = type=http-request,pattern=http:\\/\\/www.mixrnb.com\\/plugin\\.php\\?id=dsu_paulsign:sign,tag=获取mixrnb的cookie,script-path=https://raw.githubusercontent.com/zhaoguibin/surge/master/script/RNB_daily_bonus.js,script-update-interval=0</span></span><br><span class=\"line\"><span class=\"comment\"> 签到页面获取到cookie，http://www.mixrnb.com/plugin.php?id=dsu_paulsign:sign</span></span><br><span class=\"line\"><span class=\"comment\"> *************************/</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> error, response, body;</span><br><span class=\"line\"><span class=\"keyword\">var</span> set_cookies = <span class=\"keyword\">new</span> <span class=\"title class_\">Array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> isRequest = <span class=\"keyword\">typeof</span> $request != <span class=\"string\">&quot;undefined&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isRequest) &#123;</span><br><span class=\"line\">    $cookie = $request.<span class=\"property\">headers</span>.<span class=\"property\">Cookie</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> saltkey_regex = <span class=\"regexp\">/(R5nb_c8f5_saltkey=\\S*)/gm</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> auth_regex = <span class=\"regexp\">/(R5nb_c8f5_auth=(\\S*));/gm</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> R5nb_c8f5_saltkey = saltkey_regex.<span class=\"title function_\">exec</span>($cookie);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> R5nb_c8f5_auth = auth_regex.<span class=\"title function_\">exec</span>($cookie);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!R5nb_c8f5_saltkey) &#123;</span><br><span class=\"line\">        $notification.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;获取R5nb_c8f5_saltkey失败&#x27;</span>);</span><br><span class=\"line\">        $done();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!R5nb_c8f5_auth) &#123;</span><br><span class=\"line\">        $notification.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;获取R5nb_c8f5_auth失败&#x27;</span>);</span><br><span class=\"line\">        $done();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $persistentStore.<span class=\"title function_\">write</span>(R5nb_c8f5_saltkey[<span class=\"number\">1</span>], <span class=\"string\">&#x27;R5nb_c8f5_saltkey&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!$persistentStore.<span class=\"title function_\">read</span>(<span class=\"string\">&#x27;R5nb_c8f5_saltkey&#x27;</span>)) &#123;</span><br><span class=\"line\">        $notification.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;保存R5nb_c8f5_saltkey失败&#x27;</span>);</span><br><span class=\"line\">        $done();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $persistentStore.<span class=\"title function_\">write</span>(R5nb_c8f5_auth[<span class=\"number\">1</span>], <span class=\"string\">&#x27;R5nb_c8f5_auth&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!$persistentStore.<span class=\"title function_\">read</span>(<span class=\"string\">&#x27;R5nb_c8f5_auth&#x27;</span>)) &#123;</span><br><span class=\"line\">        $notification.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;保存R5nb_c8f5_auth失败&#x27;</span>);</span><br><span class=\"line\">        $done();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $notification.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;获取cookie成功，请禁用此脚本&#x27;</span>);</span><br><span class=\"line\">    $done();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Modified from yichahucha</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">gabeX</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">get</span> = (<span class=\"params\">options, callback</span>) =&gt; &#123;</span><br><span class=\"line\">        $httpClient.<span class=\"title function_\">get</span>(options, <span class=\"function\">(<span class=\"params\">error, response, body</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"title function_\">callback</span>(error, response, body)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">post</span> = (<span class=\"params\">options, callback</span>) =&gt; &#123;</span><br><span class=\"line\">        $httpClient.<span class=\"title function_\">post</span>(options, <span class=\"function\">(<span class=\"params\">error, response, body</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"title function_\">callback</span>(error, response, body)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">write</span> = (<span class=\"params\">value, key</span>) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $persistentStore.<span class=\"title function_\">write</span>(value, key)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">read</span> = (<span class=\"params\">key</span>) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> $persistentStore.<span class=\"title function_\">read</span>(key)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title function_\">notify</span> = (<span class=\"params\">title, subtitle, message</span>) =&gt; &#123;</span><br><span class=\"line\">        $notification.<span class=\"title function_\">post</span>(title, subtitle, message)</span><br><span class=\"line\">        $done();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        get,</span><br><span class=\"line\">        post,</span><br><span class=\"line\">        write,</span><br><span class=\"line\">        read,</span><br><span class=\"line\">        notify</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> $gabeX = <span class=\"title function_\">gabeX</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//cookie</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> R5nb_c8f5_auth = $persistentStore.<span class=\"title function_\">read</span>(<span class=\"string\">&#x27;R5nb_c8f5_auth&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> saltkey = $persistentStore.<span class=\"title function_\">read</span>(<span class=\"string\">&#x27;R5nb_c8f5_saltkey&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!saltkey) &#123;</span><br><span class=\"line\">    $gabeX.<span class=\"title function_\">notify</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;读取R5nb_c8f5_saltkey失败，请先访问个人空间【http://www.mixrnb.com/space-uid-*.html】获取&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!R5nb_c8f5_auth) &#123;</span><br><span class=\"line\">    $gabeX.<span class=\"title function_\">notify</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;读取R5nb_c8f5_auth失败，请先访问个人空间【http://www.mixrnb.com/space-uid-*.html】获取&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> options = &#123;</span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"string\">&quot;http://www.mixrnb.com/plugin.php?id=dsu_paulsign:sign&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">headers</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;Cookie&#x27;</span>: R5nb_c8f5_auth + <span class=\"string\">&#x27;;&#x27;</span> + saltkey,</span><br><span class=\"line\">        <span class=\"string\">&#x27;User-Agent&#x27;</span>: <span class=\"string\">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36 Edg/83.0.478.64&#x27;</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">body</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getSecuritySessionVerify</span>(<span class=\"params\">error, response, body</span>) &#123;</span><br><span class=\"line\">    set_cookie = response[<span class=\"string\">&#x27;headers&#x27;</span>][<span class=\"string\">&#x27;Set-Cookie&#x27;</span>];</span><br><span class=\"line\">    set_cookies = set_cookie.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;;&quot;</span>); <span class=\"comment\">//字符分割</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!set_cookies) &#123;</span><br><span class=\"line\">        $gabeX.<span class=\"title function_\">notify</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;获取SecuritySessionVerify失败&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    options.<span class=\"property\">headers</span>.<span class=\"property\">Cookie</span> += <span class=\"string\">&#x27;;&#x27;</span> + set_cookies[<span class=\"number\">0</span>];</span><br><span class=\"line\">    options.<span class=\"property\">url</span> += <span class=\"string\">&#x27;&amp;security_verify_data=313932302c31303830&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getSecuritySessionMidVerify</span>(<span class=\"params\">error, response, body</span>) &#123;</span><br><span class=\"line\">    set_cookie = response[<span class=\"string\">&#x27;headers&#x27;</span>][<span class=\"string\">&#x27;Set-Cookie&#x27;</span>];</span><br><span class=\"line\">    set_cookies = set_cookie.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;;&quot;</span>); <span class=\"comment\">//字符分割</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!set_cookies) &#123;</span><br><span class=\"line\">        $gabeX.<span class=\"title function_\">notify</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;获取SecuritySessionMidVerify失败&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    options.<span class=\"property\">headers</span>.<span class=\"property\">Cookie</span> += <span class=\"string\">&#x27;;&#x27;</span> + set_cookies[<span class=\"number\">0</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getFormHash</span>(<span class=\"params\">error, response, body</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> regex = <span class=\"regexp\">/^&lt;li&gt;&lt;a\\shref=\\&quot;member\\.php\\?mod=logging&amp;amp;action=logout&amp;amp;formhash=(\\w*)\\&quot;&gt;.*&lt;\\/a&gt;&lt;\\/li&gt;$/gmi</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> formhash = regex.<span class=\"title function_\">exec</span>(body)[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!formhash) &#123;</span><br><span class=\"line\">        $gabeX.<span class=\"title function_\">notify</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;获取formhash失败&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    options.<span class=\"property\">url</span> = <span class=\"string\">&#x27;http://www.mixrnb.com/plugin.php?id=dsu_paulsign:sign&amp;operation=qiandao&amp;infloat=1&amp;inajax=1&#x27;</span>;</span><br><span class=\"line\">    options.<span class=\"property\">body</span> = <span class=\"string\">&#x27;formhash=&#x27;</span> + formhash + <span class=\"string\">&#x27;&amp;qdxq=kx&#x27;</span></span><br><span class=\"line\">    options[<span class=\"string\">&#x27;headers&#x27;</span>][<span class=\"string\">&#x27;Content-Type&#x27;</span>] = <span class=\"string\">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">decodeXml</span>(<span class=\"params\">error, response, body</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//查看是否登录过期或者没登录</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> message = <span class=\"string\">&#x27;签到出错，请查看日志&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (body.<span class=\"title function_\">match</span>(<span class=\"string\">&#x27;ÄúÐèÒªÏÈµÇÂ¼²ÅÄÜ¼ÌÐø±¾²Ù×÷&#x27;</span>)) &#123;</span><br><span class=\"line\">        message = <span class=\"string\">&#x27;未登录或者cookie失效，请重新获取cookie&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (body.<span class=\"title function_\">match</span>(<span class=\"string\">&#x27;¹§Ï²ÄãÇ©µ½³É¹¦!&#x27;</span>)) &#123;</span><br><span class=\"line\">        message = <span class=\"string\">&#x27;恭喜你签到成功!&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (body.<span class=\"title function_\">match</span>(<span class=\"string\">&#x27;Äú½ñÈÕÒÑ¾­Ç©µ½£¬ÇëÃ÷ÌìÔÙÀ´£¡ &#x27;</span>)) &#123;</span><br><span class=\"line\">        message = <span class=\"string\">&#x27;您今日已经签到，请明天再来！&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(body);</span><br><span class=\"line\">    $gabeX.<span class=\"title function_\">notify</span>(<span class=\"string\">&#x27;mixrnb签到提醒&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, message);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">$gabeX.<span class=\"title function_\">get</span>(options, getSecuritySessionVerify);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    $gabeX.<span class=\"title function_\">get</span>(options, getSecuritySessionMidVerify);</span><br><span class=\"line\">&#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    $gabeX.<span class=\"title function_\">get</span>(options, getFormHash);</span><br><span class=\"line\">&#125;, <span class=\"number\">2000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    $gabeX.<span class=\"title function_\">post</span>(options, decodeXml);</span><br><span class=\"line\">&#125;, <span class=\"number\">3500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$done();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","tags":["surge"]},{"title":"ubuntu修改su密码","url":"/2017/12/02/ubuntu%E4%BF%AE%E6%94%B9su%E5%AF%86%E7%A0%81/","content":"<p>非常简单，下面是设置的方法：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">gabe@gabe-TM-1613:~$ sudo passwd</span><br><span class=\"line\">Password: &lt;--- sudo的密码</span><br><span class=\"line\">Enter new UNIX password: &lt;--- 新的Root用户密码</span><br><span class=\"line\">Retype new UNIX password: &lt;--- 重复新的Root用户密码</span><br><span class=\"line\">passwd</span><br></pre></td></tr></table></figure>\n","tags":["ubuntu"]},{"title":"ubuntu配置全局代理","url":"/2017/12/02/ubuntu%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80%E4%BB%A3%E7%90%86/","content":"<p><strong>PS:使用 polipo 前需要先安装 shadowsocks</strong></p>\n<p>启动shawdowsocks服务后，发现并不能翻墙上网，这是因为shawdowsocks是socks 5代理，需要客户端配合才能翻墙。</p>\n<p>为了让整个系统都走shawdowsocks通道，需要配置全局代理，可以通过polipo实现。</p>\n<p>首先是安装polipo：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo apt-get install polipo</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>接着修改polipo的配置文件&#x2F;etc&#x2F;polipo&#x2F;config：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">logSyslog = <span class=\"literal\">true</span></span><br><span class=\"line\">logFile = /var/log/polipo/polipo.log</span><br><span class=\"line\">proxyAddress = <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\">socksParentProxy = <span class=\"string\">&quot;127.0.0.1:1080&quot;</span></span><br><span class=\"line\">socksProxyType = socks5</span><br><span class=\"line\">chunkHighMark = 50331648</span><br><span class=\"line\">objectHighMark = 16384</span><br><span class=\"line\">serverMaxSlots = 64</span><br><span class=\"line\">serverSlots = 16</span><br><span class=\"line\">serverSlots1 = 32</span><br></pre></td></tr></table></figure>\n<p>重启polipo服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo /etc/init.d/polipo restart</span><br></pre></td></tr></table></figure>\n<p>为终端配置http代理：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=<span class=\"string\">&quot;http://127.0.0.1:8123/&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> https_proxy=<span class=\"string\">&quot;http://127.0.0.1:8123/&quot;</span></span><br></pre></td></tr></table></figure>\n<p>接着测试下能否翻墙：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ping www.google.com</span><br></pre></td></tr></table></figure>\n<p>如果有响应，则全局代理配置成功。</p>\n<p>注意事项</p>\n<p>服务器重启后，下面两句需要重新执行：</p>\n<p>shawdowsocks启动，然后</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=<span class=\"string\">&quot;http://127.0.0.1:8123/&quot;</span></span><br></pre></td></tr></table></figure>\n","tags":["ubuntu"]},{"title":"vboxadd.sh failed modprobe vboxguest failed.","url":"/2018/02/09/vboxadd.sh%20failed%20modprobe%20vboxguest%20failed./","content":"<p>virtualbox安装增强功能报错：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vboxadd.sh failed modprobe vboxguest failed.</span><br></pre></td></tr></table></figure>\n\n\n<p>解决方法：<br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install dkms binutils gcc make patch libgomp glibc-headers glibc-devel kernel-headers</span><br></pre></td></tr></table></figure>\n\n<p>then</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install kernel-devel</span><br></pre></td></tr></table></figure>\n<p>or</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install kernel-PAE-devel</span><br></pre></td></tr></table></figure>\n<p>Then</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">re-run VBoxLinuxAdditions.run.</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"vim使用","url":"/2017/12/02/vim%E4%BD%BF%E7%94%A8/","content":"<p>vim三种模式：命令模式、插入模式、编辑模式。使用ESC或i或：来切换模式。</p>\n<p>命令模式下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">:q             退出</span><br><span class=\"line\">:q!            强制退出</span><br><span class=\"line\">:wq            保存并退出</span><br><span class=\"line\">:<span class=\"built_in\">set</span> number    显示行号</span><br><span class=\"line\">:<span class=\"built_in\">set</span> nonumber  隐藏行号</span><br><span class=\"line\">/apache        在文档中查找apache 按n跳到下一个，<span class=\"built_in\">shift</span>+n上一个</span><br><span class=\"line\">yyp            复制光标所在行，并粘贴</span><br><span class=\"line\">h(左移一个字符←)、j(下一行↓)、k(上一行↑)、l(右移一个字符→)</span><br><span class=\"line\"></span><br><span class=\"line\">1、复制</span><br><span class=\"line\">1）单行复制</span><br><span class=\"line\">在命令模式下，将光标移动到将要复制的行处，按“yy”进行复制；</span><br><span class=\"line\">2）多行复制</span><br><span class=\"line\">在命令模式下，将光标移动到将要复制的首行处，按“nyy”复制n行；其中n为1、2、3……</span><br><span class=\"line\">2、粘贴</span><br><span class=\"line\">在命令模式下，将光标移动到将要粘贴的行处，按“p”进行粘贴</span><br></pre></td></tr></table></figure>\n","tags":["linux","vim"]},{"title":"virtualbox下centos挂载共享文件夹","url":"/2017/12/02/virtualbox%E4%B8%8Bcentos%E6%8C%82%E8%BD%BD%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/","content":"<p><strong>PS:要挂载共享文件，需要安装virtualbox增强功能(增强包)</strong><br><br>安装virtualbox增强功能(增强包)：<a href=\"http://zhaoguibin.me/2017/12/02/%E5%9C%A8linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD(%E5%A2%9E%E5%BC%BA%E5%8C%85)%E7%9A%84%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/\" target=\"_blank\">安装virtualbox增强功能(增强包)</a></p>\n<p>设备—&gt;共享文件夹<br>宿主机 共享路径:E:\\project, 共享文件夹名称project</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /mnt/share    //新建挂载点（mountpoint）</span><br><span class=\"line\">mount -t vboxsf project  /mnt/share   // 挂载共享文件夹</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /mnt/share    进入共享文件夹</span><br></pre></td></tr></table></figure>\n<p>OK<br>实现 开机挂载:</p>\n<p>vi ~&#x2F;.bashrc<br>在最后添加</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mount -t vboxsf sharing /mnt/share    挂载共享文件夹</span><br></pre></td></tr></table></figure>\n","tags":["linux","virtualbox"]},{"title":"virtualbox安装增强功能报错","url":"/2019/03/02/virtualbox%E5%AE%89%E8%A3%85%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD%E6%8A%A5%E9%94%99/","content":"<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/f159aafdab4237ce348344391f108d0f2261c299/VirtualBox%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9%E6%9C%AA%E8%83%BD%E5%8A%A0%E8%BD%BD%E8%99%9A%E6%8B%9F%E5%85%89%E7%9B%98.png\" alt=\"报错信息\"></p>\n<span id=\"more\"></span>\n\n<h6 id=\"在virtualbox安装目录找到VBoxGuestAdditions-iso复制到虚拟机里面，可以放到任意一个目录\"><a href=\"#在virtualbox安装目录找到VBoxGuestAdditions-iso复制到虚拟机里面，可以放到任意一个目录\" class=\"headerlink\" title=\"在virtualbox安装目录找到VBoxGuestAdditions.iso复制到虚拟机里面，可以放到任意一个目录\"></a>在virtualbox安装目录找到VBoxGuestAdditions.iso复制到虚拟机里面，可以放到任意一个目录</h6><h6 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> /media/GuestAdditionsISO</span><br><span class=\"line\"></span><br><span class=\"line\">sudo mount -o loop VBoxGuestAdditions.iso所在目录/VBoxGuestAdditions.iso /media/GuestAdditionsISO</span><br></pre></td></tr></table></figure>\n<h6 id=\"这时候你会看到一条信息，the-ISO-has-been-mounted-as-READ-ONLY\"><a href=\"#这时候你会看到一条信息，the-ISO-has-been-mounted-as-READ-ONLY\" class=\"headerlink\" title=\"这时候你会看到一条信息，the ISO has been mounted as READ-ONLY\"></a>这时候你会看到一条信息，the ISO has been mounted as READ-ONLY</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /media/GuestAdditionsISO</span><br><span class=\"line\">./VBoxLinuxAdditions.run</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"搞定\"><a href=\"#搞定\" class=\"headerlink\" title=\"搞定\"></a>搞定</h6><p><a href=\"https://askubuntu.com/questions/321589/unable-to-mount-the-cd-dvd-image-on-the-machine-sandbox\" target=\"_blank\">愿答案</a> </p>\n","tags":["linux","virtualbox"]},{"title":"windows下用navicat远程链接虚拟机Linux下MySQL数据库","url":"/2017/12/03/windows%E4%B8%8B%E7%94%A8navicat%E8%BF%9C%E7%A8%8B%E9%93%BE%E6%8E%A5%E8%99%9A%E6%8B%9F%E6%9C%BALinux%E4%B8%8BMySQL%E6%95%B0%E6%8D%AE%E5%BA%93/","content":"<p>手动增加可以远程访问数据库的用户。</p>\n<p>　　方法一、本地登入mysql，更改 “mysql” 数据库里的 “user” 表里的 “host” 项，将”localhost”改为”%”</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>proot</span><br><span class=\"line\">　　mysql<span class=\"operator\">&gt;</span>use mysql;</span><br><span class=\"line\">　　mysql<span class=\"operator\">&gt;</span><span class=\"keyword\">update</span> <span class=\"keyword\">user</span> <span class=\"keyword\">set</span> host <span class=\"operator\">=</span> <span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">where</span> <span class=\"keyword\">user</span> <span class=\"operator\">=</span> <span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\">　　mysql<span class=\"operator\">&gt;</span>flush privileges;</span><br><span class=\"line\">　　mysql<span class=\"operator\">&gt;</span><span class=\"keyword\">select</span> host, <span class=\"keyword\">user</span> <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br></pre></td></tr></table></figure>\n<p>方法二、直接授权(推荐)</p>\n<p>　　从任何主机上使用root用户，密码：youpassword（你的root密码）连接到mysql服务器：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>proot</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span><span class=\"keyword\">GRANT</span> <span class=\"keyword\">ALL</span> PRIVILEGES <span class=\"keyword\">ON</span> <span class=\"operator\">*</span>.<span class=\"operator\">*</span> <span class=\"keyword\">TO</span> <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> IDENTIFIED <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;youpassword&#x27;</span> <span class=\"keyword\">WITH</span> <span class=\"keyword\">GRANT</span> OPTION;</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span>flush privileges;</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"yum  update和yum  upgrade区别","url":"/2018/05/01/yum%20%20update%E5%92%8Cyum%20%20upgrade%E5%8C%BA%E5%88%AB/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y update</span><br><span class=\"line\"><span class=\"comment\">#升级所有包同时也升级软件和系统内核</span></span><br><span class=\"line\"></span><br><span class=\"line\">yum -y upgrade</span><br><span class=\"line\"><span class=\"comment\">#只升级所有包，不升级软件和系统内核</span></span><br></pre></td></tr></table></figure>\n","tags":["centos"]},{"title":"yum 安装报 关于Public key for .rpm is not installed 的解决方法","url":"/2017/12/02/yum%20%E5%AE%89%E8%A3%85%E6%8A%A5%20%E5%85%B3%E4%BA%8EPublic%20key%20for%20.rpm%20is%20not%20installed%20%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/","content":"<p>此时要导入rpm的签名信息即可</p>\n<p>以root登录，执行下面命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span><br></pre></td></tr></table></figure>\n\n<p>根据我的Linux版本是CentOS 7</p>\n<p>于是我执行下面命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>\n","tags":["yum"]},{"title":"yum-y-install与yum-install有什么不同","url":"/2017/12/03/yum-y-install%E4%B8%8Eyum-install%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install 包名（支持*） ：自动选择y，全自动</span><br><span class=\"line\">yum install 包名（支持*） ：手动选择y or n</span><br><span class=\"line\">yum remove 包名（不支持*）</span><br><span class=\"line\">rpm -ivh 包名（支持*）：安装rpm包</span><br><span class=\"line\">rpm -e 包名（不支持*）：卸载rpm包</span><br></pre></td></tr></table></figure>\n","tags":["centos","linux"]},{"title":"虚拟机克隆centos出现“Device eth0 does not seem to be present”解决办法","url":"/2018/01/05/%E2%80%9CDevice%20eth0%20does%20not%20seem%20to%20be%20present%E2%80%9D%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/","content":"<p>在virtualBox中克隆出新的CentOS虚拟机时，出现如下问题：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">service network restart</span><br><span class=\"line\">Shutting down loopback insterface: [ OK ]</span><br><span class=\"line\">Bringing up loopback insterface: [ OK ]</span><br><span class=\"line\">Bringing up interface eth0: Device eth0 does not seem to be present,delaying initialization. [FAILED]</span><br></pre></td></tr></table></figure>\n\n<p>用ifconfig查看发现缺少eth0，只有lo；用ifconfig -a查看发现多出了eth1的信息。</p>\n<span id=\"more\"></span>\n\n<p>解决办法1：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mv</span> /etc/sysconfig/network-scripts/ifcfg-eth0  /etcsysconfig/network-scripts/ifcfg-eth1</span><br></pre></td></tr></table></figure>\n<p>将eth0的mac地址改为eth1的mac地址，同时改变其DEVICE名称为eth1，再重启网络即可。</p>\n<p>解决办法2：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">rm</span> -rf /etc/udev/rules.d/70-persistent-net.rules</span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n\n<p>总之，只要保证&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0 与&#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;70-persistent-net.rules的信息一致即可，即网卡地址与网卡编号一致，这样service network restart 就可以配置成功。</p>\n"},{"title":"主从复制时报错：ERROR-1794-HY000-Slave……","url":"/2017/12/02/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9AERROR-1794-HY000-Slave/","content":"<p>centos 6.5</p>\n<p>mysql5.7</p>\n<p>在从库作stop slave时报：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">error:</span><br><span class=\"line\">ERROR 1794 (HY000): Slave is not configured or failed to initialize properly. You must at least <span class=\"built_in\">set</span> --server-id to <span class=\"built_in\">enable</span> either a master or a slave. Additional error messages can be found <span class=\"keyword\">in</span> the MySQL error <span class=\"built_in\">log</span>.</span><br></pre></td></tr></table></figure>\n<p>经分析，需要：</p>\n<p>删除5张表，并重新导入脚本</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">use mysql</span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> slave_master_info;</span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> slave_relay_log_info;</span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> slave_worker_info;</span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> innodb_index_stats;</span><br><span class=\"line\"><span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> innodb_table_stats;</span><br><span class=\"line\">source <span class=\"operator\">/</span>usr<span class=\"operator\">/</span>coolpad<span class=\"operator\">/</span>mysql<span class=\"operator\">/</span>share<span class=\"operator\">/</span>mysql_system_tables.sql</span><br></pre></td></tr></table></figure>\n<p>(2)重新启动数据库</p>\n<p>注：这一步是必须的，否则无法正常配置双主架构。</p>\n","tags":["linux","mysql"]},{"title":"使用crontab，让linux定时执行shell脚本","url":"/2017/12/03/%E4%BD%BF%E7%94%A8crontab%EF%BC%8C%E8%AE%A9linux%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8Cshell%E8%84%9A%E6%9C%AC/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">使用crontab你可以在指定的时间执行一个shell脚本或者一系列Linux命令。例如系统管理员安排一个备份任务使其每天都运行</span><br><span class=\"line\">入门</span><br><span class=\"line\">crontab –e</span><br><span class=\"line\">这样可以已编辑模式打开个人的crontab配置文件，然后加入一下这行：</span><br><span class=\"line\">0 0 * * * /home/linrui/XXXXXXXX.sh</span><br><span class=\"line\">这将会在每天凌晨运行 指定的.sh文件</span><br><span class=\"line\">Cron 各项的描述</span><br><span class=\"line\">以下是 crontab 文件的格式：</span><br><span class=\"line\">&#123;minute&#125; &#123;hour&#125; &#123;day-of-month&#125; &#123;month&#125; &#123;day-of-week&#125; &#123;full-path-to-shell-script&#125;</span><br><span class=\"line\">o minute: 区间为 0 – 59</span><br><span class=\"line\">o hour: 区间为0 – 23</span><br><span class=\"line\">o day-of-month: 区间为0 – 31</span><br><span class=\"line\">o month: 区间为1 – 12. 1 是1月. 12是12月.</span><br><span class=\"line\">o Day-of-week: 区间为0 – 7. 周日可以是0或7.</span><br><span class=\"line\">Crontab 示例</span><br><span class=\"line\">1、在 凌晨00:01运行</span><br><span class=\"line\">1 0 * * * /home/linrui/XXXX.sh</span><br><span class=\"line\">2、每个工作日23:59都进行备份作业。</span><br><span class=\"line\">59 11 * * 1,2,3,4,5 /home/linrui/XXXX.sh</span><br><span class=\"line\">或者如下写法：</span><br><span class=\"line\">59 11 * * 1-5 /home/linrui/XXXX.sh</span><br><span class=\"line\">3、每分钟运行一次命令</span><br><span class=\"line\">*/1 * * * * /home/linrui/XXXX.sh</span><br><span class=\"line\">4、每个月的1号 14:10 运行</span><br><span class=\"line\">10 14 1 * * /home/linrui/XXXX.sh</span><br><span class=\"line\">Crontab命令的选项</span><br><span class=\"line\">以下是 crontab 的有效选项:</span><br><span class=\"line\">crontab –e : 修改 crontab 文件. 如果文件不存在会自动创建。</span><br><span class=\"line\">crontab –l : 显示 crontab 文件。</span><br><span class=\"line\">crontab -r : 删除 crontab 文件。</span><br><span class=\"line\">crontab -ir : 删除 crontab 文件前提醒用户。</span><br></pre></td></tr></table></figure>\n","tags":["linux","crontab"]},{"title":"使用firewalld打开关闭防火墙与端口","url":"/2017/12/02/%E4%BD%BF%E7%94%A8firewalld%E6%89%93%E5%BC%80%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E4%B8%8E%E7%AB%AF%E5%8F%A3/","content":"<p>1、firewalld的基本使用</p>\n<p>启动： systemctl start firewalld</p>\n<p>查看状态： systemctl status firewalld</p>\n<p>停止： systemctl disable firewalld</p>\n<p>禁用： systemctl stop firewalld</p>\n<span id=\"more\"></span>\n\n<p>2.systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。</p>\n<p>启动一个服务：systemctl start firewalld.service</p>\n<p>关闭一个服务：systemctl stop firewalld.service</p>\n<p>重启一个服务：systemctl restart firewalld.service</p>\n<p>显示一个服务的状态：systemctl status firewalld.service</p>\n<p>在开机时启用一个服务：systemctl enable firewalld.service</p>\n<p>在开机时禁用一个服务：systemctl disable firewalld.service</p>\n<p>查看服务是否开机启动：systemctl is-enabled firewalld.service</p>\n<p>查看已启动的服务列表：systemctl list-unit-files|grep enabled</p>\n<p>查看启动失败的服务列表：systemctl –failed</p>\n<p>3.配置firewalld-cmd</p>\n<p>查看版本： firewall-cmd –version</p>\n<p>查看帮助： firewall-cmd –help</p>\n<p>显示状态： firewall-cmd –state</p>\n<p>查看所有打开的端口： firewall-cmd –zone&#x3D;public –list-ports</p>\n<p>更新防火墙规则： firewall-cmd –reload</p>\n<p>查看区域信息: firewall-cmd –get-active-zones</p>\n<p>查看指定接口所属区域： firewall-cmd –get-zone-of-interface&#x3D;eth0</p>\n<p>拒绝所有包：firewall-cmd –panic-on</p>\n<p>取消拒绝状态： firewall-cmd –panic-off</p>\n<p>查看是否拒绝： firewall-cmd –query-panic</p>\n<p>那怎么开启一个端口呢</p>\n<p>添加 firewall-cmd –zone&#x3D;public –add-port&#x3D;80&#x2F;tcp –permanent （–permanent永久生效，没有此参数重启后失效）</p>\n<p>重新载入 firewall-cmd –reload</p>\n<p>查看 firewall-cmd –zone&#x3D; public –query-port&#x3D;80&#x2F;tcp</p>\n<p>删除 firewall-cmd –zone&#x3D; public –remove-port&#x3D;80&#x2F;tcp –permanent</p>\n","tags":["linux","firewalld"]},{"title":"卸载SQL Server 2017 出现警告26003","url":"/2018/07/21/%E5%8D%B8%E8%BD%BDSQL%20Server%202017%20%E5%87%BA%E7%8E%B0%E8%AD%A6%E5%91%8A26003/","content":"<p>卸载SQLserver出现以下问题，把解决方法记录下来，留着以后备用<br>提示信息：<br><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/%E5%8D%B8%E8%BD%BDSQL%20Server%202017%20%E5%87%BA%E7%8E%B0%E8%AD%A6%E5%91%8A26003.png\" alt=\"设置共享文件夹\"></p>\n<p>解决方法：</p>\n<p>可以使用：WMIC（windows Management Instrumentation Command-line） 列出当前系统上安装的应用程序，最后使用MSIEXEC  &#x2F;X 将其卸载</p>\n<p>打开 CMD(命令提示符)<br>输入命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">WMIC</span><br><span class=\"line\">Product  list</span><br><span class=\"line\">msiexec /x &#123;IdentifyingNumbe&#125;</span><br></pre></td></tr></table></figure>\n\n\n","tags":["SQLserver"]},{"title":"在linux系统中安装virtualbox增强功能(增强包)的详细步骤","url":"/2017/12/02/%E5%9C%A8linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD(%E5%A2%9E%E5%BC%BA%E5%8C%85)%E7%9A%84%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/","content":"<p>设置共享文件路径</p>\n<p>点击虚拟机 设置–&gt;选择 共享文件夹</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD1.png\" alt=\"设置共享文件夹\"></p>\n<span id=\"more\"></span>\n\n<p>（图1 设置共享文件夹）</p>\n<p>设置共享文件夹路径</p>\n<p>1 选择路径</p>\n<p>2 填写自定义的共享名称（在后面需要与挂载路径相对应）</p>\n<p>3 设置自动挂载&#x2F;固定分配</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD2.png\" alt=\"设置共享文件路径属性\"></p>\n<p>（图2 设置共享文件路径属性）</p>\n<p>安装VirtualBox增强工具</p>\n<p>先安装必备的包</p>\n<p>执行下面的命令:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y gcc gcc-devel gcc-c++ gcc-c++-devel make kernel kernel-devel</span><br></pre></td></tr></table></figure>\n<p>安装完后，重启虚拟机：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">shutdown -r now</span><br></pre></td></tr></table></figure>\n<p>安装virtualBox增强工具</p>\n<p>点击 设置–&gt;点击 安装增强功能…</p>\n<p>点击菜单栏 设备 –&gt; 分配光驱 –&gt; 选择一个虚拟光盘，找到VirtualBox安装目录下的VBoxGuestAdditions.iso，加载此镜像。<br>启动Linux系统并用root身份登入系统<br>执行挂载命令，将虚拟光盘挂在到 &#x2F;mnt&#x2F;cdrom，如果没有cdrom目录，则先创建之。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /mnt/cdrom</span><br><span class=\"line\">mount -t auto  /dev/cdrom /mnt/cdrom</span><br></pre></td></tr></table></figure>\n<p>复制脚本到&#x2F;tmp目录下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /mnt/cdrom</span><br><span class=\"line\"><span class=\"built_in\">cp</span> VBoxLinuxAdditions.run /tmp</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /tmp</span><br><span class=\"line\">./VBoxLinuxAddtion.run</span><br></pre></td></tr></table></figure>\n<p>得到输出内容</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD3.png\" alt=\"无界面版安装完成显示信息\"></p>\n<p>如果centos是server版本的话就显示</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD4.png\" alt=\"如果centos是server版本的话就显示\"></p>\n<p>即安装成功！</p>\n<p>挂载共享文件夹</p>\n<p>切换到root用户输入挂载命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo mount -t vboxsf shared_file /home/xingoo/shared</span><br></pre></td></tr></table></figure>\n<p>注意格式为</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo mount -t vboxsf 共享文件夹名称（在设置页面设置的） 挂载的目录</span><br></pre></td></tr></table></figure>\n<p>然后进入&#x2F;home&#x2F;xingoo&#x2F;shared，就可以看到windows中的文件了</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD5.png\" alt=\"共享文件夹\"></p>\n<p>windows中的文件</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/virtualbox%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD6.png\" alt=\"共享文件夹\"></p>\n","tags":["linux","virtualbox"]},{"title":"在安装mysqli的时候，出现error-ext-mysqlnd-mysql-float-to-double-h-No-such-file-or-directory","url":"/2017/12/03/%E5%9C%A8%E5%AE%89%E8%A3%85mysqli%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%87%BA%E7%8E%B0error-ext-mysqlnd-mysql-float-to-double-h-No-such-file-or-directory/","content":"<p>直接修改源码，把找不到的那个头文件的路径修改为绝对路径，编译通过了，也能正常使用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">pwd</span></span><br><span class=\"line\">/home/neo/tools/php-5.5.28/ext/mysqli</span><br><span class=\"line\">vim mysqli_api.c</span><br><span class=\"line\">把第36行的</span><br><span class=\"line\"><span class=\"comment\">#include &quot;ext/mysqlnd/mysql_float_to_double.h&quot;</span></span><br><span class=\"line\">修改为</span><br><span class=\"line\"><span class=\"comment\">#include &quot;/home/neo/tools/php-5.5.28/ext/mysqlnd/mysql_float_to_double.h&quot;</span></span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"将Ubuntu主文件夹里的中文文件夹名称改成英文","url":"/2017/12/02/%E5%B0%86Ubuntu%E4%B8%BB%E6%96%87%E4%BB%B6%E5%A4%B9%E9%87%8C%E7%9A%84%E4%B8%AD%E6%96%87%E6%96%87%E4%BB%B6%E5%A4%B9%E5%90%8D%E7%A7%B0%E6%94%B9%E6%88%90%E8%8B%B1%E6%96%87/","content":"<p>Ubuntu中文版本把用户主目录下的文件夹名称都默认设置成了中文（home文件里用户目录的“桌面”、“图片”、“视频”、“音乐”……都是中文的），这其实对于英文不太好才选择中文版本的Ubuntu系统也未必是一件好事，当在各个路径跳转的时候必须得使用中英文切换，感觉很复杂，所以这些默认文件夹名称还是英文的比较好。下面是将中文名称调整为英文的方法。</p>\n<p>第一种调整方法</p>\n<p>首先打开终端，在终端中输入命令:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> LANG=en_US</span><br><span class=\"line\">xdg-user-dirs-gtk-update</span><br></pre></td></tr></table></figure>\n<p>然后会跳出对话框询问是否将目录转化为英文路径,同意并关闭.</p>\n<p>在终端中输入命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> LANG=zh_CN</span><br></pre></td></tr></table></figure>\n<p>最后关闭终端,并重起系统.下次再进入系统时，会提示是否把转化好的目录改回中文.选择不再提示,并取消修改.主目录的中文转英文就完成了。</p>\n<span id=\"more\"></span>\n\n<p>第二种调整方法</p>\n<p>首先通过可视化界面修改现有主文件夹下各文件夹名称（就是右键重命名）：<br>Desktop、 Download、Documents、 Pictures、 Videos 、 Music、 Templates、Public ……</p>\n<p>然后修改配置文件（采用vi或者gedit都可以，此处以gedit为例）：</p>\n<p>打开一个终端输入命令打开配置文件编辑器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim ~/.config/user-dirs.dirs</span><br></pre></td></tr></table></figure>\n<p>把文件夹指向改掉，等号右边引号中即为指向，调整为刚才通过重命名所更改的文件名</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">XDG_DESKTOP_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Desktop&quot;</span></span><br><span class=\"line\">XDG_DOWNLOAD_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Download&quot;</span></span><br><span class=\"line\">XDG_TEMPLATES_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Templates&quot;</span></span><br><span class=\"line\">XDG_DOCUMENTS_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Documents&quot;</span></span><br><span class=\"line\">XDG_MUSIC_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Music&quot;</span></span><br><span class=\"line\">XDG_PICTURES_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Pictures&quot;</span></span><br><span class=\"line\">XDG_VIDEOS_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Videos&quot;</span></span><br><span class=\"line\">XDG_PUBLICSHARE_DIR=<span class=\"string\">&quot;<span class=\"variable\">$HOME</span>/Public&quot;</span></span><br></pre></td></tr></table></figure>\n<p>调整完之后，Ubuntu主目录下文件夹中文名称改为英文就调整好了。</p>\n","tags":["ubuntu"]},{"title":"多维数组拼接成字符串","url":"/2020/08/22/%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84%E6%8B%BC%E6%8E%A5%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2/","content":"<h6 id=\"多维数组拼接成字符串\"><a href=\"#多维数组拼接成字符串\" class=\"headerlink\" title=\"多维数组拼接成字符串\"></a>多维数组拼接成字符串</h6><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@FuncName</span>:arrayToString</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span> 数组拼接成字符串</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2020-08-14 9:17</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> $data</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> string $keys</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> string $key_1 //多维数组主key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> string $string</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arrayToString</span>(<span class=\"params\"><span class=\"variable\">$data</span>, <span class=\"variable\">$keys</span> = <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$string</span> = <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$key_1</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$temp</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$value</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$key</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$key_1</span> = <span class=\"variable\">$key</span>;</span><br><span class=\"line\">                <span class=\"variable\">$string</span> .= <span class=\"variable\">$key_1</span> . <span class=\"string\">&#x27;=&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"variable\">$string</span> .= <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">arrayToString</span>(<span class=\"variable\">$value</span>, <span class=\"variable\">$key</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$key_1</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$keys</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$key</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"variable\">$temp</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"variable\">$string</span> .= <span class=\"variable\">$keys</span> . <span class=\"string\">&#x27;=&#x27;</span> . <span class=\"variable\">$value</span>;</span><br><span class=\"line\">                        <span class=\"variable\">$temp</span>++;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"variable\">$string</span> .= <span class=\"string\">&#x27;&amp;&#x27;</span> . <span class=\"variable\">$value</span> . <span class=\"string\">&#x27;&amp;&#x27;</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"variable\">$temp</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$keys</span>)) &#123;</span><br><span class=\"line\">                            <span class=\"variable\">$string</span> .= <span class=\"variable\">$keys</span> . <span class=\"string\">&#x27;=&#x27;</span> . <span class=\"variable\">$key</span> . <span class=\"string\">&#x27;=&#x27;</span> . <span class=\"variable\">$value</span> . <span class=\"string\">&#x27;&amp;&#x27;</span>;</span><br><span class=\"line\">                            <span class=\"variable\">$temp</span>++;</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"variable\">$string</span> .= <span class=\"variable\">$key</span> . <span class=\"string\">&#x27;=&#x27;</span> . <span class=\"variable\">$value</span> . <span class=\"string\">&#x27;&amp;&#x27;</span>;</span><br><span class=\"line\">                            <span class=\"variable\">$temp</span>++;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"variable\">$string</span> .= <span class=\"variable\">$key</span> . <span class=\"string\">&#x27;=&#x27;</span> . <span class=\"variable\">$value</span> . <span class=\"string\">&#x27;&amp;&#x27;</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable\">$string</span> .= <span class=\"variable\">$key</span> . <span class=\"string\">&#x27;=&#x27;</span> . <span class=\"variable\">$value</span> . <span class=\"string\">&#x27;&amp;&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$string</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","tags":["php"]},{"title":"数组按照alphabet序排序","url":"/2020/08/22/%E6%95%B0%E7%BB%84key%E6%8C%89%E7%85%A7alphabet%E5%BA%8F%E6%8E%92%E5%BA%8F/","content":"<h6 id=\"数组key按照alphabet序排序\"><a href=\"#数组key按照alphabet序排序\" class=\"headerlink\" title=\"数组key按照alphabet序排序\"></a>数组key按照alphabet序排序</h6><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@FuncName</span>:arraySoft</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Description</span> 数组key按照alphabet序排序</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@User</span> ZHaoGuiBin</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2020-08-13 15:45</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> $data</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> mixed</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arraySoft</span>(<span class=\"params\"><span class=\"variable\">$data</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">ksort</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$data</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">is_array</span>(<span class=\"variable\">$value</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$data</span>[<span class=\"variable\">$key</span>] = <span class=\"built_in\">self</span>::<span class=\"title function_ invoke__\">arraySoft</span>(<span class=\"variable\">$value</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$data</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","tags":["php"]},{"title":"安装golang","url":"/2017/12/02/%E5%AE%89%E8%A3%85golang/","content":"<p>到官方<a href=\"https://golang.org/dl/\">https://golang.org/dl/</a></p>\n<p>或者 <a href=\"https://www.golangtc.com/download\">https://www.golangtc.com/download</a><br>下载安装包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https://www.golangtc.com/static/go/1.9/go1.9.linux-amd64.tar.gz</span><br><span class=\"line\">tar zxvf go1.9.linux-amd64.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n<p>新建GOPATH目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /www/golang</span><br><span class=\"line\">vim /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">export</span> GOROOT=/usr/local/go</span><br><span class=\"line\"><span class=\"built_in\">export</span> GOBIN=<span class=\"variable\">$GOROOT</span>/bin</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$GOBIN</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> GOPATH=/www/golang</span><br></pre></td></tr></table></figure>\n<p>:wq保存<br>使其生效</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n<p>查看是否配置成功</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">go version</span><br><span class=\"line\">go version go1.9 linux/amd64</span><br></pre></td></tr></table></figure>\n<p>简单测试：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /www/golang</span><br><span class=\"line\">vim hello.go</span><br><span class=\"line\">package main</span><br><span class=\"line\">import <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">func <span class=\"function\"><span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;Hello, world&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">:wq</span><br><span class=\"line\">go run hello.go</span><br><span class=\"line\">Hello, world</span><br></pre></td></tr></table></figure>\n","tags":["linux","golang"]},{"title":"文件权限管理","url":"/2017/12/02/%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/","content":"<p>三种基本权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">R   读       数值表示为4</span><br><span class=\"line\">W   写       数值表示为2</span><br><span class=\"line\">X   可执行   数值表示为1</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/%E6%9D%83%E9%99%90.png\" alt=\"权限实例\"></p>\n<p>如图所示，downloads文件夹的权限为 drwxr-xr-x</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">drwxr-xr-x一共十个字符，分成四段。</span><br><span class=\"line\">第一个字符“d”表示目录；这个位置还可能会出现“l”链接；“-”表示普通文件</span><br><span class=\"line\">第二三四个字符“rwx”表示当前所属用户的权限。    所以用数值表示为4+2+1=7</span><br><span class=\"line\">第五六七个字符“r-x”表示当前所属组的权限。      所以用数值表示为4+1=5</span><br><span class=\"line\">第八九十个字符“r-x”表示其他用户权限。         所以用数值表示为4+1=5</span><br><span class=\"line\">所以操作此文件夹的权限用数值表示为755</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"安装CentOS7文字界面版后，无法联网，用yum安装软件提示-cannot-find-a-valid-baseurl-for-repobase7x86-64-的解决方法","url":"/2017/12/02/%E5%AE%89%E8%A3%85CentOS7%E6%96%87%E5%AD%97%E7%95%8C%E9%9D%A2%E7%89%88%E5%90%8E%EF%BC%8C%E6%97%A0%E6%B3%95%E8%81%94%E7%BD%91%EF%BC%8C%E7%94%A8yum%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E6%8F%90%E7%A4%BA-cannot-find-a-valid-baseurl-for-repobase7x86-64-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/","content":"<p>无法联网的明显表现会有：</p>\n<p>　　1、yum install出现 Error: cannot find a valid baseurl or repo:base</p>\n<p>　　2、ping host会提示unknown host</p>\n<p>方法一、</p>\n<p>　　1、打开 vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0（每个机子都可能不一样，但格式会是“ifcfg-eth数字”），把ONBOOT&#x3D;no，改为ONBOOT&#x3D;yes</p>\n<p>　　2、重启网络：service network restart</p>\n<p>方法二、</p>\n<p>　　1、打开 vi &#x2F;etc&#x2F;resolv.conf，增加 nameserver 8.8.8.8</p>\n<p>　　2、重启网络: service network restart</p>\n","tags":["centos"]},{"title":"查看linux中某个端口（port）是否被占用","url":"/2017/12/03/%E6%9F%A5%E7%9C%8Blinux%E4%B8%AD%E6%9F%90%E4%B8%AA%E7%AB%AF%E5%8F%A3%EF%BC%88port%EF%BC%89%E6%98%AF%E5%90%A6%E8%A2%AB%E5%8D%A0%E7%94%A8/","content":"<p>1.使用lsof</p>\n<p>lsof -i:端口号查看某个端口是否被占用</p>\n<p>2.使用netstat</p>\n<p>使用netstat -anp|grep 80</p>\n","tags":["linux"]},{"title":"树莓派格式化硬盘并自动挂载","url":"/2021/02/03/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%A1%AC%E7%9B%98%E5%B9%B6%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD/","content":"<h5 id=\"输入-fdisk-l查看你U盘的具体分区\"><a href=\"#输入-fdisk-l查看你U盘的具体分区\" class=\"headerlink\" title=\"输入 fdisk -l查看你U盘的具体分区\"></a>输入 fdisk -l查看你U盘的具体分区</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">fdisk -l</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"先取消树莓派自动挂载取消挂载\"><a href=\"#先取消树莓派自动挂载取消挂载\" class=\"headerlink\" title=\"先取消树莓派自动挂载取消挂载\"></a>先取消树莓派自动挂载取消挂载</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo umount /dev/sdb1</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"将-x2F-dev-x2F-sdb1分区格式化成ext4文件系统\"><a href=\"#将-x2F-dev-x2F-sdb1分区格式化成ext4文件系统\" class=\"headerlink\" title=\"将&#x2F;dev&#x2F;sdb1分区格式化成ext4文件系统\"></a>将&#x2F;dev&#x2F;sdb1分区格式化成ext4文件系统</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo mkfs.ext4 /dev/sdb1</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"挂载硬盘\"><a href=\"#挂载硬盘\" class=\"headerlink\" title=\"挂载硬盘\"></a>挂载硬盘</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo mount /dev/sdb1  /data/hardDisk/linkEase/musics</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"开机自动挂载硬盘\"><a href=\"#开机自动挂载硬盘\" class=\"headerlink\" title=\"开机自动挂载硬盘\"></a>开机自动挂载硬盘</h5><h6 id=\"查看硬盘UUID\"><a href=\"#查看硬盘UUID\" class=\"headerlink\" title=\"查看硬盘UUID\"></a>查看硬盘UUID</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> -l /dev/disk/by-uuid/</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"通过UUID挂载硬盘\"><a href=\"#通过UUID挂载硬盘\" class=\"headerlink\" title=\"通过UUID挂载硬盘\"></a>通过UUID挂载硬盘</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#编辑/etc/fstab</span></span><br><span class=\"line\">sudo vim /etc/fstab</span><br><span class=\"line\"><span class=\"comment\">#添加以下命令到/etc/fstab</span></span><br><span class=\"line\">UUID=601788b2-96aa-4975-a6c2-7b90b128a7e5 /data/hardDisk/linkEase/musics ext4 defaults 0 0</span><br></pre></td></tr></table></figure>","tags":["树莓派"]},{"title":"正则^的用法","url":"/2018/05/01/%E6%AD%A3%E5%88%99%5E%E7%9A%84%E7%94%A8%E6%B3%95/","content":"<p>^在[]外面表示以[]里的字符为首<br>^在[]里面表示不匹配[]里的字符</p>\n","tags":["正则"]},{"title":"正则掌握程度测试题","url":"/2018/05/05/%E6%AD%A3%E5%88%99%E6%8E%8C%E6%8F%A1%E7%A8%8B%E5%BA%A6%E6%B5%8B%E8%AF%95%E9%A2%98/","content":"<h3 id=\"分组提取-x2F-非捕获组\"><a href=\"#分组提取-x2F-非捕获组\" class=\"headerlink\" title=\"分组提取&#x2F;非捕获组\"></a>分组提取&#x2F;非捕获组</h3><p>分组，是正则里一个非常重要的概念，我们需要针对某个区域提取数据，往往需要依赖分组。而分组，其实就是正则里()括住的部分。</p>\n<h4 id=\"分组提取\"><a href=\"#分组提取\" class=\"headerlink\" title=\"分组提取\"></a>分组提取</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：在分组<span class=\"number\">1</span>中匹配meta中author属性的值</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;meta author=<span class=\"string\">&quot;Zjmainstay&quot;</span> /&gt;</span><br><span class=\"line\">another author=<span class=\"string\">&quot;Zjmainstay too&quot;</span></span><br><span class=\"line\">预期：分组<span class=\"number\">1</span>得到Zjmainstay</span><br><span class=\"line\">正则：/<span class=\"string\">&quot;(\\w*)&quot;</span>/</span><br></pre></td></tr></table></figure>\n<h4 id=\"非捕获组\"><a href=\"#非捕获组\" class=\"headerlink\" title=\"非捕获组\"></a>非捕获组</h4><p>针对上面的分组，有时候，我们并不需要捕获某个分组的内容，我们可以使用非捕获组(?:表达式)，从而不捕获表达式部分内容到分组中。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配每行字母个数是偶数个的数据，每行数据不为空，正则不能存在分组<span class=\"number\">1</span></span><br><span class=\"line\">源串：</span><br><span class=\"line\">a</span><br><span class=\"line\">ab</span><br><span class=\"line\">abc</span><br><span class=\"line\">abcd</span><br><span class=\"line\">预期：</span><br><span class=\"line\">匹配得到 ab 和 abcd，不包含分组<span class=\"number\">1</span></span><br><span class=\"line\">正则：/^(?:\\w\\w)+$/m</span><br></pre></td></tr></table></figure>\n<h3 id=\"单字符或\"><a href=\"#单字符或\" class=\"headerlink\" title=\"单字符或\"></a>单字符或</h3><p>或条件是正则使用过程中常用的概念，比如，密码由字母或数字组成，这里就用到了或条件，而且，由于字母或数字都是单个字符，因此，可以使用[a-z0-9]这样的单字符或语法实现。<br>常犯错误：匹配a或b写成[a|b]，此表达式实际上表示a或b或|，在[]内部的|表示其本身，注意区分(a|b)表示a或b的写法。</p>\n<h4 id=\"单字符或-1\"><a href=\"#单字符或-1\" class=\"headerlink\" title=\"单字符或\"></a>单字符或</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配由 A/S/D/F <span class=\"number\">4</span>个字母(区分大小写)组成的长度为<span class=\"number\">3</span>字符串</span><br><span class=\"line\">源串：</span><br><span class=\"line\">ABC</span><br><span class=\"line\">ASD</span><br><span class=\"line\">ADS</span><br><span class=\"line\">ASF</span><br><span class=\"line\">BBC</span><br><span class=\"line\">A|S</span><br><span class=\"line\">A|D</span><br><span class=\"line\">ASDF</span><br><span class=\"line\">预期：以[]元字符获得<span class=\"number\">3</span>个字母的或集，匹配 ASD/ADS/ASF <span class=\"number\">3</span>组数据</span><br><span class=\"line\">正则：/^[ASDF]&#123;<span class=\"number\">3</span>&#125;$/m</span><br></pre></td></tr></table></figure>\n<h3 id=\"多字符或\"><a href=\"#多字符或\" class=\"headerlink\" title=\"多字符或\"></a>多字符或</h3><p>相对单字符或条件，多字符或也是很常见的，比如，我们需要匹配http或ftp两个协议头的url，就需要^(http|ftp):&#x2F;&#x2F;.+$这样的语法来实现。</p>\n<h4 id=\"多字符或-1\"><a href=\"#多字符或-1\" class=\"headerlink\" title=\"多字符或\"></a>多字符或</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配每行数据中以.jpg/.jpeg/.png/.gif结尾的图片名称（含后缀）</span><br><span class=\"line\">源串：</span><br><span class=\"line\">image.jpg</span><br><span class=\"line\">image.jpeg</span><br><span class=\"line\">image.png</span><br><span class=\"line\">image.gif</span><br><span class=\"line\">not_image.txt</span><br><span class=\"line\">not_image.doc</span><br><span class=\"line\">not_image.xls</span><br><span class=\"line\">not_image.ppt</span><br><span class=\"line\">预期：匹配 image.jpg/image.jpeg/image.png/image.gif <span class=\"number\">4</span>个结果</span><br><span class=\"line\">正则：/(.*\\.(jpg|jpeg|png|gif))/m</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n\n<h3 id=\"分组引用\"><a href=\"#分组引用\" class=\"headerlink\" title=\"分组引用\"></a>分组引用</h3><p>前面介绍了分组，那某个分组在我们匹配过程中重复出现，又该如何处理？分组引用恰恰解决这个问题。比如，匹配出现重复单词的一行数据，我们可以这么写（多行模式）：&#x2F;^.<em>?(\\b\\S+\\b).</em>?\\1.*$&#x2F;m，\\1表示引用前面分组1中匹配到的内容，也就是重复的单词内容。</p>\n<h4 id=\"匹配连续相同3次的数字\"><a href=\"#匹配连续相同3次的数字\" class=\"headerlink\" title=\"匹配连续相同3次的数字\"></a>匹配连续相同3次的数字</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配连续相同<span class=\"number\">3</span>次的数字</span><br><span class=\"line\">源串：</span><br><span class=\"line\"><span class=\"number\">111</span></span><br><span class=\"line\"><span class=\"number\">121</span></span><br><span class=\"line\"><span class=\"number\">112</span></span><br><span class=\"line\"><span class=\"number\">222</span></span><br><span class=\"line\">预期：匹配 <span class=\"number\">111</span>/<span class=\"number\">222</span> 两组数据</span><br><span class=\"line\">正则：/^(\\d)\\<span class=\"number\">1</span>\\<span class=\"number\">1</span>$/m</span><br></pre></td></tr></table></figure>\n<h3 id=\"匹配换行数据\"><a href=\"#匹配换行数据\" class=\"headerlink\" title=\"匹配换行数据\"></a>匹配换行数据</h3><p>“我的正则本来好好的，突然不行了！”这个是很多正则新人遇到的问题，而这个问题，很多时候，就是因为原来正则中的.不能匹配新数据里的换行导致的。这时候，只需要把.改成[\\s\\S]这样的表达式就可以了。这个表达式表示空格或非空格，也就是任意字符啦。</p>\n<h4 id=\"匹配换行数据-1\"><a href=\"#匹配换行数据-1\" class=\"headerlink\" title=\"匹配换行数据\"></a>匹配换行数据</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：分别使用单行模式和普通模式匹配id=<span class=\"string\">&quot;author&quot;</span>的div中数据，div标签不在同一行</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;div id=<span class=\"string\">&quot;author&quot;</span>&gt;</span><br><span class=\"line\">Zjmainstay</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">预期：Zjmainstay</span><br><span class=\"line\">正则<span class=\"number\">1</span>：@&lt;div\\sid=<span class=\"string\">&quot;author&quot;</span>&gt;([\\s\\S]*)&lt;/div&gt;@s</span><br><span class=\"line\">正则<span class=\"number\">2</span>：</span><br></pre></td></tr></table></figure>\n<h3 id=\"存在（或）\"><a href=\"#存在（或）\" class=\"headerlink\" title=\"存在（或）\"></a>存在（或）</h3><h4 id=\"匹配多种或条件的数据，没有特殊限制\"><a href=\"#匹配多种或条件的数据，没有特殊限制\" class=\"headerlink\" title=\"匹配多种或条件的数据，没有特殊限制\"></a>匹配多种或条件的数据，没有特殊限制</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配每行中包含“作者”或者“读者”的数据</span><br><span class=\"line\">源串：</span><br><span class=\"line\">本文的作者是Zjmainstay</span><br><span class=\"line\">本文有很多读者</span><br><span class=\"line\">读者可以是任何一个地方的人</span><br><span class=\"line\">这里的任何一个地方说明读者也能在国外</span><br><span class=\"line\">什么乱七八糟的推理</span><br><span class=\"line\">你不匹配我，凭什么要我推荐你的博客 www.zjmainstay.cn</span><br><span class=\"line\">预期：匹配</span><br><span class=\"line\">本文的作者是Zjmainstay</span><br><span class=\"line\">本文有很多读者</span><br><span class=\"line\">读者可以是任何一个地方的人</span><br><span class=\"line\">这里的任何一个地方说明读者也能在国外</span><br><span class=\"line\">正则：/(.*(作者|读者).*)/m</span><br></pre></td></tr></table></figure>\n<h4 id=\"匹配多种或条件的数据，有特殊限制（不使用环视）\"><a href=\"#匹配多种或条件的数据，有特殊限制（不使用环视）\" class=\"headerlink\" title=\"匹配多种或条件的数据，有特殊限制（不使用环视）\"></a>匹配多种或条件的数据，有特殊限制（不使用环视）</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配每行中“读者”在开头或结尾的数据</span><br><span class=\"line\">源串：</span><br><span class=\"line\">本文作者是Zjmainstay，有很多读者</span><br><span class=\"line\">读者可以是任何一个地方的人</span><br><span class=\"line\">这里的任何一个地方说明读者也能在国外</span><br><span class=\"line\">预期：匹配</span><br><span class=\"line\">本文作者是Zjmainstay，有很多读者</span><br><span class=\"line\">读者可以是任何一个地方的人</span><br><span class=\"line\">正则：/.*(^读者|读者$).*/m</span><br></pre></td></tr></table></figure>\n<h4 id=\"匹配多种或条件的数据，有特殊限制（使用环视）\"><a href=\"#匹配多种或条件的数据，有特殊限制（使用环视）\" class=\"headerlink\" title=\"匹配多种或条件的数据，有特殊限制（使用环视）\"></a>匹配多种或条件的数据，有特殊限制（使用环视）</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配每行中“读者”在开头或结尾的数据</span><br><span class=\"line\">源串：</span><br><span class=\"line\">本文作者是Zjmainstay，有很多读者</span><br><span class=\"line\">读者可以是任何一个地方的人</span><br><span class=\"line\">这里的任何一个地方说明读者也能在国外</span><br><span class=\"line\">预期：匹配</span><br><span class=\"line\">本文作者是Zjmainstay，有很多读者</span><br><span class=\"line\">读者可以是任何一个地方的人</span><br><span class=\"line\">正则：/((?&lt;=^读者).*|.*(?=读者$))/m</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"存在（与）\"><a href=\"#存在（与）\" class=\"headerlink\" title=\"存在（与）\"></a>存在（与）</h3><h4 id=\"校验密码必须包含字母、数字和特殊字符，6-16位\"><a href=\"#校验密码必须包含字母、数字和特殊字符，6-16位\" class=\"headerlink\" title=\"校验密码必须包含字母、数字和特殊字符，6-16位\"></a>校验密码必须包含字母、数字和特殊字符，6-16位</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：校验密码必须包含字母、数字和特殊字符，<span class=\"number\">6</span>-<span class=\"number\">16</span>位，假定特殊字符为 -_= 三个字符</span><br><span class=\"line\">源串：</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br><span class=\"line\"><span class=\"number\">123456</span></span><br><span class=\"line\"><span class=\"number\">1234561234561234</span></span><br><span class=\"line\"><span class=\"number\">12345612345612345</span></span><br><span class=\"line\">a1234</span><br><span class=\"line\">a12345</span><br><span class=\"line\">-<span class=\"number\">1234</span></span><br><span class=\"line\">-<span class=\"number\">12345</span></span><br><span class=\"line\">a-<span class=\"number\">123</span></span><br><span class=\"line\">a-<span class=\"number\">1234</span></span><br><span class=\"line\">a-<span class=\"number\">1234</span>a-<span class=\"number\">1234</span>a-<span class=\"number\">12</span></span><br><span class=\"line\">a-<span class=\"number\">1234</span>a-<span class=\"number\">1234</span>a-<span class=\"number\">1234</span></span><br><span class=\"line\">aaaaa</span><br><span class=\"line\">aaaaaa</span><br><span class=\"line\">-_=-_</span><br><span class=\"line\">-_=-_=</span><br><span class=\"line\">预期：匹配</span><br><span class=\"line\">a-<span class=\"number\">1234</span></span><br><span class=\"line\">a-<span class=\"number\">1234</span>a-<span class=\"number\">1234</span>a-<span class=\"number\">12</span></span><br><span class=\"line\">正则：^(?=.&#123;<span class=\"number\">6</span>,<span class=\"number\">16</span>&#125;)(?=.*[a-z])(?=.*[<span class=\"number\">0</span>-<span class=\"number\">9</span>])(?=.*[-_=])[<span class=\"number\">0</span>-<span class=\"number\">9</span>a-z-_=]*$</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"特殊限制（环视否定）\"><a href=\"#特殊限制（环视否定）\" class=\"headerlink\" title=\"特殊限制（环视否定）\"></a>特殊限制（环视否定）</h3><h4 id=\"使用-d-1-3-匹配1-999的数据，不能以0开头\"><a href=\"#使用-d-1-3-匹配1-999的数据，不能以0开头\" class=\"headerlink\" title=\"使用\\d{1,3}匹配1-999的数据，不能以0开头\"></a>使用\\d{1,3}匹配1-999的数据，不能以0开头</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：使用\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">3</span>&#125;匹配每行中<span class=\"number\">1</span>-<span class=\"number\">999</span>的数据，不能以<span class=\"number\">0</span>开头</span><br><span class=\"line\">源串：</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"number\">999</span></span><br><span class=\"line\"><span class=\"number\">1000</span></span><br><span class=\"line\"><span class=\"number\">01</span></span><br><span class=\"line\"><span class=\"number\">001</span></span><br><span class=\"line\">预期：匹配</span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"number\">999</span></span><br><span class=\"line\">正则：/^(?!<span class=\"number\">0</span>)\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">3</span>&#125;$/m</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"匹配除了span标签外的所有标签\"><a href=\"#匹配除了span标签外的所有标签\" class=\"headerlink\" title=\"匹配除了span标签外的所有标签\"></a>匹配除了span标签外的所有标签</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配除了&lt;span&gt;内容&lt;/span&gt;标签外的所有&lt;tagName&gt;内容&lt;/tagName&gt;格式标签</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;div&gt;匹配我&lt;/div&gt;</span><br><span class=\"line\">&lt;span&gt;不匹配我&lt;/span&gt;</span><br><span class=\"line\">&lt;p&gt;匹配我&lt;/p&gt;</span><br><span class=\"line\">&lt;i&gt;匹配我&lt;/i&gt;</span><br><span class=\"line\">预期：匹配</span><br><span class=\"line\">&lt;div&gt;匹配我&lt;/div&gt;</span><br><span class=\"line\">&lt;p&gt;匹配我&lt;/p&gt;</span><br><span class=\"line\">&lt;i&gt;匹配我&lt;/i&gt;</span><br><span class=\"line\">正则：/&lt;(?!span).*(?&lt;!\\/span)&gt;/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"替换分组使用\"><a href=\"#替换分组使用\" class=\"headerlink\" title=\"替换分组使用\"></a>替换分组使用</h3><h4 id=\"给源串每个链接加上http-www-zjmainstay-cn前缀\"><a href=\"#给源串每个链接加上http-www-zjmainstay-cn前缀\" class=\"headerlink\" title=\"给源串每个链接加上http://www.zjmainstay.cn前缀\"></a>给源串每个链接加上<a href=\"http://www.zjmainstay.cn前缀/\">http://www.zjmainstay.cn前缀</a></h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：给源串每个链接加上http:<span class=\"comment\">//www.zjmainstay.cn前缀</span></span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-1&quot;</span> href=<span class=\"string\">&quot;/regexp-one&quot;</span>&gt;正则文章合集（All In One)&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-2&quot;</span> href=<span class=\"string\">&quot;/my-regexp&quot;</span>&gt;正则入门教程&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-3&quot;</span> href=<span class=\"string\">&quot;/deep-regexp&quot;</span>&gt;正则高级教程&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-4&quot;</span> href=<span class=\"string\">&quot;/regexp-lookaround&quot;</span>&gt;正则环视详解&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-5&quot;</span> href=<span class=\"string\">&quot;/php-curl&quot;</span>&gt;PHP cURL应用&lt;/a&gt;</span><br><span class=\"line\">预期：替换得到</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-1&quot;</span> href=<span class=\"string\">&quot;http://www.zjmainstay.cn/regexp-one&quot;</span>&gt;正则文章合集（All In One)&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-2&quot;</span> href=<span class=\"string\">&quot;http://www.zjmainstay.cn/my-regexp&quot;</span>&gt;正则入门教程&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-3&quot;</span> href=<span class=\"string\">&quot;http://www.zjmainstay.cn/deep-regexp&quot;</span>&gt;正则高级教程&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-4&quot;</span> href=<span class=\"string\">&quot;http://www.zjmainstay.cn/regexp-lookaround&quot;</span>&gt;正则环视详解&lt;/a&gt;</span><br><span class=\"line\">&lt;a id=<span class=\"string\">&quot;link-5&quot;</span> href=<span class=\"string\">&quot;http://www.zjmainstay.cn/php-curl&quot;</span>&gt;PHP cURL应用&lt;/a&gt;</span><br><span class=\"line\">查找：/href=<span class=\"string\">&quot;(?=\\/)\\// 或者 /href=&quot;</span>\\<span class=\"comment\">//</span></span><br><span class=\"line\">替换：href=<span class=\"string\">&quot;http://www.zjmainstay.cn/</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"将每行数据格式化为一条SQL语句\"><a href=\"#将每行数据格式化为一条SQL语句\" class=\"headerlink\" title=\"将每行数据格式化为一条SQL语句\"></a>将每行数据格式化为一条SQL语句</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：将每行特定格式数据格式化为SQL语句</span><br><span class=\"line\">源串：</span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"number\">2017</span>-<span class=\"number\">04</span>-<span class=\"number\">11</span> Zjmainstay</span><br><span class=\"line\"><span class=\"number\">2</span> <span class=\"number\">2017</span>-<span class=\"number\">04</span>-<span class=\"number\">12</span> Nobody</span><br><span class=\"line\"><span class=\"number\">3</span> <span class=\"number\">2017</span>-<span class=\"number\">04</span>-<span class=\"number\">13</span> Somebody</span><br><span class=\"line\">预期：替换得到</span><br><span class=\"line\">INSERT INTO <span class=\"title function_ invoke__\">table_log</span>(`id`, `created_at`, `author`) <span class=\"title function_ invoke__\">values</span>(<span class=\"string\">&#x27;1&#x27;</span>, <span class=\"string\">&#x27;2017-04-11&#x27;</span>, <span class=\"string\">&#x27;Zjmainstay&#x27;</span>);</span><br><span class=\"line\">INSERT INTO <span class=\"title function_ invoke__\">table_log</span>(`id`, `created_at`, `author`) <span class=\"title function_ invoke__\">values</span>(<span class=\"string\">&#x27;2&#x27;</span>, <span class=\"string\">&#x27;2017-04-12&#x27;</span>, <span class=\"string\">&#x27;Nobody&#x27;</span>);</span><br><span class=\"line\">INSERT INTO <span class=\"title function_ invoke__\">table_log</span>(`id`, `created_at`, `author`) <span class=\"title function_ invoke__\">values</span>(<span class=\"string\">&#x27;3&#x27;</span>, <span class=\"string\">&#x27;2017-04-13&#x27;</span>, <span class=\"string\">&#x27;Somebody&#x27;</span>);</span><br><span class=\"line\">查找：/(\\d)\\<span class=\"title function_ invoke__\">s</span>([\\d-]+)\\<span class=\"title function_ invoke__\">s</span>(\\w+)/ 或者 /([<span class=\"number\">0</span>-<span class=\"number\">9</span>])\\<span class=\"title function_ invoke__\">s</span>([<span class=\"number\">0</span>-<span class=\"number\">9</span>-]+)\\<span class=\"title function_ invoke__\">s</span>([a-zA-Z]+)/</span><br><span class=\"line\">替换：INSERT INTO <span class=\"title function_ invoke__\">table_log</span>(`id`, `created_at`, `author`) <span class=\"title function_ invoke__\">values</span>(<span class=\"string\">&#x27;$1&#x27;</span>, <span class=\"string\">&#x27;$2&#x27;</span>, <span class=\"string\">&#x27;$3&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"分组可选\"><a href=\"#分组可选\" class=\"headerlink\" title=\"分组可选\"></a>分组可选</h3><h4 id=\"分组可选-1\"><a href=\"#分组可选-1\" class=\"headerlink\" title=\"分组可选\"></a>分组可选</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：判断如果单词以A开头，匹配Apple；如果单词以B开头，匹配Banana；否则匹配Empty</span><br><span class=\"line\">源串：</span><br><span class=\"line\">Angle</span><br><span class=\"line\">Apple</span><br><span class=\"line\">Banana</span><br><span class=\"line\">Best</span><br><span class=\"line\">Empty</span><br><span class=\"line\">预期：匹配</span><br><span class=\"line\">Apple</span><br><span class=\"line\">Banana</span><br><span class=\"line\">Empty</span><br><span class=\"line\">正则：/((?:A)pple)|((?:B)anana)|((?:E)mpty)/</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"分组可选与分组引用\"><a href=\"#分组可选与分组引用\" class=\"headerlink\" title=\"分组可选与分组引用\"></a>分组可选与分组引用</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配html标签的属性值，属性值可以由双引号、单引号、无单双引号定界</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;div id=<span class=\"string\">&quot;I&#x27;m Zjmainstay&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">name</span>&quot; <span class=\"title\">data</span>-<span class=\"title\">year</span>=2017 <span class=\"title\">age</span>=&#x27;27&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"class\">预期：分组匹配</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">I</span>&#x27;<span class=\"title\">m</span> <span class=\"title\">Zjmainstay</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">name</span></span></span><br><span class=\"line\"><span class=\"class\">2017</span></span><br><span class=\"line\"><span class=\"class\">27</span></span><br><span class=\"line\"><span class=\"class\">正则：/[&quot;\\&#x27;]([\\<span class=\"title\">w</span>\\<span class=\"title\">s</span>\\&#x27;]*)[&quot;\\&#x27;]/</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"单字符拆分（数字）\"><a href=\"#单字符拆分（数字）\" class=\"headerlink\" title=\"单字符拆分（数字）\"></a>单字符拆分（数字）</h3><h4 id=\"匹配0-00-100-00的数值，可以有0-2位小数\"><a href=\"#匹配0-00-100-00的数值，可以有0-2位小数\" class=\"headerlink\" title=\"匹配0.00-100.00的数值，可以有0-2位小数\"></a>匹配0.00-100.00的数值，可以有0-2位小数</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配<span class=\"number\">0.00</span>-<span class=\"number\">100.00</span>的数值，可以有<span class=\"number\">0</span>-<span class=\"number\">2</span>位小数，不能以小数点结尾，不能以<span class=\"number\">2</span>个以上的<span class=\"number\">0</span>开头</span><br><span class=\"line\">思路：(<span class=\"number\">100</span>|<span class=\"number\">10</span>-<span class=\"number\">99</span>|<span class=\"number\">0</span>-<span class=\"number\">9</span>) + <span class=\"number\">0</span>-<span class=\"number\">2</span>小数位 + 排除小数点结尾、<span class=\"number\">2</span>个以上<span class=\"number\">0</span>开头的情况</span><br><span class=\"line\">源串：</span><br><span class=\"line\"><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">0.0</span></span><br><span class=\"line\"><span class=\"number\">0.00</span></span><br><span class=\"line\"><span class=\"number\">9.00</span></span><br><span class=\"line\"><span class=\"number\">18.00</span></span><br><span class=\"line\"><span class=\"number\">27.0</span></span><br><span class=\"line\"><span class=\"number\">36.00</span></span><br><span class=\"line\"><span class=\"number\">45.00</span></span><br><span class=\"line\"><span class=\"number\">54.00</span></span><br><span class=\"line\"><span class=\"number\">63.00</span></span><br><span class=\"line\"><span class=\"number\">72.00</span></span><br><span class=\"line\"><span class=\"number\">81.00</span></span><br><span class=\"line\"><span class=\"number\">90.00</span></span><br><span class=\"line\"><span class=\"number\">99.99</span></span><br><span class=\"line\"><span class=\"number\">100.00</span></span><br><span class=\"line\"><span class=\"number\">0</span>.</span><br><span class=\"line\"><span class=\"number\">001</span></span><br><span class=\"line\"><span class=\"number\">100.01</span></span><br><span class=\"line\"><span class=\"number\">100.001</span></span><br><span class=\"line\"><span class=\"number\">101</span></span><br><span class=\"line\">预期：匹配<span class=\"number\">0.00</span>~<span class=\"number\">100.00</span></span><br><span class=\"line\">正则：/(?!<span class=\"number\">00</span>)(<span class=\"number\">100</span>|[<span class=\"number\">10</span>-<span class=\"number\">99</span>]|[<span class=\"number\">0</span>-<span class=\"number\">9</span>])*(\\.\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;)/m</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"贪婪模式\"><a href=\"#贪婪模式\" class=\"headerlink\" title=\"贪婪模式\"></a>贪婪模式</h3><p>   贪婪模式，正则会优先尽可能多地匹配能匹配到的内容。当剩余正则匹配剩余部分字符（源串）    但无法满足匹配时，贪婪部分回溯，吐出已匹配的内容，尝试满足剩余部分字符的匹配。</p>\n<h4 id=\"匹配链接中的文件名\"><a href=\"#匹配链接中的文件名\" class=\"headerlink\" title=\"匹配链接中的文件名\"></a>匹配链接中的文件名</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：利用贪婪模式，分组<span class=\"number\">1</span>得到每行链接中的文件名</span><br><span class=\"line\">源串：</span><br><span class=\"line\">http:<span class=\"comment\">//localhost.com/a/b/c/d/file1.txt</span></span><br><span class=\"line\">https:<span class=\"comment\">//localhost.com/a/b/file2long.jpg</span></span><br><span class=\"line\">预期：分组<span class=\"number\">0</span>匹配行数据，分组<span class=\"number\">1</span>匹配文件名</span><br><span class=\"line\">file1.txt</span><br><span class=\"line\">file2long.jpg</span><br><span class=\"line\">正则：/.*\\/(.*\\..*)/</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"限定字符贪婪优化匹配性能\"><a href=\"#限定字符贪婪优化匹配性能\" class=\"headerlink\" title=\"限定字符贪婪优化匹配性能\"></a>限定字符贪婪优化匹配性能</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配div id=<span class=\"string\">&quot;author&quot;</span>的标签内容</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;div id=<span class=\"string\">&quot;author&quot;</span> <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">author</span>-<span class=\"title\">text</span> <span class=\"title\">something</span>-\t\t<span class=\"title\">useless</span>&quot;&gt;<span class=\"title\">Zjmainstay</span>&lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">预期：利用贪婪模式去掉<span class=\"title\">div</span>中的噪点（无关数据），分组1匹配到<span class=\"title\">Zjmainstay</span></span></span><br><span class=\"line\"><span class=\"class\">正则：/&lt;<span class=\"title\">div</span>.*&gt;(.*)&lt;\\/<span class=\"title\">div</span>&gt;/</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"非贪婪模式\"><a href=\"#非贪婪模式\" class=\"headerlink\" title=\"非贪婪模式\"></a>非贪婪模式</h3><p>   非贪婪模式，正则会优先尽可能少地匹配能匹配到的内容。当剩余正则匹配剩余部分字符（源    串）但无法满足匹配时，非贪婪部分继续匹配更多内容，尝试满足剩余部分字符的匹配。</p>\n<h4 id=\"匹配p标签内容\"><a href=\"#匹配p标签内容\" class=\"headerlink\" title=\"匹配p标签内容\"></a>匹配p标签内容</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配p标签内容</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;p&gt;内容<span class=\"number\">1</span>&lt;/p&gt;&lt;p&gt;内容<span class=\"number\">2</span>&lt;/p&gt;</span><br><span class=\"line\">预期：</span><br><span class=\"line\">在分组<span class=\"number\">1</span>中匹配到内容<span class=\"number\">1</span>和内容<span class=\"number\">2</span></span><br><span class=\"line\">正则：/&lt;p&gt;(.*?)&lt;\\/p&gt;/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"占用模式-PCRE\"><a href=\"#占用模式-PCRE\" class=\"headerlink\" title=\"占用模式(PCRE)\"></a>占用模式(PCRE)</h3><p>   贪婪模式后再加一个+量词，如.++，效果是贪婪而且不回溯。<br>    暂时没有想到应用场景。</p>\n<h3 id=\"字符分界（-的作用域）\"><a href=\"#字符分界（-的作用域）\" class=\"headerlink\" title=\"|字符分界（|的作用域）\"></a>|字符分界（|的作用域）</h3><p>   |作为或条件分隔符，它的分隔区间常常存在误用。在使用|字符的过程中，我们常常需要结合    ()来对它进行限定。如，^([0-9]+|[a-z]+)$表示纯数字或纯字母，如果没有()，那它又是    另一种意思了。^[0-9]+|[a-z]+$等价于^[0-9]+或[a-z]+$，因此，它表示数字开头或者    字母结尾，跟我们的需求有了很大的差别。</p>\n<h4 id=\"字符分界\"><a href=\"#字符分界\" class=\"headerlink\" title=\"|字符分界\"></a>|字符分界</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：在分组<span class=\"number\">1</span>中匹配css或script的链接</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;script src=<span class=\"string\">&quot;main.min.js&quot;</span> type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;link rel=<span class=\"string\">&quot;stylesheet&quot;</span> type=<span class=\"string\">&quot;text/css&quot;</span> href=<span class=\"string\">&quot;main.css&quot;</span>&gt;</span><br><span class=\"line\">预期：</span><br><span class=\"line\">main.min.js</span><br><span class=\"line\">main.css</span><br><span class=\"line\">正则：/src=<span class=\"string\">&quot;(.*?)&quot;</span>|href=<span class=\"string\">&quot;(.*?)&quot;</span>/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"元字符转义\"><a href=\"#元字符转义\" class=\"headerlink\" title=\"元字符转义\"></a>元字符转义</h3><p>   元字符，指正则中有特殊意义的字符，如.表示匹配除了换行符以外的任意字符，这个.就是元字符。在正则书写过程中，如果我们真的要匹配这个.，就需要对它进行转义，而不是让它使用正则的含义，比如，匹配域名里的.，我们就要写成&#x2F;zjmainstay.cn&#x2F;这样的正则。</p>\n<h4 id=\"元字符转义-1\"><a href=\"#元字符转义-1\" class=\"headerlink\" title=\"元字符转义\"></a>元字符转义</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：表达式格式固定，提取其中的数值</span><br><span class=\"line\">源串：</span><br><span class=\"line\">(<span class=\"number\">20</span>+<span class=\"number\">170</span>)-<span class=\"number\">5</span>*<span class=\"number\">1</span>/<span class=\"number\">5</span>=?</span><br><span class=\"line\">预期：</span><br><span class=\"line\">A:<span class=\"number\">20</span></span><br><span class=\"line\">B:<span class=\"number\">170</span></span><br><span class=\"line\">C:<span class=\"number\">5</span></span><br><span class=\"line\">D:<span class=\"number\">1</span></span><br><span class=\"line\">E:<span class=\"number\">5</span></span><br><span class=\"line\">F:?</span><br><span class=\"line\">正则：/\\((\\d+)\\+(\\d+)\\)-(\\d+)\\*(\\d+)\\/(\\d+)=(\\?)/</span><br><span class=\"line\">替换：($<span class=\"number\">1</span>+$<span class=\"number\">2</span>)-$<span class=\"number\">3</span>*$<span class=\"number\">4</span>/$<span class=\"number\">5</span>=$<span class=\"number\">6</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"分隔符绕过（PCRE）\"><a href=\"#分隔符绕过（PCRE）\" class=\"headerlink\" title=\"分隔符绕过（PCRE）\"></a>分隔符绕过（PCRE）</h3><p>有时候，如果该语言支持多种分隔符，在写正则的过程中通常会通过规避分隔符的方式，减少对分隔符的转义，让正则看起来更清晰，写起来更舒服，当然，js中是不支持的。</p>\n<h4 id=\"分隔符绕过\"><a href=\"#分隔符绕过\" class=\"headerlink\" title=\"分隔符绕过\"></a>分隔符绕过</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：在不对/转义的情况下匹配p标签内容</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;p&gt;内容<span class=\"number\">1</span>&lt;/p&gt;&lt;p&gt;内容<span class=\"number\">2</span>&lt;/p&gt;</span><br><span class=\"line\">预期：</span><br><span class=\"line\">在分组<span class=\"number\">1</span>中匹配到内容<span class=\"number\">1</span>和内容<span class=\"number\">2</span></span><br><span class=\"line\">正则：@&lt;p&gt;(.*?)&lt;/p&gt;@m</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"匹配溢出排除\"><a href=\"#匹配溢出排除\" class=\"headerlink\" title=\"匹配溢出排除\"></a>匹配溢出排除</h3><p>匹配溢出，这不是一个术语名词，是我自己的叫法，主要指正则匹配内容超出了我们预期，导致匹配得到非预期的结果。</p>\n<h4 id=\"div标签匹配溢出\"><a href=\"#div标签匹配溢出\" class=\"headerlink\" title=\"div标签匹配溢出\"></a>div标签匹配溢出</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配内容为数字的div</span><br><span class=\"line\">源串：</span><br><span class=\"line\">&lt;div <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">aaa</span> <span class=\"title\">bbb</span>&quot;&gt;<span class=\"title\">ABC</span>&lt;/<span class=\"title\">div</span>&gt;&lt;<span class=\"title\">div</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">bbb</span> <span class=\"title\">ccc</span>&quot;&gt;123&lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">预期：</span></span><br><span class=\"line\"><span class=\"class\">&lt;<span class=\"title\">div</span>&gt;123&lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">错误正则：/&lt;<span class=\"title\">div</span>.*?&gt;\\<span class=\"title\">d</span>+&lt;\\/<span class=\"title\">div</span>&gt;/</span></span><br><span class=\"line\"><span class=\"class\">正则：/&lt;<span class=\"title\">div</span>[^&gt;]*&gt;\\<span class=\"title\">d</span>+&lt;\\/<span class=\"title\">div</span>&gt;/</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"多字符排除\"><a href=\"#多字符排除\" class=\"headerlink\" title=\"多字符排除\"></a>多字符排除</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配不包含某个单词或词语的内容</span><br><span class=\"line\">源串：</span><br><span class=\"line\">http:<span class=\"comment\">//www.zjmainstay.cn</span></span><br><span class=\"line\">http:<span class=\"comment\">//www.baidu.com</span></span><br><span class=\"line\">http:<span class=\"comment\">//www.qq.com</span></span><br><span class=\"line\">预期：</span><br><span class=\"line\">http:<span class=\"comment\">//www.zjmainstay.cn</span></span><br><span class=\"line\">http:<span class=\"comment\">//www.qq.com</span></span><br><span class=\"line\">正则：/(http:\\/\\/www.((?!baidu).)+(cn|com))/</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"多字符排除-1\"><a href=\"#多字符排除-1\" class=\"headerlink\" title=\"多字符排除\"></a>多字符排除</h4>   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：匹配不包含某个单词或词语的内容</span><br><span class=\"line\">源串：</span><br><span class=\"line\"><span class=\"title function_ invoke__\">A</span>(<span class=\"string\">&quot;Excalibur&quot;</span>, <span class=\"string\">&quot;誓约胜利之剑&quot;</span>, LONG_SWORD, (SPFX_NOGEN | SPFX_RESTR | SPFX_SEEK | SPFX_DEFN | SPFX_INTEL | SPFX_SEARCH), </span><br><span class=\"line\">  <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"title function_ invoke__\">PHYS</span>(<span class=\"number\">5</span>, <span class=\"number\">10</span>), <span class=\"title function_ invoke__\">DRLI</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>), NO_CARY, <span class=\"number\">0</span>, A_LAWFUL, PM_KNIGHT, NON_PM, <span class=\"number\">4000</span>L, NO_COLOR);</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Stormbringer only has a 2 because it can drain a level,</span></span><br><span class=\"line\"><span class=\"comment\"> * providing 8 more.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">A</span>(<span class=\"string\">&quot;Stormbringer&quot;</span>, <span class=\"string\">&quot;兴风者&quot;</span>, RUNESWORD,</span><br><span class=\"line\">  (SPFX_RESTR | SPFX_ATTK | SPFX_DEFN | SPFX_INTEL | SPFX_DRLI), <span class=\"number\">0</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">  <span class=\"title function_ invoke__\">DRLI</span>(<span class=\"number\">5</span>, <span class=\"number\">2</span>), <span class=\"title function_ invoke__\">DRLI</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>), NO_CARY, <span class=\"number\">0</span>, A_CHAOTIC, NON_PM, NON_PM, <span class=\"number\">8000</span>L,</span><br><span class=\"line\">  NO_COLOR);</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Mjollnir will return to the hand of the wielder when thrown</span></span><br><span class=\"line\"><span class=\"comment\"> * if the wielder is a Valkyrie wearing Gauntlets of Power.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">A</span>(<span class=\"string\">&quot;Mjollnir&quot;</span>, <span class=\"string\">&quot;雷神之锤&quot;</span>, WAR_HAMMER, <span class=\"comment\">/* Mjo:llnir */</span></span><br><span class=\"line\">  (SPFX_RESTR | SPFX_ATTK), <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"title function_ invoke__\">ELEC</span>(<span class=\"number\">5</span>, <span class=\"number\">24</span>), NO_DFNS, NO_CARY, <span class=\"number\">0</span>,</span><br><span class=\"line\">  A_NEUTRAL, PM_VALKYRIE, NON_PM, <span class=\"number\">4000</span>L, NO_COLOR);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">A</span>(<span class=\"string\">&quot;Cleaver&quot;</span>, <span class=\"string\">&quot;撕裂者&quot;</span>, BATTLE_AXE, SPFX_RESTR, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"title function_ invoke__\">PHYS</span>(<span class=\"number\">3</span>, <span class=\"number\">6</span>), NO_DFNS, NO_CARY, <span class=\"number\">0</span>, A_NEUTRAL, PM_BARBARIAN, NON_PM, <span class=\"number\">1500</span>L, NO_COLOR);</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Grimtooth glows in warning when elves are present, but its</span></span><br><span class=\"line\"><span class=\"comment\"> * damage bonus applies to all targets rather than just elves</span></span><br><span class=\"line\"><span class=\"comment\"> * (handled as special case in spec_dbon()).</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">A</span>(<span class=\"string\">&quot;Grimtooth&quot;</span>, <span class=\"string\">&quot;邪兽之牙&quot;</span>, ORCISH_DAGGER, (SPFX_RESTR | SPFX_WARN | SPFX_DFLAG2),</span><br><span class=\"line\">  <span class=\"number\">0</span>, M2_ELF, <span class=\"title function_ invoke__\">PHYS</span>(<span class=\"number\">2</span>, <span class=\"number\">6</span>), NO_DFNS,</span><br><span class=\"line\">  NO_CARY, <span class=\"number\">0</span>, A_CHAOTIC, NON_PM, PM_ORC, <span class=\"number\">300</span>L, CLR_RED);</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Orcrist and Sting have same alignment as elves.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * The combination of SPFX_WARN+SPFX_DFLAG2+M2_value will trigger</span></span><br><span class=\"line\"><span class=\"comment\"> * EWarn_of_mon for all monsters that have the M2_value flag.</span></span><br><span class=\"line\"><span class=\"comment\"> * Sting and Orcrist will warn of M2_ORC monsters.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">A</span>(<span class=\"string\">&quot;Orcrist&quot;</span>, <span class=\"string\">&quot;杀兽剑&quot;</span>, ELVEN_BROADSWORD, (SPFX_WARN | SPFX_DFLAG2), <span class=\"number\">0</span>, M2_ORC, <span class=\"title function_ invoke__\">PHYS</span>(<span class=\"number\">5</span>, <span class=\"number\">0</span>), </span><br><span class=\"line\">  NO_DFNS, NO_CARY, <span class=\"number\">0</span>, A_CHAOTIC, NON_PM, PM_ELF, <span class=\"number\">2000</span>L, CLR_BRIGHT_BLUE); <span class=\"comment\">/* bright blue is actually light blue */</span></span><br><span class=\"line\">预期：</span><br><span class=\"line\">Excalibur=誓约胜利之剑</span><br><span class=\"line\">Stormbringer=兴风者</span><br><span class=\"line\">Mjollnir=雷神之锤</span><br><span class=\"line\">Cleaver=撕裂者</span><br><span class=\"line\">Grimtooth=邪兽之牙</span><br><span class=\"line\">Orcrist=杀兽剑</span><br><span class=\"line\">查找：<span class=\"variable\">$re</span> = <span class=\"string\">&#x27;/&quot;(\\w+)&quot;(,)\\s&quot;([\\x&#123;4e00&#125;-\\x&#123;9fa5&#125;]+)&quot;/u&#x27;</span>;</span><br><span class=\"line\">替换：<span class=\"variable\">$subst</span> = <span class=\"string\">&#x27;$1=$3&#x27;</span>;</span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">preg_replace</span>(<span class=\"variable\">$re</span>, <span class=\"variable\">$subst</span>, <span class=\"variable\">$str</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"环视循环提取格式化\"><a href=\"#环视循环提取格式化\" class=\"headerlink\" title=\"环视循环提取格式化\"></a>环视循环提取格式化</h3><p>在数据处理过程中，经常遇到一些格式化处理，比如简单地将一批数据格式化为SQL（参考9.2），还有复杂的需要对一行数据的某部分进行循环提取，然后格式化为特定格式。</p>\n   <figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\">需求：循环提取每行数据的分支部分和固定部分，格式化为特定格式</span><br><span class=\"line\">源串：</span><br><span class=\"line\">BBB|CCC|DDD=AAA</span><br><span class=\"line\">FFF|GGG|HHH|III|JJJ|KKK=EEE</span><br><span class=\"line\">预期：</span><br><span class=\"line\">BBB=AAA</span><br><span class=\"line\">CCC=AAA</span><br><span class=\"line\">DDD=AAA</span><br><span class=\"line\">FFF=EEE</span><br><span class=\"line\">GGG=EEE</span><br><span class=\"line\">HHH=EEE</span><br><span class=\"line\">III=EEE</span><br><span class=\"line\">JJJ=EEE</span><br><span class=\"line\">KKK=EEE</span><br><span class=\"line\">查找：/\\|(?=.*(=.*))/</span><br><span class=\"line\">替换：$<span class=\"number\">1</span>\\\\n</span><br><span class=\"line\">$<span class=\"number\">1</span> 表示引用正则表达式第一个子模式</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"三段论应用\"><a href=\"#三段论应用\" class=\"headerlink\" title=\"三段论应用\"></a>三段论应用</h3><p>​    <strong>三段论</strong>，是本人根据对正则的理解，归纳出来的三句话：<strong>定锚点</strong>，<strong>去噪点</strong>，<strong>取数据</strong>。<br><strong>锚点</strong>，在正则中指^、$、\\b这类零宽的位置，这里做了衍生，指能够唯一确定我们目标数据位置的参照点，比如author&#x3D;Zjmainstay，我们要匹配author属性的数据，则author&#x3D;就是我们的参照点，通过它，我们能快速写出提取author属性的数据的正则：author&#x3D;(.+)。 </p>\n<p><strong>噪点</strong>，就是对我们提取数据产生干扰的无关数据，我们在做正则匹配提取数据的过程中，可以选择性的忽略它们。当然，这里的忽略不是指不需要对它们做匹配，而是不需要对它们做精确匹配。比如，<a class=\"some-class-1 some-class-xxx\" style=\"border:1px solid\" href=\"http://www.zjmainstay.cn/regexp\" title=\"正则表达式教程\">正则表达式</a>，我们要提取a标签的url和文本（正则表达式），这时候，a标签上的class、style、title这些属性，对我们来说就没有意义了，它们就是噪点，在匹配过程中我们可以选择性的忽略它们（使用通配符进行匹配消耗掉它们），因此得到正则：&lt;a [^&gt;]<em>?href&#x3D;”([^”]+)”[^&gt;]</em>&gt;(.*?)</a></p>\n<p><strong>数据</strong>，这个当然是指我们需要提取的内容了，如上面锚点举例，我们通过author&#x3D;(.+)的(.+)对Zjmainstay部分数据进行了提取，因此，匹配结果的分组1（程序语言中的数组下标1）中，就能得到我们的结果。而对于多个数据的提取，如噪点举例，我们只需要针对数据部分进行多个分组（括号）的提取即可。<br>分组的计数，一般可以数左括号，排除环视和非捕获组的左括号，从1开始，依次加1递增，1,2,3,4….n，不同语言最大分组个数不同，大家在使用过程中自行留意，不过一般用不了那么多分组。<br>理解了三段论的概念，我们在写正则的过程中，只需要将源串进行分割划分，根据目标数据确定锚点，过滤噪点，提取数据，就能得到我们想要的正则了。</p>\n<h3 id=\"练习题地址\"><a href=\"#练习题地址\" class=\"headerlink\" title=\"练习题地址\"></a><a href=\"https://www.zybuluo.com/Zjmainstay/note/709093\" target=\"_blank\">练习题地址</a></h3>","tags":["正则"]},{"title":"用户及用户组管理","url":"/2017/12/02/%E7%94%A8%E6%88%B7%E5%8F%8A%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">/etc/passwd      存储用户账号</span><br><span class=\"line\">/etc/group       存储组账号</span><br><span class=\"line\">/etc/shadow      存储用户账号的密码</span><br><span class=\"line\">/etc/gshadow     存储用户组账号的密码</span><br><span class=\"line\">useradd   用户名</span><br><span class=\"line\">userdel   用户名</span><br><span class=\"line\">adduser   用户名</span><br><span class=\"line\">groupadd  组名</span><br><span class=\"line\">groupdel  组名</span><br><span class=\"line\">passwd root     给root设置密码</span><br><span class=\"line\">su root</span><br><span class=\"line\">su - root</span><br><span class=\"line\">/etc/profile     系统环境变量</span><br><span class=\"line\">bash_profile     用户环境变量</span><br><span class=\"line\">.bashrc          用户环境变量</span><br><span class=\"line\">su user          切换用户，加载配置文件.bashrc</span><br><span class=\"line\">su - user        切换用户，加载配置文件/etc/profile ，加载bash_profile</span><br><span class=\"line\">更改文件的用户及用户组</span><br><span class=\"line\">sudo <span class=\"built_in\">chown</span> [-R] owner[:group] &#123;File|Directory&#125;</span><br><span class=\"line\">例如：还以jdk-7u21-linux-i586.tar.gz为例。属于用户hadoop，组hadoop</span><br><span class=\"line\">要想切换此文件所属的用户及组。可以使用命令。</span><br><span class=\"line\">sudo <span class=\"built_in\">chown</span> root:root jdk-7u21-linux-i586.tar.gz</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"编译安装redis","url":"/2018/01/08/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85redis/","content":"<h5 id=\"一-安装Redis\"><a href=\"#一-安装Redis\" class=\"headerlink\" title=\"一.安装Redis\"></a>一.安装Redis</h5><p>(1) cd &#x2F;usr&#x2F;src 进入下载目录</p>\n<p>(1) yum install -y wget gcc make tcl 安装依赖</p>\n<p>(2) redis官网<a href=\"http://www.redis.io下载最新的源码包/\">http://www.redis.io下载最新的源码包</a></p>\n<p>(3) tar -zxvf redis-3.2.2.tar.gz     解压</p>\n<p>(4) cd redis-3.2.2    进入redis目录</p>\n<p>(5) make  编辑</p>\n<p>(6) make test 测试</p>\n<p>测试过程报错</p>\n<p>[exception]: Executing test client: NOREPLICAS Not enough good slaves to write..<br>NOREPLICAS Not enough good slaves to write.<br>while executing</p>\n<p>这种情况下，可以修改当前目录文件tests&#x2F;integration&#x2F;replication-2.tcl，将after 1000改为after 10000以延长等待时间 重新测试</p>\n<p>(7)make install PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;redis    PREFIX安装指定目录 否则安装到&#x2F;usr&#x2F;local&#x2F;bin里面了</p>\n<p>(8)启动redis服务 .&#x2F;redis-server .&#x2F;redis-conf</p>\n<p><img src=\"https://raw.githubusercontent.com/zhaoguibin/hexo_blog_files/master/redis.png\" alt=\"redis\"></p>\n<span id=\"more\"></span>\n\n<p>发现很多错误：</p>\n<ol>\n<li><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">WARNING: The TCP backlog setting of 511 cannot be enforced because</span><br><span class=\"line\">/proc/sys/net/core/somaxconn is <span class=\"built_in\">set</span> to the lower value of 128</span><br></pre></td></tr></table></figure></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> 511 &gt; /proc/sys/net/core/somaxconn</span><br></pre></td></tr></table></figure>\n<p>写到&#x2F;etc&#x2F;rc.local里面   rc.local 是开机启动程序 是一个软连接  （确定两者都有执行权限）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">lrwxrwxrwx. 1 root root 13 Aug  2 07:50 /etc/rc.local -&gt; rc.d/rc.local</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">WARNING overcommit_memory is <span class=\"built_in\">set</span> to 0! Background save may fail under low memory</span><br><span class=\"line\">condition. To fix this issue add <span class=\"string\">&#x27;vm.overcommit_memory = 1&#x27;</span> to /etc/sysctl.conf and</span><br><span class=\"line\"><span class=\"keyword\">then</span> reboot or run the <span class=\"built_in\">command</span> <span class=\"string\">&#x27;sysctl vm.overcommit_memory=1&#x27;</span> <span class=\"keyword\">for</span> this to take effect.</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>往&#x2F;etc&#x2F;sysctl.conf 中添加vm.overcommit_memory &#x3D; 1</p>\n<ol start=\"3\">\n<li><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">WARNING you have Transparent Huge Pages (THP) support enabled <span class=\"keyword\">in</span> your kernel. This</span><br><span class=\"line\">will create latency and memory usage issues with Redis. To fix this issue run the</span><br><span class=\"line\"><span class=\"built_in\">command</span> <span class=\"string\">&#x27;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#x27;</span> as root, and add</span><br><span class=\"line\">it to your /etc/rc.local <span class=\"keyword\">in</span> order to retain the setting after a reboot. Redis must</span><br><span class=\"line\">be restarted after THP is disabled.</span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>echo never &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled 写到&#x2F;etc&#x2F;rc.local里面</p>\n<p>还有想在后台运行的话修改配置redis.conf   daemonize yes 就可以了</p>\n<p>(9)运行.&#x2F;redis-cli</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">./redis-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> 1 2</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; get 1</span><br><span class=\"line\"><span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; quit</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"二-Redis配置说明\"><a href=\"#二-Redis配置说明\" class=\"headerlink\" title=\"二.Redis配置说明\"></a>二.Redis配置说明</h5><ol>\n<li><p>Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程</p>\n<p> daemonize no</p>\n</li>\n<li><p>当Redis以守护进程方式运行时，Redis默认会把pid写入&#x2F;var&#x2F;run&#x2F;redis.pid文件，可以通过pidfile指定</p>\n<p> pidfile &#x2F;var&#x2F;run&#x2F;redis.pid</p>\n</li>\n<li><p>指定Redis监听端口，默认端口为6379，作者在自己的一篇博文中解释了为什么选用6379作为默认端口，因为6379在手机按键上MERZ对应的号码，而MERZ取自意大利歌女Alessia Merz的名字</p>\n<p> port 6379</p>\n</li>\n<li><p>绑定的主机地址</p>\n<p> bind 127.0.0.1</p>\n</li>\n<li><p>当 客户端闲置多长时间后关闭连接，如果指定为0，表示关闭该功能</p>\n<p> timeout 300</p>\n</li>\n<li><p>指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose</p>\n<p> loglevel verbose</p>\n</li>\n<li><p>日志记录方式，默认为标准输出，如果配置Redis为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给&#x2F;dev&#x2F;null</p>\n<p> logfile stdout</p>\n</li>\n<li><p>设置数据库的数量，默认数据库为0，可以使用SELECT <dbid>命令在连接上指定数据库id</p>\n<p> databases 16</p>\n</li>\n<li><p>指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</p>\n<p> save <seconds> <changes></p>\n<p> Redis默认配置文件中提供了三个条件：</p>\n<p> save 900 1</p>\n<p> save 300 10</p>\n<p> save 60 10000</p>\n<p> 分别表示900秒（15分钟）内有1个更改，300秒（5分钟）内有10个更改以及60秒内有10000个更改。</p>\n</li>\n<li><p>指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大</p>\n<p>rdbcompression yes</p>\n</li>\n<li><p>指定本地数据库文件名，默认值为dump.rdb</p>\n<p>dbfilename dump.rdb</p>\n</li>\n<li><p>指定本地数据库存放目录</p>\n<p>dir .&#x2F;</p>\n</li>\n<li><p>设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步</p>\n<p>slaveof <masterip> <masterport></p>\n</li>\n<li><p>当master服务设置了密码保护时，slav服务连接master的密码</p>\n<p>masterauth <master-password></p>\n</li>\n<li><p>设置Redis连接密码，如果配置了连接密码，客户端在连接Redis时需要通过AUTH <password>命令提供密码，默认关闭</p>\n<p>requirepass foobared</p>\n</li>\n<li><p>设置同一时间最大客户端连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息</p>\n<p>maxclients 128</p>\n</li>\n<li><p>指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区</p>\n<p>maxmemory <bytes></p>\n</li>\n<li><p>指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis本身同步数据文件是按上面save条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为no</p>\n<p>appendonly no</p>\n</li>\n<li><p>指定更新日志文件名，默认为appendonly.aof</p>\n<p> appendfilename appendonly.aof</p>\n</li>\n<li><p>指定更新日志条件，共有3个可选值：<br>no：表示等操作系统进行数据缓存同步到磁盘（快）<br>always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）<br>everysec：表示每秒同步一次（折衷，默认值）</p>\n<p>appendfsync everysec</p>\n</li>\n<li><p>指定是否启用虚拟内存机制，默认值为no，简单的介绍一下，VM机制将数据分页存放，由Redis将访问量较少的页即冷数据swap到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析Redis的VM机制）</p>\n<p> vm-enabled no</p>\n</li>\n<li><p>虚拟内存文件路径，默认值为&#x2F;tmp&#x2F;redis.swap，不可多个Redis实例共享</p>\n<p> vm-swap-file &#x2F;tmp&#x2F;redis.swap</p>\n</li>\n<li><p>将所有大于vm-max-memory的数据存入虚拟内存,无论vm-max-memory设置多小,所有索引数据都是内存存储的(Redis的索引数据 就是keys),也就是说,当vm-max-memory设置为0的时候,其实是所有value都存在于磁盘。默认值为0</p>\n<p> vm-max-memory 0</p>\n</li>\n<li><p>Redis swap文件分成了很多的page，一个对象可以保存在多个page上面，但一个page上不能被多个对象共享，vm-page-size是要根据存储的 数据大小来设定的，作者建议如果存储很多小对象，page大小最好设置为32或者64bytes；如果存储很大大对象，则可以使用更大的page，如果不 确定，就使用默认值</p>\n<p> vm-page-size 32</p>\n</li>\n<li><p>设置swap文件中的page数量，由于页表（一种表示页面空闲或使用的bitmap）是在放在内存中的，，在磁盘上每8个pages将消耗1byte的内存。</p>\n<p> vm-pages 134217728</p>\n</li>\n<li><p>设置访问swap文件的线程数,最好不要超过机器的核数,如果设置为0,那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为4</p>\n<p> vm-max-threads 4</p>\n</li>\n<li><p>设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启</p>\n<p>glueoutputbuf yes</p>\n</li>\n<li><p>指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</p>\n<p>hash-max-zipmap-entries 64</p>\n<p>hash-max-zipmap-value 512</p>\n</li>\n<li><p>指定是否激活重置哈希，默认为开启（后面在介绍Redis的哈希算法时具体介绍）</p>\n<p>activerehashing yes</p>\n</li>\n<li><p>指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</p>\n<p>include &#x2F;path&#x2F;to&#x2F;local.conf</p>\n</li>\n</ol>\n<h5 id=\"增加服务并开机启动\"><a href=\"#增加服务并开机启动\" class=\"headerlink\" title=\"增加服务并开机启动\"></a>增加服务并开机启动</h5><p>redis启动脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#chkconfig: 2345 55 25</span></span><br><span class=\"line\"><span class=\"comment\">#description: Starts,stops and restart the redis-server</span></span><br><span class=\"line\"><span class=\"comment\">#Ver:1.1  </span></span><br><span class=\"line\"><span class=\"comment\">#Write by ND chengh(200808)</span></span><br><span class=\"line\"><span class=\"comment\">#usage: ./script_name -p [port] &#123;start|stop|status|restart&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Source function library.</span></span><br><span class=\"line\">. /etc/rc.d/init.d/functions</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Source networking configuration.</span></span><br><span class=\"line\">. /etc/sysconfig/network</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Check networking is up.</span></span><br><span class=\"line\">[ <span class=\"string\">&quot;<span class=\"variable\">$NETWORKING</span>&quot;</span> = <span class=\"string\">&quot;no&quot;</span> ] &amp;&amp; <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"></span><br><span class=\"line\">RETVAL=0</span><br><span class=\"line\">REDIS_PORT=6379</span><br><span class=\"line\">PID=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> = <span class=\"string\">&quot;-p&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    REDIS_PORT=<span class=\"variable\">$2</span></span><br><span class=\"line\">    <span class=\"built_in\">shift</span> 2</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">REDIS_DIR=<span class=\"string\">&quot;/opt/local/redis&quot;</span></span><br><span class=\"line\">REDIS=<span class=\"string\">&quot;<span class=\"variable\">$&#123;REDIS_DIR&#125;</span>/bin/redis-server&quot;</span></span><br><span class=\"line\">PROG=$(<span class=\"built_in\">basename</span> <span class=\"variable\">$REDIS</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">CONF=<span class=\"string\">&quot;<span class=\"variable\">$&#123;REDIS_DIR&#125;</span>/etc/redis-<span class=\"variable\">$&#123;REDIS_PORT&#125;</span>.conf&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -f <span class=\"variable\">$CONF</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -f <span class=\"string\">&quot;<span class=\"variable\">$&#123;REDIS_DIR&#125;</span>/etc/redis.conf&quot;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">      CONF=<span class=\"string\">&quot;<span class=\"variable\">$&#123;REDIS_DIR&#125;</span>/etc/redis.conf&quot;</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;<span class=\"variable\">$CONF</span> not exist.&quot;</span>;warning;<span class=\"built_in\">echo</span></span><br><span class=\"line\">      <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">PID_FILE=`grep <span class=\"string\">&quot;pidfile&quot;</span> <span class=\"variable\">$&#123;CONF&#125;</span>|<span class=\"built_in\">cut</span> -d <span class=\"string\">&#x27; &#x27;</span> -f2`</span><br><span class=\"line\">PID_FILE=<span class=\"variable\">$&#123;PID_FILE:=/var/run/redis.pid&#125;</span></span><br><span class=\"line\">LOCKFILE=<span class=\"string\">&quot;/var/lock/subsys/redis-<span class=\"variable\">$&#123;REDIS_PORT&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -x <span class=\"variable\">$REDIS</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;<span class=\"variable\">$REDIS</span> not exist.&quot;</span>;warning;<span class=\"built_in\">echo</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">start</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Starting <span class=\"variable\">$PROG</span>: &quot;</span></span><br><span class=\"line\">    <span class=\"variable\">$REDIS</span> <span class=\"variable\">$CONF</span></span><br><span class=\"line\">    RETVAL=$?</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$RETVAL</span> -eq 0 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        success;<span class=\"built_in\">echo</span>;<span class=\"built_in\">touch</span> <span class=\"variable\">$LOCKFILE</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        failure;<span class=\"built_in\">echo</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">stop</span></span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Stopping <span class=\"variable\">$PROG</span>: &quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ -f <span class=\"variable\">$PID_FILE</span> ] ;<span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">read</span> PID &lt;  <span class=\"string\">&quot;<span class=\"variable\">$PID_FILE</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      failure;<span class=\"built_in\">echo</span>;</span><br><span class=\"line\">      <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;<span class=\"variable\">$PID_FILE</span> not found.&quot;</span>;failure;<span class=\"built_in\">echo</span></span><br><span class=\"line\">      <span class=\"built_in\">return</span> 1;</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> checkpid <span class=\"variable\">$PID</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">kill</span> -TERM <span class=\"variable\">$PID</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ <span class=\"variable\">$RETVAL</span> -eq 0 ] ;<span class=\"keyword\">then</span></span><br><span class=\"line\">                success;<span class=\"built_in\">echo</span></span><br><span class=\"line\">                <span class=\"built_in\">echo</span> -n <span class=\"string\">&quot;Waiting for Redis to shutdown ..&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> checkpid <span class=\"variable\">$PID</span>;<span class=\"keyword\">do</span></span><br><span class=\"line\">                <span class=\"built_in\">echo</span> -n <span class=\"string\">&quot;.&quot;</span></span><br><span class=\"line\">                <span class=\"built_in\">sleep</span> 1;</span><br><span class=\"line\">                <span class=\"keyword\">done</span></span><br><span class=\"line\">                success;<span class=\"built_in\">echo</span>;<span class=\"built_in\">rm</span> -f <span class=\"variable\">$LOCKFILE</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">                failure;<span class=\"built_in\">echo</span></span><br><span class=\"line\">        <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -n $<span class=\"string\">&quot;Redis is dead and <span class=\"variable\">$PID_FILE</span> exists.&quot;</span>;failure;<span class=\"built_in\">echo</span></span><br><span class=\"line\">        RETVAL=7</span><br><span class=\"line\">    <span class=\"keyword\">fi</span>    </span><br><span class=\"line\">    <span class=\"built_in\">return</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">restart</span></span>() &#123;</span><br><span class=\"line\">    stop</span><br><span class=\"line\">    start</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">rhstatus</span></span>() &#123;</span><br><span class=\"line\">    status -p <span class=\"variable\">$&#123;PID_FILE&#125;</span> <span class=\"variable\">$PROG</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">hid_status</span></span>() &#123;</span><br><span class=\"line\">    rhstatus &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">&quot;<span class=\"variable\">$1</span>&quot;</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">    start)</span><br><span class=\"line\">        hid_status &amp;&amp; <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">        start</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">    stop)</span><br><span class=\"line\">        rhstatus || <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">        stop</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">    restart)</span><br><span class=\"line\">        restart</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">    status)</span><br><span class=\"line\">        rhstatus</span><br><span class=\"line\">        RETVAL=$?</span><br><span class=\"line\">        ;;</span><br><span class=\"line\">    *)</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> $<span class=\"string\">&quot;Usage: <span class=\"variable\">$0</span> -p [port] &#123;start|stop|status|restart&#125;&quot;</span></span><br><span class=\"line\">        RETVAL=1</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">exit</span> <span class=\"variable\">$RETVAL</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>把redis脚本文件放在 &#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F; 目录下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> +x /etc/rc.d/init.d/redis</span><br><span class=\"line\">chkconfig --add redis</span><br><span class=\"line\">chkconfig --level 345 redis on</span><br><span class=\"line\">chkconfig --list redis</span><br></pre></td></tr></table></figure>\n","tags":["linux","redis"]},{"title":"编辑-自定义命令","url":"/2017/12/03/%E7%BC%96%E8%BE%91-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%91%BD%E4%BB%A4/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim ~/.bashrc</span><br><span class=\"line\">example:</span><br><span class=\"line\"><span class=\"built_in\">alias</span> codedir=<span class=\"string\">&#x27;cd /opt/local/www/project&#x27;</span></span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"网络连接以及下载","url":"/2017/12/03/%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E4%BB%A5%E5%8F%8A%E4%B8%8B%E8%BD%BD/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget 指定本定文件夹和保存为特定名称</span><br><span class=\"line\">1. 在shell 中执行以下命令</span><br><span class=\"line\">wget -P /root/test <span class=\"string\">&quot;http://www.baidu.com/index.html&quot;</span></span><br><span class=\"line\">会把 index.html 文件保存到 <span class=\"string\">&quot;/root/test&quot;</span> 目录下.</span><br><span class=\"line\">2. 执行</span><br><span class=\"line\">wget -O <span class=\"string\">&quot;baidu.html&quot;</span> <span class=\"string\">&quot;http://www.baidu.com/index.html&quot;</span></span><br><span class=\"line\">会把 index.hmtl 保存到当前目录, 命令为 <span class=\"string\">&quot;baidu.html&quot;</span>.</span><br><span class=\"line\">3. 执行</span><br><span class=\"line\">wget -P /root/test -O <span class=\"string\">&quot;baidu.html&quot;</span> <span class=\"string\">&quot;http://www.baidu.com/index.html&quot;</span></span><br><span class=\"line\">的结果和 2 相同, 并不会保存到 <span class=\"string\">&quot;/root/test&quot;</span> 目录下.</span><br><span class=\"line\">在linux命令下如何访问一个url？</span><br><span class=\"line\">1.elinks - lynx-like替代角色模式WWW的浏览器</span><br><span class=\"line\">例如：</span><br><span class=\"line\"> elinks --dump http://www.baidu.com</span><br><span class=\"line\">2.wget 这个会将访问的首页下载到本地</span><br><span class=\"line\">[root@el5-mq2 ~]<span class=\"comment\"># wget http://www.baidu.com</span></span><br><span class=\"line\">--2011-10-17 16:30:10--  http://www.baidu.com/</span><br><span class=\"line\">Resolving www.baidu.com... 119.75.218.45, 119.75.217.56</span><br><span class=\"line\">Connecting to www.baidu.com|119.75.218.45|:80... connected.</span><br><span class=\"line\">HTTP request sent, awaiting response... 200 OK</span><br><span class=\"line\">Length: 8403 (8.2K) [text/html]</span><br><span class=\"line\">Saving to: `index.html<span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">100%[==========================================================================================&gt;] 8,403       --.-K/s   in 0.01s</span></span><br><span class=\"line\"><span class=\"string\">2011-10-17 16:30:10 (648 KB/s) - `index.html&#x27;</span> saved [8403/8403]</span><br><span class=\"line\">3.curl会显示出源码</span><br><span class=\"line\">curl http://www.baidu.com/index.html</span><br><span class=\"line\">4.lynx（这个以前在群里面见有人讨论过，但是没有尝试过，想用的话还需要下载软件）</span><br><span class=\"line\">lynx http://www.baidu.com</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"装完Centos7提示Initial setup of CentOS Linux 7 (core)","url":"/2018/02/09/%E8%A3%85%E5%AE%8CCentos7%E6%8F%90%E7%A4%BAInitial%20setup%20of%20CentOS%20Linux%207%20(core)/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Initial setup of CentOS Linux 7 (core)</span><br><span class=\"line\"></span><br><span class=\"line\">1) [x] Creat user 2) [!] License information</span><br><span class=\"line\"></span><br><span class=\"line\">(no user will be created) (license not accepted)</span><br><span class=\"line\"></span><br><span class=\"line\">Please make your choice from above [<span class=\"string\">&#x27;q&#x27;</span> to quit | <span class=\"string\">&#x27;c&#x27;</span> to <span class=\"built_in\">continue</span> | <span class=\"string\">&#x27;r&#x27;</span> to refresh]:</span><br></pre></td></tr></table></figure>\n\n<p>解决方法：<br>输入“1”，按Enter键<br><br>输入“2”，按Enter键<br><br>输入“q”，按Enter键<br><br>输入“yes”，按Enter键</p>\n","tags":["linux"]},{"title":"解决MySQL出现 Waiting for table metadata lock 问题","url":"/2018/06/30/%E8%A7%A3%E5%86%B3MySQL%E5%87%BA%E7%8E%B0%20Waiting%20for%20table%20metadata%20lock%20%E9%97%AE%E9%A2%98/","content":"<p>前几天修改数据库表，结果数据库就卡死了，通过命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">show processlist</span><br></pre></td></tr></table></figure>\n<p>发现 Waiting for table metadata lock状态的连接，幸好这个状态的连接不多，kill掉这些连接就可以了。</p>\n<span id=\"more\"></span>\n\n<p>通过google之后知道MySQL在进行一些alter table等DDL(Data Definition Language)操作时，如果该表上有未提交的事务的话就会出现 Waiting for table metadata lock而一旦出现metadata lock，该表上的后续操作都会被阻塞。</p>\n<h5 id=\"查看未提交事务\"><a href=\"#查看未提交事务\" class=\"headerlink\" title=\"查看未提交事务\"></a>查看未提交事务</h5><p>从 information_schema.innodb_trx 表中查看当前未提交的事务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">select trx_state, trx_started, trx_mysql_thread_id, trx_query from information_schema.innodb_trx\\G</span><br></pre></td></tr></table></figure>\n<p>（\\G作为结束符时，MySQL Client会把结果以列模式展示，对于列比较长的表，展示更直观）</p>\n<p>字段意义：</p>\n<ul>\n<li>trx_state: 事务状态，一般为RUNNING</li>\n<li>trx_started: 事务执行的起始时间，若时间较长，则要分析该事务是否合理</li>\n<li>trx_mysql_thread_id: MySQL的线程ID，用于kill</li>\n<li>trx_query: 事务中的sql</li>\n</ul>\n<p>一般只要kill掉这些线程，DDL操作就不会Waiting for table metadata lock。</p>\n<h5 id=\"调整锁超时阈值\"><a href=\"#调整锁超时阈值\" class=\"headerlink\" title=\"调整锁超时阈值\"></a>调整锁超时阈值</h5><p>lock_wait_timeout 表示获取metadata lock的超时（单位为秒），允许的值范围为1到31536000（1年）。 默认值为31536000。详见 <a href=\"https://dev.mysql.com/doc/refman/5.6/en/server-system-variables.html#sysvar_lock_wait_timeout\">https://dev.mysql.com/doc/refman/5.6/en/server-system-variables.html#sysvar_lock_wait_timeout</a> 。默认值为一年！！！已哭瞎！将其调整为30分钟</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">set session lock_wait_timeout = 1800;</span><br><span class=\"line\">set global lock_wait_timeout = 1800;</span><br></pre></td></tr></table></figure>\n\n<p>好让出现该问题时快速故障（failfast）</p>\n<p><a href=\"https://blog.csdn.net/u013235478/article/details/68062939\" target=\"_blank\">借鉴与-https://blog.csdn.net/u013235478/article/details/68062939</a></p>\n","tags":["mysql"]},{"title":"解决\"configure error no acceptable C compiler found in $PATH\"","url":"/2018/01/02/%E8%A7%A3%E5%86%B3configure%20error%20no%20acceptable%20C%20compiler%20found%20in%20$PATH/","content":"<p>解决方法：<br>安装gcc</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install gcc</span><br></pre></td></tr></table></figure>\n","tags":["linux","gcc"]},{"title":"解决问题E-无法获得锁-var-lib-dpkg-lock-open-11-资源暂时不可用-E-无法锁定管理目录","url":"/2017/12/02/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98E-%E6%97%A0%E6%B3%95%E8%8E%B7%E5%BE%97%E9%94%81-var-lib-dpkg-lock-open-11-%E8%B5%84%E6%BA%90%E6%9A%82%E6%97%B6%E4%B8%8D%E5%8F%AF%E7%94%A8-E-%E6%97%A0%E6%B3%95%E9%94%81%E5%AE%9A%E7%AE%A1%E7%90%86%E7%9B%AE%E5%BD%95/","content":"<p>在用sudo apt-get update 更新时，终端提示:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">“E: 无法获得锁 /var/lib/dpkg/lock - open (11: 资源暂时不可用)</span><br><span class=\"line\">E: 无法锁定管理目录(/var/lib/dpkg/)，是否有其他进程正占用它？”</span><br></pre></td></tr></table></figure>\n<p>解决办法如下：</p>\n<p>1.终端输入 ps -aux ，列出进程。找到含有apt‘-get的进程，直接sudo kill PID。解决。</p>\n<p>2.强制解锁,命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">rm</span> /var/cache/apt/archives/lock</span><br><span class=\"line\">sudo <span class=\"built_in\">rm</span> /var/lib/dpkg/lock</span><br></pre></td></tr></table></figure>\n","tags":["linux"]},{"title":"迁移数据库：直接复制数据表文件到数据库","url":"/2017/12/03/%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9A%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%96%87%E4%BB%B6%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93/","content":"<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">把目的数据库里面的 *.err 文件，ib_logfile 文件删除</span><br><span class=\"line\">备注：经测试，源mysql的安装目录及数据文件目录 可以与 目标Mysql的安装目录及数据文件目录 不一致。</span><br><span class=\"line\">此时，只需要拷贝所需移动的dbname及<span class=\"string\">&#x27;mysql&#x27;</span>和<span class=\"string\">&#x27;ibdata1&#x27;</span>，即可。</span><br></pre></td></tr></table></figure>\n","tags":["mysql"]},{"title":"逢4进5,逢5进10。0,5值不变","url":"/2018/01/09/%E9%80%A24%E8%BF%9B5,%E9%80%A25%E8%BF%9B10%E3%80%820,5%E5%80%BC%E4%B8%8D%E5%8F%98/","content":"<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//逢4进5,逢5进10。0,5值不变</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ceiling</span>(<span class=\"params\"><span class=\"variable\">$number</span> = <span class=\"number\">0</span></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$number</span> == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//这里取出整数</span></span><br><span class=\"line\">    <span class=\"variable\">$number</span> = <span class=\"title function_ invoke__\">explode</span>(<span class=\"string\">&#x27;.&#x27;</span>,<span class=\"variable\">$number</span>);</span><br><span class=\"line\">    <span class=\"variable\">$number</span> = <span class=\"variable\">$number</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$cc</span> = <span class=\"variable\">$number</span>%<span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"variable\">$price</span> = <span class=\"variable\">$number</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"variable\">$cc</span> &gt; <span class=\"number\">5</span>)&#123;</span><br><span class=\"line\">        <span class=\"variable\">$price</span> = <span class=\"variable\">$number</span>+(<span class=\"number\">10</span>-<span class=\"variable\">$cc</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">elseif</span> (<span class=\"variable\">$cc</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$price</span> = <span class=\"variable\">$number</span>+(<span class=\"number\">5</span>-<span class=\"variable\">$cc</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$price</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","tags":["php"]}]